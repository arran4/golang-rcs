Legend:
  Type := { ... }  : Sequential structure (all fields required unless marked)
  Type := Unordered { ... } : Fields can appear in any order
  Type := { A; B; }: Choice/Interface implementation (A or B)
  {Type}*          : Sequence of zero or more Type
  Type?            : Optional field

DateTime := num;
File := {
	Admin: Unordered {
		Head: Num?;
		Branch: Num?;
		Access: bool?;
		AccessUsers: {ID}*;
		Symbols: {Symbol}*;
		Locks: {Lock}*;
		Strict: bool?;
		Integrity: @String@?;
		Comment: @String@?;
		Expand: @String@?;
	};
	RevisionHeads: {RevisionHead}*;
	Description: @String@;
	RevisionContents: {RevisionContent}*;
};
ID := idchar+;
Lock := {
	User: ID;
	Revision: Num;
};
NewPhrase := {
	Key: ID;
	Value: {PhraseValue}*;
};
Num := {digit|.} +;
PhraseValue := {
	SimpleString;
	QuotedString;
};
QuotedString := "@" {any_char}* "@" (doubled @);
RevisionContent := {
	Revision: Num;
	Data: Unordered {
		Log: @String@;
		Text: @String@;
	};
};
RevisionHead := {
	Revision: Num;
	Meta: Unordered {
		Date: DateTime;
		Author: ID;
		State: ID;
		Branches: {Num}*;
		NextRevision: Num;
		CommitID: Sym;
		Owner: {PhraseValue}*?;
		Group: {PhraseValue}*?;
		Permissions: {PhraseValue}*?;
		Hardlinks: {PhraseValue}*?;
		Deltatype: {PhraseValue}*?;
		Kopt: {PhraseValue}*?;
		Mergepoint: {PhraseValue}*?;
		Filename: {PhraseValue}*?;
		Username: {PhraseValue}*?;
		NewPhrases: {NewPhrase}*?;
	};
};
SimpleString := idchar+;
Sym := idchar+ (no dots);
Symbol := {
	Name: Sym;
	Revision: Num;
};
