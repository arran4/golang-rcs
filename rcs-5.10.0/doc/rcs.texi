\input texinfo @c -*-texinfo-*-
@c %**start of header
@setfilename rcs.info
@documentencoding UTF-8
@include version.texi
@settitle GNU RCS @value{VERSION}
@syncodeindex vr cp
@syncodeindex fn cp
@c %**end of header

@macro WFT
Walter F.@tie{}Tichy
@end macro

@macro repo
RCS file
@end macro

@macro TODO
@*@strong{TODO:}@w{ }
@end macro

@alias rcscommand = b

@macro usage {name, required-args}
@cindex @rcscommand{\name\} invocation
@cindex invocation, @rcscommand{\name\}
@example
\name\ [options] \required-args\
@end example
@end macro

@macro dispatchusage {disp, name, required-args}
@cindex @rcscommand{\name\} invocation
@cindex invocation, @rcscommand{\name\}
@display
@rcscommand{rcs \disp\} @t{[options] \required-args\}
(or ``@rcscommand{\name\}'' instead of ``@rcscommand{rcs \disp\}'')
@end display
@end macro

@macro noVN {command}
Note that @option{-V@var{n}} is @emph{not} a valid option for
@rcscommand{\command\}, in contrast to most other RCS commands
(@pxref{Misc common options}).
@end macro

@macro UCS {hex}
@t{U+\hex\}
@end macro

@copying
This manual is for GNU RCS (version @value{VERSION}, @value{UPDATED}).

Copyright @copyright{} 2010--2020 Thien-Thi Nguyen

@quotation
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, with no Front-Cover Texts, and with no Back-Cover
Texts.  A copy of the license is included in the appendix entitled
``GNU Free Documentation License''.
@end quotation
@end copying

@dircategory Version control
@direntry
* RCS: (rcs).                   GNU Revision Control System.
@end direntry

@titlepage
@title GNU RCS
@subtitle for version @value{VERSION}, @value{UPDATED}
@author Thien-Thi Nguyen
@page
@vskip 0pt plus 1filll
@insertcopying
@end titlepage

@contents


@ifnottex
@node Top
@top GNU RCS

@insertcopying
@end ifnottex

@menu
* Overview::            General purpose and information.
* Usage::               How to use RCS.
* Hacking::             With source, you can help improve things.
* GNU FDL::             Copying and sharing this documentation.
* Index::

@detailmenu
--- The Detailed Node Listing ---

Overview
* Credits::             Who did what, and when.
* Concepts::            What is a revision?  How can RCS help?
* Quick tour::          A hands-on introduction to using RCS.

Usage
* Common elements::
* ci::
* co::
* ident::
* merge::
* rcs::
* rcsclean::
* rcsdiff::
* rcsmerge::
* rlog::

Common elements
* Revision options::
* Date option::
* Description option::
* Substitution mode option::
* Log message option::
* State option::
* Working file mtime option: minus-M.
* Misc common options::
* Delim-separated list::
* Environment::

Hacking
* File format::
* Stamp resolution::
* Still missing::
* Reporting bugs::
@end detailmenu
@end menu

@c ---------------------------------------------------------------------------
@node Overview
@chapter Overview

@cindex overview
@cindex comma-v file format
@cindex license

GNU RCS (Revision Control System) manages multiple revisions of
files.  RCS can store, retrieve, log, identify, and merge revisions.
It is useful for files that are revised frequently, e.g. programs,
documentation, graphics, and papers.  It can handle text as well as
binary files, although functionality is reduced for the latter.

A normal installation includes the commands: @rcscommand{ci},
@rcscommand{co}, @rcscommand{ident}, @rcscommand{merge},
@rcscommand{rcs}, @rcscommand{rcsclean}, @rcscommand{rcsdiff},
@rcscommand{rcsmerge} and @rcscommand{rlog} (@pxref{Usage}).
These are small and fast programs (amenable to scripting) and indeed the
distribution also includes the script @rcscommand{rcsfreeze} showing
some of the possibilities.

@cindex projects, related
RCS works with versions stored on a single filesystem or machine,
edited by one person at a time.  Other version control systems, such
as Bazaar (@url{http:///www.gnu.org/software/bazaar}), CVS,
Subversion, and Git, support distributed access in various ways.
Which is more appropriate depends on the task at hand.

@menu
* Credits::             Who did what, and when.
* Concepts::            What is a revision?  How can RCS help?
* Quick tour::          A hands-on introduction to using RCS.
@end menu

@node Credits
@section Credits
@cindex history
@cindex credits

@cindex Tichy, Walter F.
RCS was designed and built by @WFT{} of Purdue University.  RCS
version 3 was released in 1983.

Adam Hammer, Thomas Narten, and Daniel Trinkle of Purdue supported RCS
through version 4.3, released in 1990.  Guy Harris of Sun contributed
many porting fixes.  Paul Eggert of System Development Corporation
contributed bug fixes and tuneups.  Jay Lepreau contributed 4.3BSD
support.

Paul Eggert of Twin Sun wrote the changes for RCS versions 5.5 and
5.6 (1991).  Rich Braun of Kronos and Andy Glew of Intel contributed
ideas for new options.  Bill Hahn of Stratus contributed ideas for
setuid support.  Ideas for piece tables came from Joe Berkovitz of
Stratus and @WFT{}.  Matt Cross of Stratus contributed test case
ideas.  Adam Hammer of Purdue QAed.

Paul Eggert wrote most of the changes for RCS 5.7.  K.@tie{}Richard
Pixley of Cygnus Support contributed several bug fixes.  Robert
Lupton of Princeton and Daniel Trinkle contributed ideas for
@samp{$Name} expansion.  Brendan Kehoe of Cygnus Support suggested
rlog's @option{-N} option.  Paul D.@tie{}Smith of Data General
suggested improvements in option and error processing.  Adam Hammer
of Purdue QAed.

Thien-Thi Nguyen is responsible for RCS 5.8.  He modernized the code
base, build system, and manual pages, fixing some bugs on the way.  He
added standard @option{--help}, @option{--version} processing, and wrote
the documentation you are reading (gladly taking inspiration from the
paper@footnote{Source (troff) and several output formats are available
from the @url{http://www.gnu.org/software/rcs/, RCS homepage}.} and
manpages originally written by @WFT{}).

@node Concepts
@section Concepts

@subsection Interaction model
@cindex interaction model

@cindex interaction model
@cindex model, interaction
The interaction model is straightforward.  For each working file, you
initialize its @repo{} once, then enter a cycle of
checkout, modification, and checkin operations.  Along the
way, you can tweak some of the @repo{}'s metadata, as well.
All of this is done through RCS commands; you need not modify the
@repo{} directly (and in fact you should probably avoid doing so lest
RCS become confused).
This model is somewhat analogous to using a library (of books).
With a library, you sign up for a library card (initialize),
then enter a cycle of taking a book home (checkout),
enjoying it (NB: @strong{without} modification, one hopes),
and returning it to the library (checkin).

Furthermore, you can compare revisions in the @repo{}
against each other, examine the user- (hopefully high) quality
descriptions of the changes each revision embodies, merge
selected revisions, and so forth.

@subsection Working file

@cindex working file, instantiation
@cindex instantiating a working file
RCS commands operate on one pair of files at a time.  The
@dfn{working file} is what you normally view and edit (e.g., a
file of C programming language source code named @file{a.c}).
Because the working file's contents can be extracted from
the @repo{} (called @dfn{instantiating a working file}),
it can be safely deleted to regain some disk space.

@subsection RCS file

@cindex RCS file
@cindex description of working file
@cindex working file, description
The @dfn{RCS file} is a separate file, conventionally placed in the
subdirectory @file{RCS}, wherein RCS commands organize the initial and
subsequent @dfn{revisions} of the working file, associating with each
revision a unique revision number along with the remembered particulars
of the checkin that produced it.  It also contains a @dfn{description}
of the working file and various other metadata, described below.

The @repo{} is also known (colloquially) as the ``comma-v file'',
due to its name often ending in @file{,v} (e.g., @file{a.c,v}).

@cindex revision number
@cindex branch number
@cindex number, revision
@cindex number, branch
@cindex trunk
A @dfn{revision number} is a branch number followed by a dot followed by
an integer, and a @dfn{branch number} is an odd number of integers
separated by dot.  A revision number with one dot (implying a branch
number without any dots) is said to be @dfn{on the trunk}.  All integers
are positive.  For example:

@example
1.1         -- revision number for initial checkin (typically);
               branch number: 1

9.4.1.42    -- more complicated (perhaps after much gnarly hacking);
               branch number: 9.4.1

333.333.333 -- not a valid revision number;
               however, a perfectly valid branch number
@end example

@noindent
@cindex tip
@cindex branch tip
The @dfn{branch point} of a non-trunk branch is the revision number
formed by removing the branch's trailing integer.  To compute the
@dfn{next higher} branch or revision number, add one to the trailing
integer.  The highest-numbered revision on a branch is called the
@dfn{tip} of the branch (or @dfn{branch tip}).  Continuing the example:

@example
1.1         -- on trunk; no branch point;
               next higher branch number:   2
               next higher revision number: 1.2

@group
9.4.1.42    -- not on trunk; branch point:  9.4
               next higher branch number:   9.4.2
               next higher revision number: 9.4.1.43
@end group

333.333.333 -- not on trunk; branch point:  333.333
               next higher branch number:   333.333.334
               next higher revision number: 333.333.333.1
@end example

@noindent
@cindex tree of revisions
@cindex revisions, tree of
@cindex symbolic names
@cindex names, symbolic
@cindex default branch
@cindex branch, default
In addition to this ``tree'' of thus-linked revisions, the @repo{}
keeps track of the @dfn{default branch}, i.e., the branch whose tip
corresponds to the most recent checkin; as well as the @dfn{symbolic
names}, a list of associations between a user-supplied (and presumably
meaningful) symbol and an underlying branch or revision number.

@cindex locks in @repo{}
@cindex access control policy
The @repo{} contains two pieces of information used to implement its
@dfn{access control policy}.  The first is a list of usernames.  If
non-empty, only those users listed can modify the @repo{} (via RCS
commands).  The second is a list of @dfn{locks}, i.e., association
between a username and a revision number.  If a lock
@code{@var{username}:@var{revno}} exists, that means only @var{username}
may modify @var{revno} (that is, do a checkin operation to deposit the
next higher revision, or a higher revision number on the same branch as
@var{revno}).

@subsection Fundamental operations

@cindex checkin
The @dfn{checkin} operation records the contents of the working file in
the @repo{}, assigning it a new (normally the next higher) revision
number and recording the username, timestamp, @dfn{state} (a short
symbol), and user-supplied @dfn{log message} (a textual description of
the changes leading to that revision).  It uses @rcscommand{diff} to
find the differences between the tip of the default branch and the
working file, thereby writing the minimal amount of information needed
to be able to recreate the contents of the previous tip.

@cindex checkout
The @dfn{checkout} operation identifies a specific revision from the
@repo{} and either displays the content to standard output or
instantiates a working file, overwriting any current instantiation
with the selected revision.  In either case, the content may
undergo @dfn{keyword expansion}, which replaces text of the
form @samp{$Keyword$} with (possibly) different text comprising the
keyword and its @dfn{value}, depending on the current keyword expansion
mode (@pxref{Substitution mode option}).

@subsection Keywords

The keywords and their values are:

@cindex keywords, table of
@table @t
@vindex Author
@item Author
The login name of the user who checked in the revision.

@vindex Date
@item Date
The date and time the revision was checked in.
May include an appended timezone offset.

@vindex Header
@item Header
A standard header containing the absolute @repo{}name, the
revision number, the date and time, the author, the state, and the
locker (if locked).  May include an appended timezone offset.

@vindex Id
@item Id
Same as @samp{Header}, except that only the
basename appears (no directory components).

@vindex Locker
@item Locker
The login name of the user who locked the revision (empty if not locked).

@vindex Log
@item Log
The log message supplied during checkin, preceded by a header containing
the @repo{}name, the revision number, the author, and the date
and time.  May include an appended timezone offset.

Existing log messages are not replaced.
Instead, the new log message is inserted after @samp{$Log:...$}.
This is useful for accumulating a complete change log in a source file.

Each inserted line is prefixed by the string that prefixes the
@samp{$Log$} line.  For example, if the @samp{$Log$} line is

@example
// $Log: tan.cc $
@end example

@noindent
then RCS prefixes each line of the log
with @samp{// } (slash, slash, space).  This is useful for
languages with comments that go to the end of the line.

The convention for other languages is to use a @samp{ * }
(space, asterisk, space) prefix inside a multiline comment.  For
example, the initial log comment of a C program conventionally
is of the following form:

@example
 /*
  * $Log$
  */
@end example

For backwards compatibility with older versions of RCS, if the log
prefix is @samp{/*} or @samp{(*} surrounded by optional white space,
inserted log lines contain a space instead of @samp{/} or @samp{(};
however, this usage is obsolescent and should not be relied on.

@vindex Name
@item Name
The symbolic name used to check out the revision, if any.
For example, @samp{co -rJoe} generates @samp{$Name: Joe $}.
Plain @rcscommand{co} generates just @samp{$Name: $}.

@vindex RCSfile
@item RCSfile
The basename of the @repo{}.

@vindex Revision
@item Revision
The revision number assigned to the revision.

@vindex Source
@item Source
The absolute @repo{}name.

@vindex State
@item State
The state assigned to the revision with the @option{-s} option
of @rcscommand{rcs} or @rcscommand{ci}.
@end table

@node Quick tour
@section Quick tour

This section complements the preceding section (@pxref{Concepts}),
presenting a handful of RCS commands in quick succession.  For
details on individual RCS commands, @xref{Usage}.

Suppose you have a file @file{f.c} that you wish to put under
control of RCS.  If you have not already done so, make an @file{RCS}
directory with the command:

@example
mkdir RCS
@end example

@noindent
Then invoke the checkin command:

@example
ci f.c
@end example

@noindent
This command creates an @repo{} in directory @file{RCS}, stores
@file{f.c} into it as revision 1.1, and deletes @file{f.c}.  It
also asks you for a description.  The description should be a
synopsis of the contents of the file.  All later checkin
commands will ask you for a log entry, which should summarize
the changes that you made.

To get back the working file @file{f.c} in the previous example,
use the checkout command:

@example
co f.c
@end example

@noindent
This command extracts the latest revision from the @repo{}
and writes it into @file{f.c}.  If you want to edit @file{f.c},
you must lock it as you check it out, with the command:

@example
co -l f.c
@end example

@noindent
You can now edit @file{f.c}.  Suppose after some editing you want to
know what changes that you have made.  The command:

@example
rcsdiff f.c
@end example

@noindent
tells you the difference between the most recently checked-in
version and the working file.  You can check the file back in
by invoking:

@example
ci f.c
@end example

@noindent
This increments the revision number properly.
If @rcscommand{ci} complains with the message:

@example
ci error: no lock set by your name
@end example

@noindent
then you have tried to check in a file even though you did not
lock it when you checked it out.  Of course, it is too late now
to do the checkout with locking, because another checkout
would overwrite your modifications.  Instead, invoke:

@example
rcs -l f.c
@end example

@noindent
This command will lock the latest revision for you, unless
somebody else got ahead of you already.  In this case, you'll
have to negotiate with that person.

Locking assures that you, and only you, can check in the next
update, and avoids nasty problems if several people work on the
same file.  Even if a revision is locked, it can still be
checked out for reading, compiling, etc.  All that locking
prevents is a checkin by anybody but the locker.

@cindex strict locking
@cindex locking, strict
@cindex non-strict locking
@cindex locking, non-strict
If your @repo{} is private, i.e., if you are the only person
who is going to deposit revisions into it, strict locking is
not needed and you can turn it off.  If strict locking is
turned off, the owner of the @repo{} need not have a lock
for checkin; all others still do.  Turning strict locking off
and on is done with the commands:

@example
rcs -U f.c    # @r{disable strict locking}
rcs -L f.c    # @r{enable strict locking}
@end example

If you don't want to clutter your working directory with
@repo{}s, create a subdirectory called @file{RCS} in your working
directory, and move all your @repo{}s there.  RCS commands
will look first into that directory to find needed files.  All
the commands discussed above will still work, without any
modification.  @xref{Common elements}.

@cindex checkout, implicit
@cindex implicit checkout, circumstance
To avoid the deletion of the working file during checkin (in
case you want to continue editing or compiling), invoke one of:

@example
ci -l f.c     # @r{checkin + locked checkout}
ci -u f.c     # @r{checkin + unlocked checkout}
@end example

@noindent
These commands check in @file{f.c} as usual, then perform an
implicit checkout.  The first form also locks the checked in
revision, the second one doesn't.  Thus, these options save you
one checkout operation.  The first form is useful if you want
to continue editing, the second one if you just want to read
the file.  Both update the keyword substitutions in your
working file @pxref{Concepts}.

You can give @rcscommand{ci} the number you want assigned to a
checked-in revision.  Assume all your revisions were numbered
1.1, 1.2, 1.3, etc., and you would like to start release 2.
Either of the commands:

@example
ci -r2 f.c
ci -r2.1 f.c
@end example

@noindent
assigns the number 2.1 to the new revision.  From then on,
@rcscommand{ci} will number the subsequent revisions with 2.2,
2.3, etc.  The corresponding @rcscommand{co} commands:

@example
co -r2 f.c
co -r2.1 f.c
@end example

@noindent
retrieve the latest revision numbered 2.x and the revision 2.1,
respectively.  @rcscommand{co} without a revision number
selects the latest revision on the trunk, i.e. the highest
revision with a number consisting of two fields.  Numbers with
more than two fields are needed for branches.  For example, to
start a branch at revision 1.3, invoke:

@example
ci -r1.3.1 f.c
@end example

@noindent
This command starts a branch numbered 1 at revision 1.3, and
assigns the number 1.3.1.1 to the new revision.  Here is a diagram
showing the new revision in relation to its branch and the trunk.

@example
1.1  --  1.2  --  1.3  --  1.4  --  1.5
                   |
                [1.3.1]  --  1.3.1.1
@end example

@noindent
For more information about branches, @xref{Concepts}.


@c ---------------------------------------------------------------------------
@node Usage
@chapter Usage

This chapter describes how to invoke RCS commands, including common
command-line elements, as well options specific to each command.

@menu
* Common elements::
* ci::
* co::
* ident::
* merge::
* rcs::
* rcsclean::
* rcsdiff::
* rcsmerge::
* rlog::
@end menu

@node Common elements
@section Common elements

@cindex command help
@cindex command version
@noindent
All RCS commands accept @option{--help} and @option{--version}.
@xref{Command-Line Interfaces,,,standards,The GNU Coding Standards}.

Aside from @option{--help} and @option{--version}, RCS commands take the
form @samp{-@var{letter}[@var{arg}]}, i.e., a hyphen followed by a
single letter, optionally followed by extra information.  The square
braces mean that the extra information is optional.  (No square braces
means that the extra information is required.)  In any case, when
specified, the extra information @strong{must} abut the letter; there
can be no intervening whitespace.

@example
co -u 1.4 foo   # @r{wrong, space between} -u @r{and} 1.4
co -u1.4  foo   # @r{ok}
@end example

@noindent
@cindex order of options and file names
Furthermore, options must appear before file names (if any) on the
command line.

@example
ident foo -q    # @r{wrong, option after file name}
ident -q foo    # @r{ok}
@end example

@noindent
@cindex pairing RCS and working files
@cindex file names on the command-line
Lastly, pairs of RCS and working files can be specified
in three ways: (a) both are given, (b) only the working file is
given, (c) only the @repo{} is given.  For (a), both
RCS and working files may have arbitrary directory
components; RCS commands pair them up intelligently.  For (b),
RCS commands will look first into the directory @file{./RCS},
if it exists, to find the associated @repo{}.

@menu
* Revision options::
* Date option::
* Description option::
* Substitution mode option::
* Log message option::
* State option::
* Working file mtime option: minus-M.
* Misc common options::
* Delim-separated list::
* Environment::
@end menu

@node Revision options
@subsection Revision options

@cindex command-line option to specify a revision
@cindex specifying a revision
@cindex revision, specifying

As to be expected in a revision control system,
many options are of the form @samp{-@var{flag}[@var{rev}]},
where @var{flag} is a single letter (e.g., @samp{r}).
If ommitted, @var{rev} defaults to the latest revision
on the default branch.
A revision can be specified in many ways:

@table @t
@item @var{br}.@var{n}
Straightforward dot-notation, where @var{br} specifies the branch.

@item .@var{n}
Like @var{br}.@var{n}, using the default branch.

@item @var{br}
Like @var{br}.@var{n}, using the a command-specific computation of
@var{n}, given the current tip @var{i}.
@cindex branch growth
@cindex tip increment
For @rcscommand{ci} (@pxref{ci}), @var{n} would be @code{@var{i} + 1},
while for other commands @var{n} would be simply @var{i}.

@item @var{name}
This is the symbolic name of a revision, as assigned previously by a
@command{ci -n} or @command{ci -N} command.

@item $
@cindex $, special revision
@cindex special revision $
The command computes the effective revision by examining the values of
keyword expansions in the working file.
@end table

@cindex specifying a range of revisions
@cindex revision range, specifying
@cindex range of revisions, specifying
@noindent
For commands that accept a range of revisions, the syntax is
generally @code{@var{rev1}:@var{rev2}}, i.e., two revisions
(specified as described above) separated by a colon.

@node Date option
@subsection Date option

@cindex @samp{-d}
@cindex specifying a date
@cindex specifying a time/date
@cindex date, specifying
@cindex time/date, specifying
@cindex date formats
@cindex time zone

Some commands accept an option of the form @samp{-d@var{date}} to
specify a @dfn{date}, an absolute point in time (to second resolution),
expressed in a @dfn{date format}.  These also accept @samp{-z@var{zone}}
to specify the timezone.  The special value @samp{LT} stands for the
@dfn{local time zone}.  RCS recognizes many date formats and time
zones.  For example, the following dates are equivalent if local time is
January 11, 1990, 8pm Pacific Standard Time, eight hours west of
Coordinated Universal Time (UTC):

@example
8:00 pm lt
4:00 AM, Jan. 12, 1990           default is UTC
1990-01-12 04:00:00+00           ISO 8601 (UTC)
1990-01-11 20:00:00-08           ISO 8601 (local time)
1990/01/12 04:00:00              traditional RCS format
Thu Jan 11 20:00:00 1990 LT      output of ctime(3) + LT
Thu Jan 11 20:00:00 PST 1990     output of date(1)
Fri Jan 12 04:00:00 GMT 1990
Thu, 11 Jan 1990 20:00:00 -0800  Internet RFC 822
12-January-1990, 04:00 WET
@end example

@noindent
Most fields in the date and time can be defaulted.  The default time
zone is normally UTC, but this can be overridden by the @option{-z}
option.  The other defaults are determined in the order year, month,
day, hour, minute, and second (most to least significant).  At least one
of these fields must be provided.  For omitted fields that are of higher
significance than the highest provided field, the time zone's current
values are assumed.  For all other omitted fields, the lowest possible
values are assumed.  For example, without @option{-z}, the date
@samp{20, 10:30} defaults to @samp{10:30:00 UTC} of the 20th of the UTC
time zone's current month and year.  Note that for the shell, the
date/time must be quoted if it contains spaces.

RCS also accepts some other formats which specify only the date portion
(omitting the time portion).  In the following table, @var{year} is
the four-digit year @code{YYYY}, and all examples specify 20 April 2018.

@multitable @columnfractions .22 .22 .56
@headitem format
@tab example
@tab description

@item @t{@var{year}-@var{doy}}
@tab @code{2018-110}
@tab @var{doy} is the day of year @code{DDD}, 1-366.

@item @t{@var{year}-w@var{week}-@var{dow}}
@tab @code{2018-w16-5}
@tab @var{week} is the ISO week number @code{WW}, 0-53
(actually, ISO week numbers are 1-53; week 0 is a GNU RCS extension);
and @var{dow} is the ISO day number @code{D}, 1-7 (Monday through Sunday).
Note the literal @code{w} that precedes @var{week}.
@end multitable

@node Description option
@subsection Description option

@cindex @samp{-t}
@cindex specifying description text
@cindex description text, specifying

Some commands accept an option of the form @samp{-t-@var{text}}
or @samp{-t@var{file-name}}.  This option is to set or update the
@repo{} description text.  In the first form, @var{text} is used
directly, excluding the leading hyphen (@samp{-}) that distinguishes the
two forms.  In the second form, the description text is taken from the
contents of @var{file-name}.

@node Substitution mode option
@subsection Substitution mode option

@cindex @samp{-k}
@cindex specifying substitution mode
@cindex substitution mode, specifying

Some commands accept an option of the form @option{-k@var{subst}}, used
to control how keywords (@pxref{Concepts}) are expanded in the working
file.  In the following table of @var{subst} values, the example keyword
is @samp{Revision} and its value is @samp{5.13}.

@table @t
@cindex substitution mode, default
@cindex keyword-value substitution mode
@item kv
Generate @samp{$Revision: 5.13 $} (dollar-sign, keyword, colon, space,
value, space, dollar-sign).
A locker's name is inserted in the value of the @code{Header},
@code{Id} and @code{Locker} keyword strings only as a file is being locked,
i.e., by @command{ci -l} and @command{co -l}.
This is the default substitution mode.

@cindex keyword-value-locker substitution mode
@item kvl
Like @option{-kkv}, except that a locker's name is always inserted
if the given revision is currently locked.

@cindex keyword-only substitution mode
@item k
Generate @samp{$Revision$} (dollar-sign, keyword, dollar-sign).
This is useful when comparing different revisions of a file.  Log
messages are inserted after @code{Log} keywords even if @option{-kk} is
specified, since this tends to be more useful when merging changes.

@cindex old-keyword-value substitution mode
@item o
Like @option{-kkv}, but use the old value present in the working file
just before it was checked in.  This can be useful for file formats that
cannot tolerate any changes to substrings that happen to take the form
of keyword strings.

@cindex binary-old-keyword-value substitution mode
@item b
Like @option{-ko}, but do all file i/o in binary mode.  This makes
little difference on POSIX and Unix hosts, but on DOS-like hosts one
should use @command{rcs -i -kb} to initialize an @repo{} intended to be
used for binary files.  Also, on all hosts, @rcscommand{rcsmerge} normally
refuses to merge files when @option{-kb} is in effect.

@cindex value-only substitution mode
@item v
Generate @samp{5.13} (value only).  Further keyword substitution cannot
be performed once the keyword names are removed, so this should be used
with care.  Because of this danger of losing keywords, @option{-kv}
cannot be combined with @option{-l}, and the owner write permission of the
working file is turned off; to edit the file later, check it out again
without @option{-kv}.
@end table

@node Log message option
@subsection Log message option

@cindex @samp{-m}
@cindex specifying log message
@cindex log message, specifying

Both @command{ci} and @command{rcs} allow a log message
to be specified with the @option{-m} option.
@cindex empty log message
@cindex log message, empty
If the @var{msg} argument to this option is empty,
RCS uses the default @samp{*** empty log message ***}.
This particular message is handled specially
(i.e., filtered out) by @command{rlog}.

@node State option
@subsection State option

@cindex @samp{-s}
@cindex specifying a state
@cindex state, specifying

Some commands accept an option of the form @option{-s@var{state}}
to specify a state (@pxref{ci}, @pxref{co}).
For @rcscommand{frob} (@pxref{rcs}), you can also specify a revision.
For @rcscommand{log} (@pxref{rlog}), you can specify
more than one state (@pxref{Delim-separated list}).

@cindex default state
RCS uses @code{Exp} (for ``experimental'') as the default state,
but does not attach any meaning to it or any state you choose.
Other common states are @code{Rel} (for ``release''),
@code{Prod} (for ``production''), @code{Stable}, and so on.
A state should be an @code{id} (``identifier'', @pxref{comma-v grammar}).

@node minus-M
@subsection Working file mtime option

@cindex @samp{-M}
@cindex specifying working file mtime
@cindex mtime, working file

Two commands that mutate the working file (@pxref{ci}, @pxref{co})
accept an option of the form @option{-M} or @option{-M@var{rev}}.

This option works with @option{-u} or @option{-l}
to specify that the working file's modification time should
be set to the date associated with revision @var{rev}
(defaults to the branch tip if unspecified).

Like @option{-T}, this can be useful when the working file
is named in a Makefile target's list of prerequisites.

@node Misc common options
@subsection Misc common options

Other common options are @option{-I}, @option{-q},
@option{-T}, @option{-V}, @option{-w}, @option{-x}.

@table @t
@cindex @samp{-I}
@cindex interactive mode
@item -I
This option enables @dfn{interactive mode}.
More precisely, it @strong{forces} interactive mode, whereby RCS
commands believe that their standard input is a terminal, normally a
precondition for displaying a prompt to receive input (such as a log
message on checkin).
The intention of @option{-I} is for scripting situations where standard
input is actually not a terminal but you know beforehand (without
prompting) that input is needed and you are ready to provide it on
standard input anyway.

@cindex quiet mode
@cindex @samp{-q}
@item -q
This option enables @dfn{quiet mode}.
Commands work silently (unless there is an error condition),
and suppress warnings and prompts.

@cindex @samp{-T}
@cindex timestamp
@cindex specifying @repo{} mtime
@cindex mtime, @repo{}
@item -T
This option controls how some commands
(@pxref{ci}, @pxref{co}, @pxref{rcs}, @pxref{rcsclean})
timestamp the @repo{}.
Normally, RCS commands set the @repo{}'s timestamp when modifying it
in the ``natural'' way (without taking any particular care).
With @option{-T}, on the other hand, the commands either preserve
the timestamp (for standalone lock/unlock operations), or use the
timestamp of the working file (for @rcscommand{ci}).

This can be useful if the @repo{} is found in a makefile target's
list of prerequisites (@pxref{Rule Syntax,,,make,The GNU Make Manual}),
that is, if some target should be rebuilt if the @repo{} is newer
than it.  In that case, you can do @samp{rcs -u -T}, for example, to
unlock a revision in the @repo{} without triggering a recompilation.

@xref{Stamp resolution}, for details on support for subsecond resolution.

@cindex @samp{-V}
@item -V
Behave like @option{--version}, i.e., display command version
information and exit successfully.
@strong{NB}: This option is obsolete and its
@strong{support will be removed} in some future release.

@cindex emulation, previous RCS versions
@cindex RCS version emulation
@item -V@var{n}
@var{n} specifies the RCS (major) version to emulate.
Valid values for @var{n} are: 3, 4, 5.
Version 5 is the current version, so @code{-V5} does nothing special.

@cindex behavior prior to version 5
In versions prior to 5, RCS outputs @samp{\t} (tab, @UCS{09}) between
the @samp{:} (colon) and the value (for keyword substitution) instead
of space, uses the @repo{} @code{comment} string to prefix each line
in the @code{Log} expansion instead of computing it on the fly from
the input text, writes/reads localtime instead of UTC, and displays
slightly different output for @rcscommand{rlog}.

@cindex behavior, version 4
For version 4, the @code{Header} expansion unconditionally includes
@code{Locker: @var{locker}}, as if the @code{kvl} substitution mode
were specified (@pxref{Substitution mode option}).

@cindex behavior, version 3
For version 3, the @code{Header} expansion omits the directories from
the filename and says only @code{Locked} instead of the state.

@cindex @samp{-w}
@cindex specifying author
@cindex author, specifying
@item -w@var{login}
Some commands accept an option of the form @samp{-w@var{login}}
to specify the login name of the author of a revision, i.e.,
``who'' is responsible.

@cindex @samp{-x}
@cindex specifying a suffix list
@cindex suffix list, specifying
@item -x@var{suff}
Specify @var{suff} as the slash-separated list of file name suffixes
used to recognize an @repo{}.  The default value is @samp{,v/}, that
is, first try with @samp{,v} then try with an empty suffix.

This @dfn{basename search} occurs within (i.e., starting from the
beginning) the larger @dfn{directory search} loop, which comprises two
candidates: @file{d/RCS} and @file{d}, where @var{d} is the directory
component of the working file name.  For example, given the working file
@file{a.c} in the current directory, RCS tries, in order, these
candidates:

@example
./RCS/a.c,v
./RCS/a.c
./a.c,v
./a.c
@end example

Note that the last candidate is impossible (and is in fact discarded),
because the working and RCS files cannot have the same name.
@end table

@node Delim-separated list
@subsection Delim-separated list

@cindex delim-separated list
@cindex list, comma-separated

Some options that require (or allow) additional information
can take multiple items of that information in the form of
a @dfn{delim-separated list}, a concatenation of items
with one or more delimiter characters between adjacent items.
Multiple adjacent delim characters count as a single delimiter.

Most often you will use comma (@code{,} or @UCS{2C}),
but RCS also permits others, depending on context.
In the following table,
``SPC'' is the space character (@UCS{20}),
``LF'' is the linefeed character (@UCS{0A}),
``TAB'' is the tab character (@UCS{09}),
and
``semi'' is @code{;} (@UCS{3B}).

@multitable @columnfractions .25 .75
@headitem context
@tab permitted delimiter characters, notes

@item @t{co -j@var{joins}}
@tab SPC TAB comma@*
@var{joins} is a delim-separated list, each item of which is
a @dfn{join pair} of the form @var{rev}@t{:}@var{rev}.
@xref{co}.

@item @t{rcs -a@var{accessors}}@*
@t{rcs -e@var{accessors}}
@tab SPC LF TAB comma@*
@var{accessors} is a delim-separated list of logins.
@xref{rcs}.

@item @t{rcs -o@var{revspecs}}@*
@t{rlog -r@var{revspecs}}
@tab semi comma@*
@dfn{revspecs} is a delim-separated list, each item of which has
one of the forms:

@example
REV
REV1:          REV1-
REV1:REV2      REV1-REV2
@end example

@noindent
The variants in the second column use hyphen (@code{-}, @UCS{2D}).
They are obsolete and should be avoided.
They are ambiguous in the presence of symbolic branch and revision
names that include a hyphen in the name (@pxref{Revision options}).

@xref{rcs}, @xref{rlog}.
Note that although the ``join pair'' for @rcscommand{co -j}
above is identical to a @code{REV1:REV2} revspec,
the set of delim characters is different.

@item @t{rlog -l@var{lockers}}@*
@t{rlog -w@r{[}@var{authors}@r{]}}
@tab SPC TAB LF semi comma@*
Both @var{lockers} and @var{authors} are a delim-separated list of logins.
Note that @var{authors} is completely optional.
@xref{rlog}.

@item @t{rlog -s@var{states}}
@tab SPC TAB LF semi comma@*
@var{states} is a delim-separated list of states (@pxref{State option}).
@xref{rlog}.

@item @t{rlog -d@var{dates}}
@tab SPC TAB LF semi comma@*
@var{dates} is a delim-separated list of
date/time specifications (@pxref{Date option}).
@xref{rlog}.
@end multitable

Maintainer's Note: This embarrassment of choice for delim characters
will probably be reduced to simply one character in RCS 6: comma.

@node Environment
@subsection Environment

@cindex environment variables
Various environment variables influence how RCS works.

@defvr {Environment Variable} RCSINIT
Another way to set common options is with the @samp{RCSINIT}
environment variable.  This is a space-separated list of options.
Use @samp{\} (backslash) to escape significant space.  For example:

@example
# @r{Set the value; make it available to subsequent commands.}
RCSINIT="-q -x/,v -zLT"
export RCSINIT

# @r{Use it (implicitly).}
rlog -L foo
@end example

@noindent
This example, in Bourne shell syntax, arranges for RCS commands to
operate as if each command-line had prepended @samp{-q -x/,v -zLT} to
the rest of the command-line.  The effective command-line that
@rcscommand{rlog} sees is thus @samp{-q -x/,v -zLT -L foo}.
@end defvr

@defvr {Environment Variable} RCS_MEM_LIMIT
@cindex memory limit
Normally, for speed, commands either memory map or copy into memory
the @repo{} if its size is less than the @dfn{memory limit}, currently
defaulting to ``unlimited''.
Otherwise (or if the initially-tried speedy ways fail),
the commands fall back to using
standard i/o routines.

You can adjust the memory limit by setting the @samp{RCS_MEM_LIMIT}
environment variable to a numeric value (measured in kilobytes).
An empty value is silently ignored.

As a side effect, specifying the memory limit inhibits
fall-back to slower routines.
(This env var is mostly intended for testing RCS;
normally, you can leave it unset.  Probably it will be
removed in a future release.)
@end defvr

@defvr {Environment Variable} TMPDIR
@defvrx {Environment Variable} TMP
@defvrx {Environment Variable} TEMP
Commands sometimes create temporary files, normally in
a system-dependent directory, such as @file{/tmp}.
You can override this directory by specifying another one as the value
of one of the environment variables @code{TMPDIR}, @code{TMP}, or
@code{TEMP} (checked in that order).
@end defvr

@defvr {Environment Variable} LOGNAME
@defvrx {Environment Variable} USER
Absent @option{-w@var{login}}, or when @var{login} is omitted
(@pxref{Misc common options}), commands check environment variables
@code{LOGNAME} and @code{USER} in that order@footnote{However,
on systems where env var @code{LOGNAME} is readonly at configure time,
RCS checks @code{USER} first.}.  If neither of these
are set, RCS queries the host for, and uses, your login.
@end defvr

@macro ineffectual {opts}
@noindent
These options have no effect, and are included solely for consistency
with other commands (@pxref{Environment}): \opts\.
@end macro

@node ci
@section Invoking @rcscommand{ci}

@dispatchusage {ci, ci, file @dots{}}

@noindent
The @rcscommand{ci} command adds a revision to the @repo{} reflecting
the current state of the working file.  This operation is also known as
``checkin''.

@table @t
@cindex @samp{-f}, for @rcscommand{ci}
@item -f[@var{rev}]
Force new entry, even if no content changed.

@item -I[@var{rev}]
@itemx -q[@var{rev}]
@xref{Misc common options}.

@cindex @samp{-i}, for @rcscommand{ci}
@cindex checkin, initial
@cindex initial checkin
@item -i[@var{rev}]
Initial checkin; error if the @repo{} already exists.

@cindex @samp{-j}, for @rcscommand{ci}
@item -j[@var{rev}]
Just checkin, don't initialize; error if the @repo{} does not exist.

@cindex @samp{-k}, for @rcscommand{ci}
@item -k[@var{rev}]
Compute revision from working file keywords.

Do not confuse this with @option{-k@var{subst}}
(@pxref{Substitution mode option}).

@cindex @samp{-r}, for @rcscommand{ci}
@cindex release lock
@cindex lock, release
@cindex working file, deleting
@cindex deleting working file
@item -r
Release lock and delete working file.

@item -r@var{rev}
Do normal checkin.

@cindex @samp{-l}, for @rcscommand{ci}
@cindex implicit checkout, locked
@cindex locking on implicit checkout
@item -l[@var{rev}]
Like @option{-r}, but immediately checkout locked (@command{co -l}) afterwards.

@cindex @samp{-u}, for @rcscommand{ci}
@cindex implicit checkout, unlocked
@item -u[@var{rev}]
Like @option{-l}, but checkout unlocked (@command{co -u}).

@item -M[@var{rev}]
@xref{minus-M}.
@end table

@noindent
Multiple flags in @code{-@{fiIjklMqru@}} may be given, except for
@option{-r}, @option{-l}, @option{-u}, which are mutually exclusive.
For a fully specified revision of the
form @code{@var{br}.@var{n}}, @var{n} must be greater
than any existing on @var{br}, or @var{br} must be new.
If @var{rev} is omitted, compute it from the last lock
(@command{co -l}), perhaps starting a new branch.
If there is no lock, use @code{@var{defbr}.(L+1)}.
@xref{Revision options}.

@table @t
@item -d[@var{date}]
@itemx -z@var{zone}
@xref{Date option}.  If no @var{date} specified,
use the working file modification time.

@item -m[@var{msg}]
Use @var{msg} as the log message.  @xref{Log message option}.

@item -n@var{name}
@itemx -N@var{name}
Assign symbolic @var{name} to the entry.
For @option{-n}, @var{name} must be new (no previous assignment).
For @option{-N}, overwrite any previous assignment.

@item -s@var{state}
Set the state (@pxref{State option}).

@item -t-@var{text}
@itemx -t@var{file-name}
@xref{Description option}.

@item -T
Set the @repo{}'s modification time to the new revision's
time if the former precedes the latter and there is a new
revision; preserve the @repo{}'s modification time otherwise.
@xref{Misc common options}.

@item -w@var{who}
Use @var{who} as the author.
@xref{Misc common options}.

@item -V
@itemx -V@var{n}
@itemx -x@var{suff}
@xref{Misc common options}.
@end table

@node co
@section Invoking @rcscommand{co}

@dispatchusage {co, co, file @dots{}}

@noindent
The @rcscommand{co} command retrieves a revision from the @repo{},
writing a new working file.  This operation is also known as ``checkout''.

@table @t
@cindex @samp{-f}, for @rcscommand{co}
@item -f[@var{rev}]
Force overwrite of working file.

@item -I[@var{rev}]
@itemx -q[@var{rev}]
@xref{Misc common options}.

@cindex @samp{-p}
@item -p[@var{rev}]
Write to standard output instead of the working file.

@cindex @samp{-r}, for @rcscommand{co}
@item -r[@var{rev}]
Normal checkout.

@cindex @samp{-l}, for @rcscommand{co}
@item -l[@var{rev}]
Like @option{-r}, but also lock.

@cindex @samp{-u}, for @rcscommand{co}
@item -u[@var{rev}]
Like @option{-l}, but unlock.

@item -M[@var{rev}]
@xref{minus-M}.
@end table

@noindent
Multiple flags in @code{-@{fIlMpqru@}} may be given, except for
@option{-r}, @option{-l}, @option{-u}, which are mutually exclusive.
@xref{Revision options}.

@table @t
@item -k@var{subst}
@xref{Substitution mode option}.

@item -d@var{date}
@itemx -z@var{zone}
@xref{Date option}.
Select latest before or on @var{date}.

@cindex @samp{-j}, for @rcscommand{co}
@item -j@var{joins}
Merge using @var{joins}, a list of @code{@var{rev}:@var{rev}} pairs.
@strong{NB}: This option is obsolete (@pxref{rcsmerge}).

@item -s@var{state}
Select matching state (@pxref{State option}).

@item -S
Enable "self-same" mode.
In this mode, the owner of a lock is unimportant, just that it exists.
Effectively, this prevents you from checking out the same revision twice.

@example
$ whoami
ttn

$ co -l -f z
RCS/z,v  -->  z
revision 1.1 (locked)
done

$ co -S -l -f z
RCS/z,v  -->  z
co: RCS/z,v: Revision 1.1 is already locked by ttn.
@end example

@item -T
Preserve the modification time on the @repo{} even if
it changes because a lock is added or removed.
@xref{Misc common options}.

@item -w@var{who}
Select matching login @var{who}.
@xref{Misc common options}.

@item -V
@itemx -V@var{n}
@itemx -x@var{suff}
@xref{Misc common options}.
@end table

@node ident
@section Invoking @rcscommand{ident}

@usage {ident, [file @dots{}]}

@noindent
If no @var{file} is specified, scan standard input.
The @rcscommand{ident} command scans its input for keywords
(@pxref{Concepts}), displaying to standard output what it finds.

@table @t
@item -q
Normally, if no patterns are found for a file, @rcscommand{ident}
emits a warning.  This option suppresses the warning.

@item -V
@noVN{ident}
@end table

In addition to the normal keyword pattern, for Subversion 1.2
(and later) compatibility@footnote{The @dfn{fixed-length keyword syntax}
is described in detail in
@uref{http://svnbook.red-bean.com/en/1.5/svn-book.html#svn.advanced.props.special.keywords,
,Version Control with Subversion}, chapter ``Advanced Topics'', section
``Keyword Substitution''.},
@rcscommand{ident} also recognizes patterns having one of the forms:

@example
$@var{keyword}:: @var{text} $
;; two colons and space after keyword
;; space before ending $

$@var{keyword}:: @var{text}#$
;; two colons and space after keyword
;; hash before ending $
@end example

@node merge
@section Invoking @rcscommand{merge}

@usage {merge, receiving-sibling parent other-sibling}

@noindent
The @rcscommand{merge} command combines the differences between a
the parent and the other sibling, and the differences between the
parent and the receiving sibling.  It writes the result to the
receiving sibling.

@table @t
@item -A
@itemx -E
@itemx -e
Use @command{diff3} @option{-A}, @option{-E} (default), or @option{-e},
respectively.

@item -p
Write to standard output instead of overwriting @var{receiving-sibling}.

@item -q
@xref{Misc common options}.  Suppress conflict warnings.

@item -L @var{label}
(up to three times) Specify the conflict labels for
@var{receiving-sibling}, @var{parent} and @var{other-sibling},
respectively.

@item -V
@noVN{merge}
@end table

@node rcs
@section Invoking @rcscommand{rcs}

The @rcscommand{rcs} command is unique in the set of RCS programs in
that it has two usages, the modern (for RCS 5.9.0 and later) and the
legacy.

@subsection modern
@usage {rcs, command [command-arg @dots{}]}

@noindent
This @rcscommand{rcs} usage dispatches to @var{command},
passing along @var{command-arg}@dots{} without interpretation.

@table @t
@item --commands
Display a list of available commands, including a one-line
description, and exit successfully.

@item --aliases
Display a list of command aliases and exit successfully.

@item --help @var{command}
Display help for a particular @var{command} and exit successfully.
For example, to display help for the legacy interface, use:
@example
--help frob
@end example
@end table

@subsection legacy
@dispatchusage {frob, rcs, file @dots{}}

@noindent
This @rcscommand{rcs} usage performs various administrative operations
on the @repo{}, depending on the options given.

@table @t
@cindex @samp{-i}, for @rcscommand{frob}
@item -i
Create and initialize a new @repo{}.

@cindex locking, set strict
@item -L
Set strict locking.

@cindex locking, set non-strict
@item -U
Set non-strict locking.

@item -M
Don't send mail when breaking someone else's lock.

Do not confuse this with @option{-M@var{rev}} (@pxref{minus-M}).

@item -T
Preserve the modification time on the @repo{}
unless a revision is removed.

@item -I
@itemx -q
@xref{Misc common options}.

@item -a@var{logins}
Append @var{logins} (@pxref{Delim-separated list}) to access-list.

@item -e[@var{logins}]
Erase @var{logins} (@pxref{Delim-separated list}) from access-list.
If @var{logins} is omitted, clear the access-list.

@item -A@var{file-name}
Append access-list of @var{file-name} to current access-list.

@cindex default branch, setting
@item -b[@var{rev}]
Set default branch to that of @var{rev} or
highest branch on trunk if @var{rev} is omitted.

@cindex locking a revision
@item -l[@var{rev}]
Lock a revision.

@cindex unlocking a revision
@item -u[@var{rev}]
Unlock a revision.

@item -c@var{string}
Set comment leader to @var{string}.
@strong{NB}: Don't use; obsolete.

@item -k@var{subst}
@xref{Substitution mode option}.

@item -m@var{rev}:[@var{msg}]
Replace log message with @var{msg}.  @xref{Log message option}.

@item -n@var{name}[:[@var{rev}]]
If @var{:rev} is omitted, delete symbolic @var{name}.
Otherwise, associate @var{name} with @var{rev}; @var{name} must be new.

@item -N@var{name}[:[@var{rev}]]
Like @option{-n}, but overwrite any previous assignment.

@cindex deleting revisions
@cindex removing revisions
@cindex outdating revisions
@item -o@var{range}
Delete (also known as ``outdate'') revisions in @var{range}:

@table @t
@item @var{rev}
single revision

@item @var{br}
latest revision on branch @var{br}

@item @code{@var{rev1}:@var{rev2}}
@var{rev1} to @var{rev2} on same branch, inclusive

@item @code{:@var{rev}}
beginning of branch to @var{rev}

@item @code{@var{rev}:}
@var{rev} to end of branch
@end table

@item -s@var{state}[:@var{rev}]
Set state (@pxref{State option}).

@item -t-@var{text}
@itemx -t@var{file-name}
@xref{Description option}.  Replace description.

@item -V
@itemx -V@var{n}
@itemx -x@var{suff}
@xref{Misc common options}.
@end table

@ineffectual @code{-z@var{zone}}

@node rcsclean
@section Invoking @rcscommand{rcsclean}

@dispatchusage {clean, rcsclean, [file @dots{}]}

@noindent
The @rcscommand{rcsclean} command removes working files that are not being
worked on.  If given @option{-u}, it also unlocks and removes working files
that are being worked on but have not changed.
If no @var{file} is specified, operate on all the working files in the
current directory.

@table @t
@item -r[@var{rev}]
Specify revision.

@item -u[@var{rev}]
Unlock if is locked and no differences found.

@item -n[@var{rev}]
Dry run (no act, don't operate).

@item -q[@var{rev}]
@xref{Misc common options}.

@item -k@var{subst}
@xref{Substitution mode option}.

@item -T
Preserve the modification time on the @repo{} even
it changes because a lock is removed.

@item -V
@itemx -V@var{n}
@itemx -x@var{suff}
@xref{Misc common options}.

@item -z@var{zone}
@xref{Date option}.
@end table

@node rcsdiff
@section Invoking @rcscommand{rcsdiff}

@dispatchusage {diff, rcsdiff, file @dots{}}

@noindent
The @rcscommand{rcsdiff} command runs @rcscommand{diff}
to compare two revisions in an @repo{}.
@xref{Invoking diff,,,diff,The GNU Diffutils Manaual}.

@table @t
@item -r@var{rev}
(zero, one, or two times) Name a revision.
If given two revisions (@samp{-r@var{rev1} -r@var{rev2}}),
compare those revisions.
If given only one revision (@samp{-r@var{rev}}),
compare the working file with it.
If given no revisions, compare the working file with the latest
revision on the default branch.

@item -k@var{subst}
@xref{Substitution mode option}.

@item -q
@xref{Misc common options}.

@item -V
@itemx -V@var{n}
@itemx -x@var{suff}
@xref{Misc common options}.

@item -z@var{zone}
@xref{Date option}.
@end table

@ineffectual @code{-T}

@noindent
Additionally, the following options (and their argument, if any) are
passed to the underlying @rcscommand{diff} command:

@example
-0, -1, -2, -3, -4, -5, -6, -7, -8, -9, -B, -C, -D, -F, -H, -I,
-L, -U, -W, -a, -b, -c, -d, -e, -f, -h, -i, -n, -p, -t, -u, -w, -y,
long options (that start with "--")
@end example

@noindent
(Not all of these options are meaningful.)

@node rcsmerge
@section Invoking @rcscommand{rcsmerge}

@dispatchusage {merge, rcsmerge, file}

@noindent
The @rcscommand{rcsmerge} command incorporates the changes between two
revisions of an @repo{} into the corresponding working file.

@table @t
@cindex @samp{-A}
@cindex @samp{-E}
@cindex @samp{-e}
@item -A
@itemx -E
@itemx -e
Passed to the @rcscommand{diff3} command.
The default if none are specified is @code{-E}.
With @code{-e}, suppress warnings on conflict.
The @code{-A} style generates the most verbose output.
@xref{Invoking diff3,,,diff,The GNU Diffutils Manual}.

@item -p[@var{rev}]
Write to standard output instead of overwriting the working file.

@item -q[@var{rev}]
@xref{Misc common options}.

@item -r@var{rev}
(one or two times) specify a revision.
@end table

@noindent
One or two revisions must be specified
(using @option{-p}, @option{-q}, @option{-r}).
If only one is specified, the second revision defaults
to the latest revision on the default branch.

@table @t
@item -k@var{subst}
@xref{Substitution mode option}.

@item -V
@itemx -V@var{n}
@itemx -x@var{suff}
@xref{Misc common options}.

@item -z@var{zone}
@xref{Date option}.
@end table

@ineffectual @code{-T}

@node rlog
@section Invoking @rcscommand{rlog}

@dispatchusage {log, rlog, file @dots{}}

@noindent
The @rcscommand{rlog} command displays information about @repo{}s.

@table @t
@item -L
Ignore @repo{}s with no locks set.

@item -R
Print only the name of the @repo{}.

@item -h
Print only the ``header'' information.

@item -t
Like @option{-h}, but also include the description.

@item -N
Omit symbolic names.

@item -b
Select the default branch.

@item -d@var{dates}
@xref{Date option}.  Select revisions based on timestamp,
in the range @var{dates}, with spec:

@table @t
@item @var{d}
single revision @var{d} or earlier

@item @var{d1}<@var{d2}
@itemx @var{d2}>@var{d1}
between @var{d1} and @var{d2}, exclusive

@item <@var{d}
@itemx @var{d}>
before @var{d}

@item >@var{d}
@itemx @var{d}<
after @var{d}
@end table

Instead of @samp{<} or @samp{>}, you can use @samp{<=} or @samp{>=},
respectively, to specify inclusive ranges.
@var{dates} may also be a list of semicolon-separated specs.

@item -l[@var{who}]
Select revisions locked by @var{who} (@pxref{Delim-separated list})
only, or by anyone if @var{who} is omitted.

@item -r[@var{revs}]
Select revisions in @var{revs} (@pxref{Delim-separated list}),
one of: @var{rev}, @code{@var{rev}:},
@code{:@var{rev}}, @code{@var{rev1}:@var{rev2}}.

@item -s@var{state}[,@var{state}...]
Select revisions with specified state(s) (@pxref{State option}).

@item -w[@var{who}]
Select revisions checked in by @var{who} (@pxref{Delim-separated list}),
or by the user if @var{who} is omitted.

@item -V
@itemx -V@var{n}
@itemx -x@var{suff}
@xref{Misc common options}.

@item -z@var{zone}
@xref{Date option}.
This option also changes the output format of the date to use
hyphens instead of slashes.
For example:

@example
$ rlog t,v  # @r{without -z}
...
date: 2010/10/02 04:35:26;  [...]
...

$ rlog -z+0200 t,v
...
date: 2010-10-02 06:35:26+02;  [...]
...
@end example
@end table

@ineffectual @samp{-q}, @samp{-T}


@c ---------------------------------------------------------------------------
@node Hacking
@chapter Hacking

This chapter, in contrast to the previous (@pxref{Usage}),
is introspective.  It describes important aspects of RCS interop
with other programs, and development ideas and methods.

@menu
* File format::         What is stored on disk.
* Stamp resolution::    At times, whole numbers barely satisfy.
* Still missing::       What RCS lacks, perhaps perpetually.
* Reporting bugs::      Sending bug reports and feature suggestions.
@end menu


@c ---------------------------------------------------------------------------
@node File format
@section File format
@cindex RCSfile format
@cindex format, RCSfile

An @repo{}'s contents are described by the grammar below@footnote{This
section is adapted from the @samp{rcsfile(5)} manpage, written by
@WFT{}.}.
@cindex encoding, file format
Overall, the format is free--format text.
In most environments RCS uses the ISO 8859/1 encoding: visible graphic
characters are (octal) codes 041--176 and 240--377, and whitespace
characters are codes 010--015 and 040.
@TODO{} Discuss or point to encoding compatibility issues.

@menu
* comma-v grammar::
* comma-v particulars::
@end menu

@node comma-v grammar
@subsection File format grammar
@cindex grammar, file format

The meta syntax in this section uses the following conventions:
@samp{|} (@UCS{7C}) separates alternatives;
@samp{@{} (@UCS{7B}) and @samp{@}} (@UCS{7D}) enclose optional phrases;
@samp{@{} and @samp{@}*} (trailing @UCS{2A}) enclose phrases that can be
repeated zero or more times;
@samp{@{} and @samp{@}+} (trailing @UCS{2B}) enclose phrases that must
appear at least once and can be repeated;
terminal symbols are in @samp{""} (two @UCS{22}).

@example
rcstext   ::=  admin @{delta@}* desc @{deltatext@}*

admin     ::=  "head"         @{num@} ";"
               @{ "branch"     @{num@} ";" @}
               "access"       @{id@}* ";"
               "symbols"      @{ sym ":" num @}* ";"
               "locks"        @{ id ":" num @}* ";"
               @{ "strict" ";" @}
               @{ "integrity " @{intstring@} ";" @}
               @{ "comment"    @{string@} ";" @}
               @{ "expand"     @{string@} ";" @}

delta     ::=  num
               "date"       num ";"
               "author"     id ";"
               "state"      @{id@} ";"
               "branches"   @{num@}* ";"
               "next"       @{num@} ";"
               @{ "commitid" sym ";" @}

desc      ::=  "desc"  string

deltatext ::=  num
               "log"   string
               "text"  string

num       ::=  @{ digit | "." @}+

digit     ::=  "0" @r{through} "9"

id        ::=  @{ idchar | "." @}+

sym       ::=  @{idchar@}+

idchar    ::=  @r{any visible graphic character except} special

special   ::=  "$" | "," | "." | ":" | ";" | "@@"

string    ::=  "@@" @{ @r{any character, with} @@ @r{doubled} @}* "@@"

word      ::=  id | num | string | ":"

intchar   ::=  @r{any character, except} @@

thirdp    ::=  "^L" @{intchar@}*

intstring ::= "@@" @{intchar@}* @{thirdp@}* "@@"
@end example

@node comma-v particulars
@subsection Additional particulars of the file format

@itemize
@item
@cindex third-party interop, file format
In releases prior to 5.8 (2011-08-30), the grammar included the
production:

@example
newphrase ::= id word* ";"
@end example

@noindent
and used it in the @code{admin}, @code{delta} and @code{deltatext}
productions.
This allowed third-party programs to interoperate with RCS
by storing opaque (to RCS) data in the file.

As of 5.8, in the name of progress (towards more systematic file
integrity support), the only area reserved for third-party interop is in
the @code{string} value of the @code{integrity} field, specifically after the
first formfeed (@UCS{0C}).
A further restriction (for all programs) is that the @code{integrity}
value must not contain @samp{@@}.

@cindex rlog, use with CVS
@strong{Warning}: This change means you cannot use @command{rlog}
(or @command{rcs log}) as a workalike for @command{cvs log} for
versions of CVS that write other kinds of metadata into the file.
If you use CVS and have access to the @file{*,v} files it writes,
you can determine if they require @command{cvs log}
by the following command:

@example
if grep -E -q '^(deltatype|permissions|kopt)' *,v
  then echo 'must use "cvs log"'
  else echo 'probably safe to use "rcs log" (for now)'
fi
@end example

The ``(for now)'' bit is a nod to the most probable trajectory
for both RCS and CVS: away from interop.

@item
@cindex whitespace, file format
@cindex string particulars, file format
Whitespace has no significance except in @code{string} values.
However, whitespace cannot appear within an @code{id}, @code{num}, or
@code{sym}, and an @repo{} must end with newline (@UCS{0A}).
A @code{string} value is enclosed by @samp{@@} (@UCS{40})
with internal @samp{@@} characters doubled.
All other bytes (arbitrary binary data) represent themselves.
For example:

@multitable @columnfractions .4 .6
@headitem conceptual string
@tab persistent representation

@item a string of five words
@tab @t{@@a string of five words@@}

@item another, with one '@@' char
@tab @t{@@another, with one '@@@@' char@@}

@item with newline@*and unquoted @@
@tab @t{@@with newline@*and unquoted @@@@@@}
@end multitable

@item
@cindex case sensitivity, file format
Identifiers are case sensitive.
Keywords are in lower case only.
The sets of keywords and identifiers can overlap.

@item
@cindex dates, file format
Dates, which appear after the @code{date} keyword, are of the form
@code{Y.m.d.H.M.S}, where @code{Y} is the year, @code{m} the month
(01--12), @code{d} the day (01--31), @code{H} the hour (00--23),
@code{M} the minute (00--59), and @code{S} the second (00--60).
(These correspond to @code{strftime} format strings, with
the exception of @code{Y}, which depends on the particular year.)

@code{Y} contains just the last two digits of the year for years from
1900 through 1999, and all the digits of years thereafter.
Dates use the Gregorian calendar; times use UTC.

@item
@cindex node layout, file format
@cindex layout of nodes, file format
The @code{delta} nodes form a tree.
All nodes whose numbers consist of a single pair, e.g.:

@example
2.3
2.1
1.3
@end example

@noindent
are on the trunk, and are linked through the @code{next} field in order
of decreasing numbers.
The @code{head} field in the @code{admin} node points to the head of
that sequence (i.e., contains the highest pair).
The @code{branch} node in the @code{admin} node indicates the default
branch (or revision) for most RCS operations.
If empty, the default branch is the highest branch on the trunk.

All @code{delta} nodes whose numbers consist of 2@var{n} fields (@var{n}
@geq{} 2), e.g.:

@example
3.1.1.1
2.1.2.2
@end example

@noindent
are linked as follows.
All nodes whose first 2@var{n}@minus{}1 number fields are identical are
linked through the @code{next} field in order of increasing numbers.
For each such sequence, the @code{delta} node whose number is identical
to the first 2@var{n}@minus{}2 number fields of the @code{delta} nodes
on that sequence is called the @dfn{branchpoint}.

The @code{branches} field of a node contains a list of the numbers of
the first nodes of all sequences for which it is a branchpoint.
This list is ordered in increasing numbers.
@xref{Example RCS File Organization}.

@float Figure, Example RCS File Organization
@example
                           Head
                             |
                             v                        / \
                         ---------                   /   \
   / \          / \      |       |      / \         /     \
  /   \        /   \     |  2.1  |     /   \       /       \
 /     \      /     \    |       |    /     \     /         \
/1.2.1.3\    /1.3.1.1\   |       |   /1.2.2.2\   /1.2.2.1.1.1\
---------    ---------   ---------   ---------   -------------
    ^            ^           |           ^             ^
    |            |           v           |             |
   / \           |       ---------      / \            |
  /   \          |       \  1.3  /     /   \           |
 /     \         ---------\     /     /     \-----------
/1.2.1.1\      1.3.1       \   /     /1.2.2.1\     1.2.2.1.1
---------                   \ /      ---------
    ^                        |           ^
    |                        v           |
    |                    ---------       |
    |                    \  1.2  /       |
    ----------------------\     /---------
  1.2.1                    \   /       1.2.2
                            \ /
                             |
                             v
                         ---------
                         \  1.1  /
                          \     /
                           \   /
                            \ /
@end example
@caption{The organization of an example @repo{}.}
@shortcaption{Example RCS File Organization}
@end float
@end itemize


@c ---------------------------------------------------------------------------
@node Stamp resolution
@section Stamp resolution
@cindex timestamp resolution
@cindex resolution, timestamp

Regarding RCS, recorded timestamps come into play in two places:

@itemize
@item The @code{delta} production of the file format grammar
includes component @code{date} (@pxref{comma-v grammar}).
The recorded information has second (whole number) resolution.

@cindex file modification time
@cindex time, file modification
@item The metadata of a file on the filesystem usually includes
its @dfn{modification time}.  The resolution of this information
depends on the capabilities of the filesystem; modern ones
--- e.g., @uref{https://en.wikipedia.org/wiki/Ext4,ext4} ---
tend to support subsecond (fractional) resolution.
@end itemize

Historically, up through version 5.9.4, RCS behaved ``agnostically''
with respect to the subsecond component of the file modification time,
relying on the operating system and filesystem to take care of
things at whatever resolution was available at the time,
with the single exception of the @samp{-T} option
(@pxref{Misc common options}).
In the presence of this option, RCS would:

@itemize
@item (reading) Ignore the subsecond component.
@item (writing) Specify 0 as the subsecond component.
@end itemize

@cindex limitations, subsecond resolution
@cindex subsecond resolution
For versions after 5.9.4, if the filesystem supports it,
RCS reads and writes file modification time with
subsecond resolution, given the @samp{-T} option.

It's important to keep in mind that by design, the
delta @code{date} component is limited to second resolution,
so subsecond resolution is only guaranteed for operations
where the file modification time originates from a file
actually existing on the filesystem (i.e., via the
@code{stat(2)} system call).


@c ---------------------------------------------------------------------------
@node Still missing
@section Still missing
@cindex features, still missing

RCS is still missing some features.  The following is an unordered list
of ``to-do musings'' kept by the RCS maintainers.  If you would like to
hack on an item, @xref{Reporting bugs}.

@itemize

@item Add an option to @rcscommand{rcsmerge} so that it can use an arbitrary
program to do the 3-way merge, instead of the default @rcscommand{merge}.
Likewise for @rcscommand{rcsdiff} and @rcscommand{diff}.  It should be
possible to pass arbitrary options to these programs, and to the subsidiary
@rcscommand{co} invocations.

@item Add format options for finer control over the output of
@rcscommand{ident} and @rcscommand{rlog}.  E.g. there should be an easy way
for rlog to output lines like @samp{src/main.c 2.4 wft}, one for each locked
revision.  @rcscommand{rlog} options should have three orthogonal types:
selecting files, selecting revisions, and selecting rlog format.

@item Add format options for finer control over the output of keyword
strings.  E.g. there should be some way to prepend @samp{@@(#)}, and
there should be some way to change @samp{$} to some other character to
disable further substitution.  These options should make the resulting
files uneditable, like @samp{-kv}.

@item Add long options, e.g. @option{--keyword-substitution}.
Unfortunately RCS's option syntax is incompatible with getopt.  Perhaps
the best way is to overload @rcscommand{rcs}, e.g., @samp{rcs diff
--keyword-substitution=old file} instead of @samp{rcsdiff -ko file}.

@item @command{rlog -rM:N} should work even if @var{M} and @var{N} have
different numbers of fields, so long as @var{M} is an ancestor of
@var{N} or vice versa.

@item @rcscommand{rcs} should evaluate options in order;
this allows @command{rcs -oS -nS}.

@item Be able to redo your most recent checkin with minor changes.

@item @command{co -u} shouldn't complain about a @samp{+w} working
file if contents don't change.

@item Add a @samp{-} option to take the list of file names from
standard input.  Perhaps the file names should be null-terminated, not
newline-terminated, so that those that contain newlines are handled
properly.

@item Permit multiple option--filename pairs,
e.g., @command{co -r1.4 a -r1.5 b}.

@item Add an option to break a symbolic link to an @repo{},
instead of breaking the hard link that it points to.

@item Add ways to specify the earliest revision, the most recent
revision, the earliest or latest revision on a particular branch, and
the parent or child of some other revision.

@item If a user has multiple locks, perhaps @rcscommand{ci} should fall
back on the method of @command{ci -k} to figure out which revision to use.

@item Add an option to @rcscommand{rcsclean} to clean directories recursively.

@item Write an @rcscommand{rcsck} program that repairs corrupted @repo{}s,
much as fsck repairs corrupted file systems.  For example, it should
remove stale lock files.

@item Update the date parser to use the more modern @file{getdate.y}
by Bellovin, Salz, and Berets, or the even more modern @code{getdate} by
Moraes.  None of these getdate implementations are as robust as RCS's
old warhorse in avoiding problems like arithmetic overflow, so they'll
have to be fixed first.  (Perhaps we can use gnulib module @code{getdate}.)

@item Break up the code into a library so that it's easier to write
new programs that manipulate @repo{}s, and so that useless code is
removed from the existing programs.  For example, the @rcscommand{rcs}
command contains unnecessary keyword substitution baggage, and the
@rcscommand{merge} command can be greatly pruned.

@item Make it easier to use your favorite text editor to edit log
messages, etc., instead of having to type them in irretrievably at the
terminal.

@item Let the user specify a search path for default branches,
e.g., to use @var{L} as the default branch if it works, and @var{M}
otherwise.  Let the user require that at least one entry in the
search path works.  Let the user say that later entries in the
search path are read only, i.e. one cannot check in changes to them.
This should be an option settable by @samp{RCSINIT}.

@item Add a way for a user to see which revisions affected which lines.

@item Have @command{rlog -nN F} print just the revision number that
@var{N} translates to.  E.g., @command{rlog -nB. F} would print the highest
revision on the branch B.  Use this to add an option @option{-bB} to
rcsbranch, to freeze the named branch.  This should interact well with
default branches.

@item Add a @rcscommand{co} option that prints the revision number before
each line, as SCCS's @command{get -m} does.
[I implemented this for Emacs 22 as a subroutine
of @code{vc-annotate}, q.v.  ---ttn]

@end itemize


@c ---------------------------------------------------------------------------
@node Reporting bugs
@section Reporting bugs

@cindex bug reporting
@cindex problems
@cindex reporting bugs

To report bugs or suggest enhancements for GNU RCS, please
visit its homepage (@url{http://www.gnu.org/software/rcs/})
to find directions on how to ``file a bug report'' online,
or send electronic mail to @email{help-rcs@@gnu.org}.
(If you use the web interface, you don't need to also send email,
since that is done automatically.)

@cindex checklist for bug reports
For bug reports, please include enough information for the maintainers
to reproduce the problem.  Generally speaking, that means:

@itemize @bullet
@item The RCS version, command(s) and manual section(s) involved.
@item Hardware and operating system names and versions.
@item The contents of any input files necessary to reproduce the bug.
@item The expected behavior and/or output.
@item A description of the problem and samples of any erroneous output.
@item Options you gave to @command{configure} other than specifying
      installation directories.
@item Anything else that you think would be helpful.
@end itemize

When in doubt whether something is needed or not, include it.  It's
better to include too much than to leave out something important.

@cindex patches, contributing
Patches are welcome; if possible, please make them with
@samp{git format-patch} and
include @file{ChangeLog} entries (@pxref{Change Log,,, emacs, The GNU
Emacs Manual}).
Please see file @file{HACKING} in the repo, for coding standards.


@c ---------------------------------------------------------------------------
@node GNU FDL
@appendix GNU Free Documentation License

@include fdl.texi


@c ---------------------------------------------------------------------------
@node Index
@unnumbered Index

@printindex cp

@bye
