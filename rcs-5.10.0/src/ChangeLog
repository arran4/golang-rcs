2020-10-20  Thien-Thi Nguyen  <ttn@gnu.org>

	Release: 5.10.0

2019-10-28  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Declare ‘die’ to be ‘exiting’.

	* b-complain.c (die): ...here.

2019-10-28  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Assume 2nd arg to ‘reap’ is non-NULL.

	* b-feph.c (reap): Remove NULL check, early return.

2019-10-27  Thien-Thi Nguyen  <ttn@gnu.org>

	Fix bug: Include trailing slash in default ‘-x’ value.

	Regression introduced 2010-03-03, "Reduce
	dependency-transitivity of src/Makefile variables."

	* rcsutil.c (gnurcs_init): ...here, for ‘BE (pe)’.

2019-10-15  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Declare ‘valid_filename_p’ static.

	Omission from 2018-04-25, "Add abstraction: get_cwd_filenames".

	* rcsclean.c (valid_filename_p): ...here.

2018-06-27  Thien-Thi Nguyen  <ttn@gnu.org>

	[int C] Remove ‘ALL_NONNULL’ decl from ‘fro_close’.

	Oversight from 2018-04-03, "Add {ALL,ARG}_NONNULL to func decls".

	* b-fro.h (fro_close): ...here.

2018-06-27  Thien-Thi Nguyen  <ttn@gnu.org>

	[C int] Add cast to ‘size_t’.

	This avoids a GCC 4.9 warning.

	* rcsgen.c (putstring): ...here,
	for computing ‘span’ when ‘delim’ is non-NULL.

2018-06-01  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Arrange for ‘FULLDATESIZE’ + 1 to be 32.

	* base.h (DATESIZE): Bump down year component to 6.

2018-04-29  Thien-Thi Nguyen  <ttn@gnu.org>

	[C int] Replace some ‘if’..‘else’ assignments w/ ‘?:’.

	* ci.c (ci_main): ...here, for ‘bud.d.author’, ‘bud.d.state’.
	* co.c (co_main): Likewise, for ‘author’.
	* rcs.c (removerevs): Likewise, for ‘dc->cuttail’.
	* rlog.c (getnumericrev): Likewise, for ‘e.string’.

2018-04-29  Thien-Thi Nguyen  <ttn@gnu.org>

	[C int] Remove unnecessary ‘else’.

	* rcsfnms.c (isSLASH): ...here, after ‘return’ in THEN branch.

2018-04-29  Thien-Thi Nguyen  <ttn@gnu.org>

	[C int] Use ‘strspn’, ‘strtok_r’ more.

	* co.c (ks_hws): New static string.
	(SKIP_HWS): New macro.
	(addjoin): Skip horizontal ws at start of ‘spec’;
	prior to returning ‘eot’, make it skip horizontal ws.
	(preparejoin): Rename 1st arg to ‘argv’;
	use ‘strtok_r’; use ‘SKIP_HWS’.

2018-04-29  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Simplify ‘co -j’ common ancestor logic.

	The change 2010-04-27, "New abstractions: extend, wextend"
	introduced a small logic optimization unrelated to its primary
	purpose: Do search then push.  In the case where the search
	fails, the push is not necessary, anyway.  However, in that
	case, we require a ‘goto’.

	This change (reversion) allows us to eliminate the ‘goto’.
	As a tiny side benefit, doing the push first (unshadowed
	by the result of the search) helps the coverage numbers.

	* co.c (preparejoin): Revert the order of sub-operations
	to push-search from search-push; on search failure, don't
	bother w/ ‘goto’ as that is now implicit in the control flow.

2018-04-29  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Consolidate identical ‘RFATAL’ calls.

	* co.c (preparejoin): Add label ‘incomplete’ to
	second call; use ‘goto’ for first; restructure flow
	slightly to check error condition earlier.

2018-04-29  Thien-Thi Nguyen  <ttn@gnu.org>

	[C int] Rewrite func ‘getaccessor’ to use ‘strtok_r’.

	* rcs.c (ks_ws_comma): New static string.
	(getaccessor): Rewrite.
	(rcs_main): Update calls to ‘getaccessor’.

2018-04-29  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Add abstraction: tokenize

	* rlog.c (ks_delims): New static string.
	(PUSH): Move macro earlier in file; nfc.
	(tokenize): New static func.
	(getlocker, getauthor, getstate): Use ‘tokenize’.

2018-04-28  Thien-Thi Nguyen  <ttn@gnu.org>

	[C int] Rewrite func ‘addjoin’ to use ‘strcspn’.

	* co.c (addjoin): Rewrite.

2018-04-27  Thien-Thi Nguyen  <ttn@gnu.org>

	rlog: Fix bug: For ‘-w’, default to user login.

	Regression introduced 2010-05-03, "Use ‘struct link’ more".

	* rlog.c (getauthor): Ensure list finalization
	and outarg update also when no logins are specified.

2018-04-25  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Add abstraction: get_cwd_filenames

	* rcsclean.c (get_directory): Delete func.
	(valid_filename_p, get_cwd_filenames): New static funcs.
	(rcsclean_main): Use ‘get_cwd_filenames’.

2018-04-23  Thien-Thi Nguyen  <ttn@gnu.org>

	[int C] Drop trailing "p" or "_p" from boolean var names.

	M(NEW,OLD) ≡ "Rename member to NEW from OLD".
	A(NEW,OLD) ≡ "Rename arg to NEW from OLD".
	L(NEW,OLD) ≡ "Rename local var to NEW from OLD".
	* base.h (struct behavior): M (unbuffered, unbufferedp).
	(struct flow): M (erroneous, erroneousp).
	* b-excwho.h (lock_memq): A (login, loginp).
	* b-fro.h (fro_trundling): A (sequential, sequentialp).
	(atat_display): A (ensure_end_nl, ensure_newline_p).
	* maketime.h (struct maketimestuff):
	M (tzset_already_called, tzset_called_p).
	* b-complain.c (unbuffer_standard_error, vcomplain)
	(ERRONEOUS_X): Update references.
	* b-excwho.c (lock_memq): A (login, loginp).
	* b-fro.c (fro_trundling): A (sequential, sequentialp).
	(atat_display): A (ensure_end_nl, ensure_newline_p).
	* b-grok.c (maybe_read_num): A (must_be_delta, must_be_delta_p).
	(start_atat): A (blank, blankp).
	(maybe_read_atat): L (newline, newlinep).
	* ci.c (cleanup, ci_main): Update references.
	* co.c (cleanup, buildjoin, co_main): Likewise.
	* ident.c (match): L (subversion_style, svn_p).
	* maketime.c (local_tm): Update references.
	* merge.c (main): Likewise.
	* rcs.c (struct adminstuff): M (headstate_changed, headstate_changed_p).
	(cleanup, getstates, rcs_main): Update references.
	* rcsclean.c (cleanup, rcsclean_main): Likewise.
	* rcsdiff.c (struct unique): M (eqval_ok, eqval_p).
	(minus_y, minus_D, longopt_maybe_p, cleanup)
	(rcsdiff_main): Update references.
	* rcsedit.c (naturalize): A (symbolic, symbolicp).
	(rcswriteopen): L (symbolic, symbolicp).
	(donerewrite): Update references.
	* rcsfnms.c (pairnames): Likewise.
	* rcsgen.c (getsstdin): L (discard, discardp);
	L (dot_in_first_column, dot_in_first_column_p).
	* rcskeep.c (sorry, badly_terminated, get0val)
	(getval): A (save, savep).
	(keepid, getoldkeys): Update references.
	* rcsmerge.c (rcsmerge_main): Likewise.
	* rlog.c (struct daterange): M (open_end, oep).
	(cleanup): Update references.
	(count_a_d): L (add, addp).
	(extdate): L (open_end, oep); update references.
	(getdatepair, rlog_main): Update references.

2018-04-22  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Use more descriptive local var, ‘NUM_EQ’ more.

	* rcs.c (removerevs): ...here, to note revs are ‘different’.

2018-04-22  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Drop unused enum element in --help/--version processing.

	* gnu-h-v.c (hv_option_values): Delete ‘hv_unrecognized’.
	(check_hv): Don't bother handling ‘hv_unrecognized’.

2018-04-20  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Make ‘yesorno’ also output '?', answer choices, default answer.

	* rcsgen.c (yesorno): ...here.
	* ci.c (getlogmsg): Update call to ‘yesorno’.
	* co.c (rmworkfile): Likewise.
	* rcs.c (sendmail, buildtree): Likewise.

2018-04-20  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Make ‘exit_diff_trouble’ also output trailing newline.

	* rcsutil.c (exit_diff_trouble): ...here,
	after output of all other formatted args.
	(runv): Update all callers.

2018-04-13  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Drop support for tracing allocation provenance.

	* b-divvy.c (USED_FOR_DEBUG): Delete #define.
	(alloc, zlloc): Drop 2nd arg ‘what’.
	* b-divvy.h (alloc, zlloc): Likewise in func decls.
	(ZLLOC, FALLOC, FZLLOC): Update macros accordingly.
	* b-esds.c (STRUCTALLOC): Likewise.
	* b-fro.c (fro_open): Update call to ‘alloc’.
	* b-grok.c (STRUCTALLOC): Update macro accordingly.
	(maybe_read_atat, make_hash_table, empty_repo, full):
	Update calls to ‘alloc’, ‘zlloc’.
	* b-isr.c (isr_init): Update call to ‘alloc’.
	* b-kwxout.c (keyreplace): Likewise.
	* rcsedit.c (naturalize): Likewise.
	* rcsfnms.c (getfullRCSname): Likewise.
	* rlog.c (count_a_d): Update call to ‘zlloc’.

2018-04-13  Thien-Thi Nguyen  <ttn@gnu.org>

	[int C] Add {ALL,ARG}_NONNULL to func decls.

	* b-complain.h (vcomplain, complain, diagnose, syserror)
	(generic_warn, generic_error, generic_fatal, fatal_syntax)
	(fatal_sys): ...here, following arglist.
	* b-divvy.h (make_space, alloc, zlloc, intern, brush_off)
	(forget, accf, accumulate_byte, accs, finish_string, pointer_array)
	(close_space): Likewise.
	* b-esds.h (extend, wextend, prepend, wprepend): Likewise.
	* b-excwho.h (stat_mine_p, caller_login_p, lock_memq, lock_on)
	(lock_drop, addlock_maybe): Likewise.
	* b-fb.h (testIerror, testOerror, fopen_safer, Ozclose, aflush)
	(afputc, newline, aputs, aprintf): Likewise.
	* b-feph.h (keepdirtemp): Likewise.
	* b-fro.h (fro_open, fro_zclose, fro_close, fro_tello)
	(fro_move, fro_try_getbyte, fro_must_getbyte, fro_trundling)
	(fro_spew_partial, fro_spew, string_from_atat, atat_put)
	(atat_display): Likewise.
	* b-grok.h (empty_repo, grok_all, grok_resynch): Likewise.
	* b-isr.h (isr_init, access_page, isr_do): Likewise.
	* b-kwxout.h (expandline): Likewise.
	* b-peer.h (one_beyond_last_dir_sep, find_peer_prog): Likewise.
	* base.h (looking_at, , recognize_kwsub, str2expmode)
	(recognize_keyword, merge, unmake_editstuff, un_link)
	(snapshotedit, copystring, enterstring, rcswriteopen)
	(chnamemod, setmtime, findlock, addsymbol, initdiffcmd)
	(getdiffcmd, rcsfcmp, basefilename, rcssuffix, rcsreadopen)
	(pairnames, buildrevision, cleanlogmsg, yesorno, putdesc)
	(getsstdin, format_assocs, format_locks, puttree, putdtext)
	(putstring, putdftext, checkid, checksym, checksid, checkssym)
	(take, cmpnumfld, cmpdate, compartial, genrevs, gr_revno)
	(delta_from_ref, fully_numeric, namedrev, time2date, str2date)
	(date2time, zone_set, date2str, gnurcs_init, bad_option)
	(chk_set_rev, minus_p, parse_revpairs, set_empty_log_message)
	(str_save, cgetenv, awrite, runv, setRCSversion, getRCSINIT)
	(file_mtime): Likewise.
	* gnu-h-v.h (nice_getopt, display_version, check_hv): Likewise.
	* maketime.h (local_tm, difftm, str2time, tm2time)
	(adjzone): Likewise.
	* partime.h (partime, parzone): Likewise.

2018-04-11  Thien-Thi Nguyen  <ttn@gnu.org>

	Consider subsecond resolution for workfile-changed-during-checkin.

	* ci.c (ci_main): Don't compare .st_mtime members directly;
	instead, use ‘get_stat_mtime’, ‘timespec_cmp’.

2018-04-11  Thien-Thi Nguyen  <ttn@gnu.org>

	Fix bug 52288 part 2: Retain working file subsecond mtime.

	The first part was incomplete; subsecond resolution mtime
	was maintained for the RCS file, but not for the working file.

	* ci.c: #include "stat-time.h".
	(struct bud): Add member ‘work_mtime’.
	(ci_main): Save full resolution work mtime in ‘bud.work_mtime’;
	if given ‘-d’, use that value directly for ‘wtime’.

2018-04-11  Thien-Thi Nguyen  <ttn@gnu.org>

	Use subsecond resolution for atime given ‘-T’.

	* base.h (behavior.now): Change type to ‘struct timespec’.
	* ci.c (getcurdate): Use ‘now.tv_sec’.
	* rcsedit.c (setmtime): Use ‘BE (now)’ for ‘amtime[0]’.
	* rcstime.c (str2date): Use ‘now.tv_sec’.
	* rcsutil.c (gnurcs_init): Use ‘gettime’ to init ‘BE (now)’.

2018-04-09  Thien-Thi Nguyen  <ttn@gnu.org>

	Fix bug 52288: Make ‘-T’ support subsecond resolution.

	The ‘donerewrite’ arg rename was an omission from
	2018-04-01, "Rename ‘donerewrite’ second arg".

	* base.h (chnamemod, setmtime): Change type
	of arg ‘mtime’ to ‘const struct timespec’.
	(donerewrite): Likewise, renaming second arg from
	‘newRCStime’ to ‘mtime’.
	(file_mtime): Change return type to ‘struct timespec’.
	* ci.c: #include "timespec.h".
	(fixwork): Change type of arg ‘mtime’ to ‘const struct timespec’.
	(ci_main): Change type of local vars
	‘mtime’, ‘wtime’, ‘fs_mtime’ to ‘struct timespec’;
	use ‘make_timespec’, ‘unspecified_timespec’ for ‘wtime’;
	use ‘unspecified_timespec’, ‘timespec_cmp’ for ‘donerewrite’
	second arg; use ‘unspecified_timespec’ for ‘mtime’.
	* co.c: #include "timespec.h".
	(co_main): Use ‘make_timespec’ for ‘chnamemod’ 6th arg.
	* rcsedit.c (chnamemod): Change type of
	‘mtime’ arg to ‘const struct timespec’.
	(setmtime): Likewise; adjust arg to TIME_UNSPECIFIED_P
	accordingly; assign ‘mtime’ directly to ‘amtime[1]’.
	(donerewrite): Change type of
	‘mtime’ arg to ‘const struct timespec’.
	* rcsutil.c: #include "stat-time.h".
	(file_mtime): Change type of return value to ‘struct timespec’;
	use ‘get_stat_mtime’, ‘unspecified_timespec’.

2018-04-01  Thien-Thi Nguyen  <ttn@gnu.org>

	[C] Use ‘?:’ expression for local var.

	* ci.c (ci_main): ...here, for var ‘wtime’.

2018-04-01  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Use ‘make_timespec’ more.

	* rcsedit.c: #include "timespec.h".
	(setmtime): Use ‘make_timespec’.

2018-04-01  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Add abstraction: ZERO_NANOSECONDS

	* base.h (ZERO_NANOSECONDS): New #define.
	* rcsutil.c (unspecified_timespec): Use ‘ZERO_NANOSECONDS’.

2018-04-01  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Rename ‘donerewrite’ second arg.

	* rcsedit.c (donerewrite): Rename second arg to ‘mtime’.

2018-03-31  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Add abstraction: file_mtime

	* rcsutil.c (file_mtime): New func.
	* base.h (file_mtime): New func decl.
	* ci.c (ci_main): Add local var ‘fs_mtime’; use ‘file_mtime’.
	* co.c (co_main): Use ‘file_mtime’.
	* rcs.c (rcs_main): Likewise.
	* rcsclean.c (rcsclean_main): Likewise.

2018-03-31  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Add abstraction: unspecified_timespec

	* rcsutil.c: #include "timespec.h".
	(unspecified_timespec): New func.
	* base.h (unspecified_timespec): New func decl.

2017-10-30  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Add abstractions: TIME_UNSPECIFIED, TIME_UNSPECIFIED_P

	* base.h (TIME_UNSPECIFIED): New #define.
	(TIME_UNSPECIFIED_P): New macro.
	* ci.c (ci_main): Use ‘TIME_UNSPECIFIED’.
	* co.c (co_main): Likewise.
	* rcs.c (rcs_main): Likewise.
	* rcsclean.c (rcsclean_main): Likewise.
	* rcstime.c (date2str): Likewise.
	* rcsedit.c (setmtime): Use ‘TIME_UNSPECIFIED_P’.

2017-10-29  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Use ‘utimens’ instead of ‘utime’.

	* rcsedit.c: #include "utimens.h".
	(setmtime): Use ‘utimens’ instead of ‘utime’.

2017-10-28  Thien-Thi Nguyen  <ttn@gnu.org>

	[build] Use gnulib module ‘utimens’.

	* Makefile.am (LDADD): Append $(LIB_CLOCK_GETTIME).

2017-10-28  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Improve readability of some ‘?:’ expressions.

	This is mostly done by adding whitespace to either: (a) move
	the entire expression, in an argument context, onto its own
	line; or (b) ensure the ‘?’ and ‘:’ are at "code bol".  In
	some cases grouping parens are added to help distinguish
	nested ‘?:’ expressions.

	* b-kwxout.c (keyreplace): ...here.
	* ci.c (fixwork): Likewise.
	* co.c (co_main): Likewise.
	* maketime.c (tm2time): Likewise.
	* partime.c (parse_ranged): Likewise.
	* rcsgen.c (buildrevision, putadmin, putdelta): Likewise.
	* rcsmap.c (checkidentifier): Likewise.
	* rcsmerge.c (rcsmerge_main): Likewise.
	* rcsrev.c (cmpnumfld, absent, genbranch): Likewise.
	* rcstime.c (date2str): Likewise.
	* rcsutil.c (cgetenv, movefd): Likewise.
	* rlog.c (putadelta, rlog_main): Likewise.

2017-09-28  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Rename ‘datesize’ to ‘DATESIZE’; consolidate.

	* base.h (yearlength): Delete #define, incorporating value into...
	(datesize): Delete #define.
	(DATESIZE): ...new #define.
	(FULLDATESIZE): Use ‘DATESIZE’.
	(time2date, str2date, date2time, date2str): Likewise.
	* ci.c (struct bud): Likewise, for member ‘getcurdate_buffer’.
	(ci_main): Likewise.
	* co.c (co_main): Likewise.
	* rcsdiff.c (setup_label, rcsdiff_main): Likewise.
	* rcsrev.c (cantfindbranch): Likewise.
	* rcstime.c (time2date, str2date, date2time, date2str): Likewise.
	* rlog.c (struct daterange): Likewise, for members ‘beg’, ‘end’.
	(recentdate, getdatepair): Likewise.

2017-09-28  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Use ‘strncpy’ less.

	* rlog.c (getdatepair): Use ‘memcpy’ directly.
	(ZERODATE): New #define.
	(KSTRCPY): Delete macro.
	(rlog_main): Use ‘memcpy’, ‘ZERODATE’.

2017-09-28  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Add abstraction: FULLDATESIZE

	* base.h (zonelenmax): Delete #define, folding value into...
	(FULLDATESIZE): ...this new #define.
	(date2str): Use ‘FULLDATESIZE’.
	* b-kwxout.c (keyreplace): Likewise.
	* ci.c (getlogmsg, ci_main): Likewise.
	* rcsdiff.c (setup_label): Likewise.
	* rcsrev.c (cantfindbranch, genbranch, genrevs): Likewise.
	* rcstime.c (date2time, date2str): Likewise.
	* rlog.c (putadelta): Likewise.

2016-10-31  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Expand ‘exit_diff_trouble’ to handle ‘complain’ calls.

	* rcsutil.c (exit_diff_trouble): Take FMT and varargs;
	call ‘vcomplain’ w/ them immediately before ‘_Exit’.
	(runv): Fold ‘complain’ calls preceding calls to
	‘exit_diff_trouble’ into args to ‘exit_diff_trouble’.

2016-10-31  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Add abstraction: chk_set_rev

	* rcsutil.c (chk_set_rev): New func.
	* base.h (chk_set_rev): New func decl.
	* ci.c (ci_main): Use ‘chk_set_rev’.
	* co.c (co_main): Likewise.
	* rcsclean.c (rcsclean_main): Likewise.

2016-10-29  Thien-Thi Nguyen  <ttn@gnu.org>

	rlog: Fix bug: Handle ed script with embedded NUL.

	Regression introduced 2010-05-24, "Rewrite parsing".

	* rlog.c (count_a_d): Don't use ‘memchr’
	to scan for newline; instead, use ‘memchr’.

2016-10-27  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Avoid unnecessary allocation in ‘string_from_atat’.

	This is a continuation of 2016-10-25,
	"Fix stack crash and port to non-VLA".

	* b-fro.c: Don't #include "xalloc.h".
	(string_from_atat RBEG): New local macro.
	(string_from_atat): Don't bother constructing an array
	of ranges; instead, use ‘RBEG’ and ‘atat->holes’ directly.

2016-10-27  Thien-Thi Nguyen  <ttn@gnu.org>

	Fix bug: Handle time-zone specified sans numeric offset.

	* partime.c (parzone): When only the name is given,
	and it is valid, set the output offset var using the
	value associated with the name in the lookup table.

2016-10-26  Paul Eggert  <eggert@cs.ucla.edu>

	[int] Fix stack crash for long branches

	This does not fix all recursive calls, just enough to fix
	likely cases, including the bug report by Haoming Chu at:
	http://lists.gnu.org/archive/html/bug-rcs/2016-10/msg00002.html
	* rlog.c (putadelta): Do not check ‘node->selector’; now the
	caller’s responsibility.  Remove arg TRUNK; now inferred from
	other args.  All callers changed.
	(putadelta, putrunk): Omit ‘register’ as the compiler should
	figure this stuff out nowadays.
	* rcsgen.c (putree):
	* rlog.c (putree, exttree, recentdate, extdate):
	Avoid recursion in the common case where !root->branches.
	* rlog.c (putree): Avoid recursion when outputting the last tree
	in the forest.
	(putabranch): Do not check whether arg is null; now the
	caller’s responsibility.  Avoid recursion in the common case
	where !root->selector.
	(putforest): Return last tree in the forest.
	(extractdelta): Return bool, not char.
	(extdate): Return size_t, not int.  All callers changed.

2016-10-25  Paul Eggert  <eggert@cs.ucla.edu>

	[int] Fix stack crash and port to non-VLA

	Crash reported by Michael Watters in:
	http://lists.gnu.org/archive/html/bug-rcs/2016-10/msg00000.html
	* b-fro.c: Include xalloc.h.
	(string_from_atat): Use xnmalloc rather than a variable-length array.
	VLAs (a) can crash if too big, and (b) are not supported by some C
	compilers.  C11 no longer requires support for VLAs.

2016-10-24  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Incorporate ‘normalize_arg’ into unique caller.

	* merger.c (normalize_arg): Delete func.
	(merge): Do argument normalization here.

2016-10-24  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Incorporate ‘escape_string’ into unique caller.

	* b-kwxout.c (escape_string): Delete func.
	(afilename): Do escaping here.

2016-10-24  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Make ‘accs’ into a function.

	* b-divvy.c (accs): New func.
	* b-divvy.h (accs): Replace macro w/ func decl.

2016-10-21  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Declare ‘ignoble’ as ‘exiting’.

	* b-grok.c (ignoble): ...here.

2016-10-21  Thien-Thi Nguyen  <ttn@gnu.org>

	[grok] Fix bug: Detect/diagnose missing string correctly.

	Regression introduced 2010-06-12, "Build atat object incrementally".

	* b-grok.c (maybe_read_atat): After skipping whitespace,
	if the next char is not ‘SDELIM’, don't bother constructing
	a length-zero atat and return ‘false’.
	(must_read_atat): Change diagnostic to be similar to RCS 5.7.

2016-10-17  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Add abstraction: afilename

	* b-kwxout.c (afilename): New static func.
	(keyreplace): Use ‘afilename’.

2016-10-16  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Make ‘putstring’ more efficient.

	* rcsgen.c (putstring): Don't loop byte by byte w/ ‘aputc’;
	instead, loop over ‘SDELIM’-delimited byte ranges w/ ‘awrite’.

2016-10-16  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Simplify ‘putstring’.

	* rcsgen.c (putstring): No longer take 2nd arg DELIM;
	output initial ‘SDELIM’ unconditionally.
	(putdesc, putadmin, putdftext): Update ‘putstring’ calls.
	* base.h (putstring): Update func decl accordingly.
	* rcs.c (scanlogtext): Update ‘putstring’ call.

2016-10-16  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Prepare to simplify ‘putstring’.

	* rcsgen.c (putdesc): Don't output ‘SDELIM’ here;
	instead, arrange for ‘putstring’ to do it.

2016-10-15  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Add abstraction: put_SDELIM

	* rcsgen.c (put_SDELIM): New static func.
	(putstring, putdftext): Use ‘put_SDELIM’.

2016-10-15  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Simplify ‘aputc’ + ‘putstring’ sequence.

	* rcs.c (scanlogtext): Remove ‘aputc’ call; change
	‘putstring’ arg DELIM to make it handle the ‘SDELIM’ output.

2016-10-15  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Add abstraction: newline

	* b-fb.c (newline): New func.
	* b-fb.h (newline): New func decl.
	* b-fro.c (atat_display): Use ‘newline’.
	* b-kwxout.c (keyreplace): Likewise.
	* ci.c (ci_main): Likewise.
	* rcs.c (scanlogtext): Likewise.
	* rcsgen.c (putdesc, putstring, putdftext): Likewise.
	* rlog.c (putadelta, rlog_main): Likewise.

2016-10-13  Thien-Thi Nguyen  <ttn@gnu.org>

	[doc] Fix bug: Add space between merge option ‘-L’ and its arg.

	* merge.c (:help comment): ...here.

2016-10-13  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Simplify computation of obstack mask alignment.

	* b-divvy.c (make_space): For ‘width’, replace assignment
	plus conditional reassignment w/ single ‘?:’ expression.

2015-06-18  Thien-Thi Nguyen  <ttn@gnu.org>

	[C slog] Move ‘exiting’ to beginning of func decl.

	Apparently, ‘gcc --std=c11’ does not abide the ‘exiting’
	attribute appearing at the end of the func decl.
	Reported by Romain Francoise.
	See also <https://bugs.debian.org/778100>.

	* b-complain.h (generic_fatal, fatal_syntax, fatal_sys)
	* b-fb.h (Ierror, Oerror)
	* base.h (unexpected_EOF, thank_you_and_goodnight):
	Move ‘exiting’ attribute to beginning of func decl.

2015-02-19  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Add abstraction: accumulate_nbytes

	* b-divvy.c (accumulate_nbytes): New func.
	* b-divvy.h (accumulate_nbytes): New func decl.
	* b-fro.c (string_from_sym): Use ‘accumulate_nbytes’.
	* ci.c (ADD): Likewise.
	* rcsfnms.c (fin2open ACC): Likewise.

2015-02-18  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Centralize "possible-endings" defaulting.

	* rcsutil.c (gnurcs_init): Init ‘BE (pe)’ here.
	* ci.c (ci_main): Don't init ‘BE (pe)’.
	* co.c (co_main): Likewise.
	* rcs.c (rcs_main): Likewise.
	* rcsclean.c (rcsclean_main): Likewise.
	* rcsdiff.c (rcsdiff_main): Likewise.
	* rcsmerge.c (rcsmerge_main): Likewise.
	* rlog.c (rlog_main): Likewise.
	* base.h (X_DEFAULT): Delete #define.

2015-02-02  Thien-Thi Nguyen  <ttn@gnu.org>

	[slog] Consult USER before LOGNAME if latter is configure-time readonly.

	* b-excwho.c (CONSULT_FIRST, CONSULT_SECOND):
	New #define:s, bifurcated on ‘USER_OVER_LOGNAME’.
	(getusername): Use ‘CONSULT_FIRST’, ‘CONSULT_SECOND’.

2015-01-28  Thien-Thi Nguyen  <ttn@gnu.org>

	[C int] Use local var to avoid gcc warning.

	* b-isr.c (access_page): Change return type to ‘char’; return ‘t’.
	* b-isr.h (access_page): Update func decl.

2015-01-27  Thien-Thi Nguyen  <ttn@gnu.org>

	[build slog] Fix bug: Propagate makefile var ‘LIBTHREAD’.

	Omission since 5.8, or so.  Gnulib module ‘threadlib’ includes
	configure-script bits to set makefile var ‘LIBTHREAD’.  RCS has no
	concept of threads and does not specify ‘threadlib’ directly; it is a
	dependency of other Gnulib modules.  Reported by Michael Felt:
	<http://lists.gnu.org/archive/html/bug-rcs/2015-01/msg00004.html>.

	* Makefile.am (LDADD): Append $(LIBTHREAD), as well.

2015-01-24  Thien-Thi Nguyen  <ttn@gnu.org>

	[C slog] Add abstraction: BOOLEAN

	This silences a warning under AIX.  Reported by Michael Felt:
	<http://lists.gnu.org/archive/html/bug-rcs/2015-01/msg00007.html>.

	* base.h (BOOLEAN): New macro.
	* b-grok.c (maybe_read_atat): Use it.

2015-01-22  Thien-Thi Nguyen  <ttn@gnu.org>

	Release: 5.9.4

2015-01-18  Thien-Thi Nguyen  <ttn@gnu.org>

	[C int] Use a local variable.

	* b-grok.c (full): ...here, in "revisions"-chaining loop.

2015-01-18  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Use ‘MEM_SAME’ more.

	* b-anchor.c (pool_lookup): ...here.

2014-12-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[C int] Init local var ‘buf’.

	This avoids a "may be used uninitialized" warning from GCC.

	* partime.c (lookup): ...here.

2014-11-26  Thien-Thi Nguyen  <ttn@gnu.org>

	[C int] Drop redundant ‘const’ declarations.

	* rcsdiff.c (minus_y, minus_D, longopt_maybe_p): ...here.

2014-11-23  Thien-Thi Nguyen  <ttn@gnu.org>

	[C int] Drop redundant ‘const’ declarations.

	* partime.c (month_names, weekday_names, zone_names): ...here.

2014-09-17  Thien-Thi Nguyen  <ttn@gnu.org>

	Release: 5.9.3

2014-09-13  Achim Gratz  <Achim.Gratz@Stromeko.DE>  (tiny change)

	Fix bug: Ensure stdio/fd sync around diff(1) invocation.

	Regression introduced 2010-10-12, "Simplify
	stream/fd sync; avoid ‘fflush’ on input".

	* ci.c (ci_main): Don't bother doing ‘fro_bob’
	prior to running diff(1); instead, do it afterwards.

2014-09-07  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Inline ‘struct obstack’ object in ‘struct divvy’.

	* b-divvy.h: #include <obstack.h>.
	(struct divvy): Make member ‘space’ into ‘struct obstack’.
	* b-divvy.c: Don't #include <obstack.h>.
	(make_space): Don't dynamically allocate ‘divvy->space’;
	update ref to ‘divvy->space’ for ‘obstack_init’,
	‘obstack_alignment_mask’ and ‘obstack_next_free’.
	(alloc, intern, brush_off, forget, accf, accumulate_byte)
	(accumulate_range, finish_string, pointer_array):
	Update divvy ‘space’ refs accordingly.
	(close_space): Likewise; also don't bother ‘free’ing ‘divvy->space’.
	* b-grok.c: Don't #include <obstack.h>.
	(ignoble, start_atat, finish_atat, maybe_read_atat):
	Update divvy ‘space’ refs accordingly.

2014-09-07  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Use gnulib module ‘xalloc’.

	* b-divvy.c: #include "xalloc.h".
	(oom, okalloc, allocate): Delete funcs.
	(TMALLOC): Use ‘xmalloc’.
	(TCALLOC): Delete macro.
	(xmalloc): Delete func.
	(make_space): Use ‘TMALLOC’; specify ‘xalloc_die’ instead of ‘oom’.
	* b-divvy.h (okalloc): Delete func decl.
	* rcsedit.c: #include "xalloc.h".
	(insertline): Don't use ‘okalloc’, ‘malloc’, ‘realloc’;
	instead, use ‘xmlloc’, ‘xrealloc’ directly.

2014-09-07  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Use gnulib module ‘exitfail’.

	* b-complain.h: #include "exitfail.h".
	* ci.c (cleanup): Use ‘exit_failure’.
	* co.c (cleanup): Likewise.
	* ident.c (scanfile, main): Likewise.
	* rcs.c (cleanup): Likewise.
	* rcsclean.c (cleanup): Likewise.
	* rcsutil.c (thank_you_and_goodnight): Likewise.
	* rlog.c (cleanup): Likewise.

2014-08-31  Thien-Thi Nguyen  <ttn@gnu.org>

	[build int] Use gnulib module to declare non-NULL args.

	* base.h (ARG_NONNULL): New macro.
	(ALL_NONNULL): New #define.

2014-08-30  Thien-Thi Nguyen  <ttn@gnu.org>

	Drop compatibility w/ RCS 2.x file format.

	* base.h [COMPAT2] (tiny_suffix): Delete decl.
	* b-anchor.c [COMPAT2] (tiny_suffix): Delete.
	* b-grok.c (full) [COMPAT2]: Drop ‘suffix’ probe/handling.

2014-08-16  Hannes Küttner  <hannes.kuettner@meinberg.de>  (tiny change)

	Fix bug: Don't ignore ‘bp->ilk’ when pruning.

	Continuation of 2010-11-14, "Fix bug:
	For unchanged checkin, invalidate ‘newdelta’".
	Regression introduced 2010-05-24, "Rewrite parsing".

	* ci.c (prune): Handle case where ‘wrong’ is ‘bp’ successor.

2014-08-09  Thien-Thi Nguyen  <ttn@gnu.org>

	[build] Use gnulib module ‘vla’.

	* base.h: #include "vla.h".
	(ARSZ_FN_PARM): Delete macro.
	* b-feph.c (reap): Use ‘VLA_ELEMS’.
	* b-isr.c (setup_catchsig): Likewise.
	* ident.c (main): Likewise.
	* merge.c (main): Likewise.
	* super.c (main): Likewise.

2014-08-09  Thien-Thi Nguyen  <ttn@gnu.org>

	[build] Use gnulib module ‘vararrays’.

	* base.h (ARSZ_FN_PARM): Use ‘__STDC_NO_VLA__’.

2014-08-05  Thien-Thi Nguyen  <ttn@gnu.org>

	[C] Convert ‘**argv’ to ‘*argv[ARSZ_FN_PARM (argc)]’.

	* ident.c (main)
	* merge.c (main)
	* super.c (main): ...here.

2014-08-05  Thien-Thi Nguyen  <ttn@gnu.org>

	[C] Use ‘ARSZ_FN_PARM’.

	* b-feph.c (reap)
	* b-isr.c (setup_catchsig): ...here, for array arg.

2014-08-05  Thien-Thi Nguyen  <ttn@gnu.org>

	[C int] Add ‘ARSZ_FN_PARM’.

	* base.h (ARSZ_FN_PARM): New macro, using ‘ARSZ_FN_PARM_OK’.

2014-08-02  Paul Eggert  <eggert@cs.ucla.edu>

	Port to Solaris 10, which uses GCC 3.4.3.
	Array problem reported by Nelson H. F. Beebe.
	* b-feph.c (reap):
	* b-isr.c (setup_catchsig):
	Comment out size of array parameter, as GCC 3.4.3 doesn't allow it.
	* b-isr.c (catchsigaction): Use 'char *' (not 'const char *')
	for a local variable, to pacify Solaris 10 psiginfo.

2013-11-28  Thien-Thi Nguyen  <ttn@gnu.org>

	Release: 5.9.2

2013-10-20  Thien-Thi Nguyen  <ttn@gnu.org>

	[C int] Prefer bit-shift to multiplication.

	* b-fro.c (fro_open): ...here, when
	comparing the comma-v size to the memory limit.

2013-10-20  Thien-Thi Nguyen  <ttn@gnu.org>

	Relax RCS_MEM_LIMIT default; fall back if unspecified.

	* base.h (MEMORY_UNLIMITED): New #define.
	* rcsutil.c (gnurcs_init): If unspecified,
	default ‘BE (mem_limit)’ to ‘MEMORY_UNLIMITED’.
	* b-fro.c (fro_open): Notice ‘MEMORY_UNLIMITED’ mem limit;
	in that case, don't check file size, and on ‘RM_MMAP’ or
	‘RM_MEM’ failure, retry w/ the "next" method: ‘RM_MEM’ or
	‘RM_STDIO’, respectively.

2013-10-17  Thien-Thi Nguyen  <ttn@gnu.org>

	Fix typo: Spell "compatib..." correctly!

	Reported by Romain Francoise.

	* base.h: Do ‘s/compatab/compatib/g’.
	* super.c: Likewise.

2013-10-04  Thien-Thi Nguyen  <ttn@gnu.org>

	Release: 5.9.1

2013-09-25  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Decruft: Delete some "set but not used" local vars.

	* b-grok.c (must_semi): Delete var ‘was’.
	* rcsrev.c (fully_numeric): Delete var ‘have_branch’.

2013-09-25  Thien-Thi Nguyen  <ttn@gnu.org>

	[build] Fix bug: Avoid ‘$<’ in makefile actions.

	* Makefile.am ($(subs)): Use ‘$(srcdir)/sub.TEMPLATE’ directly.
	Reported by Paul Eggert.

2013-09-24  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Use ‘DIFF_L’ as C value.

	* rcsdiff.c (setup_label): Remove surrounding ‘#if DIFF_L’.
	(rcsdiff_main): Convert ‘#if DIFF_L’..‘#endif’ to
	‘if (DIFF_L) { ... }’ and in some cases merge into sub-‘if’.

2013-09-24  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Use ‘BAD_CREATE0’ as C value.

	* rcs.c (rcs_main): Convert ‘#if BAD_CREATE0’..‘#endif’
	to ‘if (BAD_CREATE0) { ... } else { ... }’.
	* rcsgen.c (putadmin): Likewise.
	* rcsedit.c (dorewrite, donerewrite): Likewise,
	merging into sub-‘if’ in some instances.

2013-09-24  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Use ‘WOE’ as C value.

	* rcsfnms.c (isSLASH): Convert ‘#if ! WOE’..‘#endif’
	to ‘if (! WOE) { ... } else { ... }’.

2013-09-24  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Use ‘MMAP_SIGNAL’ as C value.

	* b-fro.c (mmap_deallocate): Remove surrounding ‘#if MMAP_SIGNAL’.
	(fro_open): Convert ‘#if MMAP_SIGNAL’..‘#endif’
	to ‘if (MMAP_SIGNAL) { ... } else { ... }’.

2013-09-24  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Use ‘DIFF3_BIN’ as C value.

	* merger.c (merge): Convert ‘#if DIFF3_BIN’..‘#endif’
	to ‘if (DIFF3_BIN) { ... } else { ... }’.

2013-09-24  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Use ‘BAD_B_RENAME’ as C value.

	* rcsedit.c (chnamemod): Convert ‘#if BAD_B_RENAME’..‘#endif’
	to ‘if (BAD_B_RENAME) { ... }’ and merge into the the sub-‘if’.

2013-09-24  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Use ‘BAD_WAIT_IF_SIGCHLD_IGNORED’ as C value.

	* b-isr.c (maybe_reset_sigchld): Convert
	‘#if BAD_WAIT_IF_SIGCHLD_IGNORED’..‘#endif’ to
	‘if (BAD_WAIT_IF_SIGCHLD_IGNORED) { ... }’.

2013-09-24  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Use ‘BAD_A_RENAME’, ‘bad_NFS_rename’ as C values.

	* rcsedit.c (chnamemod): Convert ‘#if COND’..‘#endif’
	to ‘if (COND) { ... }’ where COND includes ‘BAD_A_RENAME’
	and/or ‘bad_NFS_rename’.  In one instance, merge COND
	with that of the sub-‘if’.

2013-09-24  Thien-Thi Nguyen  <ttn@gnu.org>

	Fix bug: Construct diff command-line correctly for non-POSIX.

	See: <https://savannah.gnu.org/bugs/?40091>.
	Reported by David Binderman.

	This is a long-standing bug, first appearing in RCS 5.7,
	released 1995-06-16.  We don't add a test because it affects
	non-POSIX systems, which are not easily available to the
	maintainers.

	* rcs.c (buildeltatext): Change ‘==’ to ‘=’
	in the case of appending "--binary" to the command line.

2013-09-23  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Use ‘OPEN_O_BINARY’ as a C value.

	Since base.h takes pains to #define this in all cases, might
	as well use it in its C-value capacity, instead of only as a
	CPP value, thus gaining some visibility for the compiler.

	* b-fro.c (fro_open): Convert gating via ‘OPEN_O_BINARY’
	from ‘#if OPEN_O_BINARY’..‘#endif’ to C value.
	* ci.c (ci_main): Likewise.
	* rcs.c (buildeltatext): Likewise.
	* rcsdiff.c (rcsdiff_main): Likewise.

2013-08-06  Thien-Thi Nguyen  <ttn@gnu.org>

	Add homepage / "gethelp" to ‘--help’ output.

	* gnu-h-v.c (AB, GNU): New macros.
	(BUGME): Use ‘AB’ for ‘PACKAGE_BUGREPORT’;
	add ‘GNU’ entries for homepage and general help URLs.

2013-05-06  Thien-Thi Nguyen  <ttn@gnu.org>

	Release: 5.9.0

2013-05-04  Thien-Thi Nguyen  <ttn@gnu.org>

	[build int] Presume availability of ‘ftruncate’.

	* ci.c: Don't check for ‘HAVE_FTRUNCATE’;
	don't define always-erroneous replacement.

2013-05-04  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Presume ‘SIGCHLD’ defined.

	* b-isr.c (maybe_reset_sigchld) [BAD_WAIT_IF_SIGCHLD_IGNORED]:
	Don't bother ensuring a #define for ‘SIGCHLD’.

2013-05-04  Thien-Thi Nguyen  <ttn@gnu.org>

	Suggest "frob" as the legacy interface command name.

	* super.c <help text>: ...here.

2013-05-04  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Add abstraction: string_from_sym

	* super.c (string_from_sym): New static func.
	(display_commands, display_aliases): Use it.

2013-05-03  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Bump max command name size to 64.

	* super.c (MAX_COMMAND_SIZE): New #define.
	(display_commands, display_aliases): Use ‘MAX_COMMAND_SIZE’.

2013-05-03  Thien-Thi Nguyen  <ttn@gnu.org>

	Warn that option ‘-V’ is obsolete.

	U (X) ≡ "Pass X to ‘display_version’".
	V ≡ "Discourage ‘-V’ usage".
	* gnu-h-v.h (DV_WARN): New #define;
	update ‘display_version’ comment accordingly.
	* gnu-h-v.c: #include "b-complain.h".
	(display_version): If ‘DV_WARN’, emit warning before version info.
	* ident.c (main): Pass ‘DV_WARN’ to ‘display_version’.
	* ci.c <help text>: V.
	* co.c <help text>: V.
	* ident.c (main): U (DV_WARN)
	<help text>: V.
	* merge.c (main): U (DV_WARN).
	<help text>: V.
	* rcs.c <help text>: V.
	* rcsclean.c <help text>: V.
	* rcsdiff.c <help text>: V.
	* rcsmerge.c <help text>: V.
	* rlog.c <help text>: V.
	* rcsutil.c (setRCSversion): U (DV_WARN | DV_EXIT).

2013-05-03  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Add conditional exiting to ‘display_version’.

	* gnu-h-v.c (display_version): Take 2nd arg ‘flags’.
	If ‘DV_EXIT’, exit successfully.
	(check_hv): Update call to ‘display_version’.
	* gnu-h-v.h (DV_ONLY, DV_EXIT): New #define:s.
	(display_version): Update func decl.
	* ident.c (main): Update call to ‘display_version’.
	* merge.c (main): Likewise.
	* rcsutil.c (setRCSversion): Likewise.

2013-05-03  Thien-Thi Nguyen  <ttn@gnu.org>

	Use ‘getopt_long’.

	* gnu-h-v.h: #include <getopt.h>.
	(nice_getopt): New func decl.
	(NICE_OPT): New macro.
	(NO_MORE_OPTIONS): New #define.
	* gnu-h-v.c: #include "gnu-h-v.h".
	(nice_getopt): New func.
	(EXACTLY): Delete macro.
	(hv_option_values): New enum.
	(ok): New static array of ‘struct option’.
	(check_hv): Use ‘nice_getopt’ and ‘switch’ on its rv.
	* super.c (main): Replace manual string-comparison for
	‘--commands’ and ‘--aliases’ recognition with option table,
	‘nice_getopt’ call, and a ‘switch’ on the rv.

2013-05-02  Thien-Thi Nguyen  <ttn@gnu.org>

	Add "rcs --aliases".

	* super.c (display_commands): Don't display aliases.
	(display_aliases): New static func.
	(main): Display aliases if given "--aliases".
	<help text>: Add ‘--aliases’ to options.

2013-05-02  Thien-Thi Nguyen  <ttn@gnu.org>

	Internalize some RCS commands; make rcs(1) dispatch to them.

	U (MAIN, AKA) ≡
	"(top): Delete var.
	 (MAIN): Rename from ‘main’; take arg ‘cmd’; pass it to ‘CHECK_HV’.
	 (AKA): New static uint8_t array.
	 <top-level>: Use ‘YET_ANOTHER_COMMAND’".
	* b-yacmd.h: New file.
	* sub.TEMPLATE: New file.
	* super.c: New file.
	* Makefile.am (subs, bin_SCRIPTS): New vars.
	($(subs)): New target.
	(libparts_a_SOURCES): Add b-yacmd.h.
	(executables): Remove ci, co, rcsclean, rcsdiff, rcsmerge, rlog.
	(BUILT_SOURCES): Add $(subs:=.help), super.help.
	(rcs_SOURCES): New var.
	(CLEANFILES): Add $(subs).
	(EXTRA_DIST): Add sub.TEMPLATE.
	* b-peer.h (peer_super): Rename var decl from ‘peer_co’.
	(PEER_SUPER): Rename macro from ‘PEER_CO’; use ‘peer_super’.
	* b-peer.c (peer_super): Raname from ‘peer_co’; use "rcs".
	* ci.c: U (ci_main, ci_aka).
	* co.c: U (co_main, co_aka).
	(VX): Bump to 3.
	(buildjoin): Use ‘PEER_SUPER’ and command "co".
	* rcs.c: U (rcs_main, rcs_aka).
	* rcsclean.c: U (rcsclean_main, rcsclean_aka).
	* rcsdiff.c: U (rcsdiff_main, rcsdiff_aka).
	(rcsdiff_main): Use ‘PEER_SUPER’ and command "co".
	* rcsmerge.c: U (rcsmerge_main, rcsmerge_aka).
	(rcsmerge_main): Use ‘PEER_SUPER’ and command "co".
	* rlog.c: U (rlog_main, rlog_aka).

2013-05-02  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Move ‘program’ to top-level.

	* gnu-h-v.h (CHECK_HV): Take arg ‘cmd’; set
	‘program.invoke’ and ‘program.name’ prior to ‘check_hv’ call.
	(DECLARE_PROGRAM): New macro.
	* ci.c: Use ‘DECLARE_PROGRAM’.
	(main): Delete local var ‘program’; update call to ‘CHECK_HV’.
	* co.c: Likewise.
	* ident.c: Likewise.
	* merge.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsmerge.c: Likewise.
	* rlog.c: Likewise.

2013-05-01  Thien-Thi Nguyen  <ttn@gnu.org>

	Include one-line description in ‘--help’ output.

	* base.h (struct program): Add member ‘desc’.
	* ci.c (main): Init ‘program.desc’.
	* co.c (main): Likewise.
	* ident.c (main): Likewise.
	* merge.c (main): Likewise.
	* rcs.c (main): Likewise.
	* rcsclean.c (main): Likewise.
	* rcsdiff.c (main): Likewise.
	* rcsmerge.c (main): Likewise.
	* rlog.c (main): Likewise.
	* gnu-h-v.c (check_hv): For ‘--help’ output,
	display the program description between the usage
	line and the the rest of the rest of the help text.

2013-04-29  Thien-Thi Nguyen  <ttn@gnu.org>

	merge: Don't accept ‘-V’ with an argument.

	* merge.c (main): If given ‘-V’ with an argument,
	display error message and exit failurefully.

2013-04-29  Thien-Thi Nguyen  <ttn@gnu.org>

	ident: Don't accept ‘-V’ with an argument.

	* ident.c (main): If given ‘-V’ with an argument,
	display error message and exit failurefully.

2013-04-11  Thien-Thi Nguyen  <ttn@gnu.org>

	[build] Add sanity check for .help generation.

	* Makefile.am (.c.help): After extraction, if the .help
	file is empty, display error message and exit failurefully.

2013-04-11  Thien-Thi Nguyen  <ttn@gnu.org>

	co: Add option ‘-S’ to enable "self-same" mode.

	Suggested by James Olin Oden:
	<https://bugzilla.redhat.com/show_bug.cgi?id=107947>.

	* b-excwho.c (addlock_maybe): Rename from ‘addlock’; take additional
	arg ‘bool selfsame’; if true, don't distinguish who holds a lock.
	* b-excwho.h (addlock_maybe): Update func decl.
	(addlock): New macro.
	* co.c (main): Add handling for ‘-S’; use ‘addlock_maybe’.
	<help text>: Add ‘-S’ to options.

2013-04-11  Thien-Thi Nguyen  <ttn@gnu.org>

	ident: Recognize Subversion "fixed-width keyword syntax".

	Suggested by Carlie J. Coats, Jr. and Jiri Moskovcak:
	<https://bugzilla.redhat.com/show_bug.cgi?id=247998>.

	* ident.c (match): Accept additional colon after the first
	is found; in that case, also allow hash before final ‘KDELIM’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘rmvlocklst’ from global state of rcs(1).

	* rcs.c (struct adminstuff): Add member ‘byelocks’.
	(rmvlocklst): Delete var.
	(dolocks): Use ‘dc->byelocks’.
	(main): Use ‘dc.byelocks’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘newlocklst’ from global state of rcs(1).

	* rcs.c (struct adminstuff): Add member ‘newlocks’.
	(newlocklst): Delete var.
	(rmnewlocklst): Take arg ‘dc’; use ‘dc->newlocks’.
	(dolocks): Use ‘dc->newlocks’.
	(main): Use ‘dc.newlocks’; update call to ‘rmnewlocklst’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘delrev’ from global state of rcs(1).

	* rcs.c (struct adminstuff): Add member ‘delrev’.
	(putdelrev): Interpret arg ‘data’ to be ‘adminstuff *dc’;
	use ‘dc->delrev’.
	(removerevs): Use ‘dc->delrev’.
	(main): Use ‘dc.delrev’; update call to ‘parse_revpairs’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘lockhead’, ‘unlockcaller’ from global state of rcs(1).

	* rcs.c (struct adminstuff):
	Add members ‘lockhead’, ‘unlockcaller’.
	(lockhead, unlockcaller): Delete vars.
	(dolocks): Use ‘dc->unlockcaller’, ‘dc->lockhead’.
	(main): Use ‘dc.lockhead’, ‘dc.unlockcaller’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘suppress_mail’ from global state of rcs(1).

	* rcs.c (struct adminstuff): Add member ‘suppress_mail’.
	(suppress_mail): Delete var.
	(sendmail): Take 3rd arg ‘suppress_mail’.
	(breaklock): Take 2nd arg ‘suppress_mail’; update call to ‘sendmail’.
	(setlock, dolocks): Update calls to ‘breaklock’.
	(main): Use ‘dc.suppress_mail’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove outdate vars from global state of rcs(1).

	U (X...) ≡ "Take arg ‘dc’; use ‘dc->X’, ...";
	U (*) ≡ U (cuthead, cuttail, delstrt).
	* rcs.c (struct adminstuff):
	Add members ‘cuthead’, ‘cuttail’, ‘delstrt’.
	(cuthead, cuttail, delstrt): Delete vars.
	(scanlogtext): U (cuttail).
	(searchcutpt): U (cuthead).
	(removerevs): U (*); update call to ‘searchcutpt’.
	(buildeltatext): U (cuttail, cuthead); update call to ‘scanlogtext’.
	(buildtree): U (*).
	(main): Use ‘dc.cuthead’, ‘dc.cuttail’; update calls to
	‘removerevs’, ‘buildtree’, ‘buildeltatext’, ‘scanlogtext’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘messagelst’ from global state of rcs(1).

	* rcs.c (struct adminstuff): Add members ‘logs’, ‘tp_log’.
	(messagelst): Delete var.
	(getmessage): Take ‘dc’, not ‘tp’; use ‘dc->tp_log’.
	(domessages): Use ‘dc->logs’.
	(main): Delete auto var ‘tp_log’;
	update call to ‘getmessage’; use ‘dc.logs’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘assoclst’ from global state of rcs(1).

	* rcs.c (struct adminstuff): Add members ‘assocs’, ‘tp_assoc’.
	(assoclst): Delete var.
	(getassoclst): Take ‘dc’, not ‘tp’; use ‘dc->tp_assoc’.
	(doassoc): Take arg ‘dc’; use ‘dc->assocs’.
	(main): Delete auto var ‘tp_assoc’;
	update calls to ‘getassoclst’, ‘doassoc’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘chaccess’ from global state of rcs(1).

	* rcs.c (struct adminstuff): Add members ‘accesses’, ‘tp_access’.
	(chaccess): Delete var.
	(getchaccess): Take ‘dc’, not ‘tp’; use ‘dc->tp_access’.
	(getaccessor): Take ‘dc’, not ‘tp’; update calls to ‘getchaccess’.
	(doaccess): Take arg ‘dc’; use ‘dc->accesses’.
	(main): Delete auto var ‘tp_chacc’; update
	calls to ‘getaccessor’, ‘getchaccess’, ‘doaccess’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove repo-state-change vars from global state of rcs(1).

	* rcs.c (struct adminstuff): Add members
	‘headstate’, ‘headstate_changed_p’, ‘states’, ‘tp_state’.
	(headstate, chgheadstate, statelst): Delete vars.
	(getstates): Take ‘dc’, not ‘tp’; use ‘dc->tp_state’,
	‘dc->headstate_changed_p’, ‘dc->headstate’.
	(main): Delete auto var ‘tp_state’; update call to ‘getstates’;
	use ‘dc.headstate_changed_p’, ‘dc.headstate’, ‘dc.states’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘revnum’ from global state of rcs(1).

	* rcs.c (revnum): Delete var.
	(removerevs, doassoc, setlock, dolocks)
	(domessages, rcs_setstate): Add auto var ‘numrev’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Move rcs.c ‘main’ auto var ‘deltas’ into adminstuff.

	U ≡ "Take ‘dc’, not ‘tp_deltas’";
	V ≡ "U; use ‘&dc->deltas’".
	* rcs.c (struct adminstuff): Add member ‘deltas’.
	(setlock): V.
	(dolocks): Likewise; update calls to ‘setlock’.
	(domessages, rcs_setstate): V.
	(main): Delete auto var ‘deltas’; update calls to ‘dolocks’,
	‘domessages’, ‘rcs_setstate’; use ‘dc.deltas’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Move a rcs.c ‘main’ auto var into a structure.

	* rcs.c (struct adminstuff): New.
	(main): Replace auto var ‘exitstatus’ with ‘dc’;
	update calls to ‘cleanup’; use ‘dc.rv’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove {force,lock,mtime}flag from global state of co(1).

	* co.c (struct work): Add member ‘force’.
	(forceflag, lockflag, mtimeflag): Delete vars.
	(rmworkfile): Use ‘work->force’.
	(main): Update initialization form for auto var ‘work’;
	add auto vars ‘lockflag’, ‘mtimeflag’; use ‘work.force’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘targetdelta’ from global state of co(1).

	* co.c (struct jstuff): Add member ‘d’.
	(targetdelta): Delete var.
	(preparejoin, buildjoin): Use ‘js->d’.
	(main): Use ‘jstuff.d’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘neworkptr’ from global state of co(1).

	* co.c (neworkptr): Delete var.
	(cleanup): Take 2nd var ‘neworkptr’.
	(main): Add auto var ‘neworkptr’; update calls to ‘cleanup’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove {expand,suffix,version,zone}arg from global state of co(1).

	* co.c (expandarg, suffixarg, versionarg, zonearg): Delete vars.
	(struct jstuff): Add members ‘expand’, ‘suffix’, ‘version’, ‘zone’.
	(buildjoin): Use ‘js->expand’,
	‘js->suffix’, ‘js->version’, ‘js->zone’.
	(main): Use ‘jstuff.suffix’, ‘jstuff.version’,
	‘jstuff.zone’, ‘jstuff.expand’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘joinlist’, ‘lastjoin’ from global state of co(1).

	* co.c (joinlist, lastjoin): Delete vars.
	(struct jstuff): Add members ‘ls’, ‘lastidx’.
	(jpush): Use ‘js->lastidx’.
	(preparejoin): Likewise; use ‘js->ls’.
	(buildjoin): Use ‘js->lastidx’, ‘js->ls’.

2011-10-14  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Remove ‘jstuff’ from global state of co(1).

	* co.c (jstuff): Delete var.
	(jpush): Take 2nd arg ‘js’; use ‘js->’.
	(addjoin): Take 2nd arg ‘js’; update call to ‘jpush’.
	(preparejoin): Take 2nd arg ‘js’; use ‘js->’;
	update call to ‘addjoin’, ‘jpush’.
	(buildjoin): Take 2nd arg ‘js’; use ‘js->’.
	(main): Add auto var ‘jstuff’;
	update calls to ‘preparejoin’, ‘buildjoin’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘workstat’ from global state of co(1).

	* co.c (struct work): New.
	(workstat): Delete var.
	(rmworkfile): Take arg ‘work’; use ‘work->st’.
	(main): Add auto var work; use ‘work.st’;
	update calls to ‘rmworkfile’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘insDelFormat’ from global state of rlog(1).

	* rlog.c (insDelFormat): Delete var.
	(putadelta): Take 4th arg ‘insDelFormat’.
	(putrunk): Take arg ‘insDelFormat’; update call to ‘putadelta’.
	(putforest): Update forward func decl.
	(putree): Take 2nd arg ‘insDelFormat’;
	update calls to self, ‘putforest’.
	(putabranch): Take 2nd arg ‘insDelFormat’;
	update calls to self, ‘putadelta’.
	(putforest): Take 2nd arg ‘insDelFormat’;
	update calls to self, ‘putabranch’, ‘putree’.
	(main): Add auto var ‘insDelFormat’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘Revlst’ from global state of rlog(1).

	* rlog.c (struct criteria): Add member ‘actual’.
	(Revlst): Delete var.
	(extractdelta, getnumericrev): Use ‘criteria->actual’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘statelist’ from global state of rlog(1).

	* rlog.c (struct criteria): Add member ‘states’.
	(statelist): Delete var.
	(extractdelta): Use ‘criteria->states’.
	(getstate): Take 2nd arg ‘criteria’; use ‘criteria->states’.
	(main): Update initialization form of auto var ‘criteria’;
	update call to ‘getstate’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘lockerlist’ from global state of rlog(1).

	* rlog.c (struct criteria): Add member ‘lockers’.
	(lockerlist): Delete var.
	(getlocker): Take 2nd arg ‘criteria’; use ‘criteria->lockers’.
	(trunclocks): Take arg ‘criteria’; use ‘criteria->lockers’.
	(main): Update initialization form of auto var ‘criteria’;
	update calls to ‘getlocker’, ‘trunclocks’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘authorlist’ from global state of rlog(1).

	* rlog.c (struct criteria): Add member ‘authors’.
	(extractdelta): Take 3rd arg ‘criteria’; use ‘criteria->authors’.
	(exttree): Take 3rd arg ‘criteria’; update call to ‘extractdelta’.
	(getauthor): Take 2nd arg ‘criteria’; use ‘criteria->authors’.
	(main): Update initialization form of auto var ‘criteria’;
	update calls to ‘getauthor’, ‘exttree’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘revlist’ from global state of rlog(1).

	* rlog.c (struct criteria): New.
	(revlist): Delete var.
	(getnumericrev): Take 2nd arg ‘criteria’; use ‘criteria->revs’.
	(putrevpairs): Unmark ‘data’ as ‘RCS_UNUSED’;
	interpret ‘data’ as ‘criteria’; use ‘criteria->revs’.
	(main): Add auto var ‘criteria’; update
	calls to ‘parse_revpairs’, ‘getnumericrev’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Make ‘parse_revpairs’ accept/pass-through opaque data.

	* rcsutil.c (parse_revpairs): Take arg ‘data’; call ‘put’ with it.
	* base.h (parse_revpairs): Update func decl.
	* rcs.c (putdelrev): Take 4th arg ‘data’; mark it ‘RCS_UNUSED’.
	(main): Update call to ‘parse_revpairs’.
	* rlog.c (putrevpairs): Take 4th arg ‘data’; mark it ‘RCS_UNUSED’.
	(main): Update call to ‘parse_revpairs’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘datelist’, ‘duelst’ from global state of rlog(1).

	* rlog.c (struct date_selection): New.
	(datelist, duelst): Delete vars.
	(extdate, getdatepair): Take 2nd arg ‘datesel’;
	use ‘datesel->in’, ‘datesel->by’.
	(main): Add auto var ‘datesel’; update call to ‘getdatepair’;
	use ‘datsel.by’; update call to ‘extdate’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘lockflag’ from global state of rlog(1).

	* rlog.c (lockflag): Delete var.
	(extractdelta): Add 2nd arg ‘lockflag’.
	(exttree): Likewise; update call to ‘extractdelta’, self.
	(main): Add auto var ‘lockflag’; update call to ‘exttree’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘branchflag’ from global state of rlog(1).

	* rlog.c (branchflag): Delete var.
	(getnumericrev): Take arg BRANCHFLAG.
	(main): Add auto var ‘branchflag’; update call to ‘getnumericrev’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘workptr’, ‘workstat’ from global state of rcsdiff(1).

	* rcsdiff.c (workptr, workstat): Delete vars.
	(struct work): New.
	(cleanup): Take 2nd arg WORK; use ‘work->fro’.
	(main): Add auto var ‘work’; update calls
	to ‘cleanup’; use ‘work.fro’ and ‘work.st’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘workptr’ from global state of rcsclean(1).

	* rcsclean.c (workptr): Delete var.
	(cleanup): Take 2nd arg WORKPTR.
	(main): Add auto var ‘workptr’; update calls to ‘cleanup’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘getcurdate_buffer’ from global state of ci(1).

	* ci.c (struct bud): Add member ‘getcurdate_buffer’.
	(getcurdate_buffer): Delete var.
	(getcurdate): Take BUD; use ‘bud->getcurdate_buffer’.
	(getlogmsg): Drop ‘const’ from arg ‘bud’; update call to ‘getcurdate’.
	(main): Update call to ‘getcurdate’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘logmsg’ from global state of ci(1).

	* ci.c (struct reason): New.
	(logmsg): Delete var.
	(getlogmsg): Dno't take MSG; take REASON; use ‘reason->delayed’.
	(main): Delete auto var ‘msg’; add auto var ‘reason’;
	use ‘reason.upfront’; update calls to ‘getlogmsg’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘targetdelta’ from global state of ci(1).

	* ci.c (targetdelta): Delete var.
	(struct bud): Add member ‘target’.
	(addbranch, addelta, getlogmsg): Use ‘bud->target’.
	(main): Use ‘bud.target’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘keepflag’ from global state of ci(1).

	* ci.c (keepflag): Delete var.
	(struct bud): Add member ‘keep’.
	(getlogmsg): Use ‘bud->keep’.
	(main): Use ‘bud.keep’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘exfile’ from global state of ci(1).

	* ci.c (exfile): Delete var.
	(struct work): Add member ‘ex’.
	(cleanup): Use ‘work->ex’.
	(xpandfile): Don't take UNEXFILE; instead, take WORK.
	(main): Init ‘work.ex’ to NULL;
	update call to ‘xpandfile’; use ‘work.ex’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘default_state’ from global state of ci(1).

	* ci.c (default_state): Delete var.
	(main): Add auto var ‘default_state’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove new{delnum,delta,branch} from global state of ci(1).

	* ci.c (newdelnum, newdelta): Delete vars.
	(struct bud): New.
	(newbranch): Delete var.
	(addbranch): Don't take NUM; take BUD,
	instead; compute ‘num’ internally.
	(addelta): Move 2nd arg to 3rd position;
	take 2nd arg BUD; update calls to ‘addbranch’.
	(getlogmsg): Take 2nd arg BUD.
	(main): Add auto var ‘bud’; update calls to ‘addelta’, ‘getlogmsg’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘rcsinitflag’ from global state of ci(1).

	* ci.c (rcsinitflag): Delete var.
	(addelta): Take 2nd arg RCSINITFLAG.
	(main): Add auto var ‘rcsinitflag’; update call to ‘addelta’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘forceciflag’, ‘keepworkingfile’ from global state of ci(1).

	* ci.c (forceciflag, keepworkingfile): Delete var.
	(main): Add auto var ‘forceciflag’, ‘keepworkingfile’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘workptr’, ‘workstat’ from global state of ci(1).

	* ci.c (workptr, workstat): Delete vars.
	(struct work): New.
	(cleanup): Take 2nd arg WORK; use it instead of ‘workptr’.
	(fixwork): Take 3rd arg WORK; use it instead of ‘workptr’, ‘workstat’.
	(main): Add auto var ‘work’; update calls to ‘cleanup’, ‘fixwork’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘assoclst’ from global state of ci(1).

	* ci.c (assoclst): Delete var.
	(addsyms): Take 2nd arg LS; walk it directly.
	(first_meaningful_symbolic_name): Take arg LS;
	find its last link and use its entry as user symdef.
	(main): Rename auto var ‘tp_assoc’ to ‘symbolic_names’;
	push onto that list instead of extending it; update calls
	to ‘addsyms’ and ‘first_meaningful_symbolic_name’.

2013-04-10  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘msg’ from global state of ci(1).

	* ci.c (msg): Delete var.
	(getlogmsg): Take pointer to ‘msg’.
	(main): Add auto var ‘msg’; update calls to ‘getlogmsg’.

2013-04-09  Thien-Thi Nguyen  <ttn@gnu.org>

	[int] Remove ‘exitstatus’ from global state in programs.

	* ci.c (exitstatus): Delete var.
	(cleanup): Take pointer to ‘exitstatus’.
	(main): Add auto var ‘exitstatus’; update call to ‘cleanup’.
	* co.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.

2013-04-05  Thien-Thi Nguyen  <ttn@gnu.org>

	[rcsmerge] Fix bug: Include ‘-A’, ‘-E’, ‘-e’ in ‘--help’ output.

	Reported by Honza Horak.

	* rcsmerge.c <help text>: ...here.

2013-04-05  Thien-Thi Nguyen  <ttn@gnu.org>

	Mention ineffectual options more prominently.

	Suggested by Honza Horak.

	* rcsdiff.c <help text>: Add ‘-T’.
	* rcsmerge.c <help text>: Likewise.
	* rlog.c <help text>: Likewise.

2013-04-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Release: 5.8.2

2013-04-02  Thien-Thi Nguyen  <ttn@gnu.org>

	Fix bug: Also check terminating nul in symbol deref search.

	Regression introduced 2010-04-21, "Add abstraction: fully_numeric".

	* rcsrev.c (rev_from_symbol): ...here.

2013-03-30  Thien-Thi Nguyen  <ttn@gnu.org>

	Fix bug: Define syntax for ‘integrity’ value.

	* b-grok.c (full): If ‘integrity’ has a value and that
	value includes an internal '@' (U+40), signal a syntax error.

2012-06-05  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Release: 5.8.1

2012-05-20  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[doc] Say "checked in" instead of "commited" (sic).

	* rlog.c <help text>: Say "checked in" in ‘-w’ description.

2012-05-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstractions: ODDP, EVENP

	* base.h (ODDP, EVENP): New macros.
	* b-grok.c (maybe_read_num): Use ‘EVENP’.
	* ci.c (addbranch): Use ‘ODDP’, ‘EVENP’.
	(addelta): Use ‘EVENP’.
	(xpandfile): Use ‘ODDP’.
	* rcs.c (removerevs): Use ‘ODDP’.
	(setlock, dolocks, rcs_setstate): Use ‘EVENP’.
	* rcskeep.c (keeprev): Use ‘ODDP’.
	* rcsrev.c (accumulate_branchno, absent, fully_numeric): Likewise.
	* rlog.c (extractdelta): Likewise.

2012-05-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: SIZEOF_NLINES

	* rcsedit.c (SIZEOF_NLINES): New macro.
	(movelines, insertline): Use ‘SIZEOF_NLINES’.

2012-05-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Incorporate test{re,}alloc into unique caller.

	* rcsedit.c (testalloc, testrealloc): Delete funcs.
	(insertline): Use ‘okalloc’, ‘malloc’, ‘realloc’ directly.

2012-05-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Incorporate ‘exit_failurefully’ into unique caller.

	* base.h (exit_failurefully): Delete func decl.
	* rcsutil.c (exit_failurefully): Delete func.

2012-05-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Make ‘exit_diff_trouble’ static.

	* base.h (exit_diff_trouble): Delete func decl.
	* rcsutil.c (exit_diff_trouble): Make static.

2012-05-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Redo "exit errorfully" specialization/implementation.

	* rcsutil.c (thank_you_and_goodnight): New func.
	* base.h (struct program): Add member ‘tyag’; delete member ‘exiterr’.
	(thank_you_and_goodnight): New func decl.
	(TYAG_ORCSERROR, TYAG_DIRTMPUNLINK, TYAG_TEMPUNLINK, TYAG_DIFF)
	(TYAG_IMMEDIATE, BOG_DIFF, BOG_ZONK, BOG_FULL): New #define:s.
	(BOW_OUT): Rewrite.
	* ci.c (exiterr): Delete func.
	(ci_main): Update ‘program’ init form.
	* co.c (exiterr, co_main): Likewise.
	* ident.c (exiterr, main): Likewise.
	* merge.c (exiterr, main): Likewise.
	* rcs.c (exiterr, rcs_main): Likewise.
	* rcsclean.c (exiterr, rcsclean_main): Likewise.
	* rcsdiff.c (exiterr, rcsdiff_main): Likewise.
	* rcsmerge.c (exiterr, rcsmerge_main): Likewise.
	* rlog.c (exiterr, rlog_main): Likewise.

2012-05-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: BOW_OUT

	* base.h (BOW_OUT): New macro.
	* b-complain.c (die): Use ‘BOW_OUT’.
	* b-fb.c (Oerror): Likewise.
	* b-isr.c (werr, catchsigaction): Likewise.
	* ident.c (scanfile): Likewise.
	* merge.c (main): Likewise.
	* merger.c (merge): Likewise.

2012-05-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Expose ‘okalloc’ instead of ‘oom’.

	* rcsedit.c (okalloc): Move func from here...
	* b-divvy.c (oom): Make static.
	(okalloc): ...to here; make non-static.
	* b-divvy.h (oom): Delete func decl.
	(okalloc): Add func decl.

2012-04-06  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[C] Fix bug: Avoid ‘bool’ for temporary ‘int’ values.

	Regression introduced 2010-03-16, "Use `bool' (and `true'
	and `false') more".  When assigning to a bool from an int,
	if the int is negative, the bool will be true, losing
	information when that value is later compared against zero.
	Reported by Paul Ackersviller.

	* ci.c (addbranch): Change type of ‘removedlock’ back to ‘int’.

2012-01-20  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Add configure option ‘--enable-coverage’.

	* rcsutil.c [USE_NORMAL_EXIT] (_Exit): New #define.

2012-01-15  Thien-Thi Nguyen  <ttn@gnuvola.org>

	ci: Fix bug: Don't discard working file mtime with ‘-T’.

	Regression introduced 2010-03-13, "Topo-sort top-level;
	eliminate redundant forward func decls".

	* ci.c (ci_main): Move incorrectly-placed parens in
	sub-conditional-expression from "partial condition" to
	condition; add additional pair of parens around sub-cond-expr.

2012-01-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Invoke diff(1) with ‘--label’ instead of ‘-L’.

	* rcsdiff.c (setup_label): Use "--label", not "-L".

2011-12-26  Oliver Billmann  <gnubug@billmann-edv.net>  (tiny change)

	Fix bug: Fully init ‘struct tm t’ used for ‘-zLT’ handling.

	On the i686 machine it was "initialized" with some large negative
	number which will than lead to tm_yday being initialized in tm2time.
	But on the x86_64 machine it contained the valid value 0 which than
	always leads to YYYY-01-01.

	ttn sez: Regression introduced 2011-01-13,
	"Fix bug: Don't clobber ‘yday’ unconditionally".
	To avoid this class of bug in the future, when converting
	an assignment from unconditional to conditional, be sure
	to initialize "upstream" of the conversion location,
	in effect, moving the unconditional assignment earlier.

	* rcstime.c (date2str): Init also ‘t.tm_yday’.

2011-12-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	rlog: Fix bug: Remove debugging instrumentation.

	Code introduced 2010-06-01, "Add abstractions:
	{NUM,DATE}_{LT,EQ,GT}, NUMF_{LT,EQ}".
	This is a bug fix and not merely "decruft" because
	in the meantime, RCS 5.8 was released.  :-(

	* rlog.c (extdate): Remove calls to ‘complain’.

2011-10-30  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[dist] Decruft: Don't distribute TAGS.

	* Makefile.am (EXTRA_DIST): Remove TAGS, $(TESTS).

2011-10-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Make ‘accumulate_range’ faster.

	* b-divvy.c (accumulate_range): Use ‘obstack_grow’.

2011-10-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘COMMAND_LINE_VARYING’ more.

	Omission from 2011-10-28, "Add
	abstraction: COMMAND_LINE_VARYING".

	* rcsdiff.c (main): Use ‘COMMAND_LINE_VARYING’ for "-M".

2011-10-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: one_beyond_last_dir_sep

	* b-beer.h (one_beyond_last_dir_sep): New func decl.
	* b-peer.c (one_beyond_last_dir_sep): New func.
	(find_peer_prog): Use ‘one_beyond_last_dir_sep’.

2011-10-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: VX

	* co.c (VX): New #define.
	(buildjoin): Use ‘VX’.

2011-10-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Use portable Makefile subst-ref variable syntax.

	The syntax $(VAR:%=%SUFFIX) is a GNU Make extension.

	* Makefile.am (BUILT_SOURCES): Use $(VAR:=SUFFIX).

2011-10-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: COMMAND_LINE_VARYING

	* rcsdiff.c (COMMAND_LINE_VARYING): New #define.
	(main): Use ‘COMMAND_LINE_VARYING’.

2011-10-18  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build int] Use gnulib to implement ‘exiting’ func attribute.

	* base.h (exiting): Use ‘_Noreturn’ directly.

2011-10-18  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build int] Decruft: Remove obsolete handling for broken ‘printf %.2d’.

	* rcstime.c (proper_dot_2): Delete macro.
	(time2date, date2str): Use format string with ".2d" directly.

2011-10-13  Ian Delaney  <della5@iinet.com.au>  (tiny change)

	Fix bug: Make sure rcsgen.c sees ‘makedirtemp’ decl.

	* rcsgen.c: #include "b-feph.h".

2011-10-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use program-specific variable name for extracted help.

	* ci.c (main): Update ‘program’ initialization form.
	* co.c (main): Likewise.
	* ident.c (main): Likewise.
	* merge.c (main): Likewise.
	* rcs.c (main): Likewise.
	* rcsclean.c (main): Likewise.
	* rcsdiff.c (main): Likewise.
	* rcsmerge.c (main): Likewise.
	* rlog.c (main): Likewise.

2011-09-16  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘set_program_name’ from gnulib.

	* rcsutil.c: #include "progname.h".
	(gnurcs_init): Use ‘set_program_name’ and ‘program->invoke’.
	* b-complain.c (program_name): Delete var.
	* b-complain.h (program_name): Delete var decl.

2011-09-16  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Avoid "discards qualifiers" warning from GCC 4.4.

	This correctly finishes the incomplete lameness of 2011-06-14,
	"Avoid "discards qualifiers" warning from GCC 3.4".  The overall
	change is to convert from ‘char const *’ to ‘const char *’.

	* b-isr.c (catchsigaction): Add ‘const’ to local var.

2011-08-30  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Release: 5.8

2011-08-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Use colon in ‘--version’ output instead of semicolon.

	Reported by Karl Berry.

	* gnu-h-v.c (COMMAND_VERSION): Use ‘:’ not ‘;’.

2011-07-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Work around compilers that omit '\0' from tinysym init.

	Reported by Nelson H. F. Beebe, for SunOS 5.11 cc, c99.

	* b-anchor.c (EXPLICIT_NUL): New #define.
	(TINY_INIT): Use ‘EXPLICIT_NUL’.

2011-06-14  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Separate ISR scratch and alt sig stack allocations.

	* b-isr.c: Don't #include <ucontext.h> or "woe/ucontext.h".
	(scratch_from_context): Delete func.
	(catchsigaction): Mark 3rd arg ‘RCS_UNUSED’; use ‘ISR_SCRATCH’.
	(SCRATCH_SIZE): Delete #define.
	(isr_init): Use ‘ZLLOC’ for ISR scratch; use
	separate ‘alloc’ in ‘PLEXUS’ for alternate signal stack.
	* Makefile.am (EXTRA_DIST): Remove woe.
	* woe/COPYING.LIB: Delete file.
	* woe/ucontext.h: Delete file.
	* woe/ucontext.c: Delete file.

2011-06-14  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Avoid "discards qualifiers" warning from GCC 3.4.

	* b-isr.c (catchsigaction): Drop ‘const’ from local var.

2011-06-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘rewind’ directly; drop homegrown replacement.

	Incidentally, t400, which had started--triggered by changes in
	gnulib--to fail towards the beginning of 2011-05, now passes.
	Probably some more investigation is indicated.  See bleating at:
	http://lists.gnu.org/archive/html/bug-gnulib/2011-06/msg00122.html

	* ci.c (main): Use ‘rewind’ directly.
	* merger.c (merge): Likewise.
	* rcs.c (sendmail, buildeltatext): Likewise.
	* rcsedit.c (swapeditfiles): Likewise.
	* b-fb.h (Orewind): Delete func decl.
	* b-fb.c (Orewind): Delete func.

2011-06-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Decruft: Don't bother with ‘SSIZE_MAX’ check/#define.

	* rcsutil.c (SSIZE_MAX): Delete #define
	and surrounding preprocessor conditional.

2011-06-11  Thien-Thi Nguyen  <ttn@ambire>

	[int] Avoid more signed/unsigned comparison warnings from GCC 4.4.

	* b-fro.c (fro_spew_partial): Locally #define and #undef
	‘MEMBUFSIZ’; use it instead of ‘(off_t) sizeof (buf)’.
	(string_from_atat): Use ‘SSIZE_MAX’.

2011-06-10  Thien-Thi Nguyen  <ttn@ambire>

	[int] Use ‘off_t’ for ‘behavior.mem_limit’.

	Incidentally, this eliminates a "comparison between signed
	and unsigned integer expressions" warning from GCC 4.4.

	* base.h (struct behavior): Change type of ‘mem_limit’ to ‘off_t’.
	* b-fro.c (fro_open): Delete cast to ‘off_t’.

2011-02-01  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[grok] Fix bug: Make sure error message accumulates cleanly.

	Omission from 2010-05-24, "Rewrite parsing".

	* b-grok.c: #include <stdarg.h>.
	(ignoble): Take args FMT and varargs; discard work-in-progress
	cruft on ‘g->systolic’; do accumulate string here, not ...
	(BUMMER): ...here; update call to ‘ignoble’.

2011-01-31  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Include <stdarg.h> for ‘va_start’ et al.

	* b-divvy.c: #include <stdarg.h>.
	* b-fb.c: Likewise.

2011-01-23  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: Use "three manifestations" for ‘!DIFF3_BIN’.

	Reported by Nelson H. F. Beebe.
	Regression introduced 2010-09-30, "Use ‘struct symdef’
	array as "three manifestations" ‘merge’ arg".

	* merger.c (merge) [!DIFF3_BIN]: Use ‘LABEL’, not ‘label’.

2011-01-22  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[dtp] Fix bug: Handle ISO week+day dates.

	* maketime.c (ISO_day_of_week): New static func.
	(tm2time): Take additional arg YWEEK; if specified,
	compute yday, and maybe year, for later ‘yday’ processing.
	(maketime): Update call to ‘tm2time’.
	* maketime.h (tm2time): Update func decl.
	* rcstime.c (date2str): Update call to ‘tm2time’.

2011-01-22  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[dtp] Fix bug: Encode weekday number (letter ‘X’) with modulo.

	* partime.c (parse_pattern_letter <X>): Use modulo to encode value.

2011-01-14  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Decruft: Remove "yet another redolently redundant RCS rap".

	* Makefile.am (EXTRA_DIST): Remove yarrrr.c.
	(YALL, YPROGS): Delete vars.
	($(YPROGS)): Delete target.
	(y-all, y-clean): Likewise.
	* yarrrr.c: Delete file.

2011-01-14  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] With ‘EXEEXT’, use ‘execvp’ instead of ‘execv’.

	* rcsutil.c (EXECV): New #define.
	(runv): Use ‘EXECV’.

2011-01-14  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] With ‘EXEEXT’, don't absolutize; instead, simply suffix.

	* b-peer.c (LOSE): Delete macro.
	(invocation_full_name): Delete func.
	(find_peer_prog) [!EXEEXT]: Call ‘find_in_path’, ‘PFATAL’
	directly; mention directory and env var ‘PATH’ in error message.
	(find_peer_prog) [EXEEXT]: Compute the underlying filename
	as simply the concatenation of the meaningful and ‘EXEEXT’.

2011-01-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Make error message for peer-finding failure more informative.

	* b-peer.c (LOSE): Use "free var" ‘name’.

2011-01-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Consider ‘EXEEXT’ when searching for peer programs.

	* b-peer.c (invocation_full_name) [EXEEXT]: Construct a
	filename, appending ‘PROGRAM (invoke)’ and ‘EXEEXT’ if necessary.

2011-01-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Handle failure to find peer programs more gracefully.

	* b-peer.c: Include "b-complain.h".
	(LOSE): New macro.
	(invocation_full_name): New static func.
	(find_peer_prog): Use ‘invocation_full_name’;
	if last slash cannot be found, don't abort;
	instead, display a diagnostic and exit failurefully.

2011-01-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[dtp] Fix bug: Don't clobber ‘yday’ unconditionally.

	* maketime.c (tm2time): If ‘yday’ is valid, compute ‘mon’
	and ‘mday’ from it; otherwise, compute it from ‘mon’ and ‘mday’.

2011-01-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Fix bug: Don't confuse day of {week,year} in date parsing.

	* partime.c (merge_partime): For both conflict detection
	and actual merging, don't conflate ‘.tm_wday’ and ‘.tm_yday’.

2011-01-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Use bundled woe/ucontext.h for cygwin.

	* Makefile.am (executables): New var.
	(bin_PROGRAMS, BUILT_SOURCES): Use $(executables).
	(EXTRA_DIST): Add woe.
	* b-isr.c [!HAVE_UCONTEXT_H && NEED_WOE_UCONTEXT_H]:
	#include woe/ucontext.h.
	(SA_ONSTACK): #define, if not already.
	(ISR_STACK_SIZE): Conditionalize on
	‘defined HAVE_SIGALTSTACK && define SIGSTKSZ’; if
	these elements are not found, default to 0 (zero).
	* woe: New directory.
	* woe/COPYING.LIB: New file.
	* woe/ucontext.c: New file.
	* woe/ucontext.h: New file.

2011-01-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	rlog: Output trailing newline for midline description.

	* rlog.c (main <description>): Ensure trailing newline.

2011-01-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	rlog: Fix bug: Output trailing newline for midline log messages.
	Ch
	Regression introduced 2010-05-24, "Rewrite parsing".

	* b-fro.c (atat_display): Take third arg ENSURE_NEWLINE_P;
	if ‘true’ and an atat is non-empty and ends without a newline,
	output a trailing newline.
	* b-fro.h (atat_display): Update func decl.
	* rcsedit.c (copystring): Update call to ‘atat_display’.
	* rlog.c (putadelta): Update call to ‘atat_display’,
	specifying ENSURE_NEWLINE_P ‘true’.
	(main <description>): Update call to ‘atat_display’.

2011-01-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstractions: semi_lf, SEMI_LF

	* rcsgen.c (semi_lf): New const string.
	(SEMI_LF): New macro.
	(putadmin, putdelta): Use ‘semi_lf’, ‘SEMI_LF’.

2011-01-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Pass through ‘integrity’ field in RCS file.

	* base.h (struct repo): Add member ‘integrity’.
	(tiny_integrity): New var decl, via ‘TINY_DECL’.
	* b-anchor.c (tiny_integrity): New var, via ‘TINYK’.
	* b-grok.c (full): Recognize ‘integrity’ prior to ‘comment’.
	* rcsgen.c (putadmin): Output integrity info, if available.

2011-01-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Fix bug: Account for $(EXEEXT) in .help filenames.

	Omission from 2010-03-19, "Use GNU Automake".

	* Makefile.am (BUILT_SOURCES): Include $(EXEEXT)
	in source part of ‘$(VAR:SOURCE=TARGET)’ reference.

2010-11-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[grok] Recognize duplicate delta log; throw error.

	Omission from 2010-05-24, "Rewrite parsing".
	* b-grok.c (full <edits>): Signal "duplicate delta log"
	error if a log already exists for a particular delta.

2010-11-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[grok] Fix bug: Check all branch forward references for match.

	* b-grok.c (fwref): New struct.
	(full): Keep track of line number of branch references, too;
	after reading tree, check that all refs were indeed matched.

2010-11-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[grok] Fix bug: Check that new branch was forward referenced.

	* b-grok.c (full): Keep track of branch references;
	check that new branches are properly forward-referenced.

2010-11-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[grok] Fix bug: Check that branches begin w/ branch point.

	* b-grok.c (full <revisions>): Check that
	branches begin with the branch point revision.

2010-11-19  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: For unchanged checkin on branch, prune ‘newdelta’.

	Expansion of 2010-11-14, "Fix bug: For
	unchanged checkin, invalidate ‘newdelta’".
	* ci.c (prune): New static func.
	(main): On unchanged checkin, use ‘prune’;
	incorporate ‘newdelta’ invalidation into ‘prune’.

2010-11-14  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: For unchanged checkin, invalidate ‘newdelta’.

	Regression introduced 2010-05-24, "Rewrite parsing".
	* ci.c (main): On unchanged checkin, where we have started
	to build the wrong new RCS file, invalidate ‘newdelta’.

2010-11-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Define ‘program_name’ for gnulib.

	* b-complain.c (program_name): New var.
	* b-complain.h (program_name): New var decl.
	* rcsutil.c (gnurcs_init): Set ‘program_name’.
	Reported by Klaus T. Aehlig.

2010-11-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: Use ‘gr_revno’ more.

	Regression introduced 2010-05-08,
	"Add abstraction: delta_from_ref".
	* ci.c (addbranch): Take 4th arg TP_DELTAS; use ‘gr_revno’.
	(addelta): Update calls to ‘addbranch’.
	(main): Use ‘gr_revno’ instead of ‘delta_from_ref’.
	* rcs.c (setlock): Take arg TP_DELTAS; use ‘gr_revno’.
	(dolocks): Likewise; update calls to ‘setlock’.
	(domessages, rcs_setstate): Likewise.
	(main): Update calls to ‘dolocks’, ‘domessages’, ‘rcs_setstate’.

2010-11-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Incorporate ‘DELNUMFORM’ into unique use.

	* rcsgen.c (rcsgen.c): Use string directly for revno, "log".
	* base.h (DELNUMFORM): Delete #define.

2010-11-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	ci, rcs: Make MSG in ‘-m...MSG’ optional.

	* rcsutil.c (set_empty_log_message): New func.
	* base.h (set_empty_log_message): New func decl.
	* ci.c (getlogmsg, main): Use ‘set_empty_log_message’.
	* rcs.c (getmessage): Likewise.

2010-11-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: Output leading '@' for "rcs -m" log in RCS file.

	Omission from 2010-05-24, "Rewrite parsing".
	* rcs.c (scanlogtext): When replacing
	log text from "rcs -m", output leading '@'.

2010-11-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘oom’ more.

	* b-divvy.c (oom): Make func not static.
	* b-divvy.h (oom): New func decl.
	* rcsedit.c (okalloc): Use ‘oom’.

2010-11-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[doc] Fix typo: Mention rcsdiff ‘-B’ once only.

	* rcsdiff.c: Mention ‘-B’ once only in help text.
	Reported by Keith Thompson.

2010-11-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Include extra \n in RCS file to fully emulate RCS 5.7.

	* rcsgen.c (putadmin): Output trailing newline.

2010-11-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Revert symbolic names ordering to be compatible with RCS 5.7.

	Translation oversight from 2010-04-28, "Replace
	‘struct assoc’ with ‘struct wlink’ + ‘struct symdef’".
	* rcsedit.c (addsymbol): For new symbolic
	names, add to front of list instead of end.

2010-11-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: Maintain ‘GROK (deltas)’ in proper order.

	Omission from 2010-05-24, "Rewrite parsing".
	* b-grok.c (full): Reorder ‘repo->deltas’
	to reflect edits order, not index order.

2010-10-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Reuse backing store in ‘swapeditfiles’.

	* rcsedit.c (swapeditfiles): Allocate and
	do basic initialization for ‘es->fedit’ once only.

2010-10-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: For stdio operation, prep ‘finishedit’ properly.

	Regressions introduced 2010-04-17 and 2010-05-31, in
	"Overhaul read-only file handling" and "Mark verbatim
	region; reduce transitional tell/seek", respectively.
	* rcsedit.c (swapeditfiles): Set the fro ‘.end’ as well.
	(finishedit_slow): Prior to spewing, set start point.

2010-10-21  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: local_tm

	Omission from 2010-06-12, "Use ‘gmtime_r’, ‘localtime_r’".
	* maketime.c (local_tm): New func.
	(time2tm): Use ‘local_tm’.
	* maketime.h (struct maketimestuff): Add member ‘tzset_called_p’.
	(local_tm): New func decl.
	* rcstime.c (date2str): Use ‘local_tm’.

2010-10-17  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Cast less.

	* b-fro.c (fro_spew_partial): Remove unnecessary cast.
	* ci.c (BHDELTA): Delete macro.
	(addbranch): Use local var for temp ‘struct delta *’.
	* rcs.c (dolocks): Use local var for temp ‘const char *’.

2010-10-17  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘NULL’ more.

	* b-fro.c (fro_open): In the case of ‘RM_MEM’
	on a zero-sized file, use ‘NULL’ for ‘f->base’.

2010-10-17  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: nfs_NOENT_p

	* rcsedit.c (nfs_NOENT_p): New static func.
	(un_link, chnamemod): Use ‘nfs_NOENT_p’.

2010-10-17  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Add configure option: --enable-suid[=setreuid]

	* b-excwho.c (set_uid_to): Use ‘HAVE_SETREUID’.
	* base.h (has_setreuid): Delete #define.

2010-10-15  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Don't bother with ‘psignal’.

	* b-isr.c (complain_signal) [HAVE_PSIGNAL]:
	Delete code and surrounding preprocessor conditional.

2010-10-15  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: change_mode

	* b-fb.c (change_mode): New func.
	* b-fb.h (change_mode): New func decl.
	* ci.c (fixwork): Use ‘change_mode’.
	* rcsedit.c (chnamemod): Likewise.

2010-10-15  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: Allocate ‘REPO (r)’ also for new repo.

	Omission from 2010-05-24, "Rewrite parsing".
	* b-grok.c (empty_repo): New func.
	(full): Use ‘empty_repo’.
	* b-grok.h (empty_repo): New func decl.
	* rcsfnms.c (InitAdmin): Use ‘empty_repo’.
	* ci.c (addelta): No longer check for NULL ‘REPO (r)’.
	* rcsgen.c (format_assocs): Likewise.
	* rcsmerge.c (main): Likewise.
	* rcs.c (main): Likewise.  Also, use ‘GROK (desc)’ directly.
	Reported by Nelson H. F. Beebe.

2010-10-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Include program name in autogenerated tmpfile name.

	* b-feph.c (struct ephemstuff):
	Drop member ‘tmpdir’; add member ‘standard’.
	(jam_sff): Include ‘PROGRAM (name)’ in ‘EPH (standard)’.

2010-10-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Presume availability of ‘strsignal’.

	* b-isr.c: Don't #include "sig2str.h".
	(complain_signal) [!HAVE_STRSIGNAL]: Delete
	code and surrounding preprocessor conditional.

2010-10-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Presume availability of ‘sigaction’.

	* b-isr.c (scratch_from_context) [!HAVE_SIGACTION]: Delete code.
	(catchsigaction): Don't reset the handler.
	[!HAVE_SIGACTION] (catchsig): Delete func.
	(setup_catchsig) [!HAVE_SIGACTION]: Delete code.
	[!HAVE_SIGACTION] (ISR_STACK_SIZE): Delete code,
	leaving unconditionally #define:d ‘ISR_STACK_SIZE’.

2010-10-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘getlogin_r’, not ‘getlogin’.

	* b-excwho.c (getusername): Use ‘getlogin_r’ instead
	of ‘getlogin’; share local ‘buf’ with ‘getpwuid_r’.
	* base.h (getlogin_is_secure): Delete #define.

2010-10-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘getpwuid_r’, not ‘getpwuid’.

	* b-excwho.c (getusername) [HAVE_GETUID && HAVE_GETPWUID]:
	Delete code; move #else code to...
	[!HAVE_GETPWUID_R]: ...here.
	[HAVE_GETPWUID_R]: Use ‘getpwuid_r’ to find user name.

2010-10-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Use autoconf macro to enable 64-bit file offsets.

	* base.h (_FILE_OFFSET_BITS): Remove #define.

2010-10-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[C] Use ‘%zu’ for ‘size_t’ arg in format string.

	* rlog.c (main): Use ‘%zu’ in format
	string to output the ‘GROK (deltas_count)’.

2010-10-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[C] Cast precision expression for ‘%.*s’ to ‘int’.

	Omission from 2010-05-18,
	"Don't mutate string in ‘checkidentifier’".
	* rcsmap.c (checkidentifier):
	Cast precision expression for ‘%.*s’ to ‘int’.

2010-10-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[C] Use ‘%zu’ for ‘size_t’ arg in format string.

	* rcsedit.c (finisheditline): Use ‘%zu’ in
	format string to output the ‘finctx->script_lno’.

2010-10-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Simplify stream/fd sync; avoid ‘fflush’ on input.

	* ci.c (main): For sending ‘workptr’ fd to diff(1),
	don't save current fd position, ‘fflush’ conditionally,
	and restore afterwards; instead, seek to beginning only.
	Also, do all this regardless of ‘STDIO_P (workptr)’.

2010-10-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Presume availability of ‘waitpid’.

	* rcsutil.c (runv) [!defined HAVE_WAITPID]:
	Delete code and surrounding preprocessor conditional.

2010-10-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix typo: group ‘getusername’ cond exprs correctly.

	Regression introduced 2010-04-11,
	"Move cached username into `struct behavior'".
	* b-excwho.c (getusername) [getlogin_is_secure]:
	Move close-paren back one line, thus promoting
	‘&& !JAM (getlogin ())’ to top-level of expression.

2010-10-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Presume availability of ‘getcwd’.

	* rcsfnms.c: Don't #include "b-isr.h".
	[!HAVE_GETCWD] (getcwd): Delete func.

2010-10-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Find invocation directory only once.

	* base.h (struct program): Add member ‘invoke’.
	(struct behavior): Add member ‘invdir’.
	* ci.c (main): Specify ‘.invoke’ in ‘program’.
	* co.c (main): Likewise.
	* ident.c (main): Likewise.
	* merge.c (main): Likewise.
	* rcs.c (main): Likewise.
	* rcsclean.c (main): Likewise.
	* rcsdiff.c (main): Likewise.
	* rcsmerge.c (main): Likewise.
	* rlog.c (main): Likewise.
	* yarrrr.c [!PROGRAM_EXITERR] (PROGRAM_EXITERR): New #define.
	(main): Construct ‘struct program program’ as a local var.
	[TEST_STR2TIME] (program): Delete var.
	[TEST_STR2TIME] (PROGRAM_NAME): New #define.
	[TEST_FCMP] (program): Delete var.
	[TEST_FCMP] (PROGRAM_NAME): New #define.
	[TEST_PAIRS] (program): Delete var.
	[TEST_PAIRS] (PROGRAM_NAME, PROGRAM_EXITERR): New #define:s.
	[TEST_KEEP] (program): Delete var.
	[TEST_KEEP] (PROGRAM_NAME): New #define.
	[TEST_GROK] (program): Delete var.
	[TEST_GROK] (PROGRAM_NAME, PROGRAM_EXITERR): New #define:s.
	[TEST_REV] (program): Delete var.
	[TEST_REV] (PROGRAM_NAME): New #define.
	* b-peer.c: #include <string.h>, "b-divvy.h".
	(find_peer_prog): Find driver's invocation directory;
	use it to construct the program's underlying filename.

2010-10-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[C] Propagate ‘const’ in casts.

	* base.h (TINYS): Add ‘const’ to cast.
	* rcsgen.c (putadmin): Likewise.

2010-10-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[C] Reduce need for casting.

	* b-isr.c (access_page): Change P type to ‘char const *’;
	change local var type to ‘char volatile’; remove cast.
	* b-isr.h (access_page): Update func decl.

2010-10-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] If writing to stderr in ISR fails, exit failurefully.

	* b-isr.c (werr): Don't bother to ‘write’ zero-len strings;
	also, if ‘write’ rv is unexpected, call ‘PROGRAM (exiterr)’.

2010-10-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use literal string for ‘PERR’, ‘MERR’ first arg.

	* co.c (rmworkfile): Rework ‘PERR (COND-EXPRESSION, ...)’ as
	‘if (COND-EXPRESSION) PERR (STR1, ...) else PERR (STR2, ...)’.
	* rcskeep.c (sorry): Use "%s" for ‘MERR’ first arg.

2010-10-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Presume availability of ‘mkstemp’.

	* b-feph.c [!HAVE_MKSTEMP] (homegrown_mkstemp): Delete func.
	[!HAVE_MKSTEMP] (mkstemp): Delete #define.

2010-10-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘fd_safer’ more.

	* b-feph.c: #include "unistd-safer.h".
	(jam_sff): Use ‘fd_safer’ for ‘msktemp’ rv.

2010-10-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[C] Avoid signed/unsigned comparison.

	* b-divvy.c (make_space): Use ‘size_t’ for "type width".

2010-10-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[C] Add ‘const’ to ‘struct pool_found’ member ‘sym’.

	* base.h (struct pool_found): Add ‘const’ to member ‘sym’.
	* b-anchor.c (pool_lookup): Add ‘const’ to cast.

2010-10-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[C] Drop redundant local-var declarations.

	* b-fro.c (string_from_atat): Drop redundant decl for ‘i’.
	* b-grok.c (full): Likewise for ‘count’.

2010-10-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Fix bug: Look for and use <siginfo.h>.

	Regression introduced 2010-04-03, "Ignore <siginfo.h>".
	* b-isr.c: [HAVE_SIGINFO_H] #include <siginfo.h>.

2010-10-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: maybe_reset_sigchld

	* b-isr.c (maybe_reset_sigchld): New func.
	* b-isr.h (maybe_reset_sigchld): New func decl.
	* rcsfnms.c: #include "b-isr.h".
	[!HAVE_GETCWD] (getcwd): Use ‘maybe_reset_sigchld’.
	* rcsutil.c (runv): Use ‘maybe_reset_sigchld’.

2010-10-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Fix bug: Look for and use <ucontext.h>.

	Regression introduced 2010-04-03, "Ignore unused <ucontext.h>".
	* b-isr.c: [HAVE_UCONTEXT_H] #include <ucontext.h>.

2010-10-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Search ‘PATH’ for co / merge at runtime.

	* b-peer.h: New file.
	* b-peer.c: New file.
	* Makefile.am (libparts_a_SOURCES): Add b-peer.h, b-peer.c.
	(BUILT_SOURCES): Remove bother.c.
	(outgoing, bothers): Delete vars.
	(co_SOURCES, rcsdiff_SOURCES, rcsmerge_SOURCES): Likewise.
	(dist-hook): Delete target.
	(clean-local): No longer "rm -rf 0pre".
	(bother.c, test-prep, FORCE): Delete targets.
	* co.c: Don't #include "bother.h"; #include "b-peer.h".
	(struct jstuff): Add member ‘merge’.
	(preparejoin): Init ‘jstuff.merge’ once.
	(buildjoin): Use ‘PEER_CO’, ‘find_peer_prog’
	* rcsdiff.c: Don't #include "bother.h"; #include "b-peer.h".
	(main): Use ‘PEER_CO’.
	* rcsmerge.c: Don't #include "bother.h"; #include "b-peer.h".
	(main): Usee ‘PEER_CO’.
	* base.h: Comment munging; nfc.
	* bother.h: Delete file.

2010-10-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Delete abstraction: exec_RCS

	* rcsutil.c (runv): Use ‘execv’ directly.

2010-10-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Specify "outgoing" programs dependency precisely.

	* bother.h: New file.
	* Makefile.am (libparts_a_SOURCES): Remove bother.c.
	(outgoing, bothers): New vars.
	(co_SOURCES, rcsdiff_SOURCES, rcsmerge_SOURCES): Likewise.
	(test-prep): Restrict forced remake to $(outgoing) programs.
	* base.h (prog_co, prog_merge): Delete var decls.
	* co.c: #include "bother.h".
	* rcsdiff.c: Likewise.
	* rcsmerge.c: Likewise.

2010-10-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Use $(abs_builddir) more.

	* Makefile.am (test-prep):
	Use $(abs_builddir) instead of $$(pwd).

2010-10-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Make ‘test-prep’ depend on ‘all’.

	* Makefile.am (test-prep): Add ‘all’ to dependency list.

2010-10-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[C] Drop redundant ‘const’ declarations.

	* Makefile.am (bother.c): Drop redundant ‘const’ decl.
	* b-anchor.c (ks_revno, prog_diff, prog_diff3
	(diff_flags, equal_line, kwsub_string): Likewise.
	* b-divvy.c (make_space): Likewise.
	* b-divvc.h (make_space): Likewise.
	* b-isr.c (setup_catchsig, isr_do): Likewise.
	* base.h (prog_co, prog_merge, prog_diff)
	(prog_diff3, diff_flags, equal_line): Likewise.
	(struct program): Likewise for members ‘name’, ‘help’.
	(ks_revno, kwsub_string, ctab): Likewise.
	* maketime.c (month_yday): Likewise.
	* partime.c (patterns): Likewise.
	* rcsfnms.c (comtable, getcwd): Likewise.
	* rcsmap.c (ctab): Likewise.

2010-10-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘EXIT_SUCCESS’ more.

	* rcsutil.c (setRCSversion): Use ‘EXIT_SUCCESS’.

2010-10-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[C] Use ‘strtol’ instead of ‘atoi’, ‘atol’.

	* rcstime.c (date2str): Use ‘strtol’, not ‘atoi’.
	* rcsutil.c (gnurcs_init): Use ‘strtol’, not ‘atol’.
	* yarrrr.c [TEST_STR2TIME] (yarrrr): Likewise.

2010-10-05  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Undo bogus workaround.

	Brain damage artifact introduced 2010-08-21, "Work
	around x86_64-linux-gnu memory corruption problem".
	* ci.c (main): Don't ‘getcurdate’ unconditionally, early on.

2010-10-05  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: gnurcs_goodbye

	* rcsutil.c (gnurcs_goodbye): New func.
	* base.h (gnurcs_goodbye): New func decl.
	* ci.c (main): Use ‘gnurcs_goodbye’.
	* co.c (main): Likewise.
	* ident.c (main): Likewise.
	* merge.c (main): Likewise.
	* rcs.c (main): Likewise.
	* rcsclean.c (main): Likewise.
	* rcsdiff.c (main): Likewise.
	* rcsmerge.c (main): Likewise.
	* rlog.c (main): Likewise.
	* yarrrr.c (main): Likewise.

2010-10-05  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘EXIT_SUCCESS’ more.

	* merge.c: #include <stdlib.h>.
	(main): Use ‘EXIT_SUCCESS’.

2010-10-05  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: Close expansion context scratch space when done.

	Omission from 2010-04-30, "Move
	‘expandline’ scratch to expansion context".
	* b-kwxout.h (FINISH_EXPCTX): New macro.
	* ci.c (xpandfile): Use ‘FINISH_EXPCTX’.
	* rcsedit.c (finishedit_fast, finishedit_slow)
	(copylines, editstring): Likewise.
	* rcsgen.c (scandeltatext): Likewise.

2010-10-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: Initialize notyet ‘.branches’ correctly.

	Original circular-GIGO from 2010-05-24, "Rewrite parsing".
	* b-grok.c (full): For notyet ‘.branches’, use ‘NULL’ as head
	of the cdr-copying chain, not the to-be-initialized ‘.branches’!

2010-10-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[v] Use Automake for building xorlf.

	* Makefile.am (clean-local): Don't delete ‘xorlf*’.
	(test-prep): Don't ‘$(MAKE) xorlf’ or move it to 0pre/bin.
	(xorlf): Delete target.

2010-10-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: Fully initialize delta objects.

	Omission from 2010-05-24, "Rewrite parsing".
	* b-grok.c (full): If there is no "commitid"
	field, explicitly clear ‘d->commitid’.
	Reported by Paul Eggert.

2010-10-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: Fully initialize notyet objects.

	Omission from 2010-05-24, "Rewrite parsing".
	* b-grok.c (full): If there are no more revision
	numbers to parse, explicitly clear ‘ny->next’.
	Reported by Paul Eggert.

2010-10-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Delete unused macro.

	* b-grok.c (NEWPAIR): Delete macro.

2010-10-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: Save notyet objects in caller space.

	Memory incoherence introduced 2010-05-24, "Rewrite parsing".
	* b-grok.c (full): Don't save notyet objects in
	‘g->tranquil’; instead, save in caller specified space.
	Reported by Paul Eggert.

2010-10-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Avoid identifier ‘SHARED’ (Solaris 8 header conflict).

	* b-divvy.c: Do s/SHARED/PLEXUS/g; do s/shared/plexus/g.
	* b-divvy.h: Likewise.
	* b-feph.c: Likewise.
	* b-isr.c: Likewise.
	* ci.c: Likewise.
	* co.c: Likewise.
	* merger.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsfnms.c: Likewise.
	* rcsgen.c: Likewise.
	* rcsutil.c: Likewise.
	* rlog.c: Likewise.
	Reported by Paul Eggert.

2010-10-01  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[maint] Let the configure script instantiate rcsfreeze.

	* Makefile.am (EXTRA_DIST): Remove rcsfreeze.sh.
	(rcsfreeze): Delete target.
	* rcsfreeze.sh: Add '@' around ‘PACKAGE_VERSION’.

2010-09-30  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘struct symdef’ array as "three manifestations" ‘merge’ arg.

	* b-merger.h: New file.
	* Makefile.am (libparts_a_SOURCES): Add b-merger.h.
	* merger.c: #include "b-merger.h".
	(merge): Don't take LABEL and ARGV; instead, take
	THREE_MANIFESTATIONS; use ‘LABEL’ and ‘FNAME’.
	* base.h (merge): Update func decl.
	* merge.c: #include "b-merger.h".
	(main): Use ‘LABEL’ and ‘FNAME’; update call to ‘merge’.
	* rcsmerge.c: #include "b-merger.h".
	(main): Use ‘LABEL’ and ‘FNAME’; update call to ‘merge’.

2010-09-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[v] Centralize tests; do complicated test last.

	* Makefile.am (PATHPREFIX, TESTS_ENVIRONMENT, TESTS): Delete vars.
	(check-TESTS, installcheck): Delete targets.
	* alive.test: Move to ../tests/t999.test.

2010-09-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Don't redundantly align atat divvy spaces.

	* b-grok.c (start_atat): Remove alignment check/enforcement,
	obsoleted by "[int] Align divvy spaces to the "widest" type width".

2010-09-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Align divvy spaces to the "widest" type width.

	* divvy.c (make_space): Initialize the alignment of
	the newly created divvy space based on the "widest" type.

2010-09-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Tighten type of struct ‘divvy’ member ‘space’.

	* b-divvy.h (struct divvy): Declare ‘space’ to be ‘struct obstack *’.
	* b-divvy.c (make_space): Remove now-redundant cast to ‘struct obstack *’.

2010-09-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[C] Fix bug: Explicitly cast ‘size_t’ to ‘off_t’ for comparing.

	* b-fro.c (fro_spew_partial): Use ‘(off_t) sizeof (buf)’ to compare.

2010-08-21  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Work around x86_64-linux-gnu memory corruption problem.

	* ci.c (main): Call ‘getcurdate’ unconditionally, early on.

2010-08-21  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘bad_option’ more.

	* ident.c (main): Use ‘bad_option’.

2010-08-19  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Specify gnulib headers location when srcdir!=builddir.

	* Makefile.am (AM_CPPFLAGS): New var.

2010-08-15  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] #define _POSIX_SYMLOOP_MAX if necessary.

	* rcsedit.c (_POSIX_SYMLOOP_MAX):
	If not already defined, #define to 8.
	Reported by Mike Mestnik <mmestnik@nagios.com>.

2010-07-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int y-GROK] Use ‘exit_failurefully’ more.

	* yarrrr.c [TEST_GROK] (exiterr): Use ‘exit_failurefully’.

2010-07-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstractions: exit_failurefully, exit_diff_trouble

	* rcsutil.c (exit_failurefully, exit_diff_trouble): New funcs.
	(runv): Use ‘exit_diff_trouble’.
	* base.h (exit_failurefully, exit_diff_trouble): New func decls.
	* ci.c (exiterr): Use ‘exit_failurefully’.
	* co.c (exiterr): Likewise.
	* ident.c (exiterr): Likewise.
	* rcs.c (exiterr): Likewise.
	* rcsclean.c (exiterr): Likewise.
	* rcsfnms.c (getcwd): Likewise.
	* rlog.c (exiterr): Likewise.
	* yarrrr.c (bow_out, scram): Likewise.
	* merge.c (exiterr): Use ‘exit_diff_trouble’.
	* rcsdiff.c (exiterr): Likewise.
	* rcsmerge.c (exiterr): Likewise.

2010-07-06  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Fix typo: Say "GPLv3+" in --version output.

	* gnu-h-v.c (COMMAND_VERSION): Say "GPLv3+".
	* rcsfreeze.sh (version): Likewise.

2010-06-24  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Update license to GPLv3+.

	* Makefile.am: Update license notice.
	* alive.test: Likewise.
	* b-anchor.c: Likewise.
	* b-complain.c: Likewise.
	* b-complain.h: Likewise.
	* b-divvy.c: Likewise.
	* b-divvy.h: Likewise.
	* b-esds.c: Likewise.
	* b-esds.h: Likewise.
	* b-excwho.c: Likewise.
	* b-excwho.h: Likewise.
	* b-fb.c: Likewise.
	* b-fb.h: Likewise.
	* b-feph.c: Likewise.
	* b-feph.h: Likewise.
	* b-fro.c: Likewise.
	* b-fro.h: Likewise.
	* b-grok.c: Likewise.
	* b-grok.h: Likewise.
	* b-isr.c: Likewise.
	* b-isr.h: Likewise.
	* b-kwxout.c: Likewise.
	* b-kwxout.h: Likewise.
	* base.h: Likewise.
	* ci.c: Likewise.
	* co.c: Likewise.
	* gnu-h-v.c: Likewise.
	* gnu-h-v.h: Likewise.
	* ident.c: Likewise.
	* maketime.c: Likewise.
	* maketime.h: Likewise.
	* merge.c: Likewise.
	* merger.c: Likewise.
	* partime.c: Likewise.
	* partime.h: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsedit.c: Likewise.
	* rcsfcmp.c: Likewise.
	* rcsfnms.c: Likewise.
	* rcsfreeze.sh: Likewise.
	* rcsgen.c: Likewise.
	* rcskeep.c: Likewise.
	* rcsmap.c: Likewise.
	* rcsmerge.c: Likewise.
	* rcsrev.c: Likewise.
	* rcstime.c: Likewise.
	* rcsutil.c: Likewise.
	* rlog.c: Likewise.
	* yarrrr.c: Likewise.

2010-06-23  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Say "RCS file", not "repository file".

	* b-grok.c (full): Say "RCS file" in error message.
	* ci.c: Say "RCS file" in help text.
	* co.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsfreeze.sh: Likewise.
	* rcsmerge.c: Likewise.
	* rlog.c: Likewise.

2010-06-22  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Say "repository file", not "repository".

	* b-grok.c (full): Say "repository file" in error message.
	* base.h: Comment munging; nfc.
	* ci.c: Say "repository file" in help text.
	* co.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsfreeze.sh: Likewise.
	* rcsmerge.c: Likewise.
	* rlog.c: Likewise.

2010-06-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Build atat object incrementally.

	* b-grok.c (alloc_atat): Delete func.
	(start_atat, finish_atat): New static funcs.
	(maybe_read_atat): Use ‘start_atat’, ‘finish_atat’; grow atat
	object onto ‘g->systolic’; copy onto ‘g->to’ when done.

2010-06-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘gmtime_r’, ‘localtime_r’.

	* base.h: Comment munging; nfc.
	* maketime.h (struct maketimestuff): Add member ‘time2tm_stash’.
	* maketime.c (time2tm): Use ‘gmtime_r’, ‘localtime_r’.
	* rcstime.c (date2str): Use ‘localtime_r’.

2010-06-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Build rcsfreeze with substituted ‘PACKAGE_VERSION’.

	* Makefile.am (rcsfreeze): New target.

2010-06-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Make ‘--help’ output say "repository", not "RCS file".

	* ci.c: In ‘--help’ comment, say "repository", not "RCS file".
	* co.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsfreeze.sh: Likewise.
	* rcsmerge.c: Likewise.
	* rlog.c: Likewise.

2010-06-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Relax syntax of id, sym to accept string of all digits.

	* rcsmap.c (checkidentifier): Flag ‘DIGIT’ as identifier, as well.
	* alive.test: Update to test using state "42".

2010-06-01  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstractions: MEM_SAME, MEM_DIFF

	* base.h (MEM_SAME, MEM_DIFF): New macros.
	* b-anchor.c (looking_at): Use ‘MEM_SAME’.
	* rcs.c (main): Use ‘MEM_DIFF’.
	* rcsfcmp.c (rcsfcmp): Likewise.
	* rcsfnms.c (rcssuffix, pairnames): Use ‘MEM_SAME’.

2010-06-01  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstractions: {NUM,DATE}_{LT,EQ,GT}, NUMF_{LT,EQ}

	* base.h (GENERIC_COMPARE, GENERIC_LT, GENERIC_EQ)
	(GENERIC_GT, NUM_LT, NUM_EQ, NUM_GT, DATE_LT, DATE_EQ)
	(DATE_GT, NUMF_LT, NUMF_EQ): New macros.
	* ci.c (addbranch, addelta, getlogmsg, main): Use new macros.
	* co.c (getancestor): Likewise.
	* rcs.c (removerevs, setlock, dolocks, rcs_setstate, main): Likewise.
	* rcsrev.c (genbranch, genrevs): Likewise.
	* rlog.c (recentdate, extdate): Likewise.

2010-06-01  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: PROB

	* base.h (PROB): New macro.
	* b-excwho.c (set_uid_to): Use ‘PROB’.
	* b-fb.c (fopen_safer, Orewind, aflush)
	(oflush, aputs, aprintf): Likewise.
	* b-feph.c [!HAVE_MKSTEMP] (homegrown_mkstemp): Likewise.
	(jam_sff): Likewise.
	* b-fro.c [MMAP_SIGNAL] (mmap_deallocate): Likewise.
	(fro_open, fro_move): Likewise.
	* b-grok.c (full, grok_resynch): Likewise.
	* b-isr.c (complain_signal, MUST, setup_catchsig, isr_init): Likewise.
	* ci.c (fixwork, main): Likewise.
	* co.c (main): Likewise.
	* ident.c (scanfile, main): Likewise.
	* partime.c (partime): Likewise.
	* rcs.c (main): Likewise.
	* rcsclean.c (get_directory, main): Likewise.
	* rcsedit.c (un_link, fopen_update_truncate, rcswriteopen)
	(chnamemod, dorewrite, donerewrite, ORCSclose): Likewise.
	* rcsfnms.c (pairnames, getfullRCSname): Likewise.
	[!HAVE_GETCWD] (getcwd): Likewise.
	* rcsgen.c (putdesc): Likewise.
	* rcsutil.c (gnurcs_init, awrite, runv): Likewise.

2010-06-01  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstractions: SHACCR, SHSTR, SHSNIP

	* b-divvy.h (SHACCR, SHSTR, SHSNIP): New macros.
	* ci.c (addelta): Use ‘SHSNIP’.
	* rcs.c (getassoclst, getaccessor, getstates): Likewise.
	* rlog.c (getnumericrev): Use ‘SHACCR’, ‘SHSTR’, ‘SHSNIP’.

2010-06-01  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Delete abstraction: intern0

	* co.c (buildjoin): Don't bother re-saving the revno into ‘SINGLE’.
	* rcsutil.c (str_save): Use ‘intern’ directly.
	* b-divvy.h (intern0): Delete macro.

2010-05-31  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Reposition less, and also less frequently.

	* b-grok.c (grok_resynch): Don't
	take ‘struct fro *f’; don't reposition.
	(grok_all): Update call to ‘grok_resynch’.
	* b-grok.h (grok_resynch): Update func decl.
	* ci.c (main): Don't reposition prior to
	resync; update call to ‘grok_resynch’.
	* rcs.c (scanlogtext): Do reposition after looping.
	* rcsfnms.c (pairnames): Don't reposition after grok.
	* rcsgen.c (scandeltatext): Do reposition after looping.

2010-05-31  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Mark verbatim region; reduce transitional tell/seek.

	* b-fro.h (struct fro): Add member ‘verbatim’.
	(FIXUP_OLD): Delete macro.
	(VERBATIM, IGNORE_REST, SAME_AFTER): New macros.
	* b-fro.c (fro_spew): Use ‘->verbatim’ for region
	beginning; afterwards, set it to the end position.
	* base.h: Comment munging; nfc.
	* ci.c (main): Use ‘IGNORE_REST’, ‘SAME_AFTER’, ‘VERBATIM’.
	* co.c (main): Use ‘SAME_AFTER’.
	* rcs.c (scanlogtext): Don't call ‘FIXUP_OLD’.
	(main): Use ‘IGNORE_REST’, ‘SAME_AFTER’.
	* rcsclean.c (main): Use ‘SAME_AFTER’.
	* rcsedit.c (copystring): Don't call ‘FIXUP_OLD’.
	* rcsgen.c (scandeltatext, write_desc_maybe, putdesc): Likewise.
	* rlog.c (main): Likewise.
	* yarrrr.c [TEST_REV] (yarrrr): Likewise.

2010-05-31  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Rename ‘struct delta’ member ‘next’ to ‘ilk’.

	* base.h (struct delta): Rename member ‘next’ to ‘ilk’.
	* b-grok.c (full): Update references.
	* ci.c (addbranch, addelta): Likewise.
	* rcs.c (branchpoint, removerevs, buildtree): Likewise.
	* rcsgen.c (putdelta, puttree): Likewise.
	* rcsrev.c (genbranch, genrevs): Likewise.
	* rlog.c (putrunk, putree, putabranch)
	(exttree, recentdate, extdate): Likewise.
	* yarrrr.c [TEST_GROK] (yarrrr): Likewise.

2010-05-31  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int y-GROK] Fix bug: Deref repo ‘locks’ entry correctly.

	Regression introduced 2010-05-24, "Rewrite parsing".
	* yarrrr.c [TEST_GROK] (struct lockdef): Delete.
	[TEST_GROK] (yarrrr): Deref repo ‘locks’ entry as ‘struct rcslock *’.

2010-05-31  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Note each delta body's file position.

	* base.h (struct delta): Add member ‘neck’.
	* b-grok.c (full): For each delta, note its body's file position.
	* rcs.c (scanlogtext): Avoid ‘fro_tello’; use saved file position.
	* rcsgen.c (scandeltatext): Likewise.

2010-05-30  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Make "need expansion" support compile-time optional, default off.

	* base.h (WITH_NEEDEXP): New #define.
	* b-fro.h (struct atat): Include members only if
	‘WITH_NEEDEXP’: ‘needexp_count’, ‘ineedexp’, ‘needexp’.
	* b-grok.c (atat_ineedexp_many, atat_ineedexp_few):
	Surround with ‘#if WITH_NEEDEXP’.
	(maybe_read_atat): Conditionalize "need
	expansion" support with ‘#if WITH_NEEDEXP’.
	* yarrrr.c [TEST_GROK] (spew_atat): Likewise.

2010-05-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: format_locks

	* base.h (format_locks): New func decl.
	* rcsgen.c (format_locks): New func.
	(putadmin): Use ‘format_locks’.
	* rlog.c (main): Likewise.

2010-05-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int org] Move ‘addlock’ to b-excwho.[hc].

	* rcsedit.c (addlock): Move func from here...
	* b-excwho.c: #include "b-divvy.h".
	(addlock): ...to here.
	* base.h (addlock): Move func decl from here...
	* b-excwho.h (addlock): ...to here.

2010-05-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: lock_on

	* b-excwho.c (lock_on): New func.
	* b-excwho.h (lock_on): New func decl.
	* rcs.c (branchpoint): Use ‘lock_on’.
	* rcsedit.c (addlock): Likewise.
	* rlog.c (extractdelta): Likewise.

2010-05-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Delete abstraction: now

	* ci.c (getcurdate): Use ‘BE (now)’ directly.
	* rcsedit.c (setmtime): Likewise.
	* rcstime.c (str2date): Likewise.
	* rcsutil.c (gnurcs_init): Init ‘BE (now)’.
	(now): Delete func.
	* base.h (now): Delete func decl.

2010-05-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Factor constant string "revision number".

	* b-anchor.c (ks_revno): New var.
	* b-grok.c (struct grok): Add member ‘bor_no’.
	(ks_revision_number): Delete var.
	(maybe_read_num, must_read_num, MUST_REVNO): Use ‘ks_revno’.
	(must_colon_revno): Use ‘g->bor_no’.
	(full): Init ‘g->bor_no’.
	* base.h (ks_revno): New var decl.
	* ci.c (main): Use ‘ks_revno’.
	* co.c (main): Likewise.
	* rcs.c (getmessage): Likewise.
	* rcsclean.c (main): Likewise.
	* rcsdiff.c (main): Likewise.
	* rcskeep.c (keeprev): Likewise.
	* rcsmerge.c (main): Likewise.
	* rcsrev.c (genbranch, genrevs, fully_numeric): Likewise.
	* yarrrr.c [TEST_REV] (yarrrr): Likewise.

2010-05-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Make b-grok.c macro ‘BUMMER’ variadic.

	* b-grok.c (ignoble): Don't accept args ‘blurb’, ‘precisely’;
	don't do initial ‘accf’.
	(BUMMER): Make macro variadic; call ‘accf’ here.
	(eof_too_soon): Update call to ‘BUMMER’.
	(full): Use ‘BUMMER’ more.

2010-05-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use local variables more.

	* b-complain.c (vcomplain): Use local variables more; reduce
	access via ‘PROGRAM’, ‘BE’, ‘MANI’, ‘PREV’, ‘REPO’, ‘GROK’, ‘FLOW’.
	* b-fb.c (oflush): Likewise.
	* b-feph.c (makedirtemp, keepdirtemp): Likewise.
	* b-kwxout.c (keyreplace): Likewise.
	* ci.c (addelta, getcurdate, main): Likewise.
	* co.c (cleanup, rmworkfile, main): Likewise.
	* merger.c (merge): Likewise.
	* rcs.c (dolocks, buildeltatext, main): Likewise.
	* rcsclean.c (main): Likewise.
	* rcsdiff.c (main): Likewise.
	* rcsedit.c (enterstring, rcswriteopen, checkaccesslist)
	(dorewrite, donerewrite, ORCSerror): Likewise.
	* rcsfnms.c (pairnames, getfullRCSname): Likewise.
	* rcsgen.c (scandeltatext, putdesc, putadmin): Likewise.
	* rcskeep.c (getoldkeys): Likewise.
	* rcsmerge.c (main): Likewise.
	* rcsrev.c (fully_numeric, tiprev): Likewise.
	* rlog.c (getnumericrev, main): Likewise.
	* yarrrr.c [TEST_PAIRS] (yarrrr): Likewise.

2010-05-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Replace ‘myself’ with new abstraction ‘stat_mine_p’.

	* b-excwho.c (stat_mine_p): New func.
	(myself): Delete func.
	* b-excwho.h (stat_mine_p): New func decl.
	(myself): Delete func decl.
	* ci.c (removelock, addelta, fixwork): Use ‘stat_mine_p’.
	* co.c (rmworkfile): Likewise.
	* rcsedit.c (checkaccesslist): Likewise.

2010-05-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int org] Move some funcs/macros to b-excwho.c, a subset to b-excwho.h.

	* b-feph.c: #include "b-excwho.h".
	* b-isr.c: #include "b-excwho.h".
	* rcsutil.c (cacheid): Move macro from here...
	(ruid, myself, euid): Move funcs from here...
	[HAVE_SETUID] (set_uid_to, nosetid, seteid, setrid):
	Move funcs from here...
	* b-excwho.c [HAVE_SETUID && !HAVE_SETEUID] (seteuid):
	Move #define to here...
	(PEBKAC): New macro.
	(cacheid): ...to here.
	(ruid): ...to here; make static.
	(myself): ...to here.
	[HAVE_SETUID] (euid): to here; make static.
	[HAVE_SETUID] (set_uid_to): ...to here.
	(nosetid, seteid, setrid): ...to here;
	surround func body with #if ‘HAVE_SETUID’.
	* base.h [HAVE_SETUID && !HAVE_SETEUID] (seteuid): ...from here.
	(ruid): Delete func decl.
	(myself): Move func decl from here...
	[HAVE_SETUID] (euid): Delete func decl.
	[HAVE_SETUID] (nosetid, seteid, setrid): Move func decl from here...
	[!HAVE_SETUID] (nosetid, seteid, setrid): Delete macros.
	* b-excwho.h (myself, nosetid, seteid, setrid): ...to here.

2010-05-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int org] Move ‘getusername’ to b-excwho.[hc].

	* rlog.c: #include "b-excwho.h".
	* rcsutil.c [HAVE_PWD_H]: Don't #include <pwd.h>.
	(getusername): Move func from here...
	* b-excwho.c: #include <stdlib.h>, <unistd.h>, "b-complain.h".
	[HAVE_PWD_H]: #include <pwd.h>.
	(getusername): ...to here.
	* base.h (getusername): Move func decl from here...
	* b-excwho.h (getusername): ...to here.

2010-05-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int org] Move ‘getcaller’ to b-excwho.[hc].

	* rcsedit.c (getcaller): Move func from here...
	* b-excwho.c: Update copyright notice.
	(getcaller): ...to here.
	* base.h (getcaller): Move func decl from here...
	* b-excwho.h: Update copyright notice.
	(getcaller): ...to here.

2010-05-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘struct wlink’ more.

	* ci.c (addelta, main): Do s/struct hshentries/struct wlink/g;
	use ->entry, ->next instead of ->first, ->rest, respectively; use
	local var of type ‘struct delta *’ to deref ->entry where necessary.
	* co.c (main): Likewise.
	* rcs.c (searchcutpt, removerevs, buildeltatext, main): Likewise.
	* rcsclean.c (main): Likewise.
	* rcsgen.c (buildrevision): Likewise.
	* rcsrev.c (store1, genbranch, genrevs, gr_revno): Likewise.
	* yarrrr.c [TEST_REV]: #include "b-esds.h".
	[TEST_REV] (yarrrr): Likewise.
	* base.h (struct hshentries): Delete.
	(buildrevision, genrevs, gr_revno): Update func decls.

2010-05-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Rename ‘struct hshentry’ to ‘struct delta’.

	* b-grok.c: Do s/struct hshentry/struct delta/g.
	* b-kwxout.c: Likewise.
	* b-kwxout.h: Likewise.
	* base.h: Likewise.
	* ci.c: Likewise.
	* co.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsedit.c: Likewise.
	* rcsfcmp.c: Likewise.
	* rcsgen.c: Likewise.
	* rcsmerge.c: Likewise.
	* rcsrev.c: Likewise.
	* rlog.c: Likewise.
	* yarrrr.c: Likewise.

2010-05-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘str_save’ more.

	* co.c (getancestor, main): Use ‘str_save’.
	* merger.c (normalize_arg): Likewise.
	* rcsclean.c (get_directory): Likewise.
	* rcsdiff.c (main): Likewise.

2010-05-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘SINGLE’ et al more (instead of ‘SHARED’).

	* b-divvy.h (FZLLOC): New macro.
	* b-fro.c (fro_open): Use ‘FZLLOC’, ‘SINGLE’.
	* b-grok.c (full): Use ‘FZLLOC’.
	* b-kwxout.c (keyreplace): Use ‘SINGLE’.
	* rcsedit.c (swapeditfiles): Use ‘FZLLOC’.
	* rcsfnms.c (InitAdmin): Clear ‘REPO (r)’.
	(pairnames): Use ‘SINGLE’.
	* rcsrev.c (fully_numeric): Use ‘SINGLE’.

2010-05-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move ‘program’ references from global scope into ‘top’.

	* gnu-h-v.c (display_version, check_hv): Take additional arg
	‘struct program *prog’; use it instead of ‘PROGRM (foo)’.
	* gnu-h-v.h (display_version, check_hv): Update func decls.
	(CHECK_HV): Update macro.
	* rcsutil.c (gnurcs_init): Take ‘struct program *’; save into ‘top’.
	(setRCSversion): Update call to ‘display_version’.
	* base.h (program): Delete var decl.
	(struct top): Add member ‘program’.
	(PROGRAM): Update to look in ‘top->program’.
	(gnurcs_init): Update func decl.
	* ci.c (program): Delete var.
	(main): Add local var ‘struct program *program’;
	update call to ‘gnurcs_init’.
	* co.c (program, main): Likewise.
	* ident.c (program, main): Likewise;
	also update call to ‘display_version’.
	* merge.c (program, main): Likewise;
	also update call to ‘display_version’.
	* rcs.c (program, main): Likewise.
	* rcsclean.c (program, main): Likewise.
	* rcsdiff.c (program, main): Likewise.
	* rcsmerge.c (program, main): Likewise.
	* rlog.c (program, main): Likewise.
	* yarrrr.c [TEST_STR2TIME] (program): Make var static.
	[TEST_FCMP] (program): Likewise.
	[TEST_PAIRS] (program): Likewise.
	[TEST_KEEP] (program): Likewise.
	[TEST_GROK] (program): Likewise.
	[TEST_REV] (program): Likewise.
	(main): Update call to ‘gnurcs_init’.

2010-05-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: lock_drop

	* b-excwho.c (lock_drop): New func.
	* b-excwho.h (lock_drop): New func decl.
	* ci.c (removelock): Use ‘lock_drop’.
	* co.c (rmlock): Likewise.
	* rcs.c (breaklock): Likewise.
	* rcsclean.c (unlock): Likewise.
	* rcsedit.c (findlock): Likewise.

2010-05-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstractions: lock_memq, lock_login_memq, lock_delta_memq

	* b-excwho.c: #include "b-esds.h".
	(lock_memq): New func.
	* b-excwho.h (lock_memq): New func decl.
	(lock_login_memq, lock_delta_memq): New macros.
	* ci.c (removelock): Use ‘lock_delta_memq’.
	* co.c (rmlock): Likewise.
	* rcs.c (breaklock, branchpoint): Likewise.
	* rcsclean.c (unlock): Likewise.
	* rcsedit.c (findlock): Use ‘lock_login_memq’.

2010-05-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: currently_setuid_p

	* b-excwho.c (currently_setuid_p): New func.
	* b-excwho.h (currently_setuid_p): New func decl.
	* ci.c (main): Use ‘currently_setuid_p’; remove surrounding
	preproc cond ‘defined HAVE_SETUID && defined HAVE_GETUID’.
	* rcsedit.c (getcaller): Use ‘currently_setuid_p’; remove
	preproc cond ‘defined HAVE_SETUID’ and its #else branch.
	* rcsutil.c: #include "b-excwho.h".
	(set_uid_to): Use ‘currently_setuid_p’.

2010-05-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Compare delta objects instead of their revision numbers.

	* co.c (rmlock): Dont ‘STR_SAME’; instead compare objects (with ‘==’).
	* rcs.c (breaklock): Likewise.

2010-05-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: caller_login_p

	Here, "I" means "#include "b-excwho.h";
	"U" means "Use ‘caller_login_p’".
	* b-excwho.h: New file.
	* b-excwho.c: New file.
	* Makefile.am (libparts_a_SOURCES): Add b-excwho.h, b-excwho.c.
	* ci.c: I.
	(removelock, addbranch): U.
	* co.c: I.
	(rmlock): U.
	* rcs.c: I.
	(breaklock): U.
	* rcsclean.c: I.
	(unlock): U.
	* rcsedit.c: I.
	(findlock, addlock, checkaccesslist): U.

2010-05-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Consult env var RCS_MEM_LIMIT to set the memory limit.

	* base.h (struct behavior): Add member ‘mem_limit’.
	* rcsutil.c (gnurcs_init): Set ‘BE (mem_limit)’.
	* b-fro.c (REASONABLE_MMAP_SIZE): Delete #define.
	(fro_open): Use ‘BE (mem_limit)’ to determine read method.

2010-05-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: Output proper range for ‘RM_STDIO’ fro.

	Regression introduced 2010-04-27, "Add abstraction: fro_spew_partial".
	* b-fro.c (fro_spew_partial): In the case of ‘RM_STDIO’,
	compute remaining size using range end, not range beginning.

2010-05-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Bump mmap limit down to 256 kilobytes.

	* b-fro.c (REASONABLE_MMAP_SIZE): Bump down to 262144.

2010-05-24  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Rewrite parsing.

	* b-grok.h: New file.
	* b-grok.c: New file.
	* b-complain.c (fatal_syntax): Don't output line number if 0.
	* b-complain.h (SYNTAX_ERROR): Specify 0 for line number.
	* b-fro.h (struct atat): New.
	(string_from_atat, atat_put, atat_display): New func decls.
	(ATAT_END, ATAT_TEXT_END, FIXUP_OLD): New macros.
	* b-fro.c: #include <string.h>.
	(string_from_atat, atat_put, atat_display): New funcs.
	* b-kwxout.c (expandline): Don't assign to ‘NEXT (c)’, ‘LEX (lno)’.
	* base.h (struct hshentry): Add members ‘log’, ‘text’;
	delete members ‘insertlns’, ‘deletelns’.
	(struct behavior): Delete member ‘receptive_to_next_hash_key’.
	(struct parse_state): Delete.
	(struct repo): New.
	(struct repository): Add member ‘r’; delete members ‘admin’, ‘ndelt’.
	(struct top): Delete member ‘parse_state’.
	(LEX, NEXT, ADMIN): Delete macros.
	(GROK): New macro.
	(copystring, enterstring, editstring): Update func decls.
	(write_desc_maybe): New func decl.
	(Lexinit, nextlex, eoflex, getlex, getkeyopt, getkey, getkeystring)
	(getid, getnum, must_get_delta_num, readstring, printstring, savestring)
	(getadmin, gettree, getdesc, free_NEXT_str): Delete func decls.
	* ci.c: #include "b-grok.h".
	(removelock): Use ‘GROK (locks)’.
	(addelta): Use ‘REPO (r)’, ‘GROK (branch)’.
	(main): No longer call ‘gettree’, ‘Lexinit’, ‘getadmin’.
	Instead, use ‘grok_resynch’.
	* co.c (rmlock): Use ‘GROK (locks)’.
	(main): No longer call ‘gettree’, ‘getdesc’;
	use ‘GROK (branch)’, ‘write_desc_maybe’.
	* rcs.c (scanlogtext): Take pointer to list of deltas;
	rewrite to walk list of deltas instead of scanning input;
	update calls to ‘editstring’, ‘enterstring’.
	(doaccess): Use ‘GROK (access)’.
	(breaklock, branchpoint): Use ‘GROK (locks)’.
	(doassoc): Use ‘GROK (symbols)’.
	(dolocks): Use ‘GROK (locks)’, ‘GROK (branch)’.
	(buildeltatext): Take pointer to list of deltas;
	update calls to ‘scanlogtext’.
	(main): Use ‘GROK (access)’, ‘GROK (branch)’, GROK (deltas);
	no longer call ‘gettree’; update call to ‘buildeltatext’.
	* rcsclean.c (unlock): Use ‘GROK (locks)’.
	(main): No longer call ‘gettree’, ‘getdesc’;
	use ‘GROK (branch)’, ‘write_desc_maybe’.
	* rcsdiff.c (main): No longer call ‘gettree’; use ‘GROK (branch)’.
	* rcsedit.c (struct editstuff): Add member ‘script_lno’.
	(SYNTAX_ERROR): Re-#define macro.
	(struct finctx): New.
	(finisheditline): Take ‘struct finctx *’; on error,
	describe the failed action precisely, with line number.
	(finishedit_fast): Construct finctx; update calls to ‘finisheditline’.
	(copystring): Rewrite.
	(enterstring): Take ‘struct atat *’; update call to ‘copystring’;
	don't assign to ‘LEX (lno)’, ‘NEXT (c)’.
	(editstring): Take ‘struct atat *’; keep track of edit
	script line number; don't assign to ‘LEX (lno)’, ‘NEXT (c)’.
	(findlock, addlock): Use ‘GROK (locks)’.
	(addsymbol): Use ‘GROK (symbols)’.
	(checkaccesslist): Use ‘GROK (access)’.
	(dorewrite): Use '\n' directly instead of getting it from ‘NEXT (c)’.
	(getdiffcmd): Don't assign to ‘LEX (lno)’, ‘NEXT (c)’.
	* rcsfnms.c: #include "b-grok.h".
	(InitAdmin): Don't init ‘ADMIN (defbr)’, ‘ADMIN (allowed)’,
	‘ADMIN (assocs)’, ‘ADMIN (locks)’; don't call ‘Lexinit’.
	(pairnames): Init ‘FLOW (erroneousp)’, ‘BE (Oerrloop)’;
	don't call ‘Lexinit’, ‘getadmin’; grok on successful open.
	* rcsgen.c (scandeltatext): Take pointer to list of deltas;
	rewrite to walk list of deltas instead of scanning input;
	update calls to ‘enterstring’, ‘copystring’, ‘editstring’.
	(buildrevision): Use ‘GROK (deltas)’; update calls to ‘scandeltatext’.
	(write_desc_maybe): New func.
	(putdesc): Use ‘write_desc_maybe’, ‘FIXUP_OLD’.
	(format_assocs): Don't do anything if ‘!REPO (r)’; use ‘GROK (symbols)’.
	(putadmin); Use ‘REPO (r)’, ‘GROK (branch)’,
	‘GROK (access)’, ‘GROK (locks)’.
	* rcsmap.c (checkidentifier): Fix typo introduced 2010-05-18,
	"Move some funcs out of rcslex.c to rcsmap.c".
	* rcsmerge.c (main): No longer call ‘gettree’; use ‘GROK (branch)’.
	* rcsrev.c (rev_from_symbol): Use ‘GROK (symbols)’.
	(fully_numeric, tiprev): Use ‘GROK (branch)’.
	* rcsutil.c (free_NEXT_str): Delete func.
	* rlog.c: #incude <errno.h>.
	(read_positive_integer, count_a_d): New static funcs.
	(putadelta): Use ‘count_a_d’, ‘atat_display’.
	(getscript, readdeltalog): Delete funcs.
	(extractdelta, trunclocks): Use ‘GROK (locks)’.
	(getnumericrev): Use ‘GROK (branch)’.
	(main): Use ‘GROK (locks)’, ‘GROK (branch)’, ‘GROK (access)’,
	‘GROK (deltas_count)’, ‘GROK (desc)’, ‘atat_display’, ‘FIXUP_OLD’;
	no longer call ‘gettree’.
	* rcslex.c: Delete file.
	* rcssyn.c: Delete file.
	* yarrrr.c [TEST_GROK]: New section.
	[TEST_LEX]: Delete section.
	[TEST_SYN]: Delete section.
	* Makefile.am (libparts_a_SOURCES):
	Add b-grok.h, b-grok.c;	delete rcslex.c, rcssyn.c.
	(YALL): Add GROK; delete LEX, SYN.

2010-05-24  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Rename ‘ADMIN (log_lead)’ to ‘REPO (log_lead)’.

	* base.h (struct repository): Add member ‘log_lead’;
	in sub-‘struct admin’, delete member ‘log_lead’.
	* b-kwxout.c (keyreplace): Update refs.
	* rcs.c (main): Likewise.
	* rcsfcmp.c (rcsfcmp): Likewise.
	* rcsfnms.c (InitAdmin): Likewise.
	* rcsgen.c (putadmin): Likewise.
	* rcssyn.c (getadmin): Likewise.
	* rlog.c (main): Likewise.
	* yarrrr.c [TEST_FCMP] (yarrrr): Likewise.

2010-05-22  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Rename ‘ADMIN (head)’ to ‘REPO (tip)’.

	* base.h (struct repository): Add member ‘tip’;
	in sub-‘struct admin’, delete member ‘head’.
	* ci.c (addelta, main): Update refs.
	* rcs.c (getstates, breaklock, dolocks, buildtree, main): Likewise.
	* rcsclean.c (main): Likewise.
	* rcsdiff.c (main): Likewise.
	* rcsedit.c (dorewrite): Likewise.
	* rcsfnms.c (InitAdmin): Likewise.
	* rcsgen.c (putadmin): Likewise.
	* rcsmerge.c (main): Likewise.
	* rcsrev.c (genrevs, fully_numeric, tiprev): Likewise.
	* rcssyn.c (getadmin): Likewise.
	* rlog.c (putrunk, readdeltalog, getnumericrev, main): Likewise.

2010-05-21  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] In ‘struct hshentry’, rename member ‘log’ to ‘pretty_log’.

	* base.h (struct hshentry): Rename member ‘log’ to ‘pretty_log’.
	* b-kwxout.c (keyreplace): Update.
	* ci.c (main): Likewise.
	* rcs.c (scanlogtext, domessages): Likewise.
	* rcsfcmp.c (rcsfcmp): Likewise.
	* rcsgen.c (scandeltatext, putdtext, putdftext): Likewise.
	* rcssyn.c (getdelta): Likewise.
	* rlog.c (putadelta, readdeltalog, exttree): Likewise.
	* yarrrr.c [TEST_FCMP] (yarrrr): Likewise.

2010-05-20  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘struct link’ for ‘ADMIN (locks)’ list.

	* base.h (struct repository): Change
	type of member ‘admin.locks’ to ‘struct link *’.
	* ci.c (removelock): Use ‘struct link’ for list-walk local vars.
	* co.c (rmlock): Likewise.
	* rcs.c (breaklock, branchpoint, dolocks): Likewise.
	* rcsclean.c (unlock): Likewise.
	* rcsedit.c (findlock, addlock): Likewise.
	* rcsgen.c (putadmin): Likewise.
	* rcssyn.c (getadmin, gettree): Likewise.
	* rlog.c (extractdelta, trunclocks, main): Likewise.

2010-05-20  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘struct link’ for ‘ADMIN (assocs)’ list.

	* base.h (struct repository): Change
	type of member ‘admin.assocs’ to ‘struct link *’.
	* rcsedit.c (addsymbol): To rebind, cons a new ‘struct symdef’
	and splice it into the list position of the original association.
	* rcs.c (doassoc): Use ‘struct link’ for list-walk local vars.
	* rcsgen.c (format_assocs): Likewise.
	* rcsrev.c (rev_from_symbol): Likewise.
	* rcssyn.c (getadmin): Likewise.

2010-05-20  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Incorporate ‘fro_get_prev_byte’ into unique caller.

	* b-kwxout.c (keyreplace): Use ‘fro_move’, ‘GETCHAR’.
	* b-fro.c (fro_get_prev_byte): Delete func.
	* b-fro.h (fro_get_prev_byte): Delete func decl.

2010-05-20  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: fro_move

	* b-fro.c (fro_bob): Delete func.
	(fro_move): New func.
	* b-fro.h (fro_bob): Convert from func decl to macro.
	(fro_move): New func decl.

2010-05-20  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int org] Move some funcs out of rcssyn.c to rcsedit.c.

	* rcssyn.c (unexpected_EOF, initdiffcmd, badDiffOutput)
	(diffLineNumberTooLarge, getdiffcmd): Move funcs from here...
	* rcsedit.c: #include <ctype.h>.
	(unexpected_EOF, initdiffcmd, badDiffOutput)
	(diffLineNumberTooLarge, getdiffcmd): ...to here.
	* base.h: Reorder func decls; nfc.

2010-05-19  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘?:’ more.

	* rlog.c (putadelta): Use ‘?:’ instead of ‘if’ statement.

2010-05-18  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: SYNTAX_ERROR

	* b-complain.c (fatal_syntax): Take line number as first arg.
	* b-complain.h (fatal_syntax): Update func decl.
	(SYNTAX_ERROR): New macro.
	* b-fro.c: Do g/fatal_syntax/SYNTAX_ERROR/g.
	* rcsedit.c: Likewise.
	* rcsgen.c: Likewise.
	* rcslex.c: Likewise.
	* rcssyn.c: Likewise.
	* rlog.c: Likewise.
	* yarrrr.c: Likewise.

2010-05-18  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int org] Move ‘LEX (erroneousp)’ to ‘FLOW (erroneousp)’.

	* base.h (struct parse_state): Move member ‘erroneousp’ from here...
	(struct flow): ...to here.
	* b-complain.c: Do s/LEX (erroneousp)/FLOW (erroneousp)/g.
	* ci.c: Likewise.
	* co.c: Likewise.
	* merge.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsedit.c: Likewise.
	* rcskeep.c: Likewise.
	* rcslex.c: Likewise.
	* rcsmerge.c: Likewise.
	* rlog.c: Likewise.

2010-05-18  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int org] Move some funcs out of rcslex.c to rcsmap.c.

	* rcslex.c (checkidentifier, checkid, checksym, checksid)
	(checkssym): Move funcs from here...
	* rcsmap.c (checkidentifier, checkid, checksym, checksid)
	(checkssym): ...to here.
	* base.h: Reorder func decls; nfc.

2010-05-18  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Dose some funcs with ‘const’.

	* rcslex.c (checkidentifier, checkid, checksym):
	Return/take ‘char const *’.
	(checksid, checkssym): Take ‘char const *’.
	* base.h (checkidentifier, checkid, checksym)
	(checksid, checkssym): Update func decls.

2010-05-18  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Don't mutate string in ‘checkidentifier’.

	* rcslex.c (checkidentifier): Don't NUL-terminate arg to
	error message; instead, use ‘%.*s’ in error message format string.

2010-05-18  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int org] Move ‘redefined’ from rcslex.c to rcsutil.c.

	* base.h (redefined): Move func decl; nfc.
	* rcslex.c (redefined): Move func from here...
	* rcsutil.c (redefined): ...to here.

2010-05-18  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int org] Move some funcs out of rcslex.c to b-fb.[hc].

	* b-fb.c (Ozclose, Orewind, aflush, oflush, afputc, aputs)
	(aprintf): Move funcs from rcslex.c to here.
	* b-fb.h (Ozclose, Orewind, aflush, oflush, afputc, aputs)
	(aprintf): Move func decls from base.h to here; add ‘extern’.
	* rcsclean.c: #include "b-fb.h".
	* rcssyn.c: Likewise.
	* rlog.c: Likewise.
	* base.h (Ozclose, Orewind, aflush, oflush, afputc, aputs)
	(aprintf): Delete func decls.
	* rcslex.c (Ozclose, Orewind, aflush, oflush, afputc, aputs)
	(aprintf): Delete funcs.

2010-05-18  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Mutate strings in rcs(1) ‘argv’ less.

	* rcs.c (getassoclst, getaccessor, getstates):
	Cons a new string in ‘SHARED’ instead of mutating the arg.

2010-05-17  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstractions: EDIT_SCRIPT_SHORT, EDIT_SCRIPT_OVERFLOW

	* rcsedit.c (EDIT_SCRIPT_SHORT, EDIT_SCRIPT_OVERFLOW): New macros.
	(editEndsPrematurely, editLineNumberOverflow): Delete funcs.
	(insertline, deletelines, copylines): Use ‘EDIT_SCRIPT_OVERFLOW’.
	(editstring): Likewise; also, use ‘EDIT_SCRIPT_SHORT’.

2010-05-17  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: Make ‘take’ handle branch number.

	Regression introduced 2010-04-21,
	"Use ‘TAKE’, not ‘partialno’; zonk the latter".
	* rcsrev.c (take): Stop looping at terminating NUL;
	in that case, accumulate up to the NUL as well.
	* base.h (take): Update var name in func decl.

2010-05-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Centralize ‘COMPAT2’ support.

	* b-anchor.c [COMPAT2] (tiny_suffix): New ‘struct tinysym’.
	* base.h [COMPAT2] (tiny_suffix): New ‘struct tinysym’ decl.
	* rcssyn.c [COMPAT2] (tiny_suffix): Delete.

2010-05-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘tmpfile’.

	* rcs.c (sendmail, buildeltatext): Use ‘tmpfile’.

2010-05-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	rcs: Fix syntax error when ‘--with-mailer=MAILER’.

	Regression introduced 2010-03-30, "Abstract writes to stderr".
	* rcs.c (sendmail): Add missing semicolon.

2010-05-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use #define for ‘rcsdir’; rename its -len var conventionally.

	* rcsfnms.c (rcsdir): Convert string var to #define.
	(rcsdirlen): Rename from ‘rcslen’.
	(rcssuffix): Use ‘rcsdirlen’.
	(fin2open): Use ‘rcsdirlen’ directly.

2010-05-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] For collecting deltas, replace file-static var w/ local var.

	* ci.c (gendeltas): Delete var.
	(addelta): Take ‘struct hshentries **’; pass it to ‘gr_revno’.
	(main): Use local var for collecting deltas; update call to ‘addelta’.
	* co.c (gendeltas): Delete var.
	(main): Use local var for collecting deltas.
	* rcs.c (gendeltas): Delete var.
	(removerevs, main): Use local var for collecting deltas.

2010-05-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: delta_from_ref

	* base.h (delta_from_ref): New func decl.
	* rcsrev.c (delta_from_ref): New func.
	(branchtip): Use ‘delta_from_ref’.
	* ci.c (addbranch, main): Likewise.
	* co.c (addjoin): Likewise.
	* rcs.c (setlock, dolocks, domessages, rcs_setstate): Likewise.
	* rcsdiff.c (main): Likewise.
	* rcsmerge.c (main): Likewise.

2010-05-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: Resolve ‘BRNUM.’ correctly.

	Regression introduced 2010-04-21, "Add abstraction: fully_numeric".
	* rcsrev.c (fully_numeric): When expanding "BRNUM."--note
	trailing dot--append only the non-branch part of the tip revision.

2010-05-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Make ‘genrevs’, ‘gr_revno’ able to inhibit storing.

	* rcsrev.c (STORE_MAYBE, CLEAR_MAYBE): New macros.
	(genbranch, genrevs): Use ‘STORE_MAYBE’, ‘CLEAR_MAYBE’.
	(branchtip): Update call to ‘gr_revno’ to specify no storage.
	* co.c (addjoin): Likewise.
	* rcsdiff.c (main): Likewise.
	* rcsmerge.c (main): Likewise.

2010-05-06  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Avoid ‘next’ as a local variable name.

	* rcsedit.c (checkaccesslist): Rewrite ‘do-while’ as ‘for’ loop.
	* rcsrev.c (genbranch, genrevs): Rename local var ‘next’ to ‘d’.
	(rev_from_symbol): Rename local var ‘next’ to ‘ls’.

2010-05-06  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘struct wlink’ for hash table buckets.

	* base.h (struct hshentry): Delete member ‘nexthsh’.
	(struct parse_state): Change type of ‘hshtab’ to ‘struct wlink **’.
	* rcslex.c: #include "b-esds.h".
	(lookup): Update to walk ‘struct wlink’ list; for new
	entries, push -- use ‘wprepend’ -- instead of appending.

2010-05-06  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Replace ‘struct branchhead’ with ‘struct wlink’.

	Here, "U" means "Update to walk ‘struct wlink’ list".
	* base.h (struct branchhead): Delete.
	(struct hshentry): Change type of member ‘branches’ to ‘struct wlink *’.
	* ci.c (newbranch): Change type to ‘struct wlink’.
	(BHDELTA): New macro.
	(addbranch): U; use ‘BHDELTA’.
	* rcs.c (buildtree): U.
	* rcsgen.c (putdelta, puttree): U.
	* rcsrev.c (genbranch): U.
	* rcssyn.c (getdelta): U.
	* rlog.c (putadelta, putforest, exttree, recentdate, extdate): U.

2010-05-06  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘struct wlink’ for ‘ADMIN (locks)’ list.

	Here, "U" means "Update to walk ‘struct wlink’ list".
	* base.h (struct rcslock): Delete member ‘nextlock’.
	(struct repository): In sub-‘struct admin’,
	change type of member ‘locks’ to ‘struct wlink *’.
	* ci.c (removelock): U.
	* co.c (rmlock): U.
	* rcs.c (breaklock, branchpoint): U.
	(dolocks): Update access to ‘ADMIN (locks)’.
	* rcsclean.c (unlock): U.
	* rcsedit.c (findlock): U.
	(addlock): U; use ‘wprepend’.
	* rcsgen.c (putadmin): U.
	* rcssyn.c (getadmin): U; use ‘wextend’.
	(gettree): U.
	* rlog.c (extractdelta, trunclocks, main): U.

2010-05-06  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: wprepend

	* b-esds.h (wprepend): New func decl.
	* b-esds.c (PREPEND_BODY): New macro.
	(prepend): Use ‘PREPEND_BODY’.
	(wprepend): New func.

2010-05-06  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Replace ‘struct Status’ with ‘struct link’ + ‘struct u_state’.

	* rcs.c (struct u_state): New.
	(struct Status): Delete.
	(statelst): Change type to ‘struct link’.
	(nextstate): Delete var.
	(getstates): Take ‘struct link **’; use ‘extend’.
	(main): Update call to ‘getstates’; update
	‘statelst’ access to walk ‘struct link’ list.

2010-05-06  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Replace ‘struct Datepairs’ with ‘struct link’ + ‘struct daterange’.

	* rlog.c (struct daterange): New.
	(struct Datepairs): Delete.
	(datelist, duelst): Change type to ‘struct link *’.
	(recentdate): Take ‘struct daterange *’.
	(extdate): Update to walk ‘struct link’ list.
	(PUSH): Move prior to ‘getdatepair’; nfc.
	(getdatepair): Use ‘struct daterange’ object; use ‘PUSH’.
	(main): Update to walk ‘struct link’ list; also, discard
	incomplete ‘duelst’ entry, substituting it with a new object.

2010-05-05  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Incorporate ‘xpandstring’ into unique caller.

	* rcsgen.c: #include "b-kwxout.h".
	(scandeltatext): Incorporate ‘xpandstring’.
	* rcsedit.c (xpandstring): Delete func.
	* base.h (xpandstring): Delete func decl.

2010-05-05  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Free edit state when done.

	* rcsedit.c (unmake_editstuff): New func.
	* base.h (unmake_editstuff): New func decl.
	* rcs.c (main): Use ‘unmake_editstuff’.
	* rcsgen.c (buildrevision): Likewise.

2010-05-05  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Replace ‘Iptr_type’ with ‘char *’.

	* b-fro.h (Iptr_type): Delete typedef.
	(struct fro): Change type to ‘char *’ for members ‘ptr’, ‘lim’, ‘base’.
	* b-fro.c (fro_open): Use ‘char *’ directly.
	* rcsedit.c (struct editstuff): Likewise.
	(movelines, insertline, snapshotline, snapshotedit_fast)
	(finisheditline, finishedit_fast, enterstring): Likewise.

2010-05-05  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Replace ‘struct Message’ with ‘struct link’ + ‘struct u_log’.

	* rcs.c (struct u_log): New.
	(struct Message): Delete.
	(messagelst): Change type to ‘struct link’.
	(nextmessage): Delete var.
	(getmessage): Take ‘struct link **’; use ‘extend’.
	(domessages): Update to walk ‘struct link’ list.
	(main): Update call to ‘getmessage’; update ‘messagelst’ access.

2010-05-05  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Replace ‘struct Revpairs’ with ‘struct link’ + ‘struct revrange’.

	* rlog.c (struct revrange): New.
	(struct Revpairs): Delete.
	(revlist, Revlst): Change type to ‘struct link *’.
	(extractdelta): Update to walk ‘struct link’ list.
	(PUSH): New macro.
	(getnumericrev): Update to walk ‘struct link’ list; use ‘PUSH’.
	(putrevpairs): Use ‘PUSH’.

2010-05-05  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: prepend

	* b-esds.h (prepend): New func decl.
	* b-esds.c (prepend): New func.

2010-05-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘struct u_symdef’ more.

	* rcs.c (struct u_symdef): Move from here...
	* base.h (struct u_symdef): ...to here.
	* ci.c: #include "b-esds.h".
	(struct Symrev): Delete.
	(assoclst): Change type to ‘struct link’.
	(nextassoc): Delete var.
	(addsyms): Update to walk ‘struct link’ list.
	(addassoclst): Delete func.
	(first_meaningful_symbolic_name): New static func.
	(main): Combine ‘-n’, ‘-N’ handling; update ‘assoclst’
	init and access; use ‘first_meaningful_symbolic_name’.

2010-05-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘struct link’ more.

	* rcs.c (struct chaccess): Delete member ‘nextchaccess’.
	(chaccess): Change type to ‘struct link’.
	(nextchaccess): Delete var.
	(getchaccess): Take ‘struct link **’; use ‘extend’.
	(getaccessor): Take ‘struct link **’; update call to ‘getchaccess’.
	(doaccess): Update to walk ‘struct link’ list.
	(main): Update calls to ‘getaccessor’, ‘getchaccess’.

2010-05-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	rcs: Fix bug: Correctly erase/append access-list entries.

	Regression introduced 2010-04-28,
	"Use ‘struct link’ instead of ‘struct access’".
	* rcs.c (doaccess): Rewrite list walking for both erase/append.

2010-05-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Replace ‘struct Symrev’ with ‘struct link’ + ‘struct u_symdef’.

	* rcs.c (struct Symrev): Delete.
	(struct u_symdef): New.
	(assoclst): Change type to ‘struct link’.
	(nextassoc): Delete var.
	(getassoclst): Don't take ‘flag’; instead, take ‘struct link **’;
	compute override flag from first char in ‘sp’; add local macro
	to skip whitespace; create a ‘struct u_symdef’; use ‘extend’.
	(doassoc): Update to walk ‘struct link’ list.
	(main): Update call to ‘getassoclst’; combine ‘-n’, ‘-N’ handling.

2010-05-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	rcs: Fix bug: Correctly delete symbolic name.

	Regression introduced 2010-04-28,
	"Replace ‘struct assoc’ with ‘struct wlink’ + ‘struct symdef’".
	* rcs.c (doassoc): Use local variable of type
	‘struct symdef *’ to assign from ‘void *’ instead of
	typecast; also, assign from ‘tp->entry’, not ‘tp’.

2010-05-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: Make ‘keepdate’ actually keep the date.

	Regression introduced 2010-04-12,
	"Use spaces for "ci -k" support".
	* rcskeep.c (keepdate): Use ‘intern’, not ‘finish_string’.

2010-05-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: parse_revpairs

	* rcsutil.c (parse_revpairs): New func.
	* base.h (parse_revpairs): New func decl.
	* rcs.c (putdelrev): New static func.
	(getdelrev): Delete func.
	(main): Use ‘parse_revpairs’.
	* rlog.c (putrevpairs): New static func.
	(getrevpairs): Delete func.
	(main): Use ‘parse_revpairs’.

2010-05-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	ident: Make error message more conventional.

	* ident.c (reportError): Delete func.
	(scanfile, main): Use ‘syserror_errno’.

2010-05-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘struct link’ more.

	* rlog.c (struct rcslockers): Delete.
	(struct stateattri, struct authors): Likewise.
	(authorlist, lockerlist, statelist): Change type to ‘struct link *’.
	(getlocker, getauthor, getstate): Use ‘extend’.
	(extractdelta, trunclocks): Update to walk ‘struct link *’ list.
	* rcs.c (struct Lockrev): Delete.
	(newlocklst, rmvlocklst): Change type to ‘struct link *’.
	(rmnewlocklst): Return ‘struct link *’.
	(dolocks): Update to walk ‘struct link *’ list.
	(main): Use ‘extend’.

2010-05-02  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘bool’ more.

	* base.h (struct hshentry): Change type of member ‘selector’ to bool.

2010-04-30  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Freeze RCS file syntax; drop ‘newphrase’ support.

	* base.h (struct hshentry): Delete members ‘ig’, ‘igtext’.
	(struct parse_state): Delete member ‘ignore’.
	(struct repository): Delete member ‘description’.
	(warnignore, getphrases, ignorephrases): Delete func decls.
	* ci.c (main): Don't init ‘newdelta.ig’, ‘newdelta.igtext’.
	* rcs.c (scanlogtext): Expect ‘text’ after ‘log’.
	* rcsfnms.c (InitAdmin): Don't init ‘ADMIN (description)’.
	* rcsgen.c (scandeltatext): Expect ‘text’ after ‘log’.
	(putadmin): Don't bother w/ ‘ADMIN (description)’ output.
	(putdelta, putdftext): Don't bother w/ "ignored phrases" output.
	* rcslex.c (warnignore): Delete func.
	(Lexinit): Don't bother w/ ‘LEX (ignore)’ init.
	(getphrases): Delete func.
	* rcssyn.c (getadmin): Don't init ‘ADMIN (description)’.
	(ignorephrases): Delete func.
	(getdelta): Don't bother lookng for "ignorable phrases".
	* rlog.c (readdeltalog): Expect ‘text’ after ‘log’.

2010-04-30  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Clean up base.h; nfc.

	* base.h: Reorder top-level forms;
	add variable names to func decls.
	(expand_names): Delete now-unused var decl.

2010-04-30  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: format_assocs

	* base.h (format_assocs): New func decl.
	* rcsgen.c (format_assocs): New func.
	(putadmin): Use ‘format_assocs’.
	* rlog.c (main): Likewise.
	* alive.test: Update expected rlog(1) output.

2010-04-30  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Recognize ‘commitid SYMBOL’ in RCS file delta tree.

	* base.h (struct hshentry): Add member ‘commitid’.
	(tiny_commitid): New var decl, via ‘TINY_DECL’.
	* b-anchor.c (tiny_commitid): New var, via ‘TINYK’.
	* rcssyn.c (getdelta): Recognize ‘commitid’; validate/save its value.
	* rcsgen.c (putdelta): Output ‘commitid’ info, if available.
	* rlog.c (putadelta): Likewise.

2010-04-30  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move ‘expandline’ scratch to expansion context.

	* b-kwxout.h (struct expctx): Add member ‘lparts’.
	* b-kwxout.c (LPARTS): Delete #define.
	(ENSURE_LPARTS): Delete macro.
	(expandline): Create/use space directly in expansion context.
	* base.h (struct manifestation): Delete member ‘lparts’.

2010-04-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] For rcsedit.c, use es->foo directly.

	* rcsedit.c (EDIT): Delete macro.
	(insertline): Use ‘es->foo’ instead of ‘EDIT (foo)’.
	(deletelines, snapshotedit_fast, finishedit_fast, swapeditfiles)
	(finishedit_slow, snapshotedit_slow, copylines, copystring)
	(enterstring, editstring): Likewise.

2010-04-29  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Tighten ‘finishedit_fast’.

	* rcsedit.c (finisheditline): Take ‘struct expctx *’.
	(finishedit_fast): Create expansion context, pass to ‘finisheditline’.

2010-04-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Replace ‘struct assoc’ with ‘struct wlink’ + ‘struct symdef’.

	Here, "U" means "Update to use ‘struct wlink’ + ‘struct symdef’".
	* base.h (struct assoc): Delete.
	(struct symdef): New.
	(struct repository): Use ‘struct wlink’ for ‘admin.assocs’.
	* rcs.c (doassoc): U.
	* rcsedit.c (addsymbol): U.
	* rcsgen.c (putadmin): U.
	* rcsrev.c: #include "b-esds.h".
	(rev_from_symbol): U.
	(lookupsym): Use ‘rev_from_symbol’.
	* rcssyn.c (getadmin): U.
	* rlog.c (main): U.

2010-04-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘struct link’ instead of ‘struct access’.

	Here, "U" means "Update to use ‘struct link’".
	* base.h (struct access): Delete.
	(struct repository): Use ‘struct link’ for ‘admin.allowed’.
	* rcs.c: #include "b-esds.h".
	(doaccess, main): U.
	* rcsedit.c: #include "b-esds.h".
	(checkaccesslist): U.
	* rcsgen.c: #include "b-esds.h".
	(putadmin): U.
	* rcssyn.c: #include "b-esds.h".
	(getadmin): U.
	* rlog.c: #include "b-esds.h".
	(main): U.

2010-04-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstractions: STR_DIFF, STR_SAME

	* base.h (STR_DIFF, STR_SAME): New macros.
	* ci.c (removelock, addbranch, main): Use one or both of them.
	* co.c (rmlock): Likewise.
	* rcs.c (rmnewlocklst, doaccess, breaklock, doassoc)
	(rcs_setstate, main): Likewise.
	* rcsclean.c (unlock): Likewise.
	* rcsedit.c (findlock, addlock, addsymbol, checkaccesslist): Likewise.
	* rcslex.c (lookup): Likewise.
	* rcsmerge.c (main): Likewise.
	* rcsrev.c (genbranch, genrevs, lookupsym, namedrev): Likewise.
	* rlog.c (extractdelta, trunclocks): Likewise.

2010-04-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Rework remaining function-static variables.

	* ci.c (newbranch): New file-static var, moved to here...
	(addbranch): ...from here.
	(getcurdate_buffer): New file-static var, renamed/moved to here...
	(getcurdate): ...from ‘buffer’, here.
	(FIRST): New #define.
	(logmsg): New file-static var, move to here...
	(getlogmsg): ...from here; also, construct "empty checkin"
	and "initial revision" messages dynamically.
	(default_state): New file-static var, moved to here...
	(main): ...from here.
	* rcsmerge.c (quietarg): New #define.
	(main): Delete func-static var ‘quietarg’.
	* rlog.c (putdelta): Delete func-static
	var ‘emptych’; use ‘EMPTYLOG’ directly.

2010-04-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] New abstractions: extend, wextend

	* b-esds.h: New file.
	* b-esds.c: New file.
	* Makefile.am (libparts_a_SOURCES): Add b-esds.h, b-esds.c.
	* co.c: #include "b-esds.h".
	(struct link): Delete.
	(struct jstuff): Delete members ‘prev’, ‘cur’; add ‘head’, ‘tp’.
	(jpush): Use ‘extend’.
	(preparejoin): Accumulate ‘joinlist’ components in order.
	* rcsclean.c: #include "b-esds.h".
	(struct link): Delete.
	(get_directory): Use ‘wextend’.

2010-04-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: fro_spew_partial

	* b-fro.h (struct range): New.
	(struct fro): Add member ‘end’.
	(fro_spew_partial): New func decl.
	* b-fro.c (fro_open): Save file-end offset.
	(fro_spew_partial): New func.
	(fro_spew): Use ‘fro_spew_partial’.

2010-04-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Make ‘struct maketimestuff’ definition global.

	* maketime.h (maketimestuff): Move struct def to here...
	* maketime.c: Don't #include "b-divvy.h".
	(maketimestuff): ...from here.
	(init_maketimestuff): Delete func.
	* rcsutil.c (gnurcs_init): Init ‘BE (maketimestuff)’ directly.

2010-04-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Allocate edit state lazily.

	Here, "F" means "Take ‘struct editstuff *’ as first arg".
	* rcsedit.c (EDIT): Update macro.
	(make_editstuff): New func.
	(insertline, deletelines, snapshotedit_fast, finishedit_fast)
	(swapeditfiles, finishedit_slow, snapshotedit_slow, finishedit)
	(snapshotedit, copylines): F.
	(ensure_editstuff): Delete func.
	(copystring): F; don't call ‘ensure_editstuff’.
	(enterstring): Likewise.
	(editstring): F.
	(rcswriteopen): Don't call ‘ensure_editstuff’.
	* rcsgen.c (scandeltatext): F.
	(buildrevision): Create a ‘struct editstuff’ to pass around.
	* rcs.c (scanlogtext, buildeltatext): F.
	(main): Create a ‘struct editstuff’ to pass around.
	* base.h (struct behavior): Remove member ‘editstuff’.
	(make_editstuff): New func decl.
	(copystring, enterstring, finishedit)
	(snapshotedit, editstring): Update func decls.

2010-04-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move ‘testalloc’, ‘testrealloc’; make them static.

	* rcsedit.c: #include <stdlib.h>.
	(okalloc, testalloc, testrealloc): New static funcs.
	* rcsutil.c (okalloc, testalloc, testrealloc): Delete funcs.
	* base.h (testalloc, testrealloc): Delete func decls.

2010-04-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘SHARED’ more.

	* ci.c (addassoclst): Use ‘ZLLOC’.
	* rcs.c (getassoclst, getchaccess)
	(getmessage, getstates, main): Likewise.
	(rmnewlocklst): Don't ‘tfree’.
	* rlog.c (getlocker, getauthor, getstate)
	(getdatepair, getrevpairs): Use ‘ZLLOC’.
	* base.h (talloc, tfree): Delete macros.

2010-04-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Bifurcate ‘fro_getbyte’ to fro_{try,must}_getbyte.

	* b-fro.c (GETBYTE_BODY): New macro.
	(fro_getbyte): Delete func.
	(fro_try_getbyte, fro_must_getbyte): New funcs.
	(fro_get_prev_byte): Use ‘fro_must_getbyte’.
	* b-fro.h (fro_getbyte): Delete func decl.
	(fro_try_getbyte, fro_must_getbyte): New func decls.
	(GETCHAR_OR) Use ‘fro_try_getbyte’.
	(GETCHAR): Use ‘fro_must_getbyte’.

2010-04-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: must_get_colon_delta_num

	* rcssyn.c (must_get_colon_delta_num): New static func.
	(getadmin): Use it.

2010-04-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: must_get_delta_num

	* rcslex.c (must_get_delta_num): New func.
	* base.h (must_get_delta_num): New func decl.
	* rcs.c (scanlogtext): Use ‘must_get_delta_num’.
	* rcsgen.c (scandeltatext): Likewise.
	* rlog.c (readdeltalog): Likewise.

2010-04-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘strlen’ less.

	* rcs.c (main): Use ‘commsymlen’.
	* rcsfnms.c (pairnames): Use ‘intern’, ‘maybe.bestfit.size’.
	* rcslex.c (lookup): Use ‘intern’.
	* rcstime.c (date2str): Track write count via ‘sprintf’ rv.

2010-04-24  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Enable 64-bit file offsets.

	* base.h (_FILE_OFFSET_BITS): New #define.

2010-04-24  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Make ‘tiny_branches’ global.

	* base.h (tiny_branches): New var decl (via ‘TINY_DECL’).
	* b-anchor.c (tiny_branches): New var (via ‘TINYK’).
	* rcssyn.c (tiny_branches): Delete static var.

2010-04-24  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Use gnulib module ‘obstack-printf’.

	* b-divvy.c (accf): New func.
	(accumulate_nonzero_bytes): Delete func.
	* b-divvy.h (accf): New func decl.
	(accumulate_nonzero_bytes): Delete func decl.
	(accs): New macro.
	* b-feph.c (jam_sff): Use ‘accf’.
	* ci.c (ACCB, ACCS): Delete macros.
	(ACCF): New macro.
	(JAM, ADD, incnum, getlogmsg): Use ‘ACCF’.
	* co.c (buildjoin): Use ‘accf’.
	* merger.c (normalize_arg): Likewise.
	* rcsdiff.c (setup_label, main): Likewise.
	* rcsedit.c (naturalize, rcswriteopen): Use ‘accs’.
	* rcsfnms.c (getfullRCSname): Use ‘accf’.
	* rcslex.c (getphrases): Use ‘accs’.
	* rcsrev.c (accumulate_branchno): Likewise.
	(fully_numeric): Use ‘accf’, ‘accs’.
	* rcsutil.c (minus_p, accumulate_arg_quoted): Use ‘accf’.
	(runv): Use ‘accs’, ‘accf’.
	* rlog.c (getnumericrev): Use ‘accf’.

2010-04-23  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Tighten ‘InitAdmin’.

	* rcsfnms.c (bindex, suffix_matches): Delete func.
	(InitAdmin): Use ‘strrchr’, ‘strcasecmp’.

2010-04-22  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use tinysym for parsing "RCS file keywords".

	* b-anchor.c (TINY_INIT, TINYK): New macros.
	(tiny_ciklog, tiny_access, tiny_author, tiny_branch, tiny_comment)
	(tiny_date, tiny_desc, tiny_expand, tiny_head, tiny_locks, tiny_log)
	(tiny_next, tiny_state, tiny_strict, tiny_symbols, tiny_text):
	New ‘struct tinysym’ objects, via ‘TINY_DECL’, ‘TINYK’.
	(looking_at): New func.
	* base.h (KS): Delete macro.
	(Kaccess, Kauthor, Kbranch, Kcomment, Kdate, Kdesc)
	(Kexpand, Khead, Klocks, Klog, Knext, Kstate, Kstrict)
	(Ksymbols, Ktext, ciklog, ciklog_len): Delete #define:s.
	(TINY, TINY_DECL): New macros.
	(tiny_ciklog, tiny_access, tiny_author, tiny_branch, tiny_comment)
	(tiny_date, tiny_desc, tiny_expand, tiny_head, tiny_locks, tiny_log)
	(tiny_next, tiny_state, tiny_strict, tiny_symbols, tiny_text):
	New ‘struct tinysym’ object decls, via ‘TINY_DECL’.
	(looking_at): New func decl.
	(getkeyopt, getphrases, getkey, getkeystring)
	(ignorephrases): Update func decls.
	(TINYS, TINYKS): New macros.
	* b-kwxout.c (keyreplace): Use ‘looking_at’, ‘TINY (ciklog)’.
	* rcsfcmp.c (rcsfcmp): Likewise.
	* ci.c (getlogmsg): Use ‘TINYKS’.
	* rcsedit.c (dorewrite): Likewise.
	* rcs.c (scanlogtext): Pass ‘&TINY (foo)’.
	* rcsgen.c (scandeltatext): Likewise.
	(putdesc, putadmin, putdelta, putdftext): Use ‘TINYKS’.
	* rcslex.c (getkeyopt, getkey, getkeystring): Take ‘struct tinysym *’.
	(getphrases): Likewise; use ‘intern’.
	* rcssyn.c (Kbranches): Replace #define with ‘TINY_DECL (branches)’.
	[COMPAT2] (Ksuffix): Replace #define with ‘TINY_DECL (suffix)’.
	(getsemi): Take ‘struct tinysym *’.
	(getadmin): Pass ‘&TINY (foo)’.
	(ignorephrases): Take ‘struct tinysym *’; use ‘looking_at’.
	(getkeyval): Take ‘struct tinysym *’; use ‘TINYS’.
	(getdelta, getdesc): Pass ‘&TINY (foo)’.
	* rlog.c (readdeltalog): Likewise.

2010-04-22  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Tighten ‘recognize_kwsub’, ‘str2expmode’.

	* b-anchor.c (pool_lookup, recognize_kwsub):
	Don't take START, LEN; instead take a ‘struct cbuf *’.
	(str2expmode): New func.
	(recognize_keyword): Update call to ‘pool_lookup’.
	* rcssyn.c (getadmin): Update call to ‘recognize_kwsub’.
	* base.h (recognize_kwsub): Update func decl.
	(str2expmode): Convert from macro to func decl.

2010-04-21  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Prune now-obsolete ‘struct buf’.

	* base.h (buf): Delete struct.

2010-04-21  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Replace ‘Ofclose’ with ‘Ozclose’ or plain ‘fclose’.

	* co.c (main): Use ‘Ozclose’.
	* merger.c (merge): Likewise.
	* rcs.c (buildeltatext): Likewise.
	* rcsclean.c (main): Use ‘fclose’.
	* rcslex.c (Ofclose): Incorporate into ‘Ozclose’.
	* rcsmerge.c (main): Use ‘fclose’.
	* rlog.c (main): Use ‘Ozclose’.
	* base.h (Ofclose): Delete func decl.

2010-04-21  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Factor func-finish code.

	* rcsgen.c (buildrevision): Move common finish to end of func.

2010-04-21  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Prune some now-obsoleted macros/funcs.

	* base.h (bufautobegin): Delete macro.
	(bufalloc, bufautoend, fbuf_save): Delete func decls.
	* rcsfnms.c (bufalloc, bufautoend): Delete funcs.
	* rcsutil.c (fbuf_save): Delete func.

2010-04-21  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘SHARED’ more.

	* b-kwxout.c (keyreplace): Save $Log leader temporarily in ‘SHARED’.
	* ci.c (getlogmsg): For -k, save log message in ‘SHARED’.
	* rcsdiff.c [DIFF_L] (setup_label): Don't take
	‘struct buf *’; construct label in ‘SHARED’.
	(main) [DIFF_L]: Update calls to ‘setup_label’.

2010-04-21  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Prune some now-obsoleted funcs.

	* base.h (bufenlarge, bufscat, bufscpy): Delete func decls.
	* rcsfnms.c (bufrealloc, bufenlarge, bufscat, bufscpy): Delete funcs.

2010-04-21  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Replace ‘expandsym’ with ‘fully_numeric_no_k’.

	* base.h (expandsym): Delete func decl.
	(fully_numeric_no_k): New macro.
	* co.c (addjoin, main): Use ‘fully_numeric_no_k’.
	* rcs.c (numrev): Change var type to ‘struct cbuf’.
	(removerevs, doassoc, setlock, dolocks, domessages)
	(rcs_setstate, main): Use ‘fully_numeric_no_k’.
	* rcsrev.c (expandsym): Delete func.
	* rlog.c (getnumericrev): Use ‘fully_numeric_no_k’.
	* yarrrr.c [TEST_REV] (yarrrr): Likewise.

2010-04-21  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘BRANCHNO’, not ‘getbranchno’; zonk the latter.

	* rcsrev.c (take): If ‘count’ is zero, take it
	to be the number of fields right for a branch number.
	(getbranchno): Delete func.
	* base.h (getbranchno): Delete func decl.
	(BRANCHNO): New macro.
	* ci.c (addbranch): Use ‘BRANCHNO’.
	* rcs.c (removerevs): Likewise.
	* rlog.c (putadelta): Likewise.

2010-04-21  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘TAKE’, not ‘partialno’; zonk the latter.

	* base.h (take): New func decl.
	(partialno): Delete func decl.
	(TAKE): Move macro to here...
	* rcsrev.c (TAKE): ... from here.
	(take): Make non-static.
	(partialno): Delete func.
	* co.c (getancestor): Use ‘TAKE’.
	* rlog.c (getnumericrev): Likewise.

2010-04-21  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: take

	* rcsrev.c (take): New static func.
	(TAKE): New macro.
	(getbranchno, absent, partialno, genbranch, genrevs): Use ‘TAKE’.

2010-04-21  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ‘fully_numeric’, not ‘fexpandsym’; zonk the latter.

	* ci.c: #include "b-divvy.h".
	(newdelnum): Change type to ‘struct cbuf’.
	(ACCB, ACCS, OK, JAM, ADD): New macros.
	(incnum): Take ‘struct cbuf *’; accumulate into ‘SHARED’.
	(addbranch): Likewise.
	(addelta): Accumulate into ‘SHARED’; pass new string to ‘cmpnum’.
	(main): Use ‘fully_numeric’.
	* rcsclean.c (main): Use ‘fully_numeric’.
	* rcsdiff.c (main): Likewise.
	* rcsmerge.c: #include "b-divvy.h".
	(main): Use ‘fully_numeric’.
	* rcsrev.c (fexpandsym): Delete func.
	(expandsym): Use ‘fully_numeric’.
	* base.h (fexpandsym): Delete func decl.

2010-04-21  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: fully_numeric

	* base.h (fully_numeric): New func decl.
	* rcsrev.c (split, accumulate_branchno, rev_from_symbol):
	New static funcs.
	(fully_numeric): New func.
	(fexpandsym): Use ‘fully_numeric’.
	(expandsym): Move after ‘fexpandsym’; nfc.

2010-04-20  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move conditionally-compiled test programs to yarrrr.c.

	* yarrrr.c: New file.
	* Makefile.am (EXTRA_DIST): Add yarrrr.c.
	(YALL, YPROGS): New vars.
	(y-STR2TIME, y-FCMP, y-PAIRS, y-KEEP, y-LEX, y-REV, y-SYN)
	(y-all, y-clean): New targets.
	* base.h: Comment munging; nfc.
	* maketime.c [TEST]: Delete #ifdef .. #endif block.
	* rcsfcmp.c [FCMPTEST]: Likewise.
	* rcsfnms.c [PAIRTEST]: Likewise.
	* rcskeep.c [KEEPTEST]: Likewise.
	* rcslex.c [LEXDB]: Likewise.
	* rcsrev.c [REVTEST]: Likewise.
	* rcssyn.c [SYNTEST]: Likewise.

2010-04-19  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: minus_p

	* base.h (minus_p): New func decl.
	* rcsutil.c (minus_p): New func.
	* rcsdiff.c (main): Use ‘minus_p’.
	* rcsmerge.c (main): Likewise.

2010-04-19  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] For ‘co -j’, save merge(1)-command args in ‘SINGLE’.

	* co.c (buildjoin): Save arg strings in ‘SINGLE’.

2010-04-19  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Encapsulate ‘pairnames’ probe protocol state entirely.

	* base.h (maybe): New struct.
	(open_rcsfile_fn): Rename from ‘open_rcsfile_fn_t’; rewrite arglist.
	(rcswriteopen, rcsreadopen, pairnames): Update func decls.
	* rcsedit.c (naturalize): Take ‘struct maybe *’; use its space
	intead of a local one; don't save new filename in ‘SINGLE’.
	(rcswriteopen): Take ‘struct maybe *’; update call to ‘naturalize’;
	save not-yet-validated filenames in ‘m->space’; don't save to
	‘SINGLE’ until after validation; pass ‘m->status’ to ‘fro_open’.
	* rcsfnms.c (rcsreadopen): Take ‘struct maybe *’.
	(maybe): Delete struct.
	(finopen): Update call to ‘m->open’; update ‘m->bestfit’ assignment.
	(fin2open): Build the strings in ‘m->space’; point ‘m->tentative’.
	(pairnames): Update type name of ‘rcsopen’ in arglist; set
	‘maybe.status’; make a space for ‘maybe.space’; update ‘maybe.bestfit’
	init; update call to ‘rcsopen’; close space before returning.

2010-04-19  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: bad_option

	* base.h (bad_option): New func decl.
	* rcsutil.c (bad_option): New func.
	* ci.c (main): Use ‘bad_option’.
	* co.c (main): Likewise.
	* merge.c (badoption): Delete func.
	(main): Use ‘bad_option’.
	* rcs.c (main): Likewise.
	* rcsclean.c (main): Likewise.
	* rcsdiff.c (main): Likewise.
	* rcsfnms.c [PAIRTEST] (main): Likewise.
	* rcsmerge.c (main): Likewise.
	* rlog.c (main): Likewise.

2010-04-19  Thien-Thi Nguyen  <ttn@gnuvola.org>

	rcsclean: On unknown option, don't display usage info.

	* rcsclean.c (main): Don't display usage info.

2010-04-19  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Don't say "path" when referring to file names.

	Files whose only changes were to comments are omitted.
	* base.h (ABSFNAME): Rename from ‘ROOTPATH’.
	(SIZEABLE_FILENAME_LEN): Rename from ‘SIZEABLE_PATH’.
	* rcs.c (main): Say "filename" in error message.
	* rcsedit.c (naturalize): Use ‘SIZEABLE_FILENAME_LEN’, ‘ABSFNAME’.
	(rcswriteopen): Rename local var; say "filename" in error messages.
	* rcsfnms.c (rcsreadopen): Rename arg; nfc.
	(getfullRCSname): Use ‘ABSFNAME’.
	[!HAVE_GETCWD] (getcwd): Rename arg; nfc.
	[PAIRTEST] (main): Say "filename" in diagnostic.

2010-04-19  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move cached cwd to ‘struct behavior’.

	* base.h (behavior): Add member ‘cwd’; delete member ‘fnstuff’.
	(init_fnstuff): Delete func decl.
	* rcsfnms.c (fnstuff): Delete struct.
	(FN): Delete macro.
	(init_fnstuff): Delete func.
	(getfullRCSname): Use ‘BE (cwd)’ instead of ‘FN (cwd)’.
	* rcsutil.c (gnurcs_init): Don't init fnstuff.

2010-04-19  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Trim some unused #include directives.

	* rcsfnms.c: Don't #include <stdint.h>,
	<sys/time.h>, <fcntl.h>, <sys/wait.h>.

2010-04-19  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Revert forced-‘if’ introduced 2010-04-12.

	* rcsfnms.c (getfullRCSname): Revert ‘if (!0)’.

2010-04-19  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Encapsulate parameters for ‘pairnames’ subroutines.

	* rcsfnms.c (fnstuff): Delete members ‘RCSb’, ‘RCSbuf’, ‘RCSerrno’.
	(maybe): New struct.
	(finopen): Take a ‘struct maybe *’; extract ‘filename’, ‘open’ and
	‘mustread’ from it; if succesful, modify its ‘bestfit’ and ‘eno’.
	(fin2open): Use '\0' instead of naked 0; take a ‘struct maybe *’;
	init its member ‘filename’; pass it to ‘finopen’.
	(pairnames): Construct a ‘struct maybe’ to pass to ‘fin2open’;
	if filename found, save its ‘bestfit’ to ‘REPO (filename)’.

2010-04-18  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use ‘open_rcsfile_fn_t’ more.

	* rcsfnms.c (finopen, fin2open):
	Use ‘open_rcsfile_fn_t’ in arglist.

2010-04-18  Thien-Thi Nguyen  <ttn@gnuvola.org>

	merge: On bad or incorrect # of options, don't display usage info.

	* merge.c (usage): Delete var.
	(badoption, main): Don't display usage info.

2010-04-18  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move temporary filename funcs to b-feph.[hc].

	* b-feph.h: New file.
	* b-feph.c: New file.
	* Makefile.am (libparts_a_SOURCES): Add b-feph.h, b-feph.c.
	* base.h (maker): New enum.
	(sff): New struct.
	(behavior): Add members ‘sff’, ‘ephemstuff’.
	(makedirtemp, dirtempunlink, keepdirtemp, set_temporary_file_name)
	(maketemp, tempunlink): Delete func decls.
	(SFFI_LOCKDIR, SFFI_NEWDIR): New #define:s.

	Here,
	"I" means "#include "b-feph.h"";
	"B" means "Call ‘makedirtemp’ with boolean value".
	* ci.c: I.
	(xpandfile): B.
	* co.c: I.
	(main): B.
	* merge.c: I.
	* merger.c: I.
	* rcs.c: I.
	* rcsclean.c: I.
	* rcsdiff.c: I.
	* rcsedit.c: #include "b-feph.h".
	(maker): Delete enum.
	(sff): Delete struct.
	(SFFI_LOCKDIR, SFFI_NEWDIR, SFF_COUNT): Delete #define:s.
	(editstuff): Convert member ‘sff’ type from array to pointer.
	(lockname, newRCSname): Use ‘BE (sff)’.
	(rcswriteopen): Likewise.  Also, modify ‘BE (sff)’ directly.
	(keepdirtemp, makedirtemp, dirtempunlink): Delete funcs.
	* rcsfnms.c: #include "b-feph.h".
	(TEMPNAMES): Delete #define.
	(fnstuff): Delete members ‘tpnames’, ‘tmpdir’.
	[!HAVE_MKSTEMP] (homegrown_mkstemp): Delete func.
	[!HAVE_MKSTEMP] (mkstemp): Delete #define.
	(set_temporary_file_name, maketemp, tempunlink): Delete funcs.
	* rcsgen.c [BAD_CREAT0] (putadmin): B.
	* rcsmerge.c: I.
	* rcsutil.c: I.
	(gnurcs_init): Init ‘BE (ephemstuff)’.

2010-04-18  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] When constructing the lockfile name, save directly to ‘SHARED’.

	* rcsedit.c (rcswriteopen): Use ‘SHARED’
	for lockfile name mangling instead of ‘struct buf’.

2010-04-18  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Make ‘bufrealloc’ static.

	* rcsfnms.c (bufrealloc): Make static.
	* base.h (bufrealloc): Delete func decl.

2010-04-18  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] When reading from stdin, save directly to ‘SHARED’.

	* rcsgen.c (getsstdin): Don't take ‘struct buf *’; save
	directly to ‘SHARED’; rewrite sole-dot-on-line detection/handling.
	(putdesc): Update call to ‘getsstdin’.
	* ci.c (getlogmsg): Update call to ‘getlogmsg’.
	* base.h (getsstdin): Update func decl.

2010-04-17  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: accumulate_range

	* b-divvy.h (accumulate_range): New func decl.
	* b-divvy.c (accumulate_range): New func.
	* rcsedit.c (naturalize): Use ‘accumulate_range’.
	* rcslex.c (getphrases): Likewise.

2010-04-17  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use ‘fseeko’ more.

	* rcslex.c (Orewind): Use ‘fseeko’ instead of ‘fseek’.

2010-04-17  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use ‘ftello’ more.

	* ci.c (main): Use ‘ftello’ instead of ‘ftell’.

2010-04-17  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Overhaul read-only file handling.

	* b-fro.h: New file.
	* b-fro.c: New file.
	* Makefile.am (libparts_a_SOURCES): Add b-fro.h, b-fro.c.
	* b-fb.h (Ieof): Delete func decl.
	* b-fb.c (Ieof): Delete func.
	* base.h [HAVE_SYS_MMAN_H]: Don't #include <sys/mman.h>.
	(large_memory, maps_memory): Delete #define:s.
	(RILE): Delete typedef.
	(declarecache, setupcache, cache, uncache, Igeteof, cachegeteof, Iget)
	(cacheget, cacheunget, Ifileno, Ioffset_type, Irewind, Itell, GETC):
	Delete macros.
	(Igetmore): Delete func decl.
	(open_rcsfile_fn_t): Update typedef.
	(parse_state): Delete member ‘rilebuf’.
	(flow): Update type of member ‘from’.
	(rcswriteopen, rcsfcmp, rcsreadopen, putdftext, getoldkeys):
	Update return value and parameter types and in func decls.
	(Ifclose, Izclose, hey_trundling, I_open, Iopen, testIeof)
	(Irewind): Delete func decls.
	(fexpandsym, getdiffcmd): Update parameter types and in func decls.
	(fastcopy): Delete func decl.
	(TEECHAR): New macro.

	Here,
	"I" means "#include "b-fro.h"";
	"U" means "Use ‘struct fro *’ instead of ‘RILE *’; remove caching;
	           use interface provided by b-fro.h and/or ‘TEECHAR’";
	"M" means "Merge ‘large_memory’/‘!large_memory’";
	"R" means "Rework to operate based on ‘STDIO_P (...)’ at runtime".
	* b-kwxout.c: I.
	(keyreplace, expandline): U.
	* b-kwxout.h (expctx): Update type of member ‘from’.
	* ci.c: I.
	(workptr): Update type of static var.
	(cleanup, fixwork, xpandfile): U.
	(main): U; rework input snapshot, flushing, rewind
	based on ‘STDIO_P (workptr)’ at runtime.
	* co.c: I.
	(cleanup): U; rework ‘FLOW (res)’ closing
	based on ‘STDIO_P (FLOW (from))’ at runtime.
	(main): U.
	* merger.c: I.
	(merge): U.
	* rcs.c: I.
	(cleanup, main): U.
	* rcsclean.c: I.
	(workptr): Update type of static var.
	(cleanup, main): U.
	* rcsdiff.c: I.
	(workptr): Update type of static var.
	(cleanup, main): U.
	* rcsedit.c: I; remove all cpp cond directives for ‘large_memory’,
	‘maps_memory’, ‘MMAP_SIGNAL’; disambiguate bifurcated funcs by
	renaming with _fast and _slow suffixes; generally, R.
	(editstuff): Include unconditionally members
	‘fedit’, ‘line’, ‘gap’, ‘gapsize’, ‘lim’.
	(movelines): Define macro unconditionally.
	(snapshotedit_fast): U; rename from ‘snapshotedit’ in ‘large_memory’.
	(snapshotedit_slow): U; rename from ‘snapshotedit’ in ‘!large_memory’.
	(finishedit_fast): U; rename from ‘finishedit’ in ‘large_memory’.
	(finishedit_slow): U; rename from ‘finishedit’ in ‘!large_memory’.
	(fopen_update_truncate): U; M; R.
	(swapeditfiles): U; on ‘EDIT (fedit)’ jam, specify ‘RM_STDIO’.
	(copylines): U; M; R.
	(enterstring): U; R.
	(UNUSED_IF_LARGE_MEMORY): Delete macro.
	(editstuff): U; R.
	(rcswriteopen, donerewrite): U.
	* rcsfcmp.c: I.
	(discardkeyval): U.
	(rcsfcmp): U, R.
	[FCMPTEST] (main): U.
	* rcsfnms.c: I.
	(rcsreadopen, finopen, fin2open): U.
	[PAIRTEST] (main): U.
	* rcsgen.c: I.
	(putdtext, putdftext): U.
	* rcskeep.c: I.
	(get0val, keepid, getval, keepdate, keeprev, getoldkeys): U.
	* rcslex.c: I.
	(Lexinit, nextlex, eoflex, getphrases)
	(readstring, printstring, savestring): U.
	(Iclose, mmap_deallocate, read_deallocate, nothing_to_deallocate)
	(hey_trundling, fd2_RILE, fd2RILE, Igetmore, I_open, Iopen, Ifclose)
	(Izclose, testIeof, Irewind): Delete macros/funcs.
	[LEXDB] (main): U.
	* rcsmerge.c: I.
	(main): U.
	* rcsrev.c (fexpandsym): U.
	[REVTEST] (main): U.
	* rcssyn.c: I.
	(getdiffcmd): U.
	[SYNTEST] (main): U.
	* rcsutil.c (fastcopy): Delete func.
	* rlog.c: I.
	(cleanup, getscript): U.

2010-04-17  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move some basic file operation funcs to b-fb.[hc].

	* b-fb.h: New file.
	* b-fb.c: New file.
	* Makefile.am (libparts_a_SOURCES): Add b-fb.h, b-fb.c.
	* b-kwxout.c: #include "b-fb.h".
	* base.h (behavior): Move member ‘Oerrloop’ to here ...
	(parse_state): ... from here.
	(Ieof, Ierror, testIerror, Oerror, testOerror)
	(fopenSafer, fdSafer): Delete func decls.
	* ci.c: #include "b-fb.h".
	(xpandfile): Use ‘fopen_safer’.
	* co.c: #include "b-fb.h".
	(main): Use ‘fopen_safer’.
	* merger.c: #include "b-fb.h".
	(merge): Use ‘fopen_safer’.
	* rcs.c: #include "b-fb.h".
	(sendmail, buildeltatext): Use ‘fopen_safer’.
	* rcsedit.c: #include "unistd-safer.h", "b-fb.h".
	[large_memory] (fopen_update_truncate): Use ‘fopen_safer’.
	(rcswriteopen): Use ‘fd_safer’.
	* rcsgen.c: #include "b-fb.h".
	(putdesc, putadmin): Use ‘fopen_safer’.
	* rcslex.c: #include "unistd-safer.h", "b-fb.h".
	(Lexinit): Update ‘Oerrloop’ init.
	(Iopen): Use ‘fd_safer’.
	(Ieof, Ierror, testIerror, Oerror, testOerror): Delete funcs.
	(Ifclose): Update ‘Oerrloop’ ref.
	* rcssyn.c: #include "b-fb.h".
	* rcsutil.c: #include "b-fb.h".
	(dupSafer, fdSafer, fopenSafer): Delete funcs.
	* rlog.c: #include "b-fb.h".

2010-04-16  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Always stash ignored phrases, regardless of ‘large_memory’.

	* rcslex.c (warnignore): Always make space.
	(getphrases): Always accumulate into ‘LEX (ignore)’.
	(Lexinit): Clear ‘LEX (ignore)’ if set.

2010-04-14  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: Specify proper expansion context in `finishedit'.

	A translation error was introduced 2010-03-27 by:
	"Move "expansion + output" to b-kwxout.[hc]; use exp context".
	* rcsedit.c (finishedit): Specify `delimstuffed' to
	be false in the expansion context passed to `expandline'.

2010-04-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Use gnulib module `readlink'.

	* rcsedit.c (naturalize) [!HAVE_READLINK]: Delete this portion.

2010-04-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use a space to stash ignored phrases.

	* base.h (parse_state): Delete member `ignoredp'; add `ignore'.
	* rcslex.c (warnignore): Initialize space
	for ignored phrases, if not `large_memory'.
	(Lexinit): If there is space for ignored phrases, clear it.
	(getphrases): Save ignored phrases in `LEX (ignore)'; rename
	local macro from `savech_' to `SAVECH'; make it a statement;
	update its callers finish with a semicolon; #undef it at eofunc.

2010-04-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use a space for symlink-resolution scratch.

	* rcsedit.c (naturalize): Rename from `resolve_symlink';
	define unconditionally; bifurcate internals for the case of
	!HAVE_READLINK; take out-arg `symbolicp'; set to indicate
	symlink resolution occurred; use space for local allocation.
	(rcswriteopen): Use `naturalize';
	do failed-symlink-check unconditionally.

2010-04-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use a space for `expandline' scratch.

	* base.h (manifestation): Remove member `keyval'; add `lparts'.
	* b-kwxout.c: #include "b-divvy.h".
	(LPARTS): New #define.
	(ENSURE_LPARTS): New macro.
	(expandline): Create and use space `LPARTS' for scanning scratch.

2010-04-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use spaces for "ci -k" support.

	* rcskeep.c (sorry): New static func.
	(badly_terminated): Use `sorry'; also, take `savep', if set,
	finish and then brush off the partially constructed string.
	(get0val): Save directly to `SINGLE'; return `char *';
	don't take `struct buf *'; instead take `bool savep'.
	(keepid): Return `char *'; don't take `struct buf *'.
	(getval): Return `char *'; don't take `struct buf *';
	instead take `bool savep'.
	(keepdate): Use `SHARED' temporarily for date and time strings.
	(checknum): Incorporate into unique caller.
	(keeprev): Return `char *'; set `PREV (rev)' directly.
	(getoldkeys): Don't keep local `struct buf' objects;
	use strings saved in `SINGLE' and `PREV (foo)' directly.

2010-04-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Re{name,base} abstraction from `ftalloc' to `FALLOC'.

	* b-divvy.h (FALLOC): New macro.
	* rcs.c: #include "b-divvy.h".
	(doaccess): Use `FALLOC'.
	* rcsedit.c (addlock, addsymbol): Likewise.
	* rcslex.c (lookup): Likewise.
	* rcsrev.c: #include "b-divvy.h".
	(store1): Use `FALLOC'.
	* rcssyn.c: #include "b-divvy.h".
	(getadmin, getdelta): Use `FALLOC'.
	* rcsutil.c (ftestalloc): Delete func.
	* rlog.c: #include "b-divvy.h".
	(getnumericrev): Use `FALLOC'.
	* base.h (ftestalloc): Delete func decl.
	(ftalloc): Delete macro.

2010-04-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use `obstack_free' more.

	* b-divvy.c (brush_off) [DEBUG]: Display info to stderr.
	(forget, close_space): Use `obstack_free' directly.

2010-04-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstractions: zlloc, ZLLOC

	* b-divvy.h (zlloc): New func decl.
	(ZLLOC): New macro.
	* b-divvy.c (zlloc): New func.
	* maketime.c: Don't #include <string.h>.
	(init_maketimestuff): Use `ZLLOC'.
	* rcsedit.c (ensure_editstuff): Likewise.
	* rcsfnms.c (init_fnstuff): Likewise.
	* rcslex.c (fd2_RILE): Likewise.
	* rcsutil.c (gnurcs_init): Likewise.

2010-04-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move filename state into `struct fnstuff'; use spaces more.

	* base.h (behavior): Add member `fnstuff'.
	(init_fnstuff): New func decl.
	* rcsfnms.c (fnstuff): New struct.
	(FN): New macro.
	(init_fnstuff): New func.
	(RCSbuf, RCSb, RCSerrno, tpnames): Delete vars.
	(set_temporary_file_name): Use `FN (tmpdir)'.
	(maketemp, tempunlink): Use `FN (tmpnames)'.
	(finopen, fin2open): Use `FN (RCSbuf)', `FN (RCSb)', `FN (RCSerrno)'.
	(pairnames): Use `SINGLE' space for `MANI (filename)' alloc;
	use `FN (RCSbuf)', `FN (RCSerrno)'.
	(getfullRCSname): Use `SHARED' for `getcwd' alloc;
	use `SINGLE' for expanded filename alloc.
	(getcwd): Remove spurious `static' for local var; add `const'.
	* rcsutil.c (gnurcs_init): call `init_fnstuff'.

2010-04-12  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move remaining maketime state into `struct maketimestuff'.

	* base.h (behavior): Add member `maketimestuff'.
	* maketime.c: #include <string.h>, "b-divvy.h".
	(maketimestuff): New struct.
	(MAKETIMESTUFF): New macro.
	(init_maketimestuff): New func.
	(time2tm): Use `MAKETIMESTUFF (TZ)'.
	(tm2time): Use `MAKETIMESTUFF (t_cache)', `MAKETIMESTUFF (tm_cache)'.
	* maketime.h (init_maketimestuff): New func decl.
	* rcsutil.c: #include "maketime.h".
	(gnurcs_init): Call `init_maketimestuff'.

2010-04-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move SIGCHLD-handler manual-reset state to `struct behavior'.

	* base.h (behavior): Add member `fixed_SIGCHLD'.
	* rcsutil.c (runv): Use `BE (fixed_SIGCHLD)' to
	record that the SIGCHLD handler was set to SIG_DFL.

2010-04-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move cached "now time" into `struct behavior'.

	* base.h (behavior): Add member `now'.
	* rcsutil.c (now): Cache now time in `BE (now)'.

2010-04-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use `SHARED' space for `system' command construction.

	* rcsutil.c [!HAVE_WORKING_FORK] (bufargcat): Delete func.
	[!HAVE_WORKING_FORK] (accumulate_arg_quoted): New static func.
	(runv) [!HAVE_WORKING_FORK]: Use `SHARED'
	space to construct string for `system' call.

2010-04-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move cached username into `struct behavior'.

	* base.h (behavior): Add member `username'.
	* rcsutil.c (getusername): Cache username in `BE (username)'.

2010-04-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move remaining edit state into `struct editstuff'.

	* base.h (behavior): Add member `editstuff'.
	* rcsedit.c: #include "b-divvy.h".
	(editstuff): New struct.
	(fedit, editname, editline, linecorr, sff)
	(line, gap, gapsize, linelim): Delete vars.
	(EDIT): New macro.
	(lockname, newRCSname): Update.
	(ensure_editstuff): New static func.
	(insertline, deletelines, snapshotedit, finishedit, swapeditfiles)
	(copylines, editstring, keepdirtemp, dirtempunlink):
	Use `EDIT (foo)' instead of deletes vars.
	(copystring, enterstring, rcswriteopen, makedirtemp): Likewise.
	Also, call `ensure_editstuff'.

2010-04-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstractions: SHARED, SINGLE

	* b-divvy.h (SHARED, SINGLE): New #define:s.
	* b-isr.c: Do s/shared/SHARED/g; do s/single/SINGLE/g.
	* co.c: Likewise.
	* merger.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsfnms.c: Likewise.
	* rcsgen.c: Likewise.
	* rcskeep.c: Likewise.
	* rcslex.c: Likewise.
	* rcsutil.c: Likewise.

2010-04-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Make `putdesc' reentrant.

	* rcsgen.c: #include "b-divvy.h".
	(putdesc): Take pointer to `struct cbuf', save description text
	there; route input from stdin and file to go into `shared' space.
	* base.h (putdesc): Update func decl.
	* ci.c (main): Update call to `putdesc'.
	* rcs.c (main): Likewise.

2010-04-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move remaining parse state into `struct parse_state'.

	* base.h (parse_state.next): Add member `hsh'.
	(parse_state): Add members `rilebuf', `Oerrloop', `ignoredp', `hshtab'.
	* rcslex.c (nexthsh, hshtab, ignored_phrases): Delete vars.
	(warnignore): Use `LEX (ignoredp)'.
	(lookup): Use `LEX (hshtab)', `NEXT (hsh)'.
	(Lexinit): Allocate `LEX (hshtab)' if necessary;
	clear `LEX (Oerrloop)'; use `LEX (ignoredp)'.
	(getnum): Use `NEXT (hsh)'.
	(fd2_RILE): Init `LEX (rilebuf)' if necessary.
	(Oerrloop): Delete var.
	(Oerror, oflush): Use `LEX (Oerrloop)'.
	[LEXDB] (main): Use `LEX (hshtab)'.

2010-04-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use a space for the token buffer.

	* base.h (manifestation): Add member `tokbuf'.
	* rcslex.c (tokbuf): Delete var.
	(lookup): Take `char *', not `struct buf *';
	save to `single' directly.
	(Lexinit): Init `LEX (tokbuf)' as a space.
	(nextlex): Accumulate bytes into `LEX (tokbuf)'; avoid realloc.

2010-04-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Do ISR allocation early on, for all programs.

	* rcsutil.c (gnurcs_init): Init `ISR_SCRATCH' here.
	* rcsedit.c (rcswriteopen): Don't init `ISR_SCRATCH'.
	* rcslex.c (fd2_RILE): Likewise.
	* b-isr.h (ISR_ENABLE): Delete unused macro.

2010-04-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Get rid of `bufremember'.

	* base.h (bufremember): Delete func decl.
	* rcsfnms.c (bufremember): Delete func.
	* rcslex.c (getphrases) [!large_memory]: Use `intern' directly.

2010-04-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Add to `single' space directly when keeping a date.

	* rcskeep.c: #include "b-divvy.h".
	(keepdate): Don't call `fbuf_save'; add directly to `single'.

2010-04-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Fix bug: Apply tmpdir `SLASH'-suffixing to all candidates.

	* rcsfnms.c (set_temporary_file_name): Use `getenv' directly;
	do `SLASH'-suffixing for any `tmpdir' found, not just `P_tmpdir'.

2010-04-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: accumulate_nonzero_bytes

	* b-divvy.h (accumulate_nonzero_bytes): New func decl.
	* b-divvy.c (accumulate_nonzero_bytes): New func.
	* merger.c (normalize_arg): Use `accumulate_nonzero_bytes'.
	* rcsdiff.c (main): Likewise.
	* rcsfnms.c (set_temporary_file_name): Likewise.

2010-04-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use `shared' space for temporary filename templating.

	* rcsfnms.c (set_temporary_file_name): Save `tmpdir' in `shared'.
	Also use `shared' temporarily for template string.

2010-04-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use `shared' space for filename arg normalization.

	* rcsdiff.c (main): Use `shared' space for prepending "./".

2010-04-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Get rid of `trealloc'.

	* rcsedit.c (insertline): Use `testrealloc' directly.
	* rcsfnms.c (bufrealloc): Likewise.
	* base.h (trealloc): Delete macro.

2010-04-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Get rid of `tnalloc'.

	* rcsedit.c (insertline): Use `testalloc' directly.
	* rcsfnms.c (bufalloc): Likewise.
	* rcslex.c (fd2_RILE): Likewise.
	* base.h (talloc): Likewise.
	(tnalloc): Delete macro.

2010-04-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use `shared' space for rcsdiff `diffvstr' construction.

	* rcsdiff.c: #include "b-divvy.h".
	(main): Use `shared' space for `diffvstr' construction.

2010-04-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use `single' space for log message handling.

	* rcslex.c (savestring): Don't write to `target';
	use `single' space instead.
	* rcsgen.c (cleanlogmsg): Take first arg as `const'.
	(scandeltatext): Update calls to `savestring', `cleanlogmsg'.
	* rcs.c (scanlogtext): Likewise.
	* rcssyn.c (Commleader): Delete now-unused `struct buf'.
	(getadmin): Update calls to `savestring'.
	* rlog.c (readdeltalog): Likewise.
	* base.h (cleanlogmsg, savestring): Update func decls.
	(manifestation): Delete now-unused member `log'.

2010-04-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use `pointer_array' more.

	* rcsutil.c (getRCSINIT): Use `pointer_array'.

2010-04-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use spaces for `co -j' parsing.

	* co.c: #include "b-divvy.h".
	(joinlength): Delete var.
	(link, jstuff): New structs.
	(jstuff): New static `struct jstuff'.
	(jpush): New func.
	(addjoin): Use `jpush'.
	(preparejoin): Likewise.  Rework `joinlist' init.

2010-04-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use `shared' space for `merge' arg normalization.

	* merger.c: #include "b-divvy.h".
	(normalize_arg): Rewrite.
	(merge): Update call to `normalize_arg'; don't `tfree'.

2010-04-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use `single' space for file(pair)-related allocation.

	* base.h (fremember): Delete func decl.
	(ftalloc): Update.
	(ftnalloc): Delete macro.
	(ffree1): Delete func decl.
	(free_NEXT_str): New func decl.
	* rcsdiff.c (main): Use `ftestalloc'.
	* rcslex.c: #include "b-divvy.h".
	(getkeyopt): Use `free_NEXT_str'.
	(getphrases): Likewise.  Also, use `intern0'.
	* rcssyn.c: Use `free_NEXT_str'.
	* rcsutil.c (alloclist): Delete struct.
	(alloced): Delete pointer to `struct alloclist'.
	(fremember): Delete func.
	(ftestalloc): Use `alloc'.
	(ffree): Use `forget'.
	(ffree1): Delete func.
	(free_NEXT_str): New func.
	(str_save): Use `intern0', into `shared'.
	(fbuf_save): Use `intern0', into `single'.

2010-04-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Allocate `tempname' in `shared'.

	* rcsfnms.c: #include "b-divvy.h".
	(maketemp): Rewrite.

2010-04-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Allocate ISR scratch in `shared'.

	* b-isr.c: #include "b-divvy.h".
	(isr_init): Allocate "isr scratch" in `shared'.
	* b-isr.h (ISR_DISABLE): Don't `tfree' isr scratch.

2010-04-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use spaces for rcsclean `get_directory'.

	* rscclean.c: #include "b-divvy.h".
	(get_directory): Rewrite.

2010-04-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Consolidate top-level structs; dynamically allocate in `main'.

	* base.h (behavior): Delete var decl.
	(manifestation, parse_state, repository, flow): Likewise.
	(top): New struct.
	(top): New pointer to `struct top'.
	(BE, MANI, LEX, REPO, FLOW): Update.
	(gnurcs_init): New func decl.
	* b-complain.c (vcomplain): Don't flush if `top' is NULL.
	* rcsutil.c: #include "b-divvy.h".
	(gnurcs_init): New func.
	(behavior): Delete `struct behavior'.
	(flow): Delete `struct flow'.
	* rcsfnms.c (manifestation): Delete `struct manifestation'.
	(repository): Delete `struct repository'.
	* rcslex.c (parse_state): Delete `struct parse_state'.
	* ci.c (top): New pointer to `struct top'.
	(main): Don't call `unbuffer_standard_error';
	instead call `gnurcs_init'.
	* co.c: Likewise.
	* ident.c: Likewise.
	* merge.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsmerge.c: Likewise.
	* rlog.c: Likewise.

2010-04-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: make_space (et al)

	* b-divvy.h: New file.
	* b-divvy.c: New file.
	* Makefile.am (libparts_a_SOURCES): Add b-divvy.h, b-divvy.c.

2010-04-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[test] Test rlog with two (working) filenames.

	* alive.test: Add a simple test with two filenames.

2010-04-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use `fbuf_save' more.

	* rcsfnms.c (bufremember): Use `fbuf_save'.

2010-04-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[test] Test multi-line log messages.

	* alive.test: Make some log messages multi-line.

2010-04-06  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Ignore `getwd', `getabsname'.

	* base.h (needs_getabsname): Delete #define.
	* rcsfnms.c (getfullRCSname): Remove #if needs_getabsname block.
	Remove preproc cond block that falls back to `getwd'.
	[!HAVE_GETCWD] (getcwd): Simplify surrounding preproc cond.

2010-04-06  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Use gnulib module `same-inode'.

	Here, all .c files have implicit "#include "same-inode.h"".
	* base.h (same_file): Delete macro.
	* ci.c (main): Use `SAME_INODE'.
	* co.c (main): Likewise.
	* rcsclean.c (main): Likewise.
	* rcsedit.c (chnamemod): Likewise.
	* rcsfnms.c (getfullRCSname): Likewise.

2010-04-06  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Overhaul interrupt handling.

	Here, "I" means "#include "b-isr.h"";
	and "U" means "Use `IGNOREINTS', `RESTOREINTS'";
	and "E (foo)" means "Use `ISR_ENABLE', `ISR_DO (foo)'".
	* b-isr.h: New file.
	* b-isr.c: New file.
	* Makefile.am (libparts_a_SOURCES): Add b-isr.h, b-isr.c.
	* base.h (behavior): Add to this struct member `isr'.
	(catchints, ignoreints, restoreints): Delete func decls.
	[HAVE_MMAP && large_memory && has_NFS && MMAP_SIGNAL]
	(catchmmapints, readAccessFilenameBuffer): Likewise.
	[HAVE_MMAP && large_memory && !(has_NFS && MMAP_SIGNAL)]
	(catchmmapints): Delete macro.
	* ci.c: I.
	(main): U.
	* co.c: I.
	(main): U.
	* rcsedit.c: I.
	(rcswriteopen): U; E (CATCHINTS).
	(dorewrite, donerewrite): U.
	* rcsfnms.c (maketemp): Remove spurious isr-enabling.
	* rcslex.c: I.
	(fd2_RILE): E (CATCHMMAPINTS); use `access_page'.
	* rcsutil.c: I; don't #include <signal.h>, "sig2str.h".
	(heldsignal, holdlevel, unsupported_SA_SIGINFO, bufsiginfo)
	(heldsiginfo, accessName, regsigs, mmapsigs): Delete vars.
	(readAccessFilenameBuffer, complain_signal, catchsig, catchsigaction)
	(ignoreints, restoreints, check_sig, setup_catchsig, catchints)
	(catchmmapints): Delete funcs.

2010-04-05  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Fix bug: Don't #undef MMAP_SIGNAL.

	Regression introduced 2010-03-02,
	"Move mmap-related checks to configure.in".
	* base.h [!MMAP_SIGNAL]: Don't #undef MMAP_SIGNAL.

2010-04-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move some file/function-static state into `struct behavior'.

	* base.h (behavior): Add to this struct members
	`unbufferedp', `version_set', `stick_with_euid', `ruid',
	`euid', `ruid_cached', `euid_cached', `already_setuid'.
	* b-complain.c (unbufferedp): Delete var.
	(unbuffer_standard_error, vcomplain): Use `BE (unbufferedp)'.
	* rcsutil.c (setRCSversion): Delete func-static
	var `oldversion'; use `BE (version_set)' instead.
	(cacheid): Rewrite macro.
	(ruid, euid): Update call to `cacheid'.
	(set_uid_to): Delete func-static var `looping';
	use `BE (already_setuid)', instead.
	(stick_with_euid): Delete var.
	(nosetid, seteid, setrid): Use `BE (stick_with_euid)'.

2010-04-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Fix bug: Notice if the system does not support SA_SIGINFO correctly.

	* rcsutil.c (catchsigaction): Arrange to ignore siginfo_t info
	if `unsupported_SA_SIGINFO', not if `!unsupported_SA_SIGINFO'.

2010-04-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: PROGRAM

	* base.h (PROGRAM): New macro.
	* b-complain.c: Throughout, use `PROGRAM (foo)' instead of program.foo.
	* base.h: Likewise.
	* gnu-h-v.c: Likewise.
	* gnu-h-v.h: Likewise.
	* ident.c: Likewise.
	* merger.c: Likewise.
	* rcslex.c: Likewise.
	* rcsutil.c: Likewise.

2010-04-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use `strlen' less.

	* gnu-h-v.c (EXACTLY): Look for NUL at end
	of string instead of comparing its length.

2010-04-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Remove unused #define.

	* base.h (RCSTMPPREFIX): Delete #define.

2010-04-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: hey_trundling

	* base.h (hey_trundling): New func decl.
	(advise_access): Delete func decl / macro (two cppcond branches).
	(if_advise_access): Delete macro.
	* rcslex.c (hey_trundling): New func.
	(advise_access): Delete func and surrounding #if ... #endif.
	(fd2RILE): Use `hey_trundling'.
	* co.c (main): Likewise.
	* rcs.c (main): Likewise.
	* rcsclean.c (main): Likewise.
	* rcsedit.c (enterstring): Likewise.

2010-04-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Use gnulib module `sys_wait'.

	* base.h: Don't #include <sys/wait.h>.
	(WEXITSTATUS, WIFEXITED, WTERMSIG, WIFSIGNALED):
	Delete conditional #define:s.
	* rcsfnms.c: #include <sys/wait.h>.
	* rcsutil.c: Likewise.

2010-04-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Remove some now-obsolete conditional #define:s.

	* base.h (P_tmpdir, S_IRUSR, S_IWUSR, S_IRGRP, S_IWGRP)
	(S_IROTH, S_IWOTH, S_ISREG): Delete conditional #define:s.

2010-04-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Use gnulib module `fcntl'.

	Here, "U" means "Convert #ifdef F_DUPFD
	foo #else bar #endif block to expression foo".
	* base.h (open_can_creat): Delete #define.
	[!O_CREAT] (O_RDONLY, O_WRONLY, O_RDWR, O_CREAT, O_TRUNC): Likewise.
	[!O_EXCL] (O_EXCL): Likewise.
	* rcsedit.c (create): Define macro unconditionally.
	* rcsfnms.c: #include <fcntl.h> unconditionally.
	[!HAVE_GETCWD && !HAVE_GETWD] (getcwd): U.
	* rcslex.c: #include <fcntl.h> unconditionally.
	* rcsutil.c: Likewise.
	(dupSafer): U.
	[F_DUPFD] (dup): Delete macro redefinition.
	(movefd): U.
	(fdreopen): Take `open_can_creat' to be 1.
	(runv): U.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Ignore <siginfo.h>.

	* base.h: Don't #include <siginfo.h>.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Ignore unused <ucontext.h>.

	* base.h: Don't #include <ucontext.h>.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Move #include <pwd.h> to .c files.

	* base.h: Don't #include <pwd.h>.
	* rcsutil.c [HAVE_PWD_H]: #include <pwd.h>.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Move #include <fcntl.h> to .c files.

	* base.h: Don't #include <fcntl.h>.
	* rcsedit.c [HAVE_FCNTL_H]: #include <fcntl.h>.
	* rcslex.c: Likewise.
	* rcsutil.c: Likewise.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Use gnulib module `dirent'.

	* rcsclean.c: #include <dirent.h> unconditionally.
	(get_directory): Define func unconditionally.
	(main): Call `get_directory' unconditionally.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Presume <signal> provides SIG{HUP,INT,PIPE,QUIT,TERM,XCPU,XFSZ}.

	* rcsutil.c (regsigs): Remove #ifdef foo and #endif, for
	foo: SIGHUP, SIGINT, SIGPIPE, SIGQUIT, SIGTERM, SIGXCPU, SIGXFZ.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Presume <signal.h> provides `SA_SIGINFO'.

	* rcsutil.c: Throughout, take `defined SA_SIGINFO' to be 1.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Presume `siginfo_t' has member `si_errno'.

	* rcsutil.c (catchsigaction): Take `defined HAVE_SI_ERRNO' to be 1.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use gnulib module `sig2str'; push `psignal' cppcond down.

	* rcsutil.c: #include "sig2str.h".
	(complain_signal): New static func.
	[!HAVE_PSIGNAL] (psignal): Delete #define.
	[!HAVE_PSIGNAL] (my_psignal): Delete func.
	(catchsigaction, runv): Use `complain_signal'.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Also link against lib/libgnu.a.

	* Makefile.am (LDADD): Add options to link against ../lib/libgnu.a.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Use gnulib module `double-slash-root'.

	* rcsfnms.c (DOUBLE_SLASH_IS_DISTINCT_ROOT): If not #define:d,
	#define to 0.
	(dir_useful_len): Use `DOUBLE_SLASH_IS_DISTINCT_ROOT'.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move the config header (and template) from src/ to lib/.

	* base.h: Don't #include "auto-sussed.h";
	instead, #include "config.h".
	* Makefile.am (AM_CPPFLAGS): Delete var.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Remove now-obsolete support for !HAVE_SIGNAL_H.

	* base.h [!HAVE_SIGNAL_H] (catchints, ignoreints, restoreints):
	Delete macros, with surrounding cpp #if block.
	* rcsutil.c: Remove #if defined HAVE_SIGNAL_H, matching #endif.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Move #include <signal.h> to .c files.

	* base.h: Don't #include <signal.h>; remove surrounding
	cpp cond #ifdef HAVE_SIGNAL_H ... #endif block.
	* rcsutil.c: #include <signal.h>.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use GCC attributes individually.

	* b-complain.h (generic_fatal, fatl_syntax): Use attribute
	declarations `printf_string' and `exiting' directly.
	* base.h (printf_string_exiting): Delete macro.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Move #include <utime.h> to .c files.

	* base.h: Don't #include <utime.h>; remove surrounding
	cpp cond #ifdef HAVE_UTIME_H ... #endif block.
	* rcsedit.c [HAVE_UTIME_H]: #include <utime.h>.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Move #include <time.h> to .c files.

	* base.h: Don't #include <time.h>.
	* maketime.c: #include <time.h>.
	* partime.c: Likewise.
	* rcstime.c: Likewise.
	* rcsutil.c: Likewise.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Presume <unistd.h> provides STD{IN,OUT,ERR}_FILENO.

	* base.h (STDIN_FILENO, STDOUT_FILENO, STDERR_FILENO): Delete
	#define:s, and surrouding #ifndef STDIN_FILENO cpp cond block.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Presume <unistd.h> provides `getlogin' decl.

	* base.h (getlogin): Delete func decl.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Move #include <unistd.h> to .c files.

	* base.h: Don't #include <unistd.h>; remove surrounding
	cpp cond #ifdef HAVE_UNISTD_H ... #endif block.
	* ci.c: #include <unistd.h>.
	* rcsedit.c: Likewise.
	* rcsfnms.c: Likewise.
	* rcsgen.c: Likewise.
	* rcslex.c: Likewise.
	* rcsutil.c: Likewise.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Move #include <string.h> to .c files.

	* base.h: Don't #include <string.h>.
	* b-anchor.c: #include <string.h>.
	* b-kwxout.c: Likewise.
	* ci.c: Likewise.
	* co.c: Likewise.
	* merger.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsedit.c: Likewise.
	* rcsfcmp.c: Likewise.
	* rcsfnms.c: Likewise.
	* rcsgen.c: Likewise.
	* rcskeep.c: Likewise.
	* rcslex.c: Likewise.
	* rcsmerge.c: Likewise.
	* rcsrev.c: Likewise.
	* rcssyn.c: Likewise.
	* rcstime.c: Likewise.
	* rcsutil.c: Likewise.
	* rlog.c: Likewise.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Presume <errno.h> provides `ELOOP', `ENOTSUP'.

	* rcsedit.c (resolve_symlink) [!ELOOP]: Remove cpp cond block.
	* rcsutil.c (setup_catchsig): Assume `defined ENOTSUP' == 1.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Move #include <stdarg.h> to .c files.

	* base.h: Don't #include <stdarg.h>.
	* b-complain.c: #include <stdarg.h>.
	* rcsgen.c: Likewise.
	* rcslex.c: Likewise.
	* rcsutil.c: Likewise.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Incorporate `fvfprintf' into unique caller.

	* rcslex.c (fvfprintf): Incorporate into `aprintf'.
	* base.h (fvfprintf): Delete func decl.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Move #include <stdlib.h> to .c files.

	* base.h: Don't #include <stdlib.h>.
	* ci.c: #include <stdlib.h>.
	* co.c: Likewise.
	* ident.c: Likewise.
	* merger.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsfnms.c: Likewise.
	* rcslex.c: Likewise.
	* rcstime.c: Likewise.
	* rcsutil.c: Likewise.
	* rlog.c: Likewise.

2010-04-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Move #include <errno.h> to .c files.

	* base.h: Don't #include <errno.h>.
	* b-complain.c: #include <errno.h>.
	* ci.c: Likewise.
	* co.c: Likewise.
	* ident.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsedit.c: Likewise.
	* rcsfnms.c: Likewise.
	* rcsgen.c: Likewise.
	* rcskeep.c: Likewise.
	* rcslex.c: Likewise.
	* rcsutil.c: Likewise.

2010-04-02  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move GCC attribute configuration into base.h.

	* base.h (exiting, printf_string): Define these
	macros based solely on GCC version -- 2.7 or higher.
	(printf_string_exiting): Define macro unconditionally.

2010-04-01  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Use gnulib module `stdbool'.

	* Makefile.am (AM_CPPFLAGS): New var.

2010-04-01  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Use gnulib to define `RCS_UNUSED'.

	* base.h (RCS_UNUSED): Update.

2010-03-31  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Avoid some function-static vars.

	* rcsedit.c (setmtime): Make local var `amtime' non-static.
	* rcsfnms.c [!HAVE_MKSTEMP] (homegrown_mkstemp): Likewise for `xrep'.
	* rcsrev.c [REVTEST] (main): Likewise for `numricrevno'.
	Also, do `bufautobegin' and `bufautoend' for it.
	* rcslex.c (fd2_RILE): Delete static
	local var `nothing'; use `FROM (to)', instead.

2010-03-31  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move "temporary buf for key value" to `struct manifestation'.

	* base.h (manifestation): Add member `keyval'.
	* b-kwxout.c (expandline): Use `MANI (keyval)'.

2010-03-31  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move "`BE (interactive)' valid" into `struct behavior'.

	* base.h (behavior): Add member `interactive_valid'.
	* rcsgen.c (ttystdin): Use `BE (interactive_valid)'.

2010-03-30  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use `bool' more.

	* rcsutil.c (cacheid): Use boolean for valid bit.

2010-03-30  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move "-z handling state" into `struct behavior'.

	* base.h (behavior): Add member `zone_offset'.
	* rcstime.c (zone_offset, use_zone_offset): Delete vars.
	(str2date, zone_set, date2str): Use
	`BE (zone_offset.valid)', `BE (zone_offset.seconds)'.

2010-03-30  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use boolean to keep track of lexical error occurance.

	Here, "U" means "Throughout, use `LEX (erroneousp)'".
	* base.h (struct parse_state): Replace `nerr' with `erroneousp'.
	* b-complain.c (ERRONEOUS_X): New macro.
	(syserror, generic_error, generic_fatal): Use `ERRONEOUS_X'.
	* ci.c: U.
	* co.c: U.
	* merge.c: U.
	* rcs.c: U.
	* rcsclean.c: U.
	* rcsdiff.c: U.
	* rcsedit.c: U.
	* rcskeep.c: U.
	* rcslex.c: U.
	* rcsmerge.c: U.
	* rlog.c: U.

2010-03-30  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Abstract writes to stderr.

	Here, "I" means "#include "b-complain.h",
	"U" means "Throughout, use the funcs and macros from there".
	* b-complain.c (vcomplain, complain): New funcs.
	(COMPLAIN_PLUS_NEWLINE): New macro.
	(diagnose): New func.
	(whoami): New static func.
	(syserror, generic_warn, generic_error): New funcs.
	(die): New static func.
	(generic_fatal, fatal_syntax, fatal_sys): New funcs.
	* b-complain.h (vcomplain, complain, diagnose, syserror)
	(generic_warn, generic_error, generic_fatal, fatal_syntax)
	(fatal_sys): New func decls.
	(syserror_errno, PWARN, MWARN, RWARN)
	(PERR, MERR, RERR, PFATAL, RFATAL): New macros.
	* b-kwxout.c: I; U.
	* ci.c: U.
	* co.c: U.
	* ident.c: U.
	* maketime.c: U.
	* merge.c: U.
	* merger.c: I; U.
	* rcs.c: U.
	* rcsclean.c: U.
	* rcsdiff.c: U.
	* rcsedit.c: I; U.
	* rcsfcmp.c: I; U.
	* rcsfnms.c: I; U.
	* rcsgen.c: I; U.
	* rcskeep.c: I; U.
	* rcslex.c: I; U.
	(fatcleanup, startsay, fatsay, errsay, warnsay, eerror)
	(enerror, efaterror, enfaterror, error, rcserror)
	(workerror, fatserror, faterror, rcsfaterror, warn)
	(rcswarn, workwarn, diagnose): Delete funcs.
	* rcsmerge.c: U.
	* rcsrev.c: I; U.
	* rcssyn.c: I; U.
	* rcstime.c: I; U.
	* rcsutil.c: I; U.
	[HAVE_WORKING_FORK] (write_stderr): Delete func.
	(runv): If the child proc exited due to a signal,
	mention that it "got a fatal signal" before dying.
	* rlog.c: U.
	* base.h (efaterror, enfaterror, fatcleanup, faterror)
	(fatserror, rcsfaterror, diagnose, eerror, enerror, error)
	(rcserror, rcswarn, warn, workerror, workwarn): Delete func decls.

2010-03-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Unbuffer stderr at program start; don't fflush it, later.

	Here, "I" means "#include "b-complain.h"";
	and "U" means "(main) Use `unbuffer_standard_error'".
	* b-complain.h: New file.
	* b-complain.c: New file.
	* Makefile.am (libparts_a_SOURCES): Add b-complain.h, b-complain.c.
	* base.h (eflush): Delete func decl.
	* rcsgen.c (yesorno, getsstdin): Don't call `eflush'.
	* rcslex.c (eflush): Delete func.
	(enerror, error, rcserror, workerror, warn, rcswarn, workwarn)
	(diagnose): Don't call `eflush'.
	* rcsutil.c (runv): Likewise.
	* ci.c: I; U.
	* co.c: I; U.
	* ident.c: I; U.
	* merge.c: I; U.
	* rcs.c: I; U.
	(sendmail): Don't call `eflush'.
	* rcsclean.c: I; U.
	* rcsdiff.c: I; U.
	* rcsmerge.c: I; U.
	* rlog.c: I; U.

2010-03-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Drop workaround for SVR4 stdio bug.

	* rcsgen.c (putadmin): Don't bother using `putc'
	for first output operation; just use `printf' normally.
	* rlog.c (main): Likewise.

2010-03-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Tighten `homegrown_mkstemp'.

	* rcsfnms.c: #include <sys/time.h>.
	[!HAVE_MKSTEMP] (homegrown_mkstemp): Make static;
	use curly braces for string constant instead of parens.

2010-03-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move "expansion + output" to b-kwxout.[hc]; use exp context.

	* b-kwxout.h: New file.
	* b-kwxout.c: New file.
	* Makefile.am (libparts_a_SOURCES): Add b-kwxout.h, b-kwxout.c.
	* base.h (expandline): Delete func decl.
	* ci.c: #include "b-kwxout.h".
	(xpandfile): Update call to `expandline'.
	* rcsedit.c: #include "b-kwxout.h".
	(finisheditline, finishedit, copylines)
	(xpandstring, editstring): Update call to `expandline'.

2010-03-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use #define for `ciklog' et al.

	* base.h (ciklog): Convert from var decl to #define.
	(ciklog_len): New #define.
	(ciklogsize): Delete #define.
	* ci.c (getlogmsg): Use `ciklog_len'.
	* rcsedit.c (ciklog): Delete var.
	(keyreplace): Use `ciklog_len'.
	* rcsfcmp.c (rcsfcmp): Use `ciklog_len'.

2010-03-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use #define for RCS file keywords.

	* base.h (KS): New macro.
	(Kaccess): Convert from var decl to #define; use `KS'.
	(Kauthor, Kbranch, Kcomment, Kdate, Kdesc, Kexpand, Khead, Klocks)
	(Klog, Knext, Kstate, Kstrict, Ksymbols, Ktext): Likewise.
	* rcssyn.c (Kaccess): Delete var.
	(Kauthor, Kbranch, Kcomment, Kdate, Kdesc, Kexpand, Khead, Klocks)
	(Klog, Knext, Kstate, Kstrict, Ksymbols, Ktext): Likewise.
	(Kbranches): Rename from `K_branches'; convert from var to #define.
	[COMPAT2] (Ksuffix): Convert from var to #define.
	(getdelta): Use `Kbranches'.

2010-03-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move some constant data from rcsutil.c to b-anchor.c.

	* b-anchor.c (prog_diff, prog_diff3, diff_flags, equal_line):
	New, moved without change from...
	* rcsutil.c (prog_diff, prog_diff3, diff_flags, equal_line):
	...here.

2010-03-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Overhaul "keyword-substitution mode name" recognition.

	* b-anchor.c (kwsub_pool): New static `uint8_t' array.
	(recognize_kwsub, kwsub_string): New funcs.
	* base.h (recognize_kwsub): New func decl.
	(str2expmode): New macro.
	(kwsub_string): New func decl.
	(str2expmode): Delete func decl.
	* rcsgen.c (putadmin): Use `kwsub_string'.
	* rcssyn.c (expand_names): Delete data structure.
	(strn2expmode, str2expmode): Delete funcs.
	(getadmin): Use `recognize_kwsub'.
	* rlog.c (main): Use `kwsub_string'.

2010-03-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Overhaul (working file) keyword recognition.

	* b-anchor.c: New file.
	* Makefile.am (libparts_a_SOURCES):
	Add b-anchor.c; remove rcskeys.c.
	* base.h: #include <stdint.h>.
	(AUTHOR, DATE, HEADER, IDH, LOCKER, LOG, NAME, RCSFILE, REVISION)
	(SOURCE, STATE): Delete #define:s.
	(tinysym, pool_found): New structs.
	(markers): From this enum, remove `Nomatch'.
	(recognize_keyword): New func decl.
	(Keyword): Delete var decl.
	(trymatch): Delete func decl.
	* rcsedit.c (keyreplace): Take `struct pool_found *'
	for first arg instead of `enum markers'; use `marker->i'.
	(expandline): Use `recognize_keyword'.
	* rcsfcmp.c (rcsfcmp): Use `recognize_keyword', `match1.i'.
	* rcskeep.c (getoldkeys): Use `recognize_keyword'.
	* rcskeys.c: Delete file.

2010-03-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Rename rcsbase.h to base.h.

	* base.h: Rename from rcsbase.h.
	* Makefile.am (libparts_a_SOURCES): Update.
	* ci.c: Update #include.
	* co.c: Likewise.
	* gnu-h-v.c: Likewise.
	* ident.c: Likewise.
	* maketime.c: Likewise.
	* merge.c: Likewise.
	* merger.c: Likewise.
	* partime.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsedit.c: Likewise.
	* rcsfcmp.c: Likewise.
	* rcsfnms.c: Likewise.
	* rcsgen.c: Likewise.
	* rcskeep.c: Likewise.
	* rcskeys.c: Likewise.
	* rcslex.c: Likewise.
	* rcsmap.c: Likewise.
	* rcsmerge.c: Likewise.
	* rcsrev.c: Likewise.
	* rcssyn.c: Likewise.
	* rcstime.c: Likewise.
	* rcsutil.c: Likewise.
	* rlog.c: Likewise.

2010-03-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Remove spurious casts to void for function call.

	* rcs.c (main): Remove cast to void for `umask' call.
	* rcskeep.c (getoldkeys): Remove cast to void for `getval' call.

2010-03-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Dose data structures with `const'.

	* maketime.c (month_yday): Add `const' to var definition.
	* partime.c (month_names): Likewise.
	(weekday_names, zone_names, patterns): Likewise.
	* rcsfnms.c (rcsdir, comtable): Likewise.
	* rcssyn.c [COMPAT2] (Ksuffix): Likewise.
	(K_branches): Likewise.
	* rcsutil.c (regsigs, mmapsigs): Likewise.

2010-03-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Consolidate i/o streams into `struct flow'.

	Here, "U" means "Throughout, use `FLOW (foo)'
	instead of the old singular variable names".
	* rcsbase.h (flow): New struct.
	(flow): New `struct flow' decl.
	(FLOW): New macro.
	(fcopy, resultname, finptr, frewrite, foutptr): Delete var decls.
	* ci.c: U.
	* co.c: U.
	* rcs.c: U.
	* rcsclean.c: U.
	* rcsdiff.c: U.
	* rcsedit.c: U.
	(fcopy, resultname): Delete var.
	* rcsfnms.c: U.
	* rcsgen.c: U.
	* rcslex.c: U.
	(finptr, frewrite, foutptr): Delete vars.
	* rcsrev.c: U.
	* rcssyn.c: U.
	* rcsutil.c (flow): New `struct flow'.
	* rlog.c: U.

2010-03-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move "possible endings for RCS file" into `struct behavior'.

	Here, "U" means "Throughout, use `BE (pe)'".
	* rcsbase.h (suffixes): Delete var decl.
	(behavior): Add `pe' to this struct.
	* ci.c: U.
	* co.c: U.
	* rcs.c: U.
	* rcsclean.c: U.
	* rcsdiff.c: U.
	* rcsfnms.c: U.
	(suffixes): Delete var.
	* rcsmerge.c: U.
	* rlog.c: U.

2010-03-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move "temporary log buffer" into `struct manifestation'.

	Here, "U" means "Throughout, use `MANI (log)'".
	* rcsbase.h (curlogbuf): Delete var decl.
	(manifestation): Add `log' to this struct.
	* rcs.c: U.
	* rcsgen.c: U.
	(curlogbuf): Delete var.

2010-03-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Remove spurious `extern'.

	* rcsbase.h (isSLASH): Remove `extern' on func decl.

2010-03-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move "keyword subtitution mode" into `struct behavior'.

	Here, "U" means "Throughout, use `BE (kws)'".
	* rcsbase.h (Expand): Delete var decl.
	(behavior): Add `kws' to this struct.
	* ci.c: U.
	* co.c: U.
	* rcs.c: U.
	* rcsclean.c: U.
	* rcsdiff.c: U.
	* rcsedit.c: U.
	* rcsfcmp.c: U.
	* rcsfnms.c: U.
	* rcsgen.c: U.
	* rcsmerge.c: U.
	* rcssyn.c: U.
	(Expand): Delete var.
	* rlog.c: U.

2010-03-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move "effective RCS version" into `struct behavior'.

	Here, "U" means "Throughout, use `BE (version)'".
	* rcsbase.h (RCSversion): Delete var decl.
	(behavior): Add `version' to this struct.
	* rcs.c: U.
	* rcsedit.c: U.
	* rcsfcmp.c: U.
	* rcsgen.c: U.
	* rcstime.c: U.
	* rcsutil.c: U.
	(RCSversion): Delete var.
	* rlog.c: U.

2010-03-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use `MANI (filename)' and `MANI (standard_output)'.

	Here, "U" means "Throughout, use `MANI (filename)'
	and `MANI (standard_output)' instead of singular variable names.
	* rcsbase.h (workname, workstdout): Delete #define:s.
	* ci.c: U.
	* co.c: U.
	* rcs.c: U.
	* rcsclean.c: U.
	* rcsdiff.c: U.
	* rcsedit.c: U.
	* rcsfnms.c: U.
	* rcskeep.c: U.
	* rcslex.c: U.
	* rcsmerge.c: U.
	* rlog.c: U.

2010-03-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Consolidate RCS file state into `struct repository'.

	Here, "U" means "Throughout, use `REPO (foo)' and
	`ADMIN (foo)' instead of the old singular variable names".
	* rcsbase.h (repository): New struct.
	(repository): New `struct repository' decl.
	(REPO, ADMIN): New macros.
	(RCSname, fdlock, RCSstat, Dbranch, AccessList, Symbols, Comment)
	(Ignored, Locks, Head, TotalDeltas): Delete var decls.
	* ci.c: U.
	* co.c: U.
	* rcs.c: U.
	* rcsclean.c: U.
	* rcsdiff.c: U.
	* rcsedit.c: U.
	* rcsfcmp.c: U.
	* rcsfnms.c: U.
	(RCSname, fdlock, RCSstat): Delete vars.
	(repository): New `struct repository'.
	* rcsgen.c: U.
	* rcslex.c: U.
	* rcsmerge.c: U.
	* rcsrev.c: U.
	* rcssyn.c: U.
	(Comment, Ignored, AccessList, Symbols, Locks, Head)
	(Dbranch, TotalDeltas): Delete vars.
	* rlog.c: U.

2010-03-24  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Define `ruid', `myself' unconditionally.

	* rcsutil.c (ruid): Remove surrounding preproc conditional.
	(ruid) [!HAVE_GETUID]: Abort; programmer error.
	(myself): New func.
	* rcsbase.h (ruid): Declare func unconditionally.
	(myself): New func decl.

2010-03-24  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Push `#if has_NFS || BAD_UNLINK' for `un_link' out of header.

	* rcsedit.c (un_link): Restructure to use #define:s in code.
	* rcsbase.h (un_link): Remove surrounding preproc conditional,
	including sibling `#if ! (has_NFS || BAD_UNLINK)' block.

2010-03-24  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Push `#if large_memory' for `editstring' out of header.

	* rcsedit.c (UNUSED_IF_LARGE_MEMORY): New #define.
	(editstring): Use `UNUSED_IF_LARGE_MEMORY' for param `delta';
	remove preproc conditional surrounding func header.
	* rcsbase.h (editstring): Remove surrounding preproc
	conditional, including sibling block `#if large_memory'.

2010-03-24  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Add braces to disambiguate `else' clause.

	* rcsedit.c [!large_memory] (copylines):
	Add braces to disambiguate `else' clause.

2010-03-24  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Define type for `pairnames' "rcsopen" func.

	* rcsbase.h (open_rcsfile_fn_t): New typedef.
	(pairnames): Use `open_rcsfile_fn_t' in func decl.
	* rcsfnms.c (pairnames): Use `open_rcsfile_fn_t' in arglist.

2010-03-24  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Dose data structures with `const'.

	* rcsbase.h (ciklog, Keyword, ctab, expand_names, Kaccess)
	(Kauthor, Kbranch, Kcomment, Kdate, Kdesc, Kexpand, Khead)
	(Klocks, Klog, Knext, Kstate, Kstrict, Ksymbols, Ktext)
	(equal_line): Add `const' to var decls.
	* rcsedit.c (ciklog): Add `const' to var definition.
	* rcskeys.c (Keyword): Likewise.
	* rcsmap.c (ctab): Likewise.
	* rcssyn.c (Kaccess, Kauthor, Kbranch, Kcomment, Kdate)
	(Kdesc, Kexpand, Khead, Klocks, Klog, Knext, Kstate)
	(Kstrict, Ksymbols, Ktext, expand_names): Likewise.
	* rcsutil.c (equal_line): Likewise.

2010-03-24  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Consolidate parse state into `struct parse_state'.

	Here, "U" means "Throughout, use `LEX (foo)' and `NEXT (foo)'
        instead of the old singular variable names".
	* rcsbase.h (parse_state): New struct.
	(parse_state): New `struct parse_state' decl.
	(LEX, NEXT): New macros.
	(NextString, nexttok, nerror, nextc, rcsline): Delete var decls.
	* rcslex.c: U.
	(parse_state): New `struct parse_state'.
	(nexttok, nextc, rcsline, nerror, NextString): Delete vars.
	* ci.c: U.
	* co.c: U.
	* merge.c: U.
	* rcs.c: U.
	* rcsclean.c: U.
	* rcsdiff.c: U.
	* rcsedit.c: U.
	* rcsgen.c: U.
	* rcskeep.c: U.
	* rcsmerge.c: U.
	* rcssyn.c: U.
	* rlog.c: U.

2010-03-23  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Consolidate workfile state into `struct manifestation'.

	* rcsbase.h (manifestation): New struct.
	(manifestation): New `struct manifestation' decl.
	(MANI, workname, workstdout, PREV): New macros.
	(workname, workstdout, prevkeys, prevauthor, prevdate)
	(prevname, prevrev, prevstate): Delete var decls.
	* rcsfnms.c (workname, workstdout): Delete vars.
	(manifestation): New `struct manifestation'.
	(pairnames): Use `PREV (valid)'.
	* rcskeep.c (prevkeys): Delete var.
	(prevauthor, prevdate, prevname, prevrev, prevstate): Likewise.
	(keepdate): Set `PREV (date)' directly.
	(keeprev): Set `PREV (rev)' directly.
	(getoldkeys): Set `PREV (foo)' state; use `PREV (foo)' directly;
	add "consider empty string as not given" processing.
	(main): Use `PREV (rev)', `PREV (date)',
	`PREV (author)', `PREV (name)', `PREV (state)'.
	* rcsrev.c (fexpandsym): Use `PREV (rev)'.
	* ci.c (main): Use `PREV (rev)', `PREV (date)',
	`PREV (author)', `PREV (state)', `PREV (name)'.

2010-03-23  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: fbuf_save

	* rcsbase.h (fbuf_save): New func decl.
	(fstr_save): Delete func decl.
	* rcsutil.c (fbuf_save): New func.
	(fstr_save): Delete func.
	* rcs.c (doassoc): Use `fbuf_save'.
	* rlog.c (getnumericrev): Likewise.
	* rcslex.c (lookup): Don't take `char *'; instead, take
	`struct buf *'; use `fbuf_save'; update callers.
	(nextlex): Use `fbuf_save'.
	(getphrases): Use `strncpy' for saving `key'.

2010-03-22  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Fix cpp conditional regression introduced 2010-02-17.

	This happened as part of the change:
	"[build] Move `getcwd', `getwd' check to configure.in".
	* rcsfnms.c [!GETCWD && !GETWD] (getcwd): Change surrounding
	cpp conditional to this from nonsensical "!GETWD && !GETWD".

2010-03-22  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Make "make test-prep" more robust.

	* Makefile.am (test-prep): Explicitly
	delete $(bin_PROGRAMS) to force relink.

2010-03-20  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Consolidate some global booleans into `struct behavior'.

	Here, "BE" means "Use BE (foo) instead of separate var names".
	* rcsbase.h (behavior): New struct.
	(behavior): New `struct behavior' decl.
	(BE): New macro.
	(locker_expansion, interactiveflag, hshenter)
	(quietflag, StrictLocks): Delete var decls.
	* rcsutil.c (behavior): New `struct behavior'.
	(catchsigaction): Use `BE (quiet)'.
	* ci.c (removelock, addelta, main): BE.
	* co.c (rmworkfile, buildjoin, main): BE.
	* ident.c (scanfile, main): BE.
	* merge.c (main): BE.
	* rcs.c (buildtree, main): BE.
	* rcsclean.c (main): BE.
	* rcsdiff.c (main): BE.
	* rcsedit.c (locker_expansion): Delete var.
	(keyreplace): BE.
	* rcsfnms.c (InitAdmin, main): BE.
	* rcsgen.c (interactiveflag): Delete var.
	(ttystdin, yesorno, putadmin): BE.
	* rcslex.c (hshenter, quietflag): Delete vars.
	(Lexinit, nextlex, warn, rcswarn, workwarn, diagnose): BE.
	[LEXDB] (main): BE.
	* rcsmerge.c (main): BE.
	* rcssyn.c (StrictLocks): Delete var.
	(getadmin, ignorephrases, getdelta): BE.
	* rlog.c (main): BE.

2010-03-19  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Use GNU Automake.

	* Makefile.am: New file.
	* ci.c: Do s/-help.c/.help/ for #include file.
	* co.c: Likewise.
	* ident.c: Likewise.
	* merge.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsmerge.c: Likewise.
	* rlog.c: Likewise.
	* Makefile.in: Delete file.

2010-03-18  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use DIFF_{SUCCESS,FAILURE,TROUBLE} directly.

	Using vars was a temporary measure while fleeing conf.h.

	Here, "U" means "Throughout, use `DIFF_SUCCESS',
	                 `DIFF_FAILURE', `DIFF_TROUBLE' directly".
	* rcsutil.c: U.
	(diff_success, diff_failure, diff_trouble): Delete vars.
	* rcsbase.h (diff_success, diff_failure, diff_trouble):
	Delete var decls.
	* ci.c: U.
	* co.c: U.
	* merge.c: U.
	* merger.c: U.
	* rcs.c: U.
	* rcsdiff.c: U.
	* rcsmerge.c: U.

2010-03-17  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Consolidate parallel rcsedit.c arrays into `struct sff'.

	* rcsedit.c (sff): New struct.
	(SFFI_LOCKDIR, SFFI_NEWDIR, SFF_COUNT): New #define:s.
	(sff): New static array of `struct sff'.
	(lockname, newRCSname): Use `sff'.
	(lockdirtp_index, newRCSdirtp_index, newworkdirtp_index)
	(DIRTEMPNAMES): Delete #define:s.
	(dirtpname, dirtpmaker): Delete data structures.
	(rcswriteopen): Use `sff', `SFFI_LOCKDIR'.
	(keepdirtemp): Use `sff', `SFF_COUNT'.
	(makedirtemp): Use `SFFI_NEWDIR', `sff'.
	(dirtempunlink): Use `SFF_COUNT', `sff'.

2010-03-17  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use `_Exit', which is C99.

	* ci.c (exiterr): Use `_Exit'.
	* co.c (exiterr): Likewise.
	* ident.c (exiterr): Likewise.
	* merge.c (exiterr): Likewise.
	* rcs.c (exiterr): Likewise.
	* rcsclean.c (exiterr): Likewise.
	* rcsdiff.c (exiterr): Likewise.
	* rcsfnms.c [!HAVE_GETWD] (getcwd): Likewise.
	(exiterr): Likewise.
	* rcslex.c [LEXDB] (exiterr): Likewise.
	* rcsmerge.c (exiterr): Likewise.
	* rcsrev.c [REVTEST] (exiterr): Likewise.
	* rcssyn.c [SYNTEST] (exiterr): Likewise.
	* rcsutil.c (write_stderr, runv): Likewise.
	* rlog.c (exiterr): Likewise.

2010-03-17  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Don't do "make distclean" on "make dist"!

	* Makefile.in (distdir, slow, headers)
	(infrastructure, EXTRA_DIST): New vars.
	(dist): New target.

2010-03-17  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Consolidate some program globals into `struct program'.

	Here, "USUAL" means "(cmdid): Delete var.
	                     (exiterr): Make static, declare `exiting'.
	                     (program): New struct instance.";
	and "PARTIAL foo" means "Like USUAL, but with only foo".
	* rcsbase.h (cmdid): Delete var decl.
	(exiterr): Delete func decl.
	(program): New struct.
	(program): New var decl.
	* ci.c: USUAL.
	* co.c: USUAL.
	* gnu-h-v.c (display_version): Use `program.name'.
	(check_hv): Likewise; also don't
	take `help'; use `program.help' instead.
	* gnu-h-v.h (check_hv): Update func decl.
	(CHECK_HV): Update call to `check_hv'.
	* ident.c: USUAL.
	(reportError, scanfile): Use `program.name'.
	* merge.c: USUAL.
	* merger.c (merge): Use `program.exiterr'.
	* rcs.c: USUAL.
	* rcsclean.c: USUAL.
	* rcsdiff.c: USUAL.
	* rcsfcmp.c [FCMPTEST]: PARTIAL cmdid, program.
	* rcsfnms.c [PAIRTEST]: USUAL.
	* rcskeep.c [KEEPTEST]: PARTIAL cmdid, program.
	* rcslex.c (Oerror): Use `program.exiterr'.
	(fatcleanup): Use `program.name', `program.exiterr'.
	(startsay, fatserror): Use `program.name'.
	[LEXDB]: USUAL.
	* rcsmerge.c: USUAL.
	* rcsrev.c [REVTEST]: USUAL.
	* rcssyn.c [SYNTEST]: USUAL.
	* rcsutil.c (catchsigaction): Use `program.exiterr'.
	* rlog.c: USUAL.

2010-03-17  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Avoid `strcpy'.

	* ci.c (incnum): Use `strncpy'.
	* rcsclean.c [HAVE_DIRENT_H] (get_directory): Likewise.
	* rcsdiff.c (main): Likewise.
	* rcsfnms.c (maketemp, bufscat, bufscpy, getfullRCSname): Likewise.
	* rcsutil.c (str_save, fstr_save): Likewise.
	* rlog.c (recentdate, getdatepair): Likewise.
	(KSTRCPY): New macro.
	(getnumericrev, main): Use `KSTRCPY'.

2010-03-16  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use `bool' (and `true' and `false') more.

	Here, "B: foo" means "Change type of foo from `int' to `bool'".
	* rcsbase.h: #include <stdbool.h>.
	(STRICT_LOCKING): Use `true'.
	[!maps_memory] (Igetmore): Update func decl.
	(merge): Update func decl.
	(locker_expansion): Update var decl.
	(rcswriteopen, makedirtemp, addlock, addsymbol, checkaccesslist)
	(dorewrite, expandline, findlock, finishedit, rcsreadopen, pairnames):
	Update func decl.
	(interactiveflag): Update var decl.
	(buildrevision, putdtext, ttystdin, yesorno, putdesc, putdftext):
	Update func decl.
	(prevkeys): Update var decl.
	(getoldkeys): Update func decl.
	(hshenter, quietflag): Update var decl.
	(fatcleanup, eoflex, getkeyopt, getlex, expandsym, fexpandsym):
	Update func decl.
	(StrictLocks): Update var decl.
	(getdiffcmd, getdesc, putstring, getusername, isSLASH): Update func decl.
	* ci.c: Don't #include <stdbool.h>.
	(struct Symrev): B: .override.
	(forceciflag, keepflag, keepworkingfile, rcsinitflag): B: var.
	(addbranch): B: param `removedlock'.
	(addsyms): B: rv.
	(xpandfile): B: param `dolog'.
	(addassoclst): B: param `flag'.
	(main): B: local vars `initflag', `mustread', `lockflag',
	`lockthis', `mtimeflag', `Ttimeflag', `dolog', `newhead',
	`usestatdate', `bad_truncate'.  Also, update interpretation
	of `ftruncate' rv to be `bool'-friendly.
	* co.c: Don't #include <stdbool.h>.
	(forceflag, mtimeflag): B: var.
	(rmworkfile, preparejoin, buildjoin): B: rv.
	(main): B: local vars `tostdout', `Ttimeflag'.
	* ident.c: Don't #include <stdbool.h>.
	* maketime.c (isleap): B: rv.
	(time2tm, tm2time): B: param `localzone'.
	(maketime): B: local var `localzone'.
	* maketime.h (time2tm, tm2time): Update func decls.
	* merge.c: Don't #include <stdbool.h>.
	(main): B: local var `tostdout'.
	* merger.c (merge): B: param `tostdout'.
	* rcs.c: Don't #include <stdbool.h>.
	(struct Symrev): B: .override.
	(chgheadstate, lockhead, unlockcaller, suppress_mail): B: var.
	(getassoclst): B: param `flag'.
	(scanlogtext): B: param `edit'.
	(doaccess): B: rv, local var `changed'.
	(sendmail): B: rv; also, remove spurious parens for `return' "arg".
	(breaklock, branchpoint): B: rv.
	(removerevs): B: rv; use `true', `false'.
	(doassoc): B: rv, local var `changed'.
	(setlock): B: rv; use `false'.
	(dolocks, domessage): B: rv, local var `changed'.
	(rcs_setstate, buildeltatext): B: rv.
	(main): B: local vars `branchflag', `initflag', `textflag',
	`strictlock', `strict_selected', `Ttimeflag', `keepRCStime';
	use `false'.
	* rcsclean.c: Don't #include <stdbool.h>.
	(unlock): B: rv.
	(main): B: local vars `dounlock', `perform', `unlocked', `unlockflag',
	`waslocked', `Ttimeflag'.
	* rcsdiff.c: Don't #include <stdbool.h>.
	(main): B: local var `no_diff_means_no_output'.
	* rcsedit.c: Don't #include <stdbool.h>.
	(locker_expansion): B: var.
	(finishedit): B: param `done'.
	(copystring): B: local var `amidline'.
	(enterstring): B: local vars `amidline', `oamidline'.
	(keyreplace): B: params `delimstuffed', `dolog';
	B: local var `kdelim_found'; use `false'.
	(expandline): B: params `delimstuffed', `dolog'; B: local var `e';
	remove local var `ds'; use `delimstuffed' directly; use `false', `true'.
	(rcswriteopen): B: param `mustread'; local var `waslocked'.
	(makedirtemp): B: param `isworkfile'.
	(findlock): B: param `delete'.
	(addlock): B: param `verbose'.
	(addsymbol): B: param `rebind'.
	(checkaccesslist): B: rv.
	(dorewrite): B: param `lockflag'.
	* rcsfcmp.c: Don't #include <stdbool.h>.
	(rcsfcmp): B: local vars `eqkeyvals', `xeof', `ueof'.
	* rcsfnms.c: Don't #include <stdbool.h>.
	(suffix_matches): B: rv.
	(rcsreadopen): B: param `mustread'.
	(finopen): B: params `rcsopen' 3rd arg, `mustread';
	B: local vars `interesting', `preferold'.
	(fin2open): B: params `rcsopen' 3rd arg, `mustread'.
	(pairnames):  B: params `rcsopen' 3rd arg, `mustread', `quiet';
	B: local var `paired'.
	(isSLASH): B: rv.
	[!HAVE_GETWD] (getcwd): B: local vars `readerror',
	`toolong'; use `true'.
	[PAIRTEST] (main): B: local var `initflag'.
	* rcsgen.c: Don't #include <stdbool.h>.
	(interactiveflag): B: var.
	(scandeltatext): B: param `needlog'.
	(buildrevision): B: param `expandflag'.
	(ttystdin): B: rv, local var `initialized'.
	(yesorno): B: rv.
	(putdesc): B: param `textflag'.
	(getsstdin): B: local var `tty'.
	(putdtext): B: rv, param `diffmt'.
	(putstring): B: params `delim', `log'.
	(putdftext): B: param `diffmt'.
	* rcskeep.c: Don't #include <stdbool.h>.
	(prevkeys): B: var.
	(badly_terminated): B: rv.
	(get0val): B: param `optional', local var `got1'.
	(keepid): B: rv.
	(getval): B: rv, param `optional'.
	(checknum, keeprev): B: rv.
	(getoldkeys): B: rv, local vars
	`needs_closing', `prevname_found'; use `true'.
	* rcslex.c: Don't #include <stdbool.h>.
	(hshenter, quietflag, ignored_phrases): B: vars.
	(eoflex, getlex): B: rv.
	(getkeyopt): B: rv; remove spurious parens around `return' "arg".
	(checkidentifier): B: param `dotok', local var `isid'.
	[!maps_memory && large_memory] (Igetmore): B: rv; use `true', `false'.
	(Oerrloop): B: var.
	(fatcleanup): B: param `already_newline'.
	* rcsmerge.c: Don't #include <stdbool.h>.
	(main): B: local var `tostdout'.
	* rcsrev.c: Don't #include <stdbool.h>.
	(expandsym): B: rv.
	(fexpandsym): B: rv, local var `id'.
	* rcssyn.c: Don't #include <stdbool.h>.
	(StrictLocks): B: var.
	(getkeyval): B: param `optional'.
	(getdelta): B: rv; remove spurious parens around `return' "arg".
	(getdesc): B: param `prdesc'.
	(getdiffcmd): B: param `delimiter'.
	* rcstime.c (use_zone_offset): B: var.
	(date2str): Use `false'.
	* rcsutil.c: Don't #include <stdbool.h>.
	(getusername): B: param `suspicious'.
	(unsupported_SA_SIGINFO): B: var.
	(setup_catchsig): Use `true'.
	(catchints): B: local var `catching_ints'.
	(catchmmapints): B: local var `catching_mmap_ints'.
	(runv) [BAD_WAIT_IF_SIGCHLD_IGNORED]: B: local var `fixed_SIGCHLD'.
	(setRCSversion): B: local var `oldversion'.
	(set_uid_to): B: local var `looping'
	(stick_with_euid): B: var.
	* rlog.c: Don't #include <stdbool.h>.
	(branchflag, lockflag): B: vars.
	(putadelta): B: param `trunk', local var `pre5'.
	(getdatepair): B: local var `switchflag', `eq'.
	(checkrevpair, getnumericrev): B: rv.
	(main): B: local var `descflag', `selectflag', `onlylockflag',
	`onlyRCSflag', `pre5', `shownames'.

2010-03-16  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use `quietflag' more.

	* ident.c (scanfile): Drop arg `quiet'; use `quietflag' instead.
	(main): If given -q, set `quietflag' directly.
	If given -V, return successfully after displaying version info.

2010-03-16  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use enum for keyword substitution mode.

	* rcsbase.h (kwsub): New enum.
	[O_BINARY] (FOPEN_R_WORK, FOPEN_W_WORK, FOPEN_WPLUS_WORK): Use enum.
	(KEYVAL_EXPAND, KEYVALLOCK_EXPAND, KEY_EXPAND, VAL_EXPAND)
	(OLD_EXPAND, BINARY_EXPAND): Delete #define:s.
	(MIN_UNEXPAND, MIN_UNCHANGED_EXPAND): Use enum.
	* ci.c (main) [OPEN_O_BINARY]: Use enum.
	(main): Likewise.
	* co.c (main) [OPEN_O_BINARY]: Likewise.
	(main): Likewise.
	* rcs.c (buildeltatext) [OPEN_O_BINARY]: Likewise.
	* rcsclean.c (main): Likewise.
	* rcsdiff.c (main): Likewise.
	(main) [OPEN_O_BINARY]: Likewise.
	* rcsedit.c (keyreplace): Likewise.
	* rcsfnms.c (InitAdmin): Likewise.
	* rcsgen.c (putadmin): Likewise.
	* rcsmerge.c (main): Likewise.
	* rcssyn.c (getadmin): Likewise.
	* rlog.c (main): Likewise.

2010-03-15  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Don't bother taking unused third arg for `same_file'.

	* rcsbase.h (same_file): Don't take third arg.
	* ci.c (main): Call `same_file' w/o third arg.
	* co.c (main): Likewise.
	* rcsclean.c (main): Likewise.
	* rcsedit.c (chnamemod): Likewise.
	* rcsfnms.c (getfullRCSname): Likewise.

2010-03-15  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Topo-sort top-level; eliminate redundant forward func decls.

	* maketime.c: Delete forward func decls; reorder
	top-level; do other whitespace and comment changes.
	* merger.c: Likewise.
	* partime.c: Likewise.
	* rcsedit.c: Likewise.
	* rcsfcmp.c: Likewise.
	* rcsfnms.c: Likewise.
	* rcsgen.c: Likewise.
	* rcskeep.c: Likewise.
	* rcskeys.c: Likewise.
	* rcslex.c: Likewise.
	* rcsmap.c: Likewise.
	* rcsrev.c: Likewise.
	* rcssyn.c: Likewise.
	* rcstime.c: Likewise.
	* rcsutil.c: Likewise.

2010-03-15  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Remove spurious debugging output.

	* rcsfnms.c [!HAVE_MKSTEMP] (homegrown_mkstemp):
	Remove debugging output.

2010-03-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Revise output for --help option.

	* ci.c (:help comment): Remove description blurb;
	use uppercase letters and a period; flatten/reorg a bit.
	* co.c (:help comment): Likewise.
	* ident.c (:help comment): Likewise.
	* merge.c (:help comment): Likewise.
	* rcs.c (:help comment): Likewise.
	* rcsclean.c (:help comment): Likewise.
	* rcsdiff.c (:help comment): Likewise.
	* rcsmerge.c (:help comment): Likewise.
	* rlog.c (:help comment): Likewise.

2010-03-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Topo-sort top-level; eliminate redundant forward func decls.

	* ci.c: Delete forward func decls; reorder top-level;
	do other whitespace and comment changes.
	(main): Move to end.
	* co.c: Likewise.
	* ident.c: Likewise.
	* merge.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsmerge.c: Likewise.
	* rlog.c: Likewise.

2010-03-13  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[sec] Use mktemp(1) instead of homegrown tmporary file naming.

	* rcsfreeze.sh (TMPLOG): Use mktemp(1); exit if not successful.

2010-03-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	rcsdiff: Refine "same-revision don't call diff" optimization.

	* rcsdiff.c (unique): New struct def.
	(s_unique): New typedef.
	(minus_y, minus_D): New static `s_unique' objects.
	(longopt_maybe_p): New static func.
	(main) <option parsing>: No longer disable "same-revision
	don't call diff" optimization on any long opt.  Instead, disable
	only for `--side-by-side', `--ifdef', or unique portions thereof.
	Reported by Aaron S. Hawley <ashawley@gnu.uvm.edu>.

2010-03-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Factor string of '='.

	* rcsbase.h (equal_line): New var decl.
	* rcsutil.c (equal_line): New const string.
	* rcsdiff.c (main): Use `equal_line'.
	* rlog.c (main): Likewise.

2010-03-11  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Document rcsdiff(1) options passed to underyling diff(1).

	* rcsdiff.c (:help comment): Expand.

2010-03-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	rcsdiff: Accept `-U N' to output N lines of unified context.

	* rcsdiff.c (main): Handle option `-U'.

2010-03-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[v] Cause "make check" to fail if any test fails.

	* Makefile.in (check): If any test fails, fail overall.

2010-03-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use '\0' more.

	* ci.c: Throughout, replace `0' a char context with '\0'.
	* co.c: Likewise.
	* merger.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsedit.c: Likewise.
	* rcskeep.c: Likewise.
	* rcslex.c: Likewise.
	* rcsrev.c: Likewise.
	* rcsutil.c: Likewise.

2010-03-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `printf %.2d' check to configure.ac.

	* rcstime.c (proper_dot_2): Rewrite func as simple macro.

2010-03-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use <stdbool.h>.

	* rcsbase.h (true, false): Delete #define:s.
	* ci.c: #include <stdbool.h>.
	* co.c: Likewise.
	* ident.c: Likewise.
	* merge.c: Likewise.
	* rcs.c: Likewise.
	* rcsbase.h: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsedit.c: Likewise.
	* rcsfcmp.c: Likewise.
	* rcsfnms.c: Likewise.
	* rcsgen.c: Likewise.
	* rcskeep.c: Likewise.
	* rcslex.c: Likewise.
	* rcsmerge.c: Likewise.
	* rcsrev.c: Likewise.
	* rcssyn.c: Likewise.
	* rcsutil.c: Likewise.
	* rlog.c: Likewise.

2010-03-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use `NULL' more.

	* ci.c: Throughout, replace `0' in a pointer context with `NULL'.
	* co.c: Likewise.
	* maketime.c: Likewise.
	* merge.c: Likewise.
	* merger.c: Likewise.
	* partime.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsedit.c: Likewise.
	* rcsfnms.c: Likewise.
	* rcsgen.c: Likewise.
	* rcskeep.c: Likewise.
	* rcskeys.c: Likewise.
	* rcslex.c: Likewise.
	* rcsmerge.c: Likewise.
	* rcsrev.c: Likewise.
	* rcssyn.c: Likewise.
	* rcsutil.c: Likewise.
	* rlog.c: Likewise.

2010-03-10  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Fix bug: Remove all log messages when removing all revisions.

	* rcs.c (main): When outdating, allow `scanlogtext' to
	do its job regardless of the presence of revisions finally.
	Reported by Jeff Sheinberg <jeffsh@erols.com>.

2010-03-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Do some small changes to quieten GCC warnings.

	* ci.c: #include <ctype.h>.
	* gnu-h-v.c (display_version): Don't take CMDID; use global.
	(check_hv): Don't take CMDID; update call to `display_version'.
	* gnu-h-v.h (display_version, check_hv): Update func decls.
	(CHECK_HV): Update call to `check_hv'.
	* ident.c (main): Update call to `display_version'.
	* maketime.c: #include "rcsbase.h";
	remove vestigal "#if has_conf_h #else ... #endif" block.
	[TEST]: Use `#ifdef', not `#if'.
	* merge.c (main): Update call to `display_version'.
	* partime.c: #include "rcsbase.h";
	remove vestigal "#if has_conf_h #else ... #endif" block.
	(isdigit): Delete #undef, #define.
	(parzone, partime): Change return type to `char const*'.
	* partime.h (partime, parzone): Update func decls.
	* rcsbase.h (O_BINARY): Use "#ifdef", not "#if".
	(isdigit): Delete #define.
	* rcsfcmp.c: Whitespace munging; nfc.
	* rcskeep.c: #include <ctype.h>.
	* rcsrev.c: Likewise.
	* rcssyn.c: Likewise.
	* rcsutil.c: Likewise.
	(setRCSversion): Update call to `display_version'.

2010-03-09  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Ensure `parse_decimal' never leaves junk fraction.

	* partime.c (parse_decimal): Make sure
	out-param `fres' always contains a valid value.

2010-03-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Delete src/foo-help.c files on "make clean".

	* Makefile.in (clean): Also delete *-help.c.

2010-03-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add abstraction: gr_revno

	* rcsbase.h (gr_revno): New func decl.
	* rcsrev.c (gr_revno): New func.
	(branchtip): Use it.
	* ci.c: Replace `genrevs (foo, NULL, NULL, NULL, bar)'
	with `gr_revno (foo, bar)', throughout.
	* co.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsmerge.c: Likewise.

2010-03-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Use `NULL' more.

	* ci.c: Throughout, replace `(foo *) 0' with `NULL'.
	* co.c: Likewise.
	* ident.c: Likewise.
	* maketime.c: Likewise.
	* merger.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsedit.c: Likewise.
	* rcsfcmp.c: Likewise.
	* rcsfnms.c: Likewise.
	* rcsgen.c: Likewise.
	* rcskeep.c: Likewise.
	* rcslex.c: Likewise.
	* rcsmerge.c: Likewise.
	* rcsrev.c: Likewise.
	* rcssyn.c: Likewise.
	* rcsutil.c: Likewise.
	* rlog.c: Likewise.

2010-03-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[v] Add basic "make check" support.

	* rcsutil.c: Don't #include "bother.h".
	(prog_co, prog_merge): Delete var definitions.
	* Makefile.in (PATHPREFIX): New var.
	(TESTS_ENVIRONMENT, TESTS): Likewise.
	(RCSPREFIX): Delete var.
	(all): Remove bother.h from dependency list.
	(check): New target.
	(RCSTEST): Delete var.
	(installcheck): Depend on `test-prep'; redirect to `check'.
	(installdebug): Delete target.
	(test-clean): New target.
	(clean): Depend on `test-clean'.
	(distclean): Delete bother.c, not bother.h.
	(rcsutil$o): Delete dependency on bother.h.
	(bother.h): Delete target.
	(bother.c): New target.
	(PARTS): Add `bother$o'.
	(test-prep, xorlf): New targets.
	* alive.test: Rename from rcstest; make sensitive
	to env var DEBUG; don't compile a "fake tr"; chmod -x.

2010-03-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Avoid comparing signed/unsigned.

	* rcsedit.c (deletelines): Take `unsigned long' (both args).
	Also, use `unsigned long' for local var.
	(insertline): Change type of first arg to `unsigned long'.
	(resolve_symlink): Use `ssize_t' for local var.
	* rcsfnms.c (pairnames): Add cast to `size_t' for `strlen' rv.
	Also, transform `baselen' comparison algebraically.
	* rcslex.c (fd2RILE): Use `off_t' for local var.
	* rcsutil.c (write_stderr): Use `int' for local var.

2010-03-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Add do-while for `aputc_'; rename.

	* rcsbase.h (aputc): Rename from `aputc_'; add do-while.
	(GETC): Use `aputc'.
	* rcsedit.c (snapshotline, copylines, copystring, editstring)
	(expandline, escape_string): Likewise.
	* rcsgen.c (putdesc, putadmin, putstring, putdftext): Likewise.
	* rcslex.c (eoflex, getphrases)
	(getphrases, printstring, diagnose): Likewise.
	* rlog.c (main): Likewise.

2010-03-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Add do-while for `Igeteof_'; rename.

	* rcsbase.h (Igeteof): Rename from `Igeteof_'; add do-while.
	[large_memory] (Iget): Use `Igeteof'.
	[!large_memory] (cachegeteof): Likewise.
	* rcsedit.c (editstring): Likewise.
	* rcsfcmp.c (discardkeyval, rcsfcmp): Likewise.
	* rcskeep.c (getoldkeys, getval)
	(get0val, keepdate, keepid): Likewise.

2010-03-08  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Add do-while for `Iget_'; rename.

	* rcsbase.h (Iget): Rename from `Iget_'; add do-while.
	[!large_memory] (cacheget): Use `Iget'.
	* rcslex.c (Lexinit): Likewise.

2010-03-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Add do-while for `cachegeteof_'; rename.

	* rcsbase.h (cachegeteof): Rename from `cachegeteof_'; add do-while.
	[large_memory] (cacheget): Use `cachegeteof'.
	* rcsedit.c (copylines, expandline): Likewise.
	* rcsgen.c (putdftext): Likewise.
	* rcslex.c (eoflex): Likewise.
	* rcssyn.c (getdiffcmd): Likewise.

2010-03-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Add do-while for `cacheunget_'; rename.

	* rcsbase.h (cacheunget): Rename from `cacheunget_'; add do-while.
	* rcsedit.c (keyreplace): Use `cacheunget'.

2010-03-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Add do-while for `cacheget_'; rename.

	* rcsbase.h (cacheget): Rename from `cacheget_'; add do-while.
	(cacheunget_, GETC): Use `cacheget'.
	* rcsedit.c (keyreplace): Likewise.
	* rcslex.c (getphrases, printstring): Likewise.
	* rcssyn.c (getdiffcmd): Likewise.
	* rlog.c (getscript): Likewise.

2010-03-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int C] Add do-while for `GETC_'; rename to `GET'.

	* rcsbase.h (GETCeof_): Delete unused macro.
	(GETC): Rename from `GETC_'; add do-while.
	* rcsedit.c (copystring): Use `GETC'.
	(enterstring, editstring, expandline): Likewise.
	* rcslex.c (nextlex, getphrases, readstring, savestring): Likewise.

2010-03-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Mark some parameters RCS_UNUSED.

	* rcsfnms.c (rcsreadopen): Mark `mustread' RCS_UNUSED.
	* rcslex.c (nothing_to_deallocate): Likewise for `f'.
	* rcsutil.c (catchsigaction): Likewise for `c'.

2010-03-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Add check for GCC attribute `unused'.

	* rcsbase.h (RCS_UNUSED): New #define.

2010-03-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Declare `display_version' for rcsutil.c.

	* rcsutil.c: #include "gnu-h-v.h".

2010-03-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move all DIFF* config to configure.in; assume diffutils.

	* Makefile.in (DIFF, DIFF3): Delete vars.
	(RCSTEST): Remove DIFF='$(DIFF)'.
	(bother.h): Don't output #define:s for `DIFF', `DIFF3'.

2010-03-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Require absolute filenames for external programs.

	* Makefile.in (absp): Delete var.
	(bother.h): Use absolute $(RCSPREFIX), via pwd(1);
	don't bother computing `ALL_ABSOLUTE', `DIFF_ABSOLUTE'.
	* rcsutil.c (exec_RCS): Move #define out of conditional.
	(set_uid_to): Update #if condition, taking DIFF_ABSOLUTE as 1.

2010-03-07  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move non-filename DIFF* configuration to configure.in.

	* merger.c: Don't #include "bother.h".
	* rcsdiff.c: Likewise.
	* Makefile.in (DIFF3_BIN, DIFFFLAGS, DIFF_L)
	(DIFF_FAILURE, DIFF_SUCCESS, DIFF_TROUBLE): Delete vars.
	(merger$o, rcsdiff$o): No longer depend on "bother.h".
	(bother.h): Remove #define generation for `DIFF_L', `DIFF3_BIN',
	`DIFFFLAGS', `DIFF_SUCCESS', `DIFF_FAILURE', `DIFF_TROUBLE'.

2010-03-06  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `SENDMAIL' configuration to configure.in.

	* rcs.c: Don't #include "bother.h".
	* Makefile.in (SENDMAIL): Delete var.
	(rcs$o): No longer depend on "bother.h".
	(bother.h): Remove `SENDMAIL' #define/#undef generation.

2010-03-06  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `ED' configuration into configure.in.

	* Makefile.in (ED): Delete var.
	(bother.h): Remove `ED' #define.
	Also, don't bother checking it for absoluteness.
	* merger.c (merge): Use `ED'.
	* rcsbase.h (prog_ed): Delete var decl.
	* rcsutil.c (prog_ed): Delete var.

2010-03-06  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `COMPAT2' configuration into configure.in.

	* Makefile.in (COMPAT2): Delete var.
	(bother.h): Remove `COMPAT2' #define/#undef generation.
	(rcssyn$o): No longer depend on "bother.h".
	* rcssyn.c: Don't #include "bother.h".

2010-03-06  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[dist] Don't distribute INSTALL.RCS.

	* Makefile.in: Comment munging; nfc.
	* rcsbase.h: Likewise.

2010-03-06  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[sec] Use `mkstemp' instead of `mktemp'.

	* rcsbase.h (P_tmpdir): New #define, but only not already.
	(set_temporary_file_name): New func decl.
	* rcsfnms.c: #include <stdint.h>.
	[HAVE_MKTEMP] (tmp): Delete func and surrounding #ifdef.
	[!HAVE_MKSTEMP] (homegrown_mkstemp): New func.
	[!HAVE_MKSTEMP] (mkstemp): #define to `homegrown_mkstemp'.
	(set_temporary_file_name): New func.
	(maketemp): Use `set_temporary_file_name'.
	* rcsedit.c (makedirtemp): Use `set_temporary_file_name'.

2010-03-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Add --help, --version handling for all programs.

	In the following, for program source PROG.c:
	Implicit: #include "ci-help.c"; add /*:help ...*/ comment.
	C means: Check for "--help" and "--version"; handle them.
	B means: Don't display usage summary on bad option.
	* gnu-h-v.h: New file.
	* gnu-h-v.c: New file.
	* ci.c (main): C; B.
	* co.c (main): C; B.
	* ident.c (main): C; use `display_version'.
	* merge.c (main): Likewise.
	* rcs.c (main): C; B.
	* rcsclean.c (main): C.
	* rcsdiff.c (main): C; B.
	* rcsfreeze.sh: Add copyright and license notices.
	Add handling for --help, --version.
	(version): New var.
	(usage): New func.
	* rcsmerge.c (main): C; B.
	* rcsutil.c (setRCSversion): Use `display_version'.
	* rlog.c (main): C; B.
	* rcsbase.h (COMMAND_VERSION): Delete macro.
	* Makefile.in (%-help.c : %.c): New pattern rule.
	(SOURCE): Add gnu-h-v.c.
	(PARTS): Add gnu-h-v$o.
	(ci$o): Depend on ci-help.c.
	(co$o): Depend on co-help.c.
	(ident$o): Depend on ident-help.c.
	(merge$o): Depend on merge-help.c.
	(rcs$o): Depend on rcs-help.c.
	(rcsclean$o): Depend on rcsclean-help.c.
	(rcsdiff$o): Depend on rcsdiff-help.c.
	(rcsmerge$o): Depend on rcsmerge-help.c.
	(rlog$o): Depend on rlog-help.c.

2010-03-04  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move some Makefile vars out of "tailorable" section.

	* Makefile.in (bindir): Move up; use @bindir@ directly.
	(x): Move up; use @EXEEXT@.
	(o): Move up; use .@OBJEXT@ -- NB leading dot.
	(LIBOBJS): Move up; use @LIBOBJS@.

2010-03-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Use an object archive instead of specifying long lists.

	* Makefile.in (LINK): Remove $(LDFLAGS), $(CFLAGS).
	(clean): Don't delete a.*, RCS/a.*; instead delete librcsparts.a.
	(ci, ci$x): Delete this var and pattern rule, respectively.
	(co, co$x): Likewise.
	(ident, ident$x): Likewise.
	(merge, merge$x): Likewise.
	(rlog, rlog$x): Likewise.
	(rcs, rcs$x): Likewise.
	(rcsclean, rcsclean$x): Likewise.
	(rcsdiff, rcsdiff$x): Likewise.
	(rcsmerge, rcsmerge$x): Likewise.
	(%$x : %$o): New pattern rule.
	(PROGS, PARTS): New vars.
	(OBJECT): Rewrite var in terms of $(PROGS), $(PARTS).
	(librcsparts.a): New target.

2010-03-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Make compilation output file a little more obvious.

	* Makefile.in (.c$o): Add "-o $@" to compile command line.
	(ci$x, co$x, ident$x, merge$x, rlog$x, rcs$x)
	(rcsclean$x, rcsdiff$x, rcsmerge$x): Move "-o $@"
	forward in the command line, following $(LINK).

2010-03-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Reduce dependency-transitivity of src/Makefile variables.

	* Makefile.in (ALL_CFLAGS): Remove -Dhas_conf_h.
	(all): Depend on bother.h.
	(clean): Remove conf.err from list of files to delete.
	(distclean): Don't delete conf.h; delete bother.h, instead.
	(conf.h): Delete target.
	(merger$o): Depend explicitly on bother.h.
	(rcs$o, rcsdiff$o, rcssyn$o, rcsutil$o): Likewise.
	(absp): New var.
	(bother.h): New target.
	(conf_h): Delete var.
	($(OBJECT)): Don't depend on $(conf_h).
	(FORCE): New target.
	* rcsbase.h: Don't #include "conf.h".
	#include <errno.h>, <stdio.h>, <time.h>, <sys/types.h>,
	<sys/stat.h>, <stdlib.h>, <stdarg.h>, <string.h>.
	[HAVE_FCNTL_H]: #include <fcntl.h>
	[HAVE_LIMITS_H]: #include <limits.h>
	[HAVE_MACH_MACH_H]: #include <mach/mach.h>.
	[HAVE_NET_ERRNO_H]: #include <net/errno.h>.
	[HAVE_PWD_H]: #include <pwd.h>.
	[HAVE_SIGINFO_H]: #include <siginfo.h>.
	[HAVE_SIGNAL_H]: #include <signal.h>.
	[HAVE_SYS_MMAN_H]: #include <sys/mman.h>.
	[HAVE_SYS_WAIT_H]: #include <sys/wait.h>.
	[HAVE_UCONTEXT_H]: #include <ucontext.h>.
	[HAVE_UNISTD_H]: #include <unistd.h>.
	[HAVE_UTIME_H]: #include <utime.h>.
	[HAVE_VFORK_H]: #include <vfork.h>.
	(exiting, printf_string, printf_string_exiting): New macros.
	(FOPEN_RB, FOPEN_R_WORK, FOPEN_WB, FOPEN_W_WORK, FOPEN_WPLUS_WORK)
	(OPEN_O_BINARY, OPEN_CREAT_READONLY, OPEN_O_LOCK, OPEN_O_WRONLY)
	(getlogin_is_secure, bad_NFS_rename, has_setreuid, needs_getabsname)
	(has_NFS, RCS_SHELL, large_memory, TMPDIR, SLASH, SLASHes)
	(ROOTPATH, X_DEFAULT, TZ_must_be_set): Likewise.
	(exec_RCS, EXIT_TROUBLE): Delete macros.
	(isSLASH): New func decl.
	(prog_co, prog_co, prog_merge, prog_diff, prog_diff3, diff_flags)
	(diff_success, diff_failure, diff_trouble, prog_ed): New var decls.
	* rcsutil.c: #include "bother.h".
	(prog_co, prog_merge, prog_diff, prog_diff3, diff_flags)
	(diff_success, diff_failure, diff_trouble, prog_ed): New vars.
	(write_error): Use `diff_trouble'.
	(exec_RCS): New macro, moved from rcsbase.h.
	(runv): Use `diff_trouble'.
	* ci.c (main): Use `prog_diff', `diff_flags', `diff_trouble'.
	* co.c (buildjoin): Use `prog_co', `prog_merge', `diff_trouble'.
	* merge.c (exiterr): Use `diff_trouble'.
	* merger.c: #include "bother.h".
	(merge): Use `prog_diff3', `diff_trouble', `diff_failure',
	`prog_diff', `diff_success', `prog_ed'.
	* rcs.c: #include "bother.h".
	(buildeltatext): Use `prog_diff', `diff_flags', `diff_trouble'.
	* rcsdiff.c: #include "bother.h".
	(main): Use `diff_success', `prog_diff', `prog_co', `diff_trouble',
	`diff_failure'.
	(cleanup, exiterr): Use `diff_trouble'.
	* rcsfnms.c (isSLASH): Define func unconditionally.
	(isSLASH) [!WOE]: Just check that the char is `SLASH'.
	* rcsmerge.c (co): Delete var.
	(main): Use `prog_co', `diff_trouble'.
	(exiterr): Use `diff_trouble'.
	* rcssyn.c: #include "bother.h".
	* conf.heg: Delete file.
	* conf.sh: Delete file.

2010-03-03  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Detect "absolute-filename-p" without compiling.

	* conf.sh: Use `WOE' value from auto-sussed.h directly to select
	set of #define values.  For `ALL_ABSOLUTE', `DIFF_ARBITRARY'
	computation, use ../build-aux/abs-p.

2010-03-02  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move "// is /" check to configure.in.

	* conf.sh: Remove "// is /" check.
	* rcsfnms.c: Do s/SLASHSLASH_is_SLASH/SLASHSLASH_IS_SLASH/g.
	Also, don't bother checking if SLASHSLASH_IS_SLASH is defined.

2010-03-02  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move "bad wait if SIGCHLD ignored" check to configure.in.

	* rcsfnms.c: Do s/bad_wait_if_SIGCHLD_ignored/BAD_WAIT_IF_SIGCHLD_IGNORED/g.
	* rcsutil.c: Likewise.
	* conf.sh: Remove "bad wait if SIGCHLD ignored" check.

2010-03-02  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move mmap-related checks to configure.in.

	* rcslex.c: Do s/has_madvise/defined HAVE_MADVISE/g; do
	s/has_mmap/defined HAVE_MMAP/g; do s/mmap_signal/MMAP_SIGNAL/g.
	* rcsutil.c: Likewise.
	* rcsbase.h: Likewise, but if `MMAP_SIGNAL'
	is 0, #undef `HAVE_MMAP', `HAVE_MADVISE' first.
	* conf.sh: Remove mmap-related checks.

2010-03-02  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move "bad rename" checks to configure.in.

	* rcsedit.c: Do s/bad_a_rename/BAD_A_RENAME/g;
	do s/bad_b_rename/BAD_B_RENAME/g.
	* conf.sh: Remove "bad rename" checks.

2010-03-01  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `sys_siglist' check to configure.in.

	* rcsbase.h (sys_siglist): Remove array decl.
	* rcsutil.c: Do s/has_sys_siglist/defined HAVE_SYS_SIGLIST/g.
	* conf.sh: Remove `sys_siglist' check, and also
	for supporting shell vars `has_signal', `has_psignal'.

2010-03-01  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move "siginfo_t .si_errno" check to configure.in.

	* rcsutil.c: Do s/has_si_errno/defined HAVE_SI_ERRNO/g.
	* conf.sh: Remove "siginfo_t .si_errno" check.

2010-03-01  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move "unlink on unwritable files" check to configure.in.

	* rcsbase.h: Do s/bad_unlink/BAD_UNLINK/g.
	* rcsedit.c: Likewise.
	* conf.sh: Remove "unlink on unwritable files" check.

2010-03-01  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move "fopen w+ truncates" check to configure.in.

	* rcsedit.c: Do s/bad_fopen_wplus/BAD_FOPEN_WPLUS/g.
	* conf.sh: Remove "fopen w+ truncates" check.

2010-02-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move "signal zaps handler" check to configure.in.

	* rcsutil.c: Do s/sig_zaps_handler/SIG_ZAPS_HANDLER/g.
	* conf.sh: Remove "signal zaps handler" check.

2010-02-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move "fflush input" check to configure.in.

	* ci.c: Do s/has_fflush_input/CAN_FFLUSH_IN/g.
	* conf.sh: Remove "fflush input" check.

2010-02-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move "`write' after `creat (F, 0)'" check to configure.in.

	* rcs.c: Do s/bad_creat0/BAD_CREAT0/g.
	* rcsedit.c: Likewise.
	* rcsgen.c: Likewise.
	* conf.sh: Remove "write after creat0 fails" check.

2010-02-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `psiginfo' check to configure.in.

	* rcsutil.c: Do s/has_psiginfo/defined HAVE_PSIGINFO/g.
	* conf.sh: Remove check for `psiginfo'.

2010-02-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Drop support for "spawn" (fork(2) analog).

	* rcsbase.h: For #if has_spawn FOO #else BAR #endif
	block, delete everything except BAR.
	* rcsutil.c [has_spawn] (redirect): Delete func.
	Also: delete #if has_spawn FOO #endif blocks;
	where there is `has_spawn', subtitute w/ 0 and simplify.
	* conf.sh: Don't define `has_spawn'.

2010-02-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Drop support for "map_fd" (HPUX mmap(2) precursor).

	* rcsbsae.h (maps_memory): Do s/has_map_fd/0/.
	* rcslex.c [has_map_fd] (map_fd_deallocate): Delete func.
	(fd2RILE) [has_map_fd]: Delete allocation sequence.
	* conf.sh: Don't check for "map_fd"; don't define `has_map_fd'.

2010-02-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Move check for proper `printf' "%.2" behavior to runtime.

	* rcstime.c (proper_dot_2): New static func.
	(time2date): For #if has_printf_dot FOO #else BAR #endif
	blocks, replace with `proper_dot_2 (FOO, BAR)'.
	* conf.sh: Remove check for proper `printf' "%.2" behavior.

2010-02-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Presume <limits.h> defines `LONG_MAX'.

	* conf.sh: Remove computation of `LONG_MAX'.

2010-02-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `sigblock' check to configure.in.

	* rcsutil.c: Do s/has_sigblock/defined HAVE_SIGBLOCK/g;
	* conf.sh: Remove check for `sigblock'.

2010-02-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] When using `sigblock', compute `sigmask' manually.

	* rcsutil.c [has_sigblock] (setup_catchsig): Don't
	use `sigmask; instead, do the subtract and shift manually.
	* conf.sh: Remove computation of `sigmask'.

2010-02-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `sigaction' check to configure.in.

	* rcsutil.c: Do s/has_sigaction/defined HAVE_SIGACTION/g.
	* conf.sh: Remove check for `sigaction'.

2010-02-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Presume `sigaction.sa_sigaction' is POSIX.

	* rcsutil.c: For #if has_sa_sigaction FOO #else
	BAR #endif block, delete everything except FOO.
	* conf.sh: Remove check for `sigaction.sa_sigaction'.

2010-02-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `psignal' check to configure.in.

	* rcsutil.c: Do s/has_psignal/defined HAVE_PSIGNAL/g.
	* conf.sh: Remove check for `psignal'.

2010-02-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Presume <utime.h> declares `struct utimbuf'.

	* rcsbase.h [!has_utimbuf] (utimbuf): Delete struct decl.
	* conf.sh: Remove check for `struct utimbuf'.

2010-02-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Presume availability of `chmod'.

	* ci.c: For #if bad_chmod_close FOO #else BAR #endif
	block, delete everything except BAR.
	* conf.sh: Remove check for `chmod'.

2010-02-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `seteuid', `setuid' checks to configure.in.

	* rcsbase.h: Do s/has_seteuid/defined HAVE_SETEUID/g;
	do s/has_setuid/defined HAVE_SETUID/g.
	* ci.c: Likewise.
	* rcsedit.c: Likewise.
	* rcsutil.c: Likewise.
	* conf.sh: Remove checks for `seteuid', `setuid'.

2010-02-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `ftruncate' check to configure.in.

	* ci.c: Do s/has_ftruncate/defined HAVE_FTRUNCATE/g.
	* conf.sh: Remove check for `ftruncate'.

2010-02-28  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `vfork', `fork' checks to configure.in.

	* rcsbase.h: Do s/has_fork/defined HAVE_WORKING_FORK/g;
	do s/has_vfork/defined HAVE_WORKING_VFORK/g.
	* rcsutil.c: Likewise.
	* conf.sh: Remove checks for `vfork', `fork'.
	Do s/has_fork/defined HAVE_WORKING_FORK/g.

2010-02-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `waitpid' check to configure.in.

	* rcsfnms.c: Do s/has_waitpid/defined HAVE_WAITPID/g.
	* rcsutil.c: Likewise.
	* conf.sh: Remove check for `waitpid'.

2010-02-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Use `HAVE_SIGNAL_H' directly.

	* rcsbase.h: Do s/has_signal/defined HAVE_SIGNAL_H/g.
	* rcsutil.c: Likewise.
	* conf.sh: Don't propagate `has_signal' to conf.h.

2010-02-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `mktemp' check to configure.in.

	* rcsedit.c: Do s/has_mktemp/defined HAVE_MKTEMP/g.
	* rcsfnms.c: Likewise.
	* conf.sh: Remove check for `mktemp'.

2010-02-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `getuid', `getpwuid' checks to configure.in.

	* rcsbase.h: Do s/has_getuid/defined HAVE_GETUID/g.
	* ci.c: Likewise.
	* rcsutil.c: Likewise; also s/has_getpwuid/defined HAVE_GETPWUID/g.
	* conf.sh: Remove checks for `getuid', `getpwuid'.

2010-02-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `fchmod' check to configure.in.

	* ci.c: Do s/if has_fchmod/ifdef HAVE_FCHMOD/g.
	* rcsedit.c: Likewise.
	* conf.sh: Remove check for `fchmod'.

2010-02-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `getcwd', `getwd' check to configure.in.

	* rcsfnms.c: Do s/has_getcwd/defined HAVE_GETCWD/g;
	do s/has_getwd/defined HAVE_GETWD/g.
	* rcsbase.h (getcwd, getwd): Delete func decls.
	* conf.sh: Remove checks for `getcwd', `getwd'.

2010-02-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move `readlink' check to configure.in; use _POSIX_SYMLOOP_MAX.

	* rcsedit.c: Do s/#if has_readlink/#ifdef HAVE_READLINK/g.
	[HAVE_READLINK] (resolve_symlink): Use `_POSIX_SYMLOOP_MAX'.
	Also, assume `EINVAL' for error-on-non-symlink situation.
	* conf.sh: Remove "check" for <sys/param.h>; remove check
	for `readlink' and its error-on-non-symlink return value.

2010-02-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move a mass of boilerplate from conf.sh to rcsbase.h.

	In the process, we also remove (by selectively not copying)
	redundant func decls meant to augment missing entries in
	<stdio.h>, <stdlib.h>, <string.h>, <time.h>.

	* rcsbase.h: Add boilerplate code.
	* conf.sh: Delete eof boilerplate; don't bother doing the
	"Comment out lines in a.ha that the compiler rejects" step.

2010-02-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move checks for missing type definitions to configure.in.

	* conf.sh Remove checks for missing type definitions;
	instead, grep auto-sussed.h directly.

2010-02-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Presume `fread' rv and arg types are both `size_t'.

	* rcslex.c (Igetmore): Use `size_t' and `fread' directly.
	* rcsutil.c (fastcopy): Likewise.
	(awrite): Use `fwrite' directly.
	* rcsbase.h (Fread, Fwrite): Delete macros.
	* conf.sh: Remove checks for `fread' rv type, arg type.

2010-02-27  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Presume <stdio.h> provides `rename', `strchr', `strrchr'.

	* rcsedit.c [!has_rename] (do_link): Delete macro, func.
	(chnamemod): Move code out of #if has_rename block,
	deleting #else block as well; simplify #if expression.
	* conf.sh: Remove checks for `rename', `strchr', `strrchr'.

2010-02-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Assume signal handlers return `void'.

	* rcsutil.c: Do s/signal_type/void/g.
	* conf.sh: Remove check for signal handler rv type.
	Also, remove checks for kill(2); replace
	callers with use `raise (getpid (), ...)'.

2010-02-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Presume availability of `fputs'.

	* rcslex.c (aputs): Move code out
	of #if has_fputs; delete #else block.
	* conf.sh: Remove check for `fputs'.

2010-02-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move checks for GCC __attribute__ handling to configure.in

	* conf.sh: Remove checks for GCC attributes `noreturn' and
	`format_printf'; use `GCC_HAS_ATTRIBUTE_NORETURN' and
	`GCC_HAS_ATTRIBUTE_FORMAT' from auto-sussed.h directly.

2010-02-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Assume `EXIT_FAILURE' works.

	* conf.sh: Remove check for `EXIT_FAILURE'.

2010-02-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Presume availability of `vfprintf'.

	* rcslex.c (fvfprintf): Move code in #if has_vfprintf
	block up; delete #else block.
	* conf.sh: Remove checks for `vfprintf', `_doprintf', `_doprnt'.

2010-02-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Assume `malloc' returns `void *'.

	* rcsbase.h: Do s/malloc_type/void */g.
	* rcsfnms.c: Likewise.
	* rcsutil.c: Likewise.
	* conf.sh: Remove check for `malloc' rv type.

2010-02-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Assume `closedir' (from <dirent.h>) returns `int'.

	* rcsclean.c [HAVE_DIRENT_H]: #include <dirent.h>.
	(get_directory): For both func decl and function definition, move
	out of #if has_dirent block and into "ifdef HAVE_DIRENT_H" block.
	Also, assume unconditionally that `closedir' returns `int'.
	(main): Use #ifdef HAVE_DIRENT_H instead of #if has_dirent.
	* conf.sh: Remove checks for <dirent.h>, `closedir' rv.

2010-02-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Presume availability of `memcmp', `memcpy', `memmove'.

	* rcsedit.c (movelines): Move #define to top-level out of
	"#if has_memmove" block, deleting the #else /*!has_memmove */ block.
	* rcsutil.c [!has_memcmp] (memcmp): Delete func.
	[!has_memcpy] (memcpy): Likewise.
	* conf.sh: Remove checks for `memcmp', `memcpy', `memmove'.

2010-02-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move check for system headers into configure.in.

	* conf.sh: Arrange to #include unconditionally <sys/types.h>,
	<sys/stat.h>, <stdlib.h>, <string.h>.  Convert checks for
	system headers from compiler-based to grep auto-sussed.h.
	Likewise for <sys/param.h>; re-#define/use HAVE_SYS_PARAM_H.
	Remove handling for <errno.h> that doesn't declare `errno'.

2010-02-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] To return from `main', use `return' directly.

	* ci.c (main): Use `return', not `exitmain'.
	* co.c (main): Likewise.
	* ident.c (main): Likewise.
	* merge.c (main): Likewise.
	* rcs.c (main): Likewise.
	* rcsclean.c (main): Likewise.
	* rcsdiff.c (main): Likewise.
	* rcskeep.c (main): Likewise.
	* rcslex.c (main): Likewise.
	* rcsmerge.c (main): Likewise.
	* rcsrev.c (main): Likewise.
	* rcssyn.c (main): Likewise.
	* rlog.c (main): Likewise.
	* conf.sh: Remove section probing validity of
	`return' from `main'.  Also, do s/exitmain/return/g.

2010-02-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Add braces to disambiguate `else' clause.

	* ci.c (removelock): Add braces to disambiguate `else'.
	* ident.c (main): Likewise.
	* rcs.c (dolocks, setlock, rcs_setstate): Likewise.
	* rcsdiff.c (main) [DIFF_L]: Likewise.
	* rcsedit.c (keyreplace, addlock, addsymbol, dorewrite): Likewise.
	* rcsgen.c (getsstdin): Likewise.
	* rcsrev.c (fexpandsym): Likewise.
	* rlog.c (putadelta): Likewise.

2010-02-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Presume availability of <stdarg.h>.

	* rcsgen.c (yesorno): Use `va_start' directly.
	* rcslex.c (error, rcserror, workerror, fatserror, faterror)
	(rcsfaterror, warn, rcswarn, workwarn, diagnose, aprintf): Likewise.
	* rcsutil.c (run): Likewise.
	* conf.sh: Remove section probing <stdarg.h>;
	arrange to #include <stdarg.h> unconditionally in conf.h.

2010-02-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Define `cmdid', `main' directly.

	* ci.c (cmdid, main): Define directly.
	* co.c (cmdid, main): Likewise.
	* ident.c (cmdid, main): Likewise.
	* merge.c (cmdid, main): Likewise.
	* rcs.c (cmdid, main): Likewise.
	* rcsclean.c (cmdid, main): Likewise.
	* rcsdiff.c (cmdid, main): Likewise.
	* rcsmerge.c (cmdid, main): Likewise.
	* rlog.c (cmdid, main): Likewise.
	* rcsbase.h (mainProg): Delete macro.

2010-02-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Say "register int c", not just "register c".

	* rcxlex.c (nextlex, readstring)
	(printstring, savestring): Say "register int c".
	* rcsedit.c (copystring, expandline): Likewise.
	* rcs.c (getaccessor, getstates): Likewise.
	* rcsdiff.c (main): Likewise.
	* rlog.c (getauthor): Likewise.

2010-02-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use Standard C syntax for function definitions.

	* ci.c: Throughout, use Standard C syntax for function definitions.
	* co.c: Likewise.
	* ident.c: Likewise.
	* maketime.c: Likewise.
	* merge.c: Likewise.
	* merger.c: Likewise.
	* partime.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsedit.c: Likewise.
	* rcsfcmp.c: Likewise.
	* rcsfnms.c: Likewise.
	* rcsgen.c: Likewise.
	* rcskeep.c: Likewise.
	* rcskeys.c: Likewise.
	* rcslex.c: Likewise.
	* rcsmerge.c: Likewise.
	* rcsrev.c: Likewise.
	* rcssyn.c: Likewise.
	* rcstime.c: Likewise.
	* rcsutil.c: Likewise.
	* rlog.c: Likewise.

2010-02-26  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[int] Use ANSI prototypes.

	Abbreviations:
	D: "Don't use `P (PROTOTYPE)', just use PROTOTYPE directly."
	P: "For #if has_prototypes FOO #else BAR #endif blocks,
	replace block with simply FOO."

	* maketime.h (__MAKETIME_P): Delete macro;
	update callers to use its arg directly.
	* partime.h (__PARTIME_P): Likewise.
	* ci.c: D; P.
	* co.c: D.
	* ident.c: D.
	* maketime.c: D.
	* merge.c: D.
	* merger.c: D.
	* partime.c: D.
	* rcs.c: D.
	* rcsbase.h: D.
	* rcsclean.c: D.
	* rcsdiff.c: D.
	* rcsedit.c: D; P.
	* rcsfcmp.c: D.
	* rcsfnms.c: D.
	* rcsgen.c: D; P.
	* rcskeep.c: D.
	* rcslex.c: D; P.
	* rcsrev.c: D.
	* rcssyn.c: D.
	* rcstime.c: D.
	* rcsutil.c: D; P.
	* rlog.c: D.
	* conf.sh: Don't compute `has_prototypes' or `P'.
	Also fix buglet: Use `$ech' instead of `echo'.

2010-02-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Move authoritative version number into configure.in.

	* rcsbase.h: #include "auto-sussed.h".
	(RCS_version_string): Delete decl.
	(COMMAND_VERSION): New #define.
	* ident.c (main): Use `COMMAND_VERSION'.
	* merge.c (main): Likewise.
	* rcsutil.c (setRCSversion): Likewise.
	* Makefile.in (SOURCE): Remove version.c.
	(ci, co, ident, merge, rlog, rcs, rcsclean)
	(rcsdiff, rcsmerge, OBJECT): Remove `version$o'.
	* version.c: Delete file.

2010-02-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[build] Drop "make lint" support.

	* rcsbase.h [RCS_lint] (lintalloc): Delete var.
	[RCS_lint] (mainProg, ftnalloc, tnalloc, trealloc, tfree):
	Remove macro definitions; promoting non-RCS_lint to top-level.
	* ci.c [RCS_lint] (exiterr): Delete #define.
	* co.c: Likewise.
	* ident.c: Likewise.
	* merge.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsmerge.c: Likewise.
	* rcsutil.c: Likewise.
	* rlog.c: Likewise.
	* rcs.c [RCS_lint] (cmdid, go, main):
	Delete var, #define, and func, respectively.
	* Makefile.in (lint): Delete target.

2010-02-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Don't coddle compilers that require `(void) EXPRESSION;'.

	* conf.sh: Remove check for `(void) EXPRESSION;' requirement.
	Don't #define `VOID'.
	* conf.heg: Don't #define `VOID'.
	* ci.c: Throughout, remove "VOID " in front of expressions.
	* co.c: Likewise.
	* ident.c: Likewise.
	* merger.c: Likewise.
	* rcs.c: Likewise.
	* rcsbase.h: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsedit.c: Likewise.
	* rcsfcmp.c: Likewise.
	* rcsfnms.c: Likewise.
	* rcskeep.c: Likewise.
	* rcslex.c: Likewise.
	* rcstime.c: Likewise.
	* rcsutil.c: Likewise.
	* rlog.c: Likewise.

2010-02-25  Thien-Thi Nguyen  <ttn@gnuvola.org>

	Drop RCS keyword `Id' from code.

	* rcsbase.h (RCSBASE, libId): Delete #define:s.
	(mainProg): Don't take 3rd arg; don't define `baseid', lib id string.
	* ci.c: Update `mainProg' call.
	* co.c: Likewise.
	* ident.c: Likewise.
	* merge.c: Likewise.
	* rcs.c: Likewise.
	* rcsclean.c: Likewise.
	* rcsdiff.c: Likewise.
	* rcsmerge.c: Likewise.
	* rlog.c: Likewise.
	* merger.c: Delete `libId' call.
	* rcsedit.c: Likewise.
	* rcsfcmp.c: Likewise.
	* rcsfnms.c: Likewise.
	* rcsgen.c: Likewise.
	* rcskeep.c: Likewise.
	* rcskeys.c: Likewise.
	* rcslex.c: Likewise.
	* rcsmap.c: Likewise.
	* rcsrev.c: Likewise.
	* rcssyn.c: Likewise.
	* rcstime.c: Likewise.
	* rcsutil.c: Likewise.
	* conf.sh (Id): Delete var.
	* maketime.c (maketId): Likewise.
	* partime.c (partimeId): Likewise.

2010-02-24  Thien-Thi Nguyen  <ttn@gnuvola.org>

	[admin] Move install-sh, mkinstalldirs into new dir build-aux/.

	* Makefile.in (bauxdir): New var.
	(installdirs): Use $(bauxdir).

Fri Jun 16 06:19:24 1995  Paul Eggert  <eggert@twinsun.com>

	* version.c: Version 5.7 released.
	* Makefile.in (TESTPREFIX): Remove; replaced with $(srcdir)/.
	* rcsutil.c (catchsig): Remove `return'.
	* Makefile.in, ci.c, co.c, conf.sh, ident.c, maketime.c, maketime.h,
	merge.c, merger.c, partime.c, partime.h, rcs.c, rcsbase.h, rcsclean.c,
	rcsdiff.c, rcsedit.c, rcsfcmp.c, rcsfnms.c, rcsgen.c, rcskeep.c,
	rcskeys.c, rcslex.c, rcsmap.c, rcsmerge.c, rcsrev.c, rcssyn.c, rcstest,
	rcstime.c, rcsutil.c, rlog.c:  Update FSF address.

Mon Jun  5 08:30:02 1995  Paul Eggert  <eggert@twinsun.com>

	* version.c (RCS_version_string): Update to 5.6.8.1 (beta).

Fri Jun  2 18:19:00 1995  Paul Eggert  <eggert@twinsun.com>

	* rcsutil.c (catchsigaction):
	New name for `catchsig', for sa_sigaction signature.
	Use nRCS even if !has_psiginfo, to remove unused variable warning.
	(setup_catchsig): Use sa_sigaction only if has_sa_sigaction.
	Use ENOTSUP only if defined.
	* conf.sh, conf.heg (has_sa_sigaction): New configuration variable.

Thu Jun  1 16:23:43 1995  Paul Eggert  <eggert@twinsun.com>

	* version.c (RCS_version_string): Update to 5.6.8 (beta).

	* Makefile.in:
	Renamed from Makefile; autoconf now preprocesses this file.
	Rewrite to follow GNU makefile standards.
	(clean): `rm core*' -> `rm core core.* *.core', for BSD/OS 2.0.

	* ci.c (main): Add -kb.  Use `cmpdate', not `cmpnum', to compare dates.
	Don't worry about errno after ftruncate fails.
	Fix input file rewinding bug when large_memory && !maps_memory
	and checking in a branch tip.

	(fixwork): Fall back on chmod if fchmod fails; it might be ENOSYS.

	* co.c (main, preparejoin):
	Pass argument instead of using `join' static variable.
	(main): Add -kb.

	* ident.c (exiterr, reportError):
	New functions, needed for DOS and OS/2 ports.
	(scanfile): Use them.

	* rcsdiff.c (main):
	Pass "--binary" if -kb and if --binary makes a difference.
	Don't treat + options specially.

	* rcsmerge.c (main):
	Report an error if -kb, so don't worry about binary stdout.
	Punctuate messages properly.  Rewrite to avoid `goto end'.

	* rcs.c (main):
	Warn if no options were given.  Punctuate messages properly.

	(sendmail): Rewind mailmess before flushing it.
	Output another warning if mail should work but fails.

	(buildeltatext): Pass "--binary" if -kb and if --binary is needed.

	* merger.c (normalize_arg): Don't treat + options specially.
	(merge): Don't make -A the default; always use -E.
	Always open working file in text mode.

	* rlog.c (struct rcslockers): Renamed from `struct lockers'.
	(getnumericrev): Return error indication instead of ignoring errors.
	(main): Check it.  Don't use dateform.
	(recentdate, extdate): cmpnum -> cmpdate

	* rcsclean.c (unlock): struct lock -> struct rcslock

	* rcsedit.c (dirtpname): No longer external.
	(do_link): Simplify logic.
	(finisheditline, finishedit): Replace Iseek/Itell with definiens.
	(fopen_update_truncate): Replace `#if' with `if'.
	(keyreplace, makedirtemp): dirlen(x) -> basefilename(x)-x.

	(edit_string): Fix bug: if !large_memory, a bogus trailing `@' was
	output at the end of incomplete lines.

	(keyreplace): Do not assume that seeking backwards
	at the start of a file will fail; on some systems it succeeds.
	Convert C- and Pascal-style comment starts to ` *' in comment leader.

	(rcswriteopen): Use fdSafer to get safer file descriptor.
	Open RCS file with FOPEN_RB.

	(chnamemod): Work around bad_NFS_rename; don't ignore un_link result.
	Fall back on chmod if fchmod fails, since it might be ENOSYS.

	(aflush): Move to rcslex.c.

	* rcsfcmp.c (rcsfcmp): Add -kb support.

	* rcsfnms.c (basefilename): Renamed from basename to avoid collisions.
	(dirlen): Remove (for similar reasons).
	(rcsreadopen): Open with FOPEN_RB.
	(SLASHSLASH_is_SLASH): Default is 0.
	(getcwd): Work around bad_wait_if_SIGCHLD_ignored bug.

	* rcsgen.c (putadmin): Open RCS file with FOPEN_WB.

	* rcskeep.c (getoldkeys): Don't panic if a Name: is empty.

	* rcslex.c:
	(map_fd_deallocate, mmap_deallocate, read_deallocate,
	nothing_to_deallocate): New functions.
	(Iclose): If large_memory and maps_memory, use them to deallocate.
	(fd2RILE): Use map_fd if available.
	If one mapping method fails, try the next instead of giving up;
	if they all fail, fall back on ordinary read.
	Work around bug: root mmap over NFS succeeds, but accessing dumps core.
	Use MAP_FAILED macro for mmap failure, and `char *' instead of caddr_t.
	(advise_access): Use madvise only if this instance used mmap.
	(Iopen): Use fdSafer to get safer file descriptor.
	(aflush): Moved here from rcsedit.c.

	* rcsrev.c (cmpdate, normalizeyear):
	New functions work around MKS incompatibility.
	(cmpnum, compartial): s[d] -> *(s+d) to work around Cray compiler bug.
	(genrevs, genbranch): cmpnum -> cmpdate

	* rcssyn.c (expand_names): Add "b" for -kb.
	(getdelta): Don't strip leading "19" from MKS dates; see cmpdate.

	* rcsutil.c (catchsig, restoreints, setup_catchsig):
	Use SA_SIGINFO, not has_psiginfo,
	to determine whether to use SA_SIGINFO feature,
	but also check at runtime whether the feature works.
	(catchsig): If an mmap_signal occurs, report the affected file name.
	(unsupported_SA_SIGINFO, accessName): New variables.
	(setup_catchsig): If using SA_SIGINFO, use sa_sigaction not sa_handler.
	If SA_SIGINFO fails, fall back on sa_handler method.

	(readAccessFilenameBuffer, dupSafer, fdSafer, fopenSafer): New fns.
	(concatenate): Remove.

	(runv): Work around bad_wait_if_SIGCHLD_ignored bug.
	Remove reference to OPEN_O_WORK.

	* maketime.h (adjzone, str2time):
	Time zones are now (long) seconds, not (int) minutes.
	(const): Remove.

	* maketime.c (difftm):
	Use smaller expressions, to avoid confusing buggy compilers.
	(adjzone, str2time): Time zones are (long) seconds, not (int) minutes.

	* partime.c (zone_names):
	Add "jdt", since Japan might use it.  "nrt" -> "nrft".
	Use special markers 1 and -1, not TM_LOCAL_ZONE and TM_UNDEFINED_ZONE,
	to avoid integer overflow now that time zones are seconds, not minutes.
	(parse_decimal): Round to even.
	(parzone): Time zones are now (long) seconds, not (int) minutes,
	as allowed by ISO 8601.

	* partime.h (TM_UNDEFINED_ZONE, zone):
	Now (long) seconds, not (int) minutes.
	(const): Remove.

	* rcstime.c (dateform): Remove.
	(zone_offset, str2time_checked, zone_set, date2str):
	Time zones are now (long) seconds, not (int) minutes.
	(date2str): Use `-08' style time zone, not `-0800', for ISO 8601.

	* conf.sh: `#!/bin/sh' -> `#! /bin/sh'; some picky hosts require this.
	Ensure we don't run as root; it would yield the wrong answers.
	Ensure the C compiler works on a trivial program first.
	Rename incoming environment variables to follow GNU makefile standards.
	Use $PREPARE_CC consistently.

	(_POSIX_C_SOURCE, <mach/mach.h>, <net/errno.h>, has_map_fd,
	bad_NFS_rename, has_si_errno, bad_wait_if_SIGCHLD_ignored):
	New configuration options.

	(has_sys_dir_h, text_equals_binary_stdio, text_work_stdio,
	FOPEN_R, FOPEN_W, FOPEN_WPLUS, has_caddr_t, DIFF3_A): Remove.

	(O_BINARY, OPEN_O_WRONLY, FOPEN_RB, FOPEN_R_WORK, FOPEN_WB,
	FOPEN_W_WORK, FOPEN_WPLUS_WORK): New macros, for -kb support.
	(bad_fopen_wplus): Use "w+", not FOPEN_WPLUS.

	(has_const, has_volatile): Rename test functions to avoid collisions.
	(has_fchmod, has_mmap, has_vfork): fileno(stdio) -> STDIN_FILENO.
	(has_fflush_input): Don't trust fflush's return value when testing.
	(has_mmap): Use MAP_FAILED if available.  Look at 0th byte, not last.
	Define to 0 if HP-UX 8.07 or 9.*, or SunOS 5.4 before patch 10.
	(has_psiginfo): Handler's 3rd arg is void *, as per Posix 1003.1b-1993.
	(has_varargs): Don't set if has_stdarg.
	(large_memory): Also define to 1 if has_map_fd.
	(mmap_signal): Don't try to deduce it if creat yields ETXTBSY.

	* conf.heg: Adjust to latest conf.sh.

	* rcsbase.h (SIZEABLE_PATH):
	Don't depend on PATH_MAX: it's not worth configuring.
	(Ioffset_type, BINARY_EXPAND, MIN_UNEXPAND, MIN_UNCHANGED_EXPAND):
	New macros.
	(maps_memory): New macro; replaces many instances of `has_mmap'.
	(cacheptr): Renamed from cachetell.
	(struct RILE): New alternate name for RILE; the type is now recursive.
	(deallocate): New member for RILE, used for generic deallocation.
	(cacheunget_): No longer take a failure arg; just call Ierror.
	(struct rcslock): Renamed from struct lock, to avoid collisions with
	system headers on some hosts.  All users changed.
	(basefilename): Renamed from basename, likewise.
	(dirtpname): Remove; no longer external.
	(dirlen, dateform): Remove; no longer used.
	(cmpdate, fopenSafer, fdSafer, readAccessFilenameBuffer): New fns.
	(zonelenmax): Increase to 9 for full ISO 8601 format.
	(catchmmapints): Depend on has_NFS.

	* rcstest: Add -kb test.
	`#!/bin/sh' -> `#! /bin/sh'; some picky hosts require this.
	(ALL_CFLAGS): Renamed from CFLAGS.
	(LIBS): Renamed from LDLIBS.
	(CL): Add explicit `-o a.out'.

Thu Apr 14 06:55:24 1994  Paul Eggert  <eggert@twinsun.com>

	* conf.sh:  Relax test for puts.  Improve test for mmap; don't
	rely on getpagesize, output better messages when it fails,
	don't assume you can mmap something larger than the file,
	output "SIGSEGV" if appropriate, add commentary.

Wed Apr 13 16:31:38 1994  Paul Eggert  <eggert@twinsun.com>

	* version.c: now 5.6.7.4 (beta); intermediate versions were PC-related.
	* rcstime.c: Don't dump core if there's no zone.
	* rlog.c: Fix bug; `rlog -lxxx' inverted the sense of -l.

Sun Mar 20 04:52:58 1994  Paul Eggert  <eggert@twinsun.com>

	* version.c: now 5.6.7 (beta)

	* ci.c: Do not remove the lock when `ci -l' reverts.
	Do not generate a corrupted RCS file if the user modifies
	the working file while `ci' is running.
	* ci.c, co.c:
	Move buffer-flushes out of critical sections, as they aren't critical.
	* ci.c, co.c, merger.c, rcs.c, rcsbase.h, rcsdiff.c, rcsmerge.c,
	rcsutil.c: Specify subprocess input via file descriptor, not file name.
	* ci.c, co.c, rcs.c, rcsclean.c, rcsedit.c:
	Use ORCSerror to clean up after a fatal error.

	* ident.c: Remove `exiting' from identExit.

	* rcs.c, rcsgen.c: Flush stderr after prompt.

	* rcsclean.c: Add void_closedir support.

	* rlog.c: Emulate -V4's white space generation more precisely.
	-d'<DATE' now excludes DATE; the new syntax -d'<=DATE' includes it.
	* rlog.c, rcsgen.c: Work around SVR4 stdio performance bug.

	* rcsbase.h: Add primitives for reading backwards from a RILE;
	this is needed to go back and find the $Log prefix.

	* partime.c: Don't include rcsbase.h; you only need conf.h.
	Fix `am/pm' parsing bug.  Update time zones.

	* rcsedit.c, rcsfcmp.c:
	Normally calculate the $Log prefix from context, not from RCS file.

	* rcsfcmp.c:
	Calculate line numbers correctly even if the $Log prefix contains \n.

	* rcsfnms.c: Strip trailing SLASHes from TMPDIR; some systems need it.

	* rcslex.c: Don't worry if madvise fails.  Add Orewind.

	* rcsutil.c: Move setmtime to rcsedit.c.
	Avoid messing with I/O buffers in the child process.
	Define dup in terms of F_DUPFD if it exists.

	* Makefile: Make sure $(DESTBINDIR) exists before installing.
	Remove core* (for BSDI), RCS/a.*.

	* conf.sh: Do errno checking before readlink checking.
	Check for GCC __attribute__ infelicities.
	Output a better error message for wait problems.
	Check for AIX 3.2.0 mmap bug.  Update HP-UX test.
	Fix SLASHes typo.  Add SEEK_CUR.  Configure off_t, has_fflush_input.
	Improve test for __attribute__((noreturn)).
	* conf.heg: Adjust to latest conf.sh.

	* rcstest: Port to BSD/386 1.1's /bin/sh brain damage.
	Test for new $Log behavior.

	* co.c, merge.c, merger.c, rcs.c, rcsbase.h, rcsdiff.c, rcsedit.c,
	rcsfcmp.c, rcsfnms.c, rcsgen.c, rcskeep.c, rcslex.c, rcsmerge.c,
	rcsrev.c, rcssyn.c, rcsutil.c, rlog.c: Remove lint.

Tue Nov  9 17:55:29 1993  Paul Eggert  <eggert@twinsun.com>

	* version.c: now 5.6.6 (beta)
	* merge.c, rcsclean.c, rcsutil.c, rlog.c:
	-V now prints version on stdout and exits.
	* ci.c, co.c, rcs.c, rcsdiff.c, rcsmerge.c:
	Likewise.  Don't print usage twice.
	* Makefile: Add -Dhas_conf_h, maketime.h, partime.h, rcstime.c.
	ident wants version.o.
	* conf.heg, conf.sh: gcc doesn't do constant expressions in
	__attribute__((format(...))).
	* conf.sh: Quote $dots.
	* ident.c: Add -V.
	* maketime.c: Move RCS-specific stuff into rcstime.c.
	* maketime.h, partime.h, rcstime.c: New files.
	* partime.c: Complete rewrite from scratch.
	* rcsbase.h: Move RCS-specific time handling into rcstime.c.
	printf_string now takes two arguments, alas.
	* rcskeep.c: Use simpler time zone parsing strategy
	now that we're using ISO 8601 format.
	* rcslex.c: Fix `label: }' typo.
	* rcsrev.c: Fix format string typos.

Wed Nov  3 18:25:07 1993  Paul Eggert  <eggert@twinsun.com>

	* version.c: Initial revision; now 5.6.5 (beta)

	* ci.c, co.c, rcs.c, rcsdiff.c, rcsclean.c, rcsedit.c, rcsmerge.c,
	rcsrev.c, rlog.c: Add -z.

	* ci.c: Don't subtract from RCS file timestamp even if -T.
	Scan for and use Name keyword if -k.
	* ci.c, rcs.c, rcsbase.h, rcsgen.c, rcslex.c, rcssyn.c:
	Don't discard ignored phrases.
	* ci.c, co.c, rcs.c, rcsbase.h, rcsclean.c, rcsdiff.c, rcsfnms.c,
	rcsgen.c, rcskeep.c, rcslex.c, rcsrev.c, rcssyn.c:
	Improve quality of diagnostics.

	* co.c: Generate a value for the Name keyword.
	* co.c, rcsbase.h: Don't arbitrarily limit the number of joins.

	* ident.c: Test for char == EOF, not char < 0.

	* rcs.c: Don't lose track of -m or -t when there are no other changes.

	* rcsdiff.c: Put revision numbers in -c output.
	* rcsdiff.c, rcsbase.h, rcsedit.c, rcskeys.c: Add Name keyword.
	* rcsdiff.c, rcsmerge.c: Pass -Vn to `co'.
	* rcsdiff.c, rcsmerge.c, rlog.c: Ignore -T.

	* rcsmerge.c:
	Pass unexpanded revision name to `co', so that $Name works.
	* rcsmerge.c, rcsbase.h, merge.c, merger.c:
	Add -A, -E, -e.  Allow up to three labels.

	* rlog.c: Add -N.

	* rcsbase.h: Remove `nil'.  Improve quality of prototypes.

	* partime.c: Simplify time zone table.

	* rcsedit.c: If bad_unlink, ignore errno when unlink fails.
	Escape white space, $, and \ in keyword string file names.
	Don't output 2 spaces between date and time after Log.

	* rcskeep.c: Scan for Name keyword.

	* rcsfnms.c: Determine whether a file name is too long indirectly,
	by examining inode numbers, instead of trying to use operating system
	primitives like pathconf, which are not trustworthy in general.
	File names may now hold white space or $.
	Do not flatten ../X in pathnames; that may be wrong for symlinks.
	Add getabsname hook.

	* rcsfcmp.c:
	Fix yet another off-by-one error when comparing Log string expansions.

	* rcsrev.c: Add `namedrev' for Name support.
	Revision `.N' now stands for `D.N', where D is the default branch.

	* rcssyn.c: Parse MKS dates; ignore \r in diff control lines.

	* rcsutil.c: Use psiginfo and setreuid if available.
	Move date2str to maketime.c.

	* Makefile: Fix DIFF3_A default.

	* conf.sh: Update for RCS 5.6.5 (much better configuration messages).
	* conf.heg: Adjust to latest conf.sh.

	* rcstest: Compile our own program instead of using `tr'.
	Use rlog to get UTC instead of relying on `date -u'.
	Test `Name' keyword.

	* rcsfreeze.sh: Don't ignore RCS/.*,v files.

Tue Jun 29 17:03:43 1993  Paul Eggert  <eggert@twinsun.com>

	* maketime.c: Add -z support.  New function zone_set, date2str.
	str2time now has default_zone arg.  Parenthesize to keep GCC happy.

Tue Jul 28 16:12:44 1992  Paul Eggert  <eggert@twinsun.com>

	Version 5.6.4 (beta)

	* ci.c: Add -i, -j.  Check that working and RCS files are distinct.
	* ci.c, co.c, rcs.c, rcsclean.c, rcsdiff.c, rcsmerge.c, rcsutil.c,
	rlog.c: Add -V.

	* co.c, rcsclean.c: Check that working and RCS files are distinct.

	* rcs.c: rcs -l now asks whether you want to break the lock.
	Set RCS file's mode and time at right moment.

	* rcsclean.c: Fix -n bugs.

	* rcsdiff.c: Use co -M for better dates with traditional diff -c.

	* rlog.c: Don't miss B.0 when handling branch B.
	Diagnose missing `,' in -r.
	* rlog.c, rcsedit.c, rcslex.c, rcsrev.c, rcssyn.c:
	Avoid `unsigned'; this avoids the ULONG_MAX/10 configuration problem.
	* rlog.c, rcsbase.h, rcsedit.c, rcsgen.c rcsfcmp.c, rcskeep.c, rcslex.c,
	rcssyn.c: Statement macro names now end in _.

	* partime.c: Fix time zones again.

	* rcsedit.c: Some hosts have readlink but not ELOOP.
	Preserve dates more systematically.

	* rcsgen.c, rcsfnms.c: Be consistent about pathnames vs filenames.

	* rcsfnms.c: Add .sty.  .pl now implies Perl, not Prolog.
	Fix fdlock initialization bug.  Check that $PWD is really ".".

	* rcslex.c, rcsrev.c:  Identifiers may now start with a digit and
	(unless they are symbolic names) may contain `.'.

	* rcsutil.c: has_sigaction overrides sig_zaps_handler.  Fix -M bug.
	Add mmap_signal, which minimizes signal handling for non-mmap hosts.

	* Makefile: Add BINDIR.  Update for GCC 2.  Redo configuration scheme.
	Add rcsvers.c.

	* conf.sh: Output more chatter to keep builders happy.
	Fix several portability bugs: fileno, readlink, readlink errno,
	HP-UX brain damage, execv, mmap, waitpid, same_file.  Remove ULONG_MAX.
	* conf.heg: Adjust to latest conf.sh.

	* rcstest: Test rcsclean.  rm -f a.c more often.
	*'! 1.1.1.1') -> *!\ 1.1.1.1) to avoid some shell bugs.
	Set PWD unconditionally.  Don't assume RCS knows date's time zone.
	Avoid `tr' if possible; it's not standardized well.

Sun May 31 08:29:18 1992  Paul Eggert  <eggert@twinsun.com>

	* maketime.c:
	Complete rewrite from scratch, because we need to work even if
	the underlying implementation has leap seconds.

	* partime.c: The special time zone LOCAL_TIME+1 now tells maketime
	that no zone was given.

Mon Feb 17 23:02:28 1992  Paul Eggert  <eggert@twinsun.com>

	Version 5.6.3 (beta)

	* ci.c, co.c, rcs.c, rcsbase.h, rcsclean.c, rcsedit.c, rcsutil.c:
	Add -T.
	* ci.c: `-rREV' now just specifies a revision REV;
	only bare `-r' reverts to default.

	* rcsdiff.c: Output more readable context diff headers.
	Suppress needless checkout and comparison of identical revisions.

	* maketime.c:
	When setting a file's modification time, set its access time to now.

	* rcsbase.h, rcslex.c, rcsutil.c: Work around NFS mmap SIGBUS problem.

	* rcsfnms.c: `a/RCS/b/c' is now an RCS file with an empty extension,
	not just `a/b/RCS/c'.

	* conf.sh: Add has_utimbuf to avoid echo line length limit.
	Some sigactions don't allow 2nd arg of type struct sigaction const *.
	* conf.heg: Adjust to latest conf.sh.

	* rcsfreeze.sh: Use `rcs -nN:' to simplify the code.

Mon Jan 27 16:42:53 1992  Paul Eggert  <eggert@twinsun.com>

	Version 5.6.2 (beta)

	* ci.c: Always unlock branchpoint if caller has a lock.
	* ci.c, conf.sh, rcsedit.c: Support bad_chmod_close.
	* ci.c, co.c, conf.sh, rcs.c, rcsbase.h, rcsclean.c, rcsedit.c,
	rcsfnms.c, rcsgen.c: Support bad_creat0.
	* ci.c, co.c, ident.c, merge.c, rcs.c, rcsbase.h, rcsclean.c,
	rcsdiff.c, rcsmerge.c, rlog.c, rcsutil.c: lint -> RCS_lint

	* rcs.c: Add -M.
	Avoid invoking umask(); it's one less thing to configure.

	* rcsdiff.c: Add GNU diff 1.15.2's new options.

	* rlog.c: Don't duplicate unexpected_EOF's function.

	* maketime.c: Fix day of week bug with dates after February 28, 2100.

	* rcsfnms.c: Fix bug: Expand and Ignored weren't reinitialized.
	Avoid `char const c=ch;' compiler bug.

	* rcsgen.c: Move put routines here from rcssyn.c.
	* rcssyn.c: Move put routines to rcsgen.c.

	* rcsutil.c: Work around NFS mmap bug that leads to SIGBUS core dumps.

	* Makefile: Add DESTRCSDIR.  lint -> RCS_lint

	* conf.sh: Add workaround for `volatile sig_atomic_t' screwups,
	and for Ultrix 4.2 prototype brain damage.
	* conf.heg: Adjust to latest conf.sh.

Thu Jan  9 19:02:09 1992  Paul Eggert  <eggert@twinsun.com>

	* Makefile: $(LDLIBS) -o $@ -> -o $@ $(LDLIBS) to keep MS-DOS happy.

Mon Jan  6 03:04:24 1992  Paul Eggert  <eggert@twinsun.com>

	Version 5.6.1 (beta)

	* ci.c: Invoke utime() before chmod() to keep some buggy systems happy.

	* co.c, merge.c, rcsdiff.c, rcsmerge.c, rlog.c: Update usage string.

	* rcs.c:
	Avoid changing RCS file in common cases where no change can occur.

	* rcsbase.h, rcsedit.c, rcsfnms.c, rcsrev.c, rcssyn.c, rcsutil.c,
	rlog.c: while (E) ; -> while (E) continue;

	* rcsedit.c: Add setmode parameter to chnamemod.
	addsymbol now reports changes.

	* rcsfnms.c: Shorten long (>31 chars) name.

	* rcslex.c: Use OPEN_O_BINARY if mode contains 'b'.
	* rcsutil.c: O_BINARY -> OPEN_O_WORK

	* rcssyn.c: ULONG_MAX/10 -> ULONG_MAX_OVER_10

	* Makefile: Remove obsolete AIX comment.  sh -> $(SHELL).

	* conf.sh: Simplify MS-DOS port; work around several porting anomalies.
	* conf.heg: Adjust to latest conf.sh.

	* rcstest: mkdir RCS if it doesn't already exist.

Wed Nov 20 18:21:10 1991  Paul Eggert  <eggert@twinsun.com>

	Version 5.6 released.
	* ci.c, rcs.c: Don't read the delta tree from a nonexistent RCS file.
	* rcsmerge.c: Don't Iopen(f, "r+"); it's not portable.
	* conf.sh, conf.heg: Remove FOPEN_RPLUS.
	* rcstest: Test for rcs -i -A bug.

Sun Nov  3 03:30:44 1991  Paul Eggert  <eggert@twinsun.com>

	* rcsclean.c:
	Don't remove working files that look like they are checked out.

	* rcsedit.c: Move the warning about link breaking
	to where they're actually being broken.

	* rcslex.c: Fix porting bug to ancient hosts lacking vfprintf.

	* conf.sh: Detect yet another const compiler bug.
	Don't declare args to mmap, strchr, strrchr, in case they disagree.

Mon Oct  7 17:32:46 1991  Paul Eggert  <eggert@twinsun.com>

	* ci.c, rcs.c, rcsdiff.c: Remove lint.
	* ci.c, rcsgen.c: Fix log bugs, e.g. ci -t/dev/null when has_mmap.
	* co.c: -k affects just working file, not RCS file.
	* rcsfcmp.c: Count log lines correctly.
	* conf.sh: Add declare_signal, large_memory, O_EXCL.  Remove creat.
	* conf.heg: Adjust to latest conf.sh.
	* rcsbase.h, rcsedit.c, rcslex.c, rcsutil.c:
	Support piece tables even if !has_mmap.
	* rcsedit.c: Fix rare NFS bugs.
	* Makefile: Fix Minix description.

Thu Sep 26 23:10:30 1991  Paul Eggert  <eggert@twinsun.com>

	* ci.c: Plug file descriptor leak.

Tue Sep 24 00:49:12 1991  Paul Eggert  <eggert@twinsun.com>

	* rcsfnms.c: Don't export bindex().
	* rcslex.c: Don't export Ierror(), errsay().
	* rcsbase.h: Remove unexported functions.
	* Makefile: Put MS-DOS support into a separate distribution.

Wed Sep 18 07:29:10 1991  Paul Eggert  <eggert@twinsun.com>

	* ci.c: Work around a common ftruncate() bug.

Tue Sep 17 19:07:40 1991  Paul Eggert  <eggert@twinsun.com>

	* rlog.c: Getscript() didn't uncache partial lines.
	* rcsedit.c: SGI readlink() yields ENXIO, not EINVAL, for nonlinks.

Tue Sep 10 22:36:26 1991  Paul Eggert  <eggert@twinsun.com>

	* ci.c, rcsgen.c: Fix test for redirected stdin.

	* ident.c: Open files with FOPEN_R, not FOPEN_R_WORK,
	because they might be executables, not working files.

	* conf.heg: Adjust to latest conf.sh.

	* Makefile: Prepend $(DIFFPREFIX). to PATH.
	Adjust `make clean' for DOS.

Wed Aug 21 00:29:52 1991  Paul Eggert  <eggert@twinsun.com>

	* rcstest: Fix test for non-text diffs; it missed some botched diffs.

Tue Aug 20 23:05:00 1991  Paul Eggert  <eggert@twinsun.com>

	* merger.c: Fix !DIFF3_BIN porting bug.
	* conf.sh: Fix porting bugs for #include, SENDMAIL, pwd,
	cc with wrong exit status.

Mon Aug 19 23:17:54 1991  Paul Eggert  <eggert@twinsun.com>

	* ci.c: When there are no changes,
	revert to previous revision instead of aborting.
	* ci.c, co.c, rcs.c: Add -M.
	* ci.c, rcs.c, rcsbase.h, rcsedit.c, rcsgen.c: Add piece tables.
	* ci.c, rcs.c, rcsdiff.c, rcsmerge.c, rcsrev.c: Add -r$.
	* ci.c, co.c, merge.c, rcs.c, rcsbase.h, rcsdiff.c, rcsedit.c,
	rcsfcmp.c, rcsfnms.c, rcsgen.c, rcskeep.c, rcslex.c, rcsmerge.c,
	rcsrev.c, rcssyn.c, rcsutil.c, rlog.c: Tune.

	* co.c: Warn before removing somebody else's file.
	Fix co -j bugs.

	* ident.c: Report read errors immediately.

	* merge.c: Remove lint.

	* rcs.c, rlog.c: Revision separator is `:', not `-'.

	* rcsclean.c: Rewrite from scratch.

	* rcsdiff.c: Add RCSINIT.

	* rlog.c: Check for missing and duplicate logs.
	Permit log messages that do not end in newline (including empty logs).

	* rcskeys.c: Say `T const' instead of `const T';
	it's less confusing for pointer types.
	(This change was made in other source files too.)

	* rcslex.c: Add eoflex(), mmap support.

	* rcsrev.c: Add `-rB.'.  Remove botches like `<now>' from messages.

	* conf.sh: Add ALL_ABSOLUTE, FOPEN_RPLUS, ftell, getlogin_is_secure,
	RCS_SHELL, sigmask, strchr, TZ_must_be_set.
	Add checks for dirent, ftruncate, link, madvise, memcmp, memcpy,
	memmove, mmap, spawn, wait, utimbuf.
	Improve checks for const/volatile, va_start.
	Remove atoi, has_utime, strncmp, strncpy.
	Make NEW_LINK_BEHAVIOR the default.
	sgi has seteuid.
	Don't try to guess the bad line number by parsing the error message.
	* conf.heg: Adjust to latest conf.sh.

	* maketime.c: Add setfiledate, str2time, TZ_must_be_set.

	* merger.c: Plug memory leak.

	* partime.c: Update time zones.

	* rcsbase.h, rcsedit.c: Add NFS bug workarounds.
	* rcsedit.c: Catch odd filenames.

	* rcsfnms.c: Fix messages when rcswriteopen fails.
	Look in $TMP and $TEMP if $TMPDIR isn't set.

	* rcsmap.c: Don't assume EOF == -1.

	* rcsutil.c: Add spawn() support.
	Explicate assumptions about getting invoker's name.
	Standardize user-visible dates.

	* Makefile: Improve hooks to make DOS makefile from Unix makefile.
	Switch to GNU diff as the default.  ${} -> $().

	* rcstest: Add test for reverting checkin.  Ease DOS ports.
	Add PATH warning.

Sat Jun 22 22:43:23 1991  Paul Eggert  <eggert@twinsun.com>

	* rcsclean.sh: Unlock the correct version.

Sun Apr 21 11:59:14 1991  Paul Eggert  <eggert@twinsun.com>

	* ci.c, co.c, rcsbase.h, rcs.c, rcsdiff.c, rcsedit.c,
	rcsfnms.c, rcsmerge.c, rlog.c: Add -x, RCSINIT.
	* ci.c, co.c, conf.sh, Makefile, rcsbase.h, rcs.c, rcsdiff.c,
	rcsedit.c, rcsfcmp.c, rcsfnms.c, rcsgen.c, rcslex.c, rcsmerge.c,
	rcssyn.c, rlog.c: Add MS-DOS support.
	* ci.c, co.c: Ensure that working file is newer than RCS file
	after co -[lu].

	* merge.c, merger.c: Initial revision
	* partime.c: Don't put , just before } in initializer.
	* rcsedit.c, rcsfcmp.c, rcsfnms.c, rcssyn.c: Fix errno bugs.
	* rcskeep.c, rcssyn.c: Disambiguate names on shortname hosts.
	* rcskeys.c, rcsmap.c: Don't put , just before } in initializer.
	* rcsrev.c: Add tiprev().
	* rcsutil.c: Plug setuid security hole.
	* conf.sh, conf.heg: Fix several reported bugs.
	* rcstest: Fix porting bugs.
	* rcsfreeze.sh: Port to broken shells.

Sun Mar 17 05:42:57 1991  Paul Eggert  <eggert@twinsun.com>

	* rcsclean.sh: Support RCS file names.  Add -n.

Thu Feb 28 19:18:53 1991  Paul Eggert  <eggert@twinsun.com>

	* ci.c: Don't let a setuid ci create a new RCS file;
	rcs -i -a must be run first.
	Fix ci -ko -l mode bug.  Open work file at most once.

	* rcsbase.h, conf.sh, conf.heg: Try setuid() if seteuid() doesn't work.

	* rcsfcmp.c: Open work file at most once.

	* rcssyn.c: Fix null termination bug in reporting keyword expansion.

	* rcsutil.c: Try setuid() if seteuid() doesn't work.
	Check the results more carefully.

	* Makefile: Remove setuid installation -- it's now up to the users.

Tue Feb 26 17:48:39 1991  Paul Eggert  <eggert@twinsun.com>

	* ci.c: getdate -> getcurdate (SVR4 name clash)

	* ident.c: Don't report empty keywords.  Check for I/O errors.

	* rcs.c: 0444 -> S_IRUSR|S_IRGRP|S_IROTH for portability
	* rcs.c, rlog.c, rcslex.c, rcsutil.c:
	strsave -> str_save (DG/UX name clash)

	* rcsmerge.c: Merging a revision to itself is no longer an error.

	* rlog.c: Survive RCS files with missing logs.

	* rcsbase.h: Move ANSI C / Posix declarations into conf.sh.
	* rcsbase.h, rcsedit.c, rcsfnms.c: Support new link behavior.

	* rcsedit.c: Work around broken "w+" fopen.
	* rcsedit.c, rcsfnms.c, rcsutil.c: Fix setuid bug.

	* rcsfnms.c: Support tempnam.  Define more portable getcwd().

	* rcslex.c: Work around fputs bug.

	* rcsrev.c: Avoid overflow when comparing revision numbers.

	* rcssyn.c: Check diff output more carefully; avoid overflow.

	* rcsutil.c: Use fread, fwrite more portably.
	Support waitpid.  Don't assume -1 is acceptable to W* macros.

	* Makefile: Remove setgid support.  Add NEW_LINK_BEHAVIOR.

	* conf.sh: Revamp extensively for portability.
	* conf.heg: Adjust to latest conf.sh.

	* rcstest: Work even if diff -c and diff3 -E don't.
	Improve handling of binary files and bad locks.

Mon Dec 31 01:00:12 1990  Paul Eggert  <eggert@twinsun.com>

	Version 5.5 released.
	* ci.c: Don't use uninitialized storage when handling -{N,n}.

Sun Dec 30 05:07:35 1990  Paul Eggert  <eggert@twinsun.com>

	* rcsedit.c:
	Fix report of busy RCS files when !defined(O_CREAT) | !defined(O_EXCL).

Thu Dec 27 19:54:26 1990  Paul Eggert  <eggert@twinsun.com>

	* rcsgen.c: Fix bug: rcs -t inserted \n, making RCS file grow.

Tue Dec 18 17:19:21 1990  Paul Eggert  <eggert@twinsun.com>

	* rcs.c: Fix bug with multiple -n and -N options.

Thu Dec 13 06:54:07 1990  Paul Eggert  <eggert@twinsun.com>

	* rcsdiff.c, Makefile: GNU diff 1.15 has -u.

Tue Dec  4 05:18:49 1990  Paul Eggert  <eggert@twinsun.com>

	* ci.c, co.c, rcs.c, rcsbase.h, rcsgen.c, rcslex.c, rcsutil.c:
	Use -I for prompts and -q for diagnostics.

	* co.c: Don't checkaccesslist() unless necessary.

	* rcsutil.c: Don't output a blank line after a signal diagnostic.

Tue Nov 27 09:26:05 1990  Paul Eggert  <eggert@twinsun.com>

	* rcsfcmp.c: Fix comment leader bug.

Sun Nov 11 00:06:35 1990  Paul Eggert  <eggert@twinsun.com>

	* rcs.c: Fix `rcs -e' core dump.

Mon Nov  5 20:30:10 1990  Paul Eggert  <eggert@twinsun.com>

	* ci.c: Don't remove working file when aborting due to no changes.

Thu Nov  1 05:28:48 1990  Paul Eggert  <eggert@twinsun.com>

	* ci.c, rcs.c: Add -I and new -t behavior.
	* ci.c, rcs.c, rcsbase.h, rcsedit.c, rcsgen.c, rcsfcmp.c, rcsfnms.c,
	rcssyn.c, rlog.c: Permit arbitrary data in logs and comment leaders.

	* co.c: Fix -j.  Add -I.

	* merge.sh: Yield exit status 2 on error like the man page says.

	* rcsdiff.c, rcsmerge.c, rcsutil.c: Remove unneeded setid check.

	* maketime.c: Remove lint.

	* rcsbase.h: Don't assume that builtins are functions;
	they may be macros.

	* rcsgen.c: Add -I and new -t behavior.

	* rcslex.c, rcssyn.c:
	When ignoring unknown phrases, copy them to the output RCS file.

	* rcssyn.c: Don't check for nontext on initial checkin.

	* rcsutil.c: Add awrite(), fremember().

	* Makefile: Add test and debug instructions.
	Remove unwieldy "make depend" stuff.

	* conf.sh: Use better guess for Posix 1003.1-1990 seteuid() behavior.
	(A real test would requiring running conf.sh setid.  Ugh!)
	Use test for vfork() that detects GCC 1.37.1+sparc and IRIX bugs.
	Use better test for const and volatile.
	User better test for include files; just running cpp isn't enough,
	because the include files may be buggy.
	Don't assume that builtins are functions; they may be macros.
	Remove DIFF_ARBITRARY.
	* conf.heg: Initial revision

	* rcsclean.sh: Basically a complete rewrite.  Add rcsdiff options.
	Clean working directory if no arguments are given.

	* rcsfreeze.sh: Check for errors better.
	Remove the need for one of the temporary files.

Sat Oct  6 00:16:45 1990  Paul Eggert  <eggert@twinsun.com>

	* rcsutil.c: Don't fread F if feof(F).

Thu Oct  4 06:30:22 1990  Paul Eggert  <eggert@twinsun.com>

	* ci.c, co.c, rcs.c, rcsdiff.c, rlog.c:
	Accumulate exit status across files.

	* maketime.c: Don't assume time_t is 32 bits.
	Calculate the GMT offset of 'xxx LT' as of xxx, not as of now.
	Fix bugs near epoch and near end of time.

	* partime.c: Check for overflow when lexing an integer.
	Remove date vs time heuristics that fail between 2000 and 2400.
	Parse 'Jan 10 LT' as 'Jan 10, LT', not 'Jan, 10 LT'.

	* rcskeep.c: Parse time zone offsets;
	future RCS versions may output them.

Thu Sep 27 01:31:43 1990  Paul Eggert  <eggert@twinsun.com>

	* rcsdiff.c: Yield 1, not EXIT_FAILURE, when diffs are found.
	* rcsbase.h, conf.sh: Port wait() to non-Posix ANSI C hosts.
	* conf.sh: Test for vfork() file descriptor screwup.

Tue Sep 25 20:11:46 1990  Adam Hammer  <hammer@cs.purdue.edu>

	* ci.c: fixed another small typo

Mon Sep 24 18:56:31 1990  Paul Eggert  <eggert@twinsun.com>

	* partime.c: Update time zones.

Fri Sep 21 06:16:38 1990  Adam Hammer  <hammer@cs.purdue.edu>

	* ci.c: made it handle multiple -{N,n}'s.
	Also, made it treat re-directed stdin the same as the terminal

Thu Sep 20 07:58:32 1990  Paul Eggert  <eggert@twinsun.com>

	* ci.c: ci -k now checks dates more thoroughly.

	* merge.sh: Fix bug in passing arguments to old diff3 programs.
	Fix calculation of #!/bin/sh header.

	* rcskeep.c: ci -k now checks dates more thoroughly.

	* rcssyn.c:
	Remove the test for non-text bytes; it caused more pain than it cured.

	* conf.sh: Calculate signal_type more reliably on older systems.

	* rcstest: Adjust to old and brain damaged diffs.

Sat Sep 15 01:29:51 1990  Paul Eggert  <eggert@twinsun.com>

	* conf.sh: Output header warning that it's generated automatically.

Tue Sep 11 02:41:16 1990  Paul Eggert  <eggert@twinsun.com>

	* ci.c: Fix revision bug with `ci -k file1 file2'.
	* co.c: co -kv yields a readonly working file.
	* rcsdiff.c: Simplify -kkvl test.
	* rlog.c: Plug memory leak.
	* rcsedit.c: Tune expandline().
	* rcsfcmp.c: Don't ignore differences in keyword strings if -ko is set.
	* Makefile: Don't make -R the default.

Tue Sep  4 17:07:19 1990  Paul Eggert  <eggert@twinsun.com>

	* ci.c: Permit adjacent revisions with identical time stamps
	(possible on fast hosts).
	* ci.c, rcsbase.h, rcsedit.c: Improve incomplete line handling.
	* ci.c, co.c, rcs.c, rcsbase.h, rcsgen.c:
	Standardize yes-or-no procedure.

	* rcsdiff.c: Diff's argv was too small by 1.

	* rlog.c, rcsedit.c, rcslex.c, rcssyn.c: Count RCS lines better.

	* rcsmerge.c: Check for I/O error when reading working file.

	* partime.c: Don't permit 'Aug Aug'.
	Don't parse two-digit years, because it won't work after 1999/12/31.

	* rcsbase.h: Don't redefine NAME_MAX, PATH_MAX.

	* rcsfnms.c: Fix typo when !RCSSEP.

	* rcsgen.c: Fix `co -p1.1 -ko' bug.

	* rcssyn.c: Parse RCS files with no revisions.
	Don't strip leading white space from diff commands.

	* rcsutil.c: Store fread()'s result in an fread_type object.

	* conf.sh: Don't include <stdarg.h> unless has_prototypes is set.

	* rcstest: Test -kkv, etc.
	Work even when today's day of the month is less than 10.

Wed Aug 29 07:14:52 1990  Paul Eggert  <eggert@twinsun.com>

	* ci.c: Expand locker value like co.
	* ci.c, rcs.c, rcsbase.h, rcsfcmp.c, rcsgen.c, rcssyn.c:
	Clean old log messages too.

	* merge.sh: Add -q.

	* rcs.c: Remove unused setuid support.

	* rcsdiff.c, rcsbase.h rcsedit.c, rcssyn.c: Add -kkvl.

	* rcsmerge.c: Add -q.  Pass -L options to merge.

	* partime.c: Be able to parse our own date format.
	Don't assume year<10000.

	* rcsbase.h: Fix type typos exposed by porting.

	* rcsedit.c:
	Fix bug when getting revisions to files ending in incomplete lines.
	Fix bug in comment leader expansion.

	* rcsfnms.c, rcslex.c:
	Work around buggy compilers with defective argument promotion.

	* rcsutil.c: Declare getpwuid() more carefully.

	* Makefile: Remove -g from default CFLAGS.

	* conf.sh: Fix porting bugs.  Add sanity checks and better doc strings.

	* rcstest: Initial revision

Wed Aug 22 08:49:14 1990  Paul Eggert  <eggert@twinsun.com>

	* ci.c: Don't pass +args to diff.
	* ci.c, co.c, rcsbase.h, rcsdiff.c, rcsedit.c, rcskeys.c, rcssyn.c:
	Add -k.
	* ci.c, co.c, rcs.c, rcsbase.h, rcsdiff.c, rcsedit.c, rcsmerge.c,
	rcsutil.c, rlog.c: Add -V.
	* ci.c, co.c, ident.c, rcs.c, rcsbase.h, rcsdiff.c, rcsedit.c,
	rcsfnms.c, rcsgen.c, rcskeep.c, rcslex.c, rcsmerge.c, rcsrev.c,
	rcssyn.c, rcsutil.c, rlog.c:
	Remove compile-time limits; use malloc instead.
	* ci.c, co.c, rcs.c, rcsbase.h, rcsdiff.c, rcsutil.c, rlog.c:
	Add setuid support.
	* ci.c, rcsedit.c, rcskeep.c, rcssyn.c: Don't require a final newline.
	* ci.c, co.c, rcs.c, rcsdiff.c, rcsedit.c, rcsfnms.c, rcsmerge.c:
	Make lock and temp files faster and safer.
	* ci.c, co.c, maketime.c, rcs.c, rcsedit.c, rcsfnms.c, rcskeep.c,
	rcsutil.c: Permit dates past 1999/12/31.
	* ci.c, co.c, rlog.c, maketime.c, partime.c, rcsutil.c, Makefile:
	Switch to GMT and fixed the bugs exposed thereby.
	* ci.c, rcs.c, rcsedit.c, rcssyn.c: Check diff's output.
	* ci.c, co.c, rcsbase.h, rcsutil.c: Remove snooping.
	* ci.c, co.c, rcs.c, rcsfnms.c, rcskeep.c, rcsmerge.c, rcsrev.c,
	rcssyn.c, rcsutil.c: Tune.
	* ci.c, co.c, ident.c, maketime.c, partime.c, rcs.c, rcsbase.h,
	rcsdiff.c, rcsedit.c, rcsfcmp.c, rcsfnms.c, rcsgen.c, rcskeep.c,
	rcskeys.c, rcslex.c, rcsmerge.c, rcsrev.c, rcssyn.c, rcsutil.c, rlog.c:
	Ansify and Posixate.

	* co.c, rcsutil.c: Permit multiple locks by same user.

	* ident.c: Don't limit output to known keywords.
	* ident.c, rcs.c, rcsfcmp.c, rcsrev.c, rcssyn.c: Remove lint.

	* merge.sh: Become a shell file that outputs the needed shell file.
	Support GNU diff3.  Add -L.

	* rcs.c: Don't lose names when applying -a option to multiple files.
	Fix umask bug.  Yield proper exit status.

	* rcsdiff.c: Don't pass arguments with leading '+' to diff;
	GNU DIFF treats them as options.  Add GNU diff's flags.
	* rcsdiff.c, rcsbase.h, rcsmerge.c, rcsfnms.c: Don't use access().

	* rcsmerge.c: Propagate merge's exit status.

	* rlog.c:
	Report dates in long form, to warn about dates past 1999/12/31.
	Change "added/del" message to make room for the longer dates.
	* rlog.c, rcsedit.c: Don't generate trailing white space.

	* partime.c: Update time zones.  Fix peekahead and int-size bugs.

	* rcsbase.h: Adjust ANSI C / Posix support.  Remove v2 support.
	* rcsbase.h, rcslex.c, rcssyn.c: Add support for ISO 8859.

	* rcsedit.c, rcsfcmp.c: Don't append "checked in with -k by " log to
	logs, so that checking in a program with -k doesn't change it.

	* rcsfnms.c: Ignore signals when manipulating the semaphore file.
	Modernize list of file name extensions.
	Beware file names beginning with "-".
	Fix test for non-regular files.

	* rcskeep.c: Retrieve old log message if there is one.

	* rcslex.c: Report errno-related errors with perror().
	Use better hash function.

	* rcsrev.c: Remove possibility of an internal error.

	* rcssyn.c: Try to parse future RCS formats without barfing.
	Don't output branch keyword if there's no default branch,
	because RCS version 3 doesn't understand it.
	Check that a newly checked-in file is acceptable as input to 'diff'.

	* rcsutil.c: Some USG hosts define NSIG but not sys_siglist.
	Don't run /bin/sh if it's hopeless.
	Don't leave garbage behind if the output is an empty pipe.
	Clean up after SIGXCPU or SIGXFSZ.
	Print name of signal that caused cleanup.

	* Makefile: Configure more automatically.  Upgrade for RCS 5.0.

	* conf.sh, rcsmap.c: Initial revision

Wed May 23 06:54:32 1990  Paul Eggert  <eggert@twinsun.com>

	* Makefile: Make Posix the default; it's the wave of the future.
	Add advice for SunOS.  Remove references to rcsclean, rcsfreeze.

Thu Mar 22 07:06:14 1990  Paul Eggert  <eggert@twinsun.com>

	* merge.sh: Add support for GNU DIFF 1.15.

	* Makefile: Permit dates past 1999/12/31.  Ansify and Posixate.
	Remove snoop and v2 support.  Add <vfork.h> flag.

Sat Nov 18 13:34:16 1989  Adam Hammer  <hammer@cs.purdue.edu>

	Version 4.3 released.

Mon Oct 30 12:29:00 1989  Daniel Trinkle  <trinkle@cs.purdue.edu>

	* rcsclean.c:
	Added -q option to agree with man page, added code to actually unlock
	the RCS file if there were no differences, picked a bit of lint.

Wed Jun 28 12:56:23 1989  Paul Eggert  <eggert@twinsun.com>

	* rcsfnms.c:
	Prevent checkin of all non-regular files, not just directories.

Wed Jun 28 09:02:14 1989  Thomas Narten  <narten@cs.purdue.edu>

	Version 4.2 released.

Mon May  1 15:17:14 1989  Thomas Narten  <narten@cs.purdue.edu>

	changed copyright header to reflect current distribution rules

	* rcsbase.h: changed #include <strings.h> -> string.h for USG systems.
	* partime.c: fixed #ifdef DEBUG construct
	* rcsfnms.c: changed getwd to not stat empty directories.

Thu Dec  8 14:02:20 1988  Paul Eggert  <eggert@sm.unisys.com>

	* rcsfnms.c:
	Fix bug: "co -p .../RCS/dir,v" failed if ./dir is a directory.

Tue Nov  8 16:01:02 1988  Thomas Narten  <narten@cs.purdue.edu>

	* ci.c: changes from root@seismo.CSS.GOV (Super User)
	-d with no arguments uses the mod time of the file it is checking in

	* rcs.c: removed include <sysexits.h> (not needed)
	minor fix for -A option

	* rcsbase.h: removed defs for functions loaded from libraries
	* maketime.c: allow negative time zones (-24h <= x <= 24h)
	* rcsedit.c: misplaced semicolon caused infinite loop
	* rcsutil.c: corrected use of varargs routines

Sun Aug 28 15:09:38 1988  Paul Eggert  <eggert@sm.unisys.com>

	* Makefile: 'make depend' now discards /usr/include/*
	(#ifdefs may comment around them).
	Use sed rather than ex for portability.  Remove obsolete comments.
	Separate LINTFLAGS.  Use LDFLAGS consistently.
	Edit DIFF in merge.sh.  Use execv(), not system(); allow cc -R.
	Permit signal handlers to yield either 'void' or 'int'.

	* rcslex.c:
	Don't loop when writing error messages to a full filesystem.
	Flush stderr/stdout when mixing output.
	Yield exit status compatible with diff(1).
	Shrink stdio code size; allow cc -R; remove lint.

	* rcsgen.c: Shrink stdio code size; allow cc -R; remove lint;
	isatty() -> ttystdin()

	* partime.c: Remove unportable "#endif XXX"s.

	* maketime.c: Allow cc -R.  Remove unportable "#endif XXX"s.

Tue Aug  9 19:13:28 1988  Paul Eggert  <eggert@sm.unisys.com>

	* ci.c: Remove lint.
	isatty(fileno(stdin)) -> ttystdin()
	Make sure workfile is a regular file;
	use its mode if RCSfile doesn't have one.
	* ci.c, rcsdiff.c, rcsedit.c: Allow cc -R.

	* co.c: Fix "co -d" core dump; rawdate wasn't always initialized.
	fix putchar('\0') and diagnose() botches.
	* co.c, rcs.c, rcsbase.h, rcskeep.c, rcssyn.c, rlog.c: Remove lint.

	* merge.sh:
	Check and yield proper exit status; keep temporary files private;
	economize to avoid a temporary file; fix "1 overlaps";
	keep '.' out of PATH.

	* rcsdiff.c, rcsmerge.c: Yield exit status like diff(1)'s.

	* rcsmerge.c: Beware merging into a readonly file.
	Beware merging a revision to itself (no change).

	* rcs.c: Don't access freed storage.
	Yield proper exit status.

	* rlog.c: Check for memory exhaustion; don't access freed storage.
	Shrink stdio code size.
	* rlog.c, rcsutil.c: Check for memory exhaustion.

	* rcsbase.h: Permit -Dhshsize=nn.
	* rcsbase.h, rcsedit.c, rcsfcmp.c: Shrink stdio code size.

	* rcskeep.c: Speed up by making FILE *fp local, not global.

	* rcsutil.c:  Permit signal handlers to yield either 'void' or
	'int'; fix oldSIGINT botch.  Yield exit status like diff(1)'s.

Wed Jul 27 00:31:11 1988  Paul Eggert  <eggert@sm.unisys.com>

	* merge.sh: RCS version 4

Thu Jun 23 16:06:55 1988  Paul Eggert  <eggert@sm.unisys.com>

	* sig_t.sh: Initial revision

Fri Dec 18 17:06:41 1987  Thomas Narten  <narten@cs.purdue.edu>

	* ci.c, co.c, rcs.c, rcsfcmp.c, rcskeep.c, rcssyn.c, rlog.c:
	lint cleanups (from Guy Harris)

	* rcsdiff.c:  changes Jay Lepreau made in the 4.3 BSD version,
	to add support for "-i", "-w", and "-t" flags and to permit
	flags to be bundled together, merged in.

	* maketime.c: include rcsparam.h

	* rcsbase.h: made removed BSD ifdef, now uses V4_2BSD

	* rcsedit.c:
	Changes from the 43. version. Don't know the significance of the
	first change involving "rewind". Also, additional "lint" cleanup.
	(Guy Harris)

	* rcsfnms.c:
	additional file types added from 4.3 BSD version, and SPARC assembler
	comment character added. Also, more lint cleanups. (Guy Harris)

	* rcsgen.c:
	additional lint cleanups, and a bug fix from the 4.3BSD version that
	keeps "ci" from sticking a '\377' into the description if you run it
	with a zero-length file as the description. (Guy Harris)

	* rcslex.c: fixed to use "varargs" in "fprintf";
	this is required if it is to work on a SPARC machine such as a Sun-4

	* rcsrev.c: more lint cleanups.
	Also, the NOTREACHED comment is no longer necessary,
	since there's now a return value there with a value. (Guy Harris)

	* Makefile: RCS version 4.0's Makefile

	* rcsfreeze.sh: Initial revision

Mon Nov 23 16:06:50 1987  Paul Eggert  <eggert@sm.unisys.com>

	* Makefile: Permit signal handlers to yield either 'void' or 'int'.

Fri Oct 23 17:09:57 1987  Thomas Narten  <narten@cs.purdue.edu>

	* ident.c: added exit(0) so exit return code would be non random

Tue Sep 15 16:39:39 1987  Roy Morris  <...!felix!roy>

	* rcsedit.c: added an initialization of the variables editline and
	linecorr; this will be done each time a file is processed.
	(there was an obscure bug where if co was used to retrieve multiple
	files it would dump)

Sun Oct 18 10:40:22 1987  Thomas Narten  <narten@cs.purdue.edu>

	Updating version numbers.
	Changes relative to revision 1.1 are actually relative to 4.x.

Mon Aug 24 13:57:19 1987  Thomas Narten  <narten@cs.purdue.edu>

	Sources now pass through lint
	(if you ignore printf/sprintf/fprintf warnings).

Mon Aug 10 11:52:53 1987  Paul Eggert  <eggert@sm.unisys.com>

	* co.c: 'co -d' dumped core; this fixes it.

Thu Jul  9 09:20:52 1987  Daniel Trinkle  <trinkle@cs.purdue.edu>

	* ident.c: Added check to make sure there is at least one arg
	before comparing argv[1] with "-q".  This necessary on machines
	that don't allow dereferencing null pointers (i.e. Suns).

Mon Jun 22 13:52:35 1987  Paul Eggert  <eggert@sm.unisys.com>

	* Makefile:
	Allow cc -R; add rclm; add $(LDFLAGS) when linking anything

	* rcs.c, rlog.c: Don't access freed storage.

	* rcs.c: If you lack locks, "rcs -u" now breaks the newest lock
	regardless of owner.

Fri Mar 27 14:21:53 1987  jenkins  <jenkins@cs.purdue.edu>

	Port to suns

Mon Mar 23 12:01:04 1987  Paul Eggert  <eggert@sm.unisys.com>

	* ci.c, co.c, rcs.c, rcsdiff.c, rcsmerge.c, rcsutil.c:
	Use execv(), not system(); yield proper exit status.
	* co.c: fix putchar('\0') and diagnose() botches.
	* rcsutil.c: Fix bug: catchints() didn't work if ignoreints()
	had already been called.
	* rcsmerge.c: Beware merging into a readonly file.
	Beware merging a revision to itself (no change).
	* rcsbase.h: Shrink stdio code size; remove lint; vfork=fork on USG
	* merge.sh:
	Check and yield proper exit status; clean up if interrupted;
	keep temporary files private; fix "1 overlaps" message.
	* ci.c, rcsdiff.c: Allow cc -R.
	* co.c, rcs.c: Remove lint.

Tue Mar 17 17:27:32 1987  loverso  <loverso@cs.purdue.edu>

	* ci.c: Don't allow non-regular files (directories, etc)
	to be checked in.

Mon Mar  9 17:11:52 1987  Paul Eggert  <eggert@sm.unisys.com>

	* rcsedit.c: Shrink stdio code size; allow cc -R.
	Fix linecorr botch: dumped core on Suns sometimes on 'co -rold f1 f2'.

Fri Feb 13 11:28:51 1987  Paul Eggert  <eggert@sm.unisys.com>

	* rlog.c: Add -W flag.
	* rcslex.c: Don't loop when writing error messages to a full filesystem
	Flush stderr/stdout when mixing output.
	Yield exit status compatible with diff(1).
	* rcsgen.c, rcslex.c, rlog.c: Allow cc -R; remove lint.
	* rcsfcmp.c, rcsgen.c, rcslex.c, rlog.c: Shrink stdio code size.

Thu Feb 12 18:24:19 1987  Paul Eggert  <eggert@sm.unisys.com>

	* ident.c: Add -efghi flags.
	* maketime.c, rcsfnms.c, rcssyn.c, sccstorcs.c: Allow cc -R.
	* rcsfnms.c: Fix troff macro comment leader bug; add Prolog.
	* rcskeep.c: Speed up by making FILE *fp local, not global.
	* rcsrev.c, All files above: Remove lint.

Tue Jul 29 12:17:25 1986  Guy Harris  <guy@sun.com>

	* maketime.c: More "lint" cleanups.

Mon Jul 28 23:34:14 1986  Guy Harris  <guy@sun.com>

	* Makefile: Netnews fixes from guy@sun
	* sccstorcs.c, rlog.c, rcsutil.c, rcssyn.c, rcsrev.c, rcsmerge.c,
	rcslex.c, rcskeep.c, rcsgen.c, rcsfnms.c, rcsfcmp.c, rcsedit.c,
	rcsdiff.c, rcsbase.h, rcs.c, ident.c, co.c, ci.c: More "lint" cleanups.

Thu Jul  3 13:09:55 1986  jdl  <jdl@cs.purdue.edu>

	* rcsclean.sh: New file.

Wed Jun 18 15:02:32 1986  Jay Lepreau  <lepreau@cs.purdue.edu>

	* rcsdiff.c: I broke -c<number> in last rev.
	Also, mixing a bopt with an otheropt was broken.

Mon May 19 02:36:16 1986  Jay Lepreau  <lepreau@cs.purdue.edu>

	* rcsdiff.c: Pass on new diff options, and allow them to be clustered.

Thu May 15 02:25:37 1986  Jay Lepreau  <lepreau@cs.purdue.edu>

	* Makefile: 4.3BSD revision
	* rcsedit.c: Use "Locked" instead of state in $Head expansion if locked.
	* rcsfnms.c: add suffix .el for gnulisp
	* rcsgen.c: Fix immediate EOF from non-tty files:
	avoid 0377's in description.

Tue Dec 17 13:59:09 1985  albitz  <albitz@cs.purdue.edu>

	* rcs.c: Changed setstate to rcs_setstate
	because of conflict with random.o.

Wed Jun 26 07:34:28 1985  svb  <svb@cs.purdue.edu>

	* rcsfnms.c: Comment leader '% ' for '*.tex' files added.

Wed Oct 17 21:12:11 1984  Admin  <root@cs.purdue.edu>

	* sccstorcs.c:  Added check for having multiple deltas in a row
	for the same revision.  --ks

Tue Dec 20 16:04:20 1983  Walter F. Tichy  <wft@purdue>

	* rcsbase.h: Increased logsize, added macro SMALLOG.
	moved setting of STRICT_LOCKING to Makefile.
	changed DOLLAR to UNKN (conflict with KDELIM).

Thu Dec 15 12:28:54 1983  Walter F. Tichy  <wft@purdue>

	* ci.c, co.c: ci -u and ci -l now set mode of working file properly.
	* rcs.c: rcs -u now breaks most recent lock
	if it can't find a lock by the caller.

	* rcsfnms.c: Added check for KDELIM in filenames to pairfilenames().

Mon Dec  5 13:40:54 1983  Walter F. Tichy  <wft@purdue>

	* ci.c: Merged with 3.9.1.1: added calls to clearerr(stdin).
	* ci.c, co.c, rlog.c: made rewriteflag external.

	* rcs.c: Added conditional compilation for sending mail.
	Alternatives: V4_2BSD, V6, USG, and other.

Fri Dec  2 22:47:45 1983  Walter F. Tichy  <wft@purdue>

	* rcsfnms.c: Added csh, red, and sl filename suffixes.

Wed Oct 19 04:22:11 1983  Jay Lepreau  <lepreau@purdue>

	* rcsbase.h: Make teeny logsize big
	* rcsgen.c: Added clearerr(stdin) for re-reading description from stdin.

Thu May 12 13:10:30 1983  Walter F. Tichy  <wft@purdue>

	* rcsedit.c:
	Added new markers Id and RCSfile; added locker to Header and Id.
	Overhauled expandline completely()
	(problem with $01234567890123456789@).
	Moved trymatch() and marker table to rcskeys.c.
	Log no longer expands full path of RCS file.

Wed May 11 14:24:13 1983  Walter F. Tichy  <wft@purdue>

	* rlog.c: Added -b, updated getnumericrev() accordingly.
	Replaced getpwuid() with getcaller().
	Added options -L and -R; Fixed selection bug with -l on multiple files.
	Fixed error on dates of the form -d'>date' (rewrote getdatepair()).

	* rcsedit.c: Fixed truncation problem for $19chars followed by@@.
	Added retry to expandline to resume after failed match which ended in $.

	* rcsfnms.c: Added initialization of Dbranch to InitAdmin().
	Changed pairfilenames():
	1. added copying of path from workfile to RCS file, if RCS file omitted;
	2. added getting the file status of RCS and working files;
	3. added ignoring of directories.
	Added comtable[] which pairs filename suffixes with comment leaders;
	updated InitAdmin() accordingly.

Tue May 10 17:03:06 1983  Walter F. Tichy  <wft@purdue>

	* ci.c: Added option -d and -w, and updated assignment of date, etc.
	to new delta.
	Option -k generates std. log message;
	fixed undef. pointer in reading of log.
	Replaced getlock() with findlock(),
	getpwuid() with getcaller().
	Moved all revision number generation to new routine addelta().
	Removed calls to stat(); now done by pairfilenames().
	Directed all interactive messages to stderr.
	* ci.c, co.c: Added handling of default branches.
	Replaced getpwuid() with getcaller().
	Replaced unlink()--link() with rename()
	* ci.c, co.c, rcs.c:
	Removed calls to stat(); now done by pairfilenames().
	Changed most calls to catchints() with restoreints().

	* co.c: Added option -u and -f.
	Changed and renamed rmoldfile() to rmworkfile().

	* rcs.c:
	Simplified breaklock(); added calls to findlock() and getcaller().
	Added option -b (default branch). Updated -s and -w for -b.
	Removed check for exit status of delivermail().
	Directed all interactive output to stderr.

	* ident.c: Added option -q and input from reading stdin.
	Marker matching is now done with trymatch() (independent of keywords).

	* rcsfcmp.c: Marker matching now uses trymatch().
	Marker pattern is now checked precisely.

	* rcsgen.c: Changed putamin() to abort if trying to reread redirected
	stdin.  Fixed getdesc() to output a prompt on initial newline.

	* rcskeep.c: Added new markers Id and RCSfile; extraction added.
	Marker matching with trymatch().

	* rcsutil.c: Added getcaller() and findlock().
	Changed catchints() to check SIGINT for SIG_IGN before setting up
	the signal (needed for background jobs in older shells).
	Added restoreints().
	Removed printing of full RCS path from logcommand().

Wed May  4 09:12:41 1983  Walter F. Tichy  <wft@purdue>

	* rcsbase.h: Added markers Id and RCSfile.
	Added Dbranch for default branches.

	* rcskeys.c: Initial revision

Tue May  3 22:13:19 1983  Walter F. Tichy  <wft@purdue>

	* rcsdiff.c: Added default branch, option -q, exit status like diff.
	Added fterror() to replace faterror().

Tue Apr  5 14:47:36 1983  Walter F. Tichy  <wft@purdue>

	* rcsfnms.c: fixed Suffix in InitAdmin().

Mon Mar 28 11:14:57 1983  Walter F. Tichy  <wft@purdue>

	* rcsmerge.c, rcssyn.c: Added handling of default branch.

Fri Mar 25 18:12:51 1983  Walter F. Tichy  <wft@purdue>

	* rcslex.c, rcsrev.c: Only changed $Header to $Id.

Fri Feb 18 17:37:49 1983  Walter F. Tichy  <wft@purdue>

	* ident.c: removed printing of new line after last file.

Tue Feb 15 15:41:49 1983  Walter F. Tichy  <wft@purdue>

	* ci.c, co.c, rcs.c, rcsutil.c: Added call to fastcopy()
	to copy remainder of RCS file in blocks.

Tue Jan 18 18:04:25 1983  Walter F. Tichy  <wft@purdue>

	* rcs.c: Changed sendmail(): now uses delivermail,
	and asks whether to break the lock.

Mon Jan 17 18:01:04 1983  Walter F. Tichy  <wft@purdue>

	* rcsfnms.c: Added getwd() and rename(); these can be removed by
	defining V4_2BSD, since they are not needed in 4.2 bsd.
	Changed sys/param.h to sys/types.h.

Sat Jan 15 17:46:50 1983  Walter F. Tichy  <wft@purdue>

	* rcs.c: Removed putree(); replaced with puttree() in rcssyn.c.
	Combined putdellog() and scanlogtext(); deleted putdellog().
	Cleaned up diagnostics and error messages.  Fixed problem with
	mutilated files in case of deletions in 2 files in a single command.
	Changed marking of selector from 'D' to DELETE.

	* rcsdiff.c: Expanded mainprogram to handle multiple RCS files.

	* rcsbase.h: Replaced dbm.h with BYTESIZ, fixed definition of rindex().
	Added variants of NCPFN and NCPPN for bsd 4.2,
	selected by defining V4_2BSD.  Added macro DELNUMFORM
	to have uniform format for printing delta text nodes.
	Added macro DELETE to mark deleted deltas.

	* rcssyn.c: Changed readdelta() to initialize selector and log-pointer.
	Changed puttree to check for selector==DELETE;
	putdtext() uses DELNUMFORM.

Fri Jan 14 15:37:31 1983  Walter F. Tichy  <wft@purdue>

	* ci.c, co.c, rcs.c:
	Added ignoring of interrupts while new RCS file is renamed;
	Avoids deletion of RCS files by interrupts.

Thu Jan  6 09:33:45 1983  Walter F. Tichy  <wft@purdue>

	* rcsdiff.c: Fixed passing of -c (context) option to diff.

Fri Dec 24 15:29:00 1982  Walter F. Tichy  <wft@purdue>

	* rcsdiff.c, rcsmerge.c: Added call to catchsig().
	* rlog.c: shortened output format.
	* rcskeep.c: added missing #endif.
	* rcsutil.c: added catchints(), ignoreints() for catching and ignoring
	interrupts; fixed catchsig().

Fri Dec 10 16:22:37 1982  Walter F. Tichy  <wft@purdue>

	* ci.c, rcs.c, rcsdiff.c: Corrected checking of return code from diff.
	* rcs.c: Removed unused variables,
	introduced variant COMPAT2 for skipping Suffix on -A files.
	* rcsdiff.c, rcslex.c: Improved error messages.
	* rcsmerge.c: Replaced getdelta() with gettree().
	* rcsbase.h: Added two forms of DATEFORM, one using %02d,
	the other %.2d.
	* rcslex.c: Changed exit status on error to 1.

Wed Dec  8 21:34:49 1982  Walter F. Tichy  <wft@purdue>

	* ci.c: Fixed return from addbranch().
	* ci.c, co.c, rcsutil.c, rlog.c: Using DATEFORM to format dates.

	* co.c: removed actual from call to preparejoin;
	re-fixed printing of done at the end.

	* rcs.c: Replaced getdelta() with gettree(),
	changed breaklock to update field lockedby, added some diagnostics.

	* rlog.c: removed call to checkaccesslist().
	* rlog.c, rcsfnms.c: removed unused variable.

	* rcssyn.c: renamed Commentleader to Commleader.

Sat Dec  4 13:24:08 1982  Walter F. Tichy  <wft@purdue>

	* ci.c: Updated field lockedby in removelock(),
	moved getlogmsg() before calling diff.
	* ci.c, co.c, rcsutil.c: Replaced SNOOPDIR with SNOOPFILE.
	* ci.c, co.c, rcsdiff.c, rcsrev.c, rlog.c:
	Replaced getdelta() with gettree().
	* co.c: Fixed printing of "done".
	* rcsdiff.c: Changed diagnostics.
	* ident.c, rcsbase.h: Added LOCKER.
	* rlog.c: Removed updating of field lockedby.
	* rcsbase.h: Locker, and USG (redefinition of rindex).
	* rcsedit.c: Added expansion of keyword Locker.
	* rcsfcmp.c, rcskeep.c: Initial revision
	* rcsrev.c: Replaced getdelta() with gettree().
	* rcssyn.c: Added routine gettree(),
	which updates keeplock after reading the delta tree.
	* rcsutil.c: changed addlock() to update lockedby-field.

Fri Dec  3 17:08:04 1982  Walter F. Tichy  <wft@purdue>

	* rcs.c:
	Replaced getlogin() with getpwuid(), fclose() with ffclose(),
	/usr/ucb/Mail with macro MAIL. Removed handling of Suffix (-x).
	fixed -u for missing revno.
	* rcs.c, rlog.c: Disambiguated structure members.

	* rlog.c:  Replaced getlogin with getpwuid(), %02d with %.2d,
	fancydate with PRINTDATE.  Fixed printing of nil, removed
	printing of Suffix, added shortcut if no revisions are printed.

	* rcsbase.h:
	Added dbm.h, stdio.h, RCSBASE, RCSSEP, RCSSUF, WORKMODE, TMPFILE3,
	PRINTDATE, PRINTTIME, map, and ctab; removed Suffix.
	Redefined keyvallength using NCPPN.
	Changed putc() to abort on write error.

	* rcsedit.c:  Added line number correction in case editing does
	not start at the beginning of the file.  Changed keyword
	expansion to always print a space before closing KDELIM;
	Expansion for Header shortened.

	* rcsutil.c: Added check to addlock() ensuring only one lock per person.
	Addlock also returns a pointer to the lock created.
	Deleted fancydate().

Thu Dec  2 13:27:13 1982  Walter F. Tichy  <wft@purdue>

	* ci.c: Added option -k.

Sun Nov 28 19:45:37 1982  Walter F. Tichy  <wft@purdue>

	* ci.c: Added mustcheckin() to check for redundant checkins.
	Added xpandfile() to do keyword expansion for -u and -l;
	-m appends linefeed to log message if necessary.
	getlogmsg() suppresses prompt if stdin is not a terminal.
	Replaced keeplock with lockflag.
	* ci.c, co.c:
	Replaced fclose() with ffclose(),
	%02d with %.2d, getlogin() with getpwuid().

	* co.c: Replaced mode generation for working file with WORKMODE.
	Fixed nil printing. Fixed -j combined with -l and -p, and exit
	or non-existing revisions in preparejoin().

	* ident.c: removed Suffix;
	added ungetc to avoid skipping over trailing KDELIM.

	* merge.sh: 4.3BSD revision

	* rcsmerge.c: Initial revision

	* rcsfnms.c: Changed mktempfile() to store the generated filenames.
	Changed getfullRCSname() to store the file and pathname,
	and to delete leading "../" and "./".

	* rcsgen.c: Replaced ferror() followed by fclose() with ffclose().
	Putdesc() now suppresses the prompts if stdin is not a terminal.
	A pointer to the current log message is now inserted into the
	corresponding delta, rather than leaving it in a global variable.

	* rcslex.c: Renamed ctab to map and included EOFILE;
	ctab is now a macro in rcsbase.h.
	Added fflsbuf(), fputs(), and fprintf(), which abort the RCS operations
	properly in case there is an IO-error (e.g., file system full).

	* rcsrev.c: fixed compartial() and compnum() for nil-parameters;
	fixed nils in error messages. Testprogram output shortened.

	* rcssyn.c: Reading and printing of Suffix removed;
	version COMPAT2 skips the Suffix for files of release 2 format.
	Fixed problems with printing nil.

Sat Nov 27 12:24:37 1982  Walter F. Tichy  <wft@purdue>

	* rcsutil.c:  moved rmsema(), trysema(), trydiraccess(),
	getfullRCSname() to rcsfnms.c.  Introduced macro SNOOP so that snoop
	can be placed in directory other than TARGETDIR.
	Changed %02d to %.2d for compatibility reasons.

Sun Nov 14 14:49:30 1982  Walter F. Tichy  <wft@purdue>

	* rcsedit.c:
	removed Suffix from keyword expansion. Replaced fclose with ffclose.
	keyreplace() gets log message from delta, not from curlogmsg.
	fixed expression overflow in while(c=putc(GETC....
	checked nil printing.

Fri Nov 12 14:29:40 1982  Walter F. Tichy  <wft@purdue>

	* rcsfnms.c: changed pairfilenames() to handle file.sfx,v;
	also deleted checkpathnosfx(),
	checksuffix(), checkfullpath(). Semaphore name generation updated.
	mktempfile() now checks for nil path; freefilename initialized properly.
	Added Suffix .h to InitAdmin. Added testprogram PAIRTEST.
	Moved rmsema, trysema, trydiraccess, getfullRCSname
	rom rcsutil.c to here.

Mon Oct 18 20:57:23 1982  Walter F. Tichy  <wft@purdue>

	* ci.c:
	Fixed ci -l, added ci -u (both do an implicit co after the ci).
	Changed conflicting identifiers.
	* ci.c, co.c, rcs.c: Fixed call to getlogin(), added call to
	getfullRCSname().
	* ci.c, co.c, rcs.c: An RCS file inherits its mode during the first ci
	or rcs -i from the working file, otherwise it stays the same,
	except that write permission is removed.
	* ci.c, co.c, rcs.c, rcsedit.c, rcsgen.c: Added check for write error.

	* co.c: The working file inherits its mode from the RCS file, plus
	write permission for the owner.  The write permission is not given if
	locking is strict and co does not lock.  An existing working file
	without write permission is deleted automatically.  Otherwise, co asks
	(empty answer: abort co).

	* rcs.c: I replaced curdir() with getfullRCSname(),
	cleaned up handling -U/L, and changed conflicting, long identifiers.

	* rcsdiff.c: Initial revision

	* rlog.c: call to curdir replaced with getfullRCSname(),
	fixed call to getlogin(), cosmetic changes on output,
	changed conflicting long identifiers.

	* rcsbase.h: added macro STRICT_LOCKING, removed RCSUMASK.
	renamed JOINFILE[1,2] to JOINFIL[1,2].

	* rcsedit.c: Renamed expandstring() to xpandstring().

	* rcsfnms.c: InitAdmin() now initializes StrictLocks=STRICT_LOCKING
	(def. in rcsbase.h).  renamed checkpath() to checkfullpath().

	* rcsgen.c: improved the prompt on putdesc().

	* rcsrev.c: renamed compnum->cmpnum, compnumfld->cmpnumfld,
	numericrevno->numricrevno.

	* rcssyn.c: renamed putdeltatext to putdtext.

	* rcsutil.c: added function getfullRCSname().

Wed Oct 13 16:04:59 1982  Walter F. Tichy  <wft@purdue>

	* ci.c: added include file dbm.h for getting BYTESIZ.
	This is used to check the return code from diff portably.
	* ci.c, co.c, ident.c, rcs.c, rcsedit.c, rcsgen.c, rlog.c:
	fixed type of variables receiving from getc() (char -> int).

	* co.c: removed unused variables.

	* rcsedit.c: made keyword expansion loop in expandline()
	portable to machines without sign-extension.

	* rcsutil.c: Cleanup message is now suppressed in quiet mode.

Mon Oct 11 19:41:17 1982  Walter F. Tichy  <wft@purdue>

	* rcsbase.h: removed NBPW, NBPC, NCPW.
	added typdef int void to aid compiling

	* rcslex.c: removed unused label out:;
	* rcslex.c, rcssyn.c:
	made sure all calls to getc() return into an integer, not a char.

	* rcsrev.c: changed expandsym() to check for source==nil;
	returns zero length string in that case.

Thu May  6 11:38:00 1982  Walter F. Tichy  <wft@purdue>

	* maketime.c, partime.c: Initial revision


Copyright (C) 2010-2020 Thien-Thi Nguyen

Copying and distribution of this file, with or without modification,
are permitted provided the copyright notice and this notice are preserved.
